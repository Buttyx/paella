From 388f9973672ececa4d487390e52c4b061891af7e Mon Sep 17 00:00:00 2001
From: Sergio Peiro <serpeilop@gmail.com>
Date: Wed, 23 Oct 2013 11:58:56 +0200
Subject: [PATCH 1/6] New plugins added: captions, break, social, fullscreen

---
 extended_debug.html           |    5 +-
 plugins/break.css             |   10 ++
 plugins/break.js              |  204 +++++++++++++++++++++++++++++++++++++++++
 plugins/caption_editor.css    |   10 ++
 plugins/caption_editor.js     |  196 +++++++++++++++++++++++++++++++++++++++
 plugins/comments.css          |   27 ++++++
 plugins/comments.js           |   55 +++++++++++
 plugins/description.js        |   28 ++++++
 plugins/extended_profiles.css |    4 +
 plugins/extended_profiles.js  |   79 +++++++++++++++-
 plugins/facebook_button.png   |  Bin 0 -> 2281 bytes
 plugins/fullscreen_button.png |  Bin 0 -> 2714 bytes
 plugins/fullscreenbutton.css  |   12 +++
 plugins/fullscreenbutton.js   |   64 +++++++++++++
 plugins/pluginloading.gif     |  Bin 0 -> 404 bytes
 plugins/social.css            |   42 +++++++++
 plugins/social.js             |   59 ++++++++++++
 plugins/social_button.png     |  Bin 0 -> 5161 bytes
 plugins/twitter_button.png    |  Bin 0 -> 2677 bytes
 src/00_base.js                |    8 +-
 20 files changed, 794 insertions(+), 9 deletions(-)
 create mode 100644 plugins/break.css
 create mode 100644 plugins/break.js
 create mode 100644 plugins/caption_editor.css
 create mode 100644 plugins/caption_editor.js
 create mode 100644 plugins/comments.css
 create mode 100644 plugins/comments.js
 create mode 100644 plugins/description.css
 create mode 100644 plugins/description.js
 create mode 100644 plugins/facebook_button.png
 create mode 100644 plugins/fullscreen_button.png
 create mode 100644 plugins/fullscreenbutton.css
 create mode 100644 plugins/fullscreenbutton.js
 create mode 100644 plugins/pluginloading.gif
 create mode 100644 plugins/social.css
 create mode 100644 plugins/social.js
 create mode 100644 plugins/social_button.png
 create mode 100644 plugins/twitter_button.png

diff --git a/extended_debug.html b/extended_debug.html
index d3a0945..fd2adea 100644
--- a/extended_debug.html
+++ b/extended_debug.html
@@ -49,7 +49,7 @@
 		
 		paella.plugins.myRightBarPlugin = new paella.plugins.MyRightBarPlugin();
 		
-		paella.plugins.MyTabBarPlugin = Class.create(paella.TabBarPlugin,{
+		/*paella.plugins.MyTabBarPlugin = Class.create(paella.TabBarPlugin,{
 			getSubclass:function() { return "test"; },
 			getTabName:function() { return "Test"; },
 			getName:function() { return "es.upv.paella.test.MyTabBarPlugin"; },
@@ -81,7 +81,6 @@
 			getSubclass:function() { return "test"; },
 			getTabName:function() { return "Test 2"; },
 			getName:function() { return "es.upv.paella.test.MyTabBarPlugin2"; },
-			
 			domElement:null,
 			
 			buildContent:function(domElement) {
@@ -102,7 +101,7 @@
 			}
 		});
 		
-		paella.plugins.myTabBarPlugin2 = new paella.plugins.MyTabBarPlugin2();
+		paella.plugins.myTabBarPlugin2 = new paella.plugins.MyTabBarPlugin2();*/
 		
 		</script>
 	</head>
diff --git a/plugins/break.css b/plugins/break.css
new file mode 100644
index 0000000..b16a0da
--- /dev/null
+++ b/plugins/break.css
@@ -0,0 +1,10 @@
+.textBreak {
+	background-color: rgba(128,128,128,0.7);
+	text-align: center;
+	color: white;
+	line-height: 17px;
+	font-size: 18px;
+	padding-top: 10px;
+	padding-bottom: 10px;
+	border-radius: 12px;
+}
\ No newline at end of file
diff --git a/plugins/break.js b/plugins/break.js
new file mode 100644
index 0000000..f483231
--- /dev/null
+++ b/plugins/break.js
@@ -0,0 +1,204 @@
+paella.plugins.BreaksEditorPlugin = Class.create(paella.editor.TrackPlugin,{
+	tracks:null,
+	selectedTrackItem:null,
+	
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.tracks = [];
+		paella.data.read('breaks',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.breaks && data.breaks.length>0) {
+				This.tracks = data.breaks;
+			}
+			onSuccess(true);
+		});
+	},
+
+	setup:function() {
+		if (paella.utils.language()=="es") {
+			var esDict = {
+				'Breaks':'Descansos',
+				'Break':'Descanso',
+				'Create a new break in the current position': 'Añade un descanso en el instante actual',
+				'Delete selected break': 'Borra el descanso seleccionado'
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getTrackItems:function() {
+		return this.tracks;
+	},
+	
+	getTools:function() {
+		return [
+			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new break in the current position')},
+			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected break')}
+		];
+	},
+	
+	onToolSelected:function(toolName) {
+		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
+			paella.events.trigger(paella.events.documentChanged);
+			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
+			return true;
+		}
+		else if (toolName=='create') {
+			paella.events.trigger(paella.events.documentChanged);
+			var start = paella.player.videoContainer.currentTime();
+			var end = start + 30;
+			var id = this.getTrackUniqueId();
+			var content = paella.dictionary.translate('Break');
+			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
+			return true;
+		}
+	},
+	
+	getTrackUniqueId:function() {
+		var newId = -1;
+		if (this.tracks.length==0) return 1;
+		for (var i=0;i<this.tracks.length;++i) {
+			if (newId<=this.tracks[i].id) {
+				newId = this.tracks[i].id + 1;
+			}
+		}
+		return newId;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.trackBreaks";
+	},
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Breaks");
+	},
+	
+	getColor:function() {
+		return 'rgb(226, 228, 204)';
+	},
+	
+	getTextColor:function() {
+		return 'rgb(90,90,90)';
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.s = start;
+			item.e = end;
+			this.selectedTrackItem = item;
+		}
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.content = content;
+			item.name = content;
+		}
+	},
+	
+	allowEditContent:function() {
+		return true;
+	},
+	
+	getTrackItem:function(id) {
+		for (var i=0;i<this.tracks.length;++i) {
+			if (this.tracks[i].id==id) return this.tracks[i];
+		}
+	},
+	
+	contextHelpString:function() {
+		if (paella.utils.language()=="es") {
+			return "Utiliza esta herramienta para crear, borrar y editar descansos. Para crear un descanso, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los descansos";
+		}
+		else {
+			return "Use this tool to create, delete and edit breaks. To create a break, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the break text.";
+		}
+	},
+	
+	onSave:function(success) {
+		var data = {
+			breaks:this.tracks
+		}
+		paella.data.write('breaks',{id:paella.initDelegate.getId()},data,function(response,status) {
+			paella.plugins.breaksPlayerPlugin.breaks = data.breaks;
+			success(status);
+		});
+		
+	}
+});
+
+paella.plugins.breaksEditorPlugin = new paella.plugins.BreaksEditorPlugin();
+
+
+paella.plugins.BreaksPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
+	breaks:null,
+	lastEvent:0,
+	visibleBreaks:null,
+
+	getName:function() { return "es.upv.paella.BreaksPlayerPlugin"; },
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.breaks = [];
+		this.visibleBreaks = [];
+		paella.data.read('breaks',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.breaks && data.breaks.length>0) {
+				This.breaks = data.breaks;
+			}
+			onSuccess(true);
+		});
+	},
+		
+	getEvents:function() { return [paella.events.timeUpdate]; },
+
+	onEvent:function(eventType,params) {
+		this.checkBreaks(params);
+	},
+	
+	checkBreaks:function(params) {
+		for (var i=0; i<this.breaks.length; ++i) {
+			var a = this.breaks[i];
+			
+			if (a.s<params.currentTime && a.e>params.currentTime) {
+				this.showBreaks(a);
+			} else if (a.s.toFixed(0) == params.currentTime.toFixed(0)){
+				this.avoidBreak(a);
+			}
+		}
+		
+		for (var key in this.visibleBreaks) {
+			if (typeof(a)=='object') {
+				var a = this.visibleBreaks[key];
+				if (a && (a.s>=params.currentTime || a.e<=params.currentTime)) {
+					this.removeBreak(a);
+				}
+			}
+		}
+	},
+	
+	showBreaks:function(br) {
+		if (!this.visibleBreaks[br.s]) {
+			var rect = {left:100,top:350,width:1080,height:20};
+			br.elem = paella.player.videoContainer.overlayContainer.addText(br.content,rect);
+			br.elem.className = 'textBreak';
+			this.visibleBreaks[br.s] = br;
+		}
+	},
+	
+	removeBreak:function(br) {
+		if (this.visibleBreaks[br.s]) {
+			var elem = this.visibleBreaks[br.s].elem;
+			paella.player.videoContainer.overlayContainer.removeElement(elem);
+			this.visibleBreaks[br.s] = null;
+		}
+	},
+	
+	avoidBreak:function(br){
+		var newTime = br.e; 
+		paella.events.trigger(paella.events.seekToTime,{time:newTime});
+	}
+});
+
+paella.plugins.breaksPlayerPlugin = new paella.plugins.BreaksPlayerPlugin();
diff --git a/plugins/caption_editor.css b/plugins/caption_editor.css
new file mode 100644
index 0000000..520b1b0
--- /dev/null
+++ b/plugins/caption_editor.css
@@ -0,0 +1,10 @@
+.textCaption {
+	background-color: rgba(128,128,128,0.7);
+	text-align: center;
+	color: white;
+	line-height: 17px;
+	font-size: 18px;
+	padding-top: 10px;
+	padding-bottom: 10px;
+	border-radius: 12px;
+}
\ No newline at end of file
diff --git a/plugins/caption_editor.js b/plugins/caption_editor.js
new file mode 100644
index 0000000..47407dd
--- /dev/null
+++ b/plugins/caption_editor.js
@@ -0,0 +1,196 @@
+paella.plugins.CaptionsEditorPlugin = Class.create(paella.editor.TrackPlugin,{
+	tracks:null,
+	selectedTrackItem:null,
+	
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.tracks = [];
+		paella.data.read('captions',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.captions && data.captions.length>0) {
+				This.tracks = data.captions;
+			}
+			onSuccess(true);
+		});
+	},
+
+	setup:function() {
+		if (paella.utils.language()=="es") {
+			var esDict = {
+				'Captions':'Subtítulos',
+				'Caption':'Subtítulo',
+				'Create a new caption in the current position': 'Añade un subtítulo en el instante actual',
+				'Delete selected caption': 'Borra el subtítulo seleccionado'
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getTrackItems:function() {
+		return this.tracks;
+	},
+	
+	getTools:function() {
+		return [
+			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new caption in the current position')},
+			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected caption')}
+		];
+	},
+	
+	onToolSelected:function(toolName) {
+		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
+			paella.events.trigger(paella.events.documentChanged);
+			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
+			return true;
+		}
+		else if (toolName=='create') {
+			paella.events.trigger(paella.events.documentChanged);
+			var start = paella.player.videoContainer.currentTime();
+			var end = start + 30;
+			var id = this.getTrackUniqueId();
+			var content = paella.dictionary.translate('Caption');
+			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
+			return true;
+		}
+	},
+	
+	getTrackUniqueId:function() {
+		var newId = -1;
+		if (this.tracks.length==0) return 1;
+		for (var i=0;i<this.tracks.length;++i) {
+			if (newId<=this.tracks[i].id) {
+				newId = this.tracks[i].id + 1;
+			}
+		}
+		return newId;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.trackCaptions";
+	},
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Captions");
+	},
+	
+	getColor:function() {
+		return 'rgb(159, 166, 88)';
+	},
+	
+	getTextColor:function() {
+		return 'rgb(90,90,90)';
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.s = start;
+			item.e = end;
+			this.selectedTrackItem = item;
+		}
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.content = content;
+			item.name = content;
+		}
+	},
+	
+	allowEditContent:function() {
+		return true;
+	},
+	
+	getTrackItem:function(id) {
+		for (var i=0;i<this.tracks.length;++i) {
+			if (this.tracks[i].id==id) return this.tracks[i];
+		}
+	},
+	
+	contextHelpString:function() {
+		if (paella.utils.language()=="es") {
+			return "Utiliza esta herramienta para crear, borrar y editar subtítulos. Para crear un subtítulo, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los subtítulos";
+		}
+		else {
+			return "Use this tool to create, delete and edit video captions. To create a caption, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the caption text.";
+		}
+	},
+	
+	onSave:function(success) {
+		var data = {
+			captions:this.tracks
+		}
+		paella.data.write('captions',{id:paella.initDelegate.getId()},data,function(response,status) {
+			paella.plugins.captionsPlayerlugin.captions = data.captions;
+			success(status);
+		});
+	}
+});
+
+paella.plugins.captionsEditorPlugin = new paella.plugins.CaptionsEditorPlugin();
+
+
+paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
+	captions:null,
+	lastEvent:0,
+	
+	visibleCaptions:null,
+
+	getName:function() { return "es.upv.paella.CaptionsPlayerPlugin"; },
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.captions = [];
+		this.visibleCaptions = [];
+		paella.data.read('captions',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.captions && data.captions.length>0) {
+				This.captions = data.captions;
+			}
+			onSuccess(true);
+		});
+	},
+		
+	getEvents:function() { return [paella.events.timeUpdate]; },
+
+	onEvent:function(eventType,params) {
+		this.checkCaptions(params);
+	},
+	
+	checkCaptions:function(params) {
+		for (var i=0; i<this.captions.length; ++i) {
+			var a = this.captions[i];
+			if (a.s<params.currentTime && a.e>params.currentTime) {
+				this.showCaption(a);
+			}
+		}
+		
+		for (var key in this.visibleCaptions) {
+			if (typeof(a)=='object') {
+				var a = this.visibleCaptions[key];
+				if (a && (a.s>=params.currentTime || a.e<=params.currentTime)) {
+					this.removeCaption(a);
+				}
+			}
+		}
+	},
+	
+	showCaption:function(caption) {
+		if (!this.visibleCaptions[caption.s]) {
+			var rect = {left:100,top:650,width:1080,height:20};
+			caption.elem = paella.player.videoContainer.overlayContainer.addText(caption.content,rect);
+			caption.elem.className = 'textCaption';
+			this.visibleCaptions[caption.s] = caption;
+		}
+	},
+	
+	removeCaption:function(caption) {
+		if (this.visibleCaptions[caption.s]) {
+			var elem = this.visibleCaptions[caption.s].elem;
+			paella.player.videoContainer.overlayContainer.removeElement(elem);
+			this.visibleCaptions[caption.s] = null;
+		}
+	}
+});
+
+paella.plugins.captionsPlayerlugin = new paella.plugins.CaptionsPlayerPlugin();
diff --git a/plugins/comments.css b/plugins/comments.css
new file mode 100644
index 0000000..544b124
--- /dev/null
+++ b/plugins/comments.css
@@ -0,0 +1,27 @@
+.CommentPlugin_Loading {
+    background-image: url("pluginloading.gif");
+    background-repeat: no-repeat;
+    background-position: center;
+    margin-top: 10px;
+    width: 100%;
+    height: 11px;
+    display:block;
+}
+
+.CommentPlugin_Comments {
+	/*position: absolute;
+	overflow: auto;
+	bottom: 123px;
+	top: 65px;
+	left: 10px;
+	right: 10px;*/
+	box-shadow: inset 0px 0px 10px 2px rgba(10, 10,10, 0.39);
+	border-radius: 7px;
+	padding-left: 13px;
+}
+
+/*.bottomContainer.big{
+width: 300px;
+overflow-x:auto;
+overflow-y:hidden;
+}*/
\ No newline at end of file
diff --git a/plugins/comments.js b/plugins/comments.js
new file mode 100644
index 0000000..ff2f212
--- /dev/null
+++ b/plugins/comments.js
@@ -0,0 +1,55 @@
+paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
+	id:null,
+	divRoot:null,
+	divPublishComment:null,
+	divComments:null,
+	divLoading:null,
+  
+	getSubclass:function() { return "showCommentsTabBar"; },
+	getName:function() { return "es.upv.paella.commentsPlugin"; },
+	getTabName:function() { return "Comentarios"; },
+			
+	domElement:null,
+			
+	buildContent:function(domElement) {
+		this.domElement = domElement;
+		this.loadContent();
+	},
+			
+	action:function(tab) {
+		this.loadContent();
+	},
+			
+	loadContent:function() {
+		var container = this.domElement;
+		container.innerHTML = "Loading...";
+		new paella.Timer(function(t) {
+			container.innerHTML = "Loading done";
+		},2000);
+		
+		/*var container = this.domElement;
+		
+		this.divPublishComment = document.createElement('div');
+		this.divPublishComment.className = 'CommentPlugin_Publish';
+		
+		this.divLoading = document.createElement('div');
+		this.divLoading.className = 'CommentPlugin_Loading';		
+		
+		this.divComments = document.createElement('div'); 
+		this.divComments.className = 'CommentPlugin_Comments';
+		this.divComments.innerHTML = "Texto";
+
+		
+		container.appendChild(this.divPublishComment);
+		container.appendChild(this.divLoading);
+		container.appendChild(this.divComments);*/
+		
+		
+		
+	}
+	
+});
+  
+
+paella.plugins.commentsPlugin = new paella.plugins.CommentsPlugin();
+
diff --git a/plugins/description.css b/plugins/description.css
new file mode 100644
index 0000000..e69de29
diff --git a/plugins/description.js b/plugins/description.js
new file mode 100644
index 0000000..2ba786a
--- /dev/null
+++ b/plugins/description.js
@@ -0,0 +1,28 @@
+paella.plugins.DescriptionPlugin = Class.create(paella.TabBarPlugin,{
+	getSubclass:function() { return "showDescriptionTabBar"; },
+	getName:function() { return "es.upv.paella.descriptionPlugin"; },
+	getTabName:function() { return "Descripción"; },
+			
+	domElement:null,
+			
+	buildContent:function(domElement) {
+		this.domElement = domElement;
+		this.loadContent();
+	},
+			
+	action:function(tab) {
+		this.loadContent();
+	},
+			
+	loadContent:function() {
+		var container = this.domElement;
+		container.innerHTML = "Loading...";
+		new paella.Timer(function(t) {
+			container.innerHTML = "Loading done";
+		},2000);
+	}
+	
+});
+  
+
+paella.plugins.descriptionPlugin = new paella.plugins.DescriptionPlugin();
\ No newline at end of file
diff --git a/plugins/extended_profiles.css b/plugins/extended_profiles.css
index ea5c268..2f86097 100644
--- a/plugins/extended_profiles.css
+++ b/plugins/extended_profiles.css
@@ -45,3 +45,7 @@
 .extendedProfilesItemButton.small {
 	background-image: url(extended_player_profile_small.png);
 }
+
+.extendedProfilesItemButton.fullScr {
+	background-image: url(fullscreen_button.png);
+}
diff --git a/plugins/extended_profiles.js b/plugins/extended_profiles.js
index f4db211..c84d175 100644
--- a/plugins/extended_profiles.js
+++ b/plugins/extended_profiles.js
@@ -13,7 +13,7 @@ paella.plugins.ExtendedProfilesPlugin = Class.create(paella.ButtonPlugin,{
 	buildContent:function(domElement) {
 		var thisClass = this;
 		this.buttonItems = {};
-		extendedModes = ['full','big','small'];
+		extendedModes = ['fullScr','full','big','small'];
 		for (var mode in extendedModes){
 		  var modeData = extendedModes[mode];
 		  var buttonItem = thisClass.getProfileItemButton(mode,modeData);
@@ -38,14 +38,83 @@ paella.plugins.ExtendedProfilesPlugin = Class.create(paella.ButtonPlugin,{
 	},
 	
 	onItemClick:function(button,profile,profileData) {
-	  this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
-	  this.buttonItems[profile].className = this.getButtonItemClass(profileData,true);
-	  paella.extended.setProfile(button.data.profileData);
-	  paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
+		if (profileData == "fullScr") {
+			//paella.extended.setProfile('full');
+			this.switchFullScreen(profile,profileData);
+		} else {
+			if (this.isFullscreen()) {
+				if (document.webkitCancelFullScreen) {
+					document.webkitCancelFullScreen();
+				}
+				else if (document.mozCancelFullScreen) {
+					document.mozCancelFullScreen();
+				}
+				else if (document.cancelFullScreen) {
+					document.cancelFullScreen();
+				}
+				this.buttonItems[0].className  = this.getButtonItemClass(profileData,false);
+			}
+			
+			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
+			this.buttonItems[profile].className = this.getButtonItemClass(profileData,true);
+			paella.extended.setProfile(button.data.profileData);
+	  }
+	    paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
 	},
 	
 	getButtonItemClass:function(profileName,selected) {
 		return 'extendedProfilesItemButton ' + profileName  + ((selected) ? ' selected':'');
+	},
+	
+	switchFullScreen:function(profile,profileData){
+		var fs = document.getElementById(paella.player.mainContainer.id);
+		fs.style.width = '100%';
+		fs.style.height = '100%';
+		if (this.isFullscreen()) {
+			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),true);
+			if (document.webkitCancelFullScreen) {
+				document.webkitCancelFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,false);
+			}
+			else if (document.mozCancelFullScreen) {
+				document.mozCancelFullScreen();
+				this.buttonItems[profile].className = this.getButtonItemClass(profileData,false);
+			}
+			else if (document.cancelFullScreen) {
+				document.cancelFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,false);
+			}
+		}
+		else {
+			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
+			if (fs.webkitRequestFullScreen) {
+				fs.webkitRequestFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
+				
+			}
+			else if (fs.mozRequestFullScreen){
+				fs.mozRequestFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
+			}
+			else if (fs.requestFullScreen()) {
+				fs.requestFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
+			  
+			}
+			else {
+				alert('Your browser does not support fullscreen mode');
+			}
+		}
+	},
+	
+	isFullscreen:function() {
+		if (document.webkitIsFullScreen!=undefined) {
+			return document.webkitIsFullScreen;
+		}
+		else if (document.mozFullScreen!=undefined) {
+			return document.mozFullScreen;
+		}
+		return false;
 	}
 	
 });
diff --git a/plugins/facebook_button.png b/plugins/facebook_button.png
new file mode 100644
index 0000000000000000000000000000000000000000..46028a4e952a55322997c819ccd8c6a45c927289
GIT binary patch
literal 2281
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
H#%=inM7xtJ

literal 0
HcmV?d00001

diff --git a/plugins/fullscreen_button.png b/plugins/fullscreen_button.png
new file mode 100644
index 0000000000000000000000000000000000000000..d9d29b99f9492c1d4748eb478d891ef6cdfb3857
GIT binary patch
literal 2714
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

literal 0
HcmV?d00001

diff --git a/plugins/fullscreenbutton.css b/plugins/fullscreenbutton.css
new file mode 100644
index 0000000..aa37031
--- /dev/null
+++ b/plugins/fullscreenbutton.css
@@ -0,0 +1,12 @@
+.showFullScreenButton {
+	background-image: url(fullscreen_button.png);
+	background-size: 200%;	
+}
+
+.showFullScreenButton:hover {
+	background-color: rgb(171,178,178);
+}
+
+.showFullScreenButton.active {
+	background-position:-40px 0px;
+}
\ No newline at end of file
diff --git a/plugins/fullscreenbutton.js b/plugins/fullscreenbutton.js
new file mode 100644
index 0000000..32f5945
--- /dev/null
+++ b/plugins/fullscreenbutton.js
@@ -0,0 +1,64 @@
+paella.plugins.FullScreenPlugin = Class.create(paella.ButtonPlugin, {
+	getIndex:function() { return 104; },
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showFullScreenButton"; },
+	getName:function() { return "es.upv.paella.fullScreenButtonPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(!paella.extended); },
+
+					       
+	action:function(button) {
+		var fs = document.getElementById(paella.player.mainContainer.id);
+		fs.style.width = '100%';
+		fs.style.height = '100%';
+		if (this.isFullscreen()) {
+		 
+			if (document.webkitCancelFullScreen) {
+				document.webkitCancelFullScreen();
+				button.className = this.getButtonItemClass(false);
+			}
+			else if (document.mozCancelFullScreen) {
+				document.mozCancelFullScreen();
+				button.className = this.getButtonItemClass(false);
+			}
+			else if (document.cancelFullScreen) {
+				document.cancelFullScreen();
+				button.className = this.getButtonItemClass(false);
+			}
+			
+			
+		}
+		else {
+			if (fs.webkitRequestFullScreen) {
+				fs.webkitRequestFullScreen();
+				button.className = this.getButtonItemClass(true);
+			}
+			else if (fs.mozRequestFullScreen){
+				fs.mozRequestFullScreen();
+				button.className = this.getButtonItemClass(true);
+			}
+			else if (fs.requestFullScreen()) {
+				fs.requestFullScreen();
+				button.className = this.getButtonItemClass(true);
+			}
+			else {
+				alert('Your browser does not support fullscreen mode');
+			}
+		}
+	},
+	
+	isFullscreen:function() {
+		if (document.webkitIsFullScreen!=undefined) {
+			return document.webkitIsFullScreen;
+		}
+		else if (document.mozFullScreen!=undefined) {
+			return document.mozFullScreen;
+		}
+		return false;
+	},
+	
+	getButtonItemClass:function(selected) {
+		return 'buttonPlugin '+this.getAlignment() +' '+ this.getSubclass() + ((selected) ? ' active':'');
+	}
+});
+
+paella.plugins.fullScreenPlugin = new paella.plugins.FullScreenPlugin();
diff --git a/plugins/pluginloading.gif b/plugins/pluginloading.gif
new file mode 100644
index 0000000000000000000000000000000000000000..9d67a22ab137599f4cc1f7dce547e7830aa8e284
GIT binary patch
literal 404
zcmZ?wbhEHb)Mnsj_{hNU_xZVB`KrIyR0B!H|J;7AA;Hd$0j@@R2F#2M3=E3@q@0UV
z6H8K46v{J8G87WC5-W1@6I1ju^V0Ge6o0aCasgH805Jo|Kn5nGmOhTt({A2q{(O{6
z`d--Q)2$E8+9Dzsrm5H7o3(E_Pr9z>_4ZSGzm9DFX}4p6f{~9X&=O2zY>xnqQQ%KZ
z-Z-n}_?nu}GZOE8?@5_4WB#dyUd~<xIy>02&u(1%QiX35W2%T$e#EERzEggeAI;K9
z3Oc?XyNMu&830XOIV&srPW~f)F5&H!4=a0?Tv@PU7vD1OL$7_3%{rf-JooZv(5xA2
zOwSnfxSx9YX(rIb73;8?=m7QVj48X=rRz5S+L`LJ!eqX?T%cBo`q6bOfAeiLo4s{z
m|KClIC#E>ZzI~?cRd&KvSYS_r(m4UqUrZtl4A!7<0|NjRZI|N!

literal 0
HcmV?d00001

diff --git a/plugins/social.css b/plugins/social.css
new file mode 100644
index 0000000..6a16420
--- /dev/null
+++ b/plugins/social.css
@@ -0,0 +1,42 @@
+.showSocialPluginButton {
+	background-image: url(social_button.png);
+	background-size: 200%;
+}
+
+.buttonPluginPopUp.showSocialPluginButton {
+	background-image:none;
+}
+
+.buttonPlugin.showSocialPluginButton:hover {
+	background-color: rgb(171,178,178);
+}
+
+.buttonPlugin.showSocialPluginButton.selected {
+	background-position:-40px 0px;
+}
+
+.socialItemButton {  /*crea el popup*/
+	background-repeat:no-repeat;
+	background-size: 200% auto;
+	width: 40px;
+	height: 40px;
+	cursor: pointer;
+	background-color: rgba(128,128,128,0.8);
+}
+
+.socialItemButton:hover {
+	background-color: rgba(90,90,90,0.8);
+}
+
+.socialItemButton.selected {
+	background-position:-40px 0px;
+}
+
+.socialItemButton.facebook{
+	background-image: url(facebook_button.png);
+}
+
+.socialItemButton.twitter {
+	background-image: url(twitter_button.png);
+}
+
diff --git a/plugins/social.js b/plugins/social.js
new file mode 100644
index 0000000..96f389c
--- /dev/null
+++ b/plugins/social.js
@@ -0,0 +1,59 @@
+paella.plugins.SocialPlugin = Class.create(paella.ButtonPlugin,{
+	buttonItems: null,
+	socialMedia: null,
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showSocialPluginButton"; },
+	getIndex:function() { return 103; },
+	getMinWindowSize:function() { return 300; },
+	getName:function() { return "es.upv.paella.socialPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(true); },
+	
+	getButtonType:function() { return paella.ButtonPlugin.type.popUpButton; },
+	
+	buildContent:function(domElement) {
+		var thisClass = this;
+		this.buttonItems = {};
+		socialMedia = ['facebook','twitter'];
+		for (var media in socialMedia){
+		  var mediaData = socialMedia[media];
+		  var buttonItem = thisClass.getSocialMediaItemButton(mediaData);
+		  thisClass.buttonItems[media] = buttonItem;
+		  domElement.appendChild(buttonItem);
+		}
+	},
+	
+	getSocialMediaItemButton:function(mediaData) {
+		var elem = document.createElement('div');
+		elem.className = 'socialItemButton ' + mediaData
+		elem.id = mediaData + '_button';
+		elem.data = {
+			mediaData:mediaData,
+			plugin:this
+		}
+		$(elem).click(function(event) {
+			this.data.plugin.onItemClick(this.data.mediaData);
+		});
+		return elem;
+	},
+	
+	onItemClick:function(mediaData) {
+		var url = this.getVideoUrl();
+		switch (mediaData) {
+			case ('twitter'):
+				window.open('http://twitter.com/home?status=' + url);
+				break;
+			case ('facebook'):
+				window.open('http://www.facebook.com/sharer.php?u=' + url);
+				break;  
+                }
+		paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
+	},
+	
+	getVideoUrl:function() {
+		var url = document.location.href;
+		return url;
+	}
+});
+  
+
+paella.plugins.socialPlugin = new paella.plugins.SocialPlugin();
diff --git a/plugins/social_button.png b/plugins/social_button.png
new file mode 100644
index 0000000000000000000000000000000000000000..4fab9d65426b2421f16f09cec43e91b3ec5e8782
GIT binary patch
literal 5161
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

literal 0
HcmV?d00001

diff --git a/plugins/twitter_button.png b/plugins/twitter_button.png
new file mode 100644
index 0000000000000000000000000000000000000000..c090e0f9461e6878ca5672bce46101b0b4c99d65
GIT binary patch
literal 2677
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
Jalt1l?ccz^Y2^R_

literal 0
HcmV?d00001

diff --git a/src/00_base.js b/src/00_base.js
index 115ae4e..3dd56c7 100644
--- a/src/00_base.js
+++ b/src/00_base.js
@@ -47,7 +47,13 @@ paella.pluginList = [
 	'extended_profiles.js',
 	'trimming.js',
 	'annotations.js',
-	'consolidate.js'
+	'consolidate.js',
+	'social.js',
+	'fullscreenbutton.js',
+	'caption_editor.js',
+	'break.js',
+	'comments.js',
+	'description.js'
 ];
 
 paella.events = {
-- 
1.7.9.5


From 4fb7cfe6f3037f51bf335600394f405aa91ed685 Mon Sep 17 00:00:00 2001
From: Sergio Peiro <serpeilop@gmail.com>
Date: Thu, 24 Oct 2013 14:48:24 +0200
Subject: [PATCH 2/6] Captions Toggle Button added

---
 newPlugs.patch               | 1268 ++++++++++++++++++++++++++++++++++++++++++
 plugins/caption_editor.css   |   13 +
 plugins/caption_editor.js    |   37 +-
 plugins/caption_icon.png     |  Bin 0 -> 2133 bytes
 plugins/extended_profiles.js |    2 +-
 plugins/social.css.orig      |   50 ++
 plugins/statistics_icon.png  |  Bin 0 -> 4433 bytes
 7 files changed, 1365 insertions(+), 5 deletions(-)
 create mode 100644 newPlugs.patch
 create mode 100644 plugins/caption_icon.png
 create mode 100644 plugins/social.css.orig
 create mode 100644 plugins/statistics_icon.png

diff --git a/newPlugs.patch b/newPlugs.patch
new file mode 100644
index 0000000..1ccb808
--- /dev/null
+++ b/newPlugs.patch
@@ -0,0 +1,1268 @@
+From 388f9973672ececa4d487390e52c4b061891af7e Mon Sep 17 00:00:00 2001
+From: Sergio Peiro <serpeilop@gmail.com>
+Date: Wed, 23 Oct 2013 11:58:56 +0200
+Subject: [PATCH] New plugins added: captions, break, social, fullscreen
+
+---
+ extended_debug.html           |    5 +-
+ plugins/break.css             |   10 ++
+ plugins/break.js              |  204 +++++++++++++++++++++++++++++++++++++++++
+ plugins/caption_editor.css    |   10 ++
+ plugins/caption_editor.js     |  196 +++++++++++++++++++++++++++++++++++++++
+ plugins/comments.css          |   27 ++++++
+ plugins/comments.js           |   55 +++++++++++
+ plugins/description.js        |   28 ++++++
+ plugins/extended_profiles.css |    4 +
+ plugins/extended_profiles.js  |   79 +++++++++++++++-
+ plugins/facebook_button.png   |  Bin 0 -> 2281 bytes
+ plugins/fullscreen_button.png |  Bin 0 -> 2714 bytes
+ plugins/fullscreenbutton.css  |   12 +++
+ plugins/fullscreenbutton.js   |   64 +++++++++++++
+ plugins/pluginloading.gif     |  Bin 0 -> 404 bytes
+ plugins/social.css            |   42 +++++++++
+ plugins/social.js             |   59 ++++++++++++
+ plugins/social_button.png     |  Bin 0 -> 5161 bytes
+ plugins/twitter_button.png    |  Bin 0 -> 2677 bytes
+ src/00_base.js                |    8 +-
+ 20 files changed, 794 insertions(+), 9 deletions(-)
+ create mode 100644 plugins/break.css
+ create mode 100644 plugins/break.js
+ create mode 100644 plugins/caption_editor.css
+ create mode 100644 plugins/caption_editor.js
+ create mode 100644 plugins/comments.css
+ create mode 100644 plugins/comments.js
+ create mode 100644 plugins/description.css
+ create mode 100644 plugins/description.js
+ create mode 100644 plugins/facebook_button.png
+ create mode 100644 plugins/fullscreen_button.png
+ create mode 100644 plugins/fullscreenbutton.css
+ create mode 100644 plugins/fullscreenbutton.js
+ create mode 100644 plugins/pluginloading.gif
+ create mode 100644 plugins/social.css
+ create mode 100644 plugins/social.js
+ create mode 100644 plugins/social_button.png
+ create mode 100644 plugins/twitter_button.png
+
+diff --git a/extended_debug.html b/extended_debug.html
+index d3a0945..fd2adea 100644
+--- a/extended_debug.html
++++ b/extended_debug.html
+@@ -49,7 +49,7 @@
+ 		
+ 		paella.plugins.myRightBarPlugin = new paella.plugins.MyRightBarPlugin();
+ 		
+-		paella.plugins.MyTabBarPlugin = Class.create(paella.TabBarPlugin,{
++		/*paella.plugins.MyTabBarPlugin = Class.create(paella.TabBarPlugin,{
+ 			getSubclass:function() { return "test"; },
+ 			getTabName:function() { return "Test"; },
+ 			getName:function() { return "es.upv.paella.test.MyTabBarPlugin"; },
+@@ -81,7 +81,6 @@
+ 			getSubclass:function() { return "test"; },
+ 			getTabName:function() { return "Test 2"; },
+ 			getName:function() { return "es.upv.paella.test.MyTabBarPlugin2"; },
+-			
+ 			domElement:null,
+ 			
+ 			buildContent:function(domElement) {
+@@ -102,7 +101,7 @@
+ 			}
+ 		});
+ 		
+-		paella.plugins.myTabBarPlugin2 = new paella.plugins.MyTabBarPlugin2();
++		paella.plugins.myTabBarPlugin2 = new paella.plugins.MyTabBarPlugin2();*/
+ 		
+ 		</script>
+ 	</head>
+diff --git a/plugins/break.css b/plugins/break.css
+new file mode 100644
+index 0000000..b16a0da
+--- /dev/null
++++ b/plugins/break.css
+@@ -0,0 +1,10 @@
++.textBreak {
++	background-color: rgba(128,128,128,0.7);
++	text-align: center;
++	color: white;
++	line-height: 17px;
++	font-size: 18px;
++	padding-top: 10px;
++	padding-bottom: 10px;
++	border-radius: 12px;
++}
+\ No newline at end of file
+diff --git a/plugins/break.js b/plugins/break.js
+new file mode 100644
+index 0000000..f483231
+--- /dev/null
++++ b/plugins/break.js
+@@ -0,0 +1,204 @@
++paella.plugins.BreaksEditorPlugin = Class.create(paella.editor.TrackPlugin,{
++	tracks:null,
++	selectedTrackItem:null,
++	
++	checkEnabled:function(onSuccess) {
++		var This = this;
++		this.tracks = [];
++		paella.data.read('breaks',{id:paella.initDelegate.getId()},function(data,status) {
++			if (data && typeof(data)=='object' && data.breaks && data.breaks.length>0) {
++				This.tracks = data.breaks;
++			}
++			onSuccess(true);
++		});
++	},
++
++	setup:function() {
++		if (paella.utils.language()=="es") {
++			var esDict = {
++				'Breaks':'Descansos',
++				'Break':'Descanso',
++				'Create a new break in the current position': 'Añade un descanso en el instante actual',
++				'Delete selected break': 'Borra el descanso seleccionado'
++			};
++			paella.dictionary.addDictionary(esDict);
++		}
++	},
++
++	getTrackItems:function() {
++		return this.tracks;
++	},
++	
++	getTools:function() {
++		return [
++			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new break in the current position')},
++			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected break')}
++		];
++	},
++	
++	onToolSelected:function(toolName) {
++		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
++			paella.events.trigger(paella.events.documentChanged);
++			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
++			return true;
++		}
++		else if (toolName=='create') {
++			paella.events.trigger(paella.events.documentChanged);
++			var start = paella.player.videoContainer.currentTime();
++			var end = start + 30;
++			var id = this.getTrackUniqueId();
++			var content = paella.dictionary.translate('Break');
++			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
++			return true;
++		}
++	},
++	
++	getTrackUniqueId:function() {
++		var newId = -1;
++		if (this.tracks.length==0) return 1;
++		for (var i=0;i<this.tracks.length;++i) {
++			if (newId<=this.tracks[i].id) {
++				newId = this.tracks[i].id + 1;
++			}
++		}
++		return newId;
++	},
++	
++	getName:function() {
++		return "es.upv.paella.editor.trackBreaks";
++	},
++	
++	getTrackName:function() {
++		return paella.dictionary.translate("Breaks");
++	},
++	
++	getColor:function() {
++		return 'rgb(226, 228, 204)';
++	},
++	
++	getTextColor:function() {
++		return 'rgb(90,90,90)';
++	},
++	
++	onTrackChanged:function(id,start,end) {
++		paella.events.trigger(paella.events.documentChanged);
++		var item = this.getTrackItem(id);
++		if (item) {
++			item.s = start;
++			item.e = end;
++			this.selectedTrackItem = item;
++		}
++	},
++	
++	onTrackContentChanged:function(id,content) {
++		paella.events.trigger(paella.events.documentChanged);
++		var item = this.getTrackItem(id);
++		if (item) {
++			item.content = content;
++			item.name = content;
++		}
++	},
++	
++	allowEditContent:function() {
++		return true;
++	},
++	
++	getTrackItem:function(id) {
++		for (var i=0;i<this.tracks.length;++i) {
++			if (this.tracks[i].id==id) return this.tracks[i];
++		}
++	},
++	
++	contextHelpString:function() {
++		if (paella.utils.language()=="es") {
++			return "Utiliza esta herramienta para crear, borrar y editar descansos. Para crear un descanso, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los descansos";
++		}
++		else {
++			return "Use this tool to create, delete and edit breaks. To create a break, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the break text.";
++		}
++	},
++	
++	onSave:function(success) {
++		var data = {
++			breaks:this.tracks
++		}
++		paella.data.write('breaks',{id:paella.initDelegate.getId()},data,function(response,status) {
++			paella.plugins.breaksPlayerPlugin.breaks = data.breaks;
++			success(status);
++		});
++		
++	}
++});
++
++paella.plugins.breaksEditorPlugin = new paella.plugins.BreaksEditorPlugin();
++
++
++paella.plugins.BreaksPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
++	breaks:null,
++	lastEvent:0,
++	visibleBreaks:null,
++
++	getName:function() { return "es.upv.paella.BreaksPlayerPlugin"; },
++	checkEnabled:function(onSuccess) {
++		var This = this;
++		this.breaks = [];
++		this.visibleBreaks = [];
++		paella.data.read('breaks',{id:paella.initDelegate.getId()},function(data,status) {
++			if (data && typeof(data)=='object' && data.breaks && data.breaks.length>0) {
++				This.breaks = data.breaks;
++			}
++			onSuccess(true);
++		});
++	},
++		
++	getEvents:function() { return [paella.events.timeUpdate]; },
++
++	onEvent:function(eventType,params) {
++		this.checkBreaks(params);
++	},
++	
++	checkBreaks:function(params) {
++		for (var i=0; i<this.breaks.length; ++i) {
++			var a = this.breaks[i];
++			
++			if (a.s<params.currentTime && a.e>params.currentTime) {
++				this.showBreaks(a);
++			} else if (a.s.toFixed(0) == params.currentTime.toFixed(0)){
++				this.avoidBreak(a);
++			}
++		}
++		
++		for (var key in this.visibleBreaks) {
++			if (typeof(a)=='object') {
++				var a = this.visibleBreaks[key];
++				if (a && (a.s>=params.currentTime || a.e<=params.currentTime)) {
++					this.removeBreak(a);
++				}
++			}
++		}
++	},
++	
++	showBreaks:function(br) {
++		if (!this.visibleBreaks[br.s]) {
++			var rect = {left:100,top:350,width:1080,height:20};
++			br.elem = paella.player.videoContainer.overlayContainer.addText(br.content,rect);
++			br.elem.className = 'textBreak';
++			this.visibleBreaks[br.s] = br;
++		}
++	},
++	
++	removeBreak:function(br) {
++		if (this.visibleBreaks[br.s]) {
++			var elem = this.visibleBreaks[br.s].elem;
++			paella.player.videoContainer.overlayContainer.removeElement(elem);
++			this.visibleBreaks[br.s] = null;
++		}
++	},
++	
++	avoidBreak:function(br){
++		var newTime = br.e; 
++		paella.events.trigger(paella.events.seekToTime,{time:newTime});
++	}
++});
++
++paella.plugins.breaksPlayerPlugin = new paella.plugins.BreaksPlayerPlugin();
+diff --git a/plugins/caption_editor.css b/plugins/caption_editor.css
+new file mode 100644
+index 0000000..520b1b0
+--- /dev/null
++++ b/plugins/caption_editor.css
+@@ -0,0 +1,10 @@
++.textCaption {
++	background-color: rgba(128,128,128,0.7);
++	text-align: center;
++	color: white;
++	line-height: 17px;
++	font-size: 18px;
++	padding-top: 10px;
++	padding-bottom: 10px;
++	border-radius: 12px;
++}
+\ No newline at end of file
+diff --git a/plugins/caption_editor.js b/plugins/caption_editor.js
+new file mode 100644
+index 0000000..47407dd
+--- /dev/null
++++ b/plugins/caption_editor.js
+@@ -0,0 +1,196 @@
++paella.plugins.CaptionsEditorPlugin = Class.create(paella.editor.TrackPlugin,{
++	tracks:null,
++	selectedTrackItem:null,
++	
++	checkEnabled:function(onSuccess) {
++		var This = this;
++		this.tracks = [];
++		paella.data.read('captions',{id:paella.initDelegate.getId()},function(data,status) {
++			if (data && typeof(data)=='object' && data.captions && data.captions.length>0) {
++				This.tracks = data.captions;
++			}
++			onSuccess(true);
++		});
++	},
++
++	setup:function() {
++		if (paella.utils.language()=="es") {
++			var esDict = {
++				'Captions':'Subtítulos',
++				'Caption':'Subtítulo',
++				'Create a new caption in the current position': 'Añade un subtítulo en el instante actual',
++				'Delete selected caption': 'Borra el subtítulo seleccionado'
++			};
++			paella.dictionary.addDictionary(esDict);
++		}
++	},
++
++	getTrackItems:function() {
++		return this.tracks;
++	},
++	
++	getTools:function() {
++		return [
++			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new caption in the current position')},
++			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected caption')}
++		];
++	},
++	
++	onToolSelected:function(toolName) {
++		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
++			paella.events.trigger(paella.events.documentChanged);
++			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
++			return true;
++		}
++		else if (toolName=='create') {
++			paella.events.trigger(paella.events.documentChanged);
++			var start = paella.player.videoContainer.currentTime();
++			var end = start + 30;
++			var id = this.getTrackUniqueId();
++			var content = paella.dictionary.translate('Caption');
++			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
++			return true;
++		}
++	},
++	
++	getTrackUniqueId:function() {
++		var newId = -1;
++		if (this.tracks.length==0) return 1;
++		for (var i=0;i<this.tracks.length;++i) {
++			if (newId<=this.tracks[i].id) {
++				newId = this.tracks[i].id + 1;
++			}
++		}
++		return newId;
++	},
++	
++	getName:function() {
++		return "es.upv.paella.editor.trackCaptions";
++	},
++	
++	getTrackName:function() {
++		return paella.dictionary.translate("Captions");
++	},
++	
++	getColor:function() {
++		return 'rgb(159, 166, 88)';
++	},
++	
++	getTextColor:function() {
++		return 'rgb(90,90,90)';
++	},
++	
++	onTrackChanged:function(id,start,end) {
++		paella.events.trigger(paella.events.documentChanged);
++		var item = this.getTrackItem(id);
++		if (item) {
++			item.s = start;
++			item.e = end;
++			this.selectedTrackItem = item;
++		}
++	},
++	
++	onTrackContentChanged:function(id,content) {
++		paella.events.trigger(paella.events.documentChanged);
++		var item = this.getTrackItem(id);
++		if (item) {
++			item.content = content;
++			item.name = content;
++		}
++	},
++	
++	allowEditContent:function() {
++		return true;
++	},
++	
++	getTrackItem:function(id) {
++		for (var i=0;i<this.tracks.length;++i) {
++			if (this.tracks[i].id==id) return this.tracks[i];
++		}
++	},
++	
++	contextHelpString:function() {
++		if (paella.utils.language()=="es") {
++			return "Utiliza esta herramienta para crear, borrar y editar subtítulos. Para crear un subtítulo, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los subtítulos";
++		}
++		else {
++			return "Use this tool to create, delete and edit video captions. To create a caption, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the caption text.";
++		}
++	},
++	
++	onSave:function(success) {
++		var data = {
++			captions:this.tracks
++		}
++		paella.data.write('captions',{id:paella.initDelegate.getId()},data,function(response,status) {
++			paella.plugins.captionsPlayerlugin.captions = data.captions;
++			success(status);
++		});
++	}
++});
++
++paella.plugins.captionsEditorPlugin = new paella.plugins.CaptionsEditorPlugin();
++
++
++paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
++	captions:null,
++	lastEvent:0,
++	
++	visibleCaptions:null,
++
++	getName:function() { return "es.upv.paella.CaptionsPlayerPlugin"; },
++	checkEnabled:function(onSuccess) {
++		var This = this;
++		this.captions = [];
++		this.visibleCaptions = [];
++		paella.data.read('captions',{id:paella.initDelegate.getId()},function(data,status) {
++			if (data && typeof(data)=='object' && data.captions && data.captions.length>0) {
++				This.captions = data.captions;
++			}
++			onSuccess(true);
++		});
++	},
++		
++	getEvents:function() { return [paella.events.timeUpdate]; },
++
++	onEvent:function(eventType,params) {
++		this.checkCaptions(params);
++	},
++	
++	checkCaptions:function(params) {
++		for (var i=0; i<this.captions.length; ++i) {
++			var a = this.captions[i];
++			if (a.s<params.currentTime && a.e>params.currentTime) {
++				this.showCaption(a);
++			}
++		}
++		
++		for (var key in this.visibleCaptions) {
++			if (typeof(a)=='object') {
++				var a = this.visibleCaptions[key];
++				if (a && (a.s>=params.currentTime || a.e<=params.currentTime)) {
++					this.removeCaption(a);
++				}
++			}
++		}
++	},
++	
++	showCaption:function(caption) {
++		if (!this.visibleCaptions[caption.s]) {
++			var rect = {left:100,top:650,width:1080,height:20};
++			caption.elem = paella.player.videoContainer.overlayContainer.addText(caption.content,rect);
++			caption.elem.className = 'textCaption';
++			this.visibleCaptions[caption.s] = caption;
++		}
++	},
++	
++	removeCaption:function(caption) {
++		if (this.visibleCaptions[caption.s]) {
++			var elem = this.visibleCaptions[caption.s].elem;
++			paella.player.videoContainer.overlayContainer.removeElement(elem);
++			this.visibleCaptions[caption.s] = null;
++		}
++	}
++});
++
++paella.plugins.captionsPlayerlugin = new paella.plugins.CaptionsPlayerPlugin();
+diff --git a/plugins/comments.css b/plugins/comments.css
+new file mode 100644
+index 0000000..544b124
+--- /dev/null
++++ b/plugins/comments.css
+@@ -0,0 +1,27 @@
++.CommentPlugin_Loading {
++    background-image: url("pluginloading.gif");
++    background-repeat: no-repeat;
++    background-position: center;
++    margin-top: 10px;
++    width: 100%;
++    height: 11px;
++    display:block;
++}
++
++.CommentPlugin_Comments {
++	/*position: absolute;
++	overflow: auto;
++	bottom: 123px;
++	top: 65px;
++	left: 10px;
++	right: 10px;*/
++	box-shadow: inset 0px 0px 10px 2px rgba(10, 10,10, 0.39);
++	border-radius: 7px;
++	padding-left: 13px;
++}
++
++/*.bottomContainer.big{
++width: 300px;
++overflow-x:auto;
++overflow-y:hidden;
++}*/
+\ No newline at end of file
+diff --git a/plugins/comments.js b/plugins/comments.js
+new file mode 100644
+index 0000000..ff2f212
+--- /dev/null
++++ b/plugins/comments.js
+@@ -0,0 +1,55 @@
++paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
++	id:null,
++	divRoot:null,
++	divPublishComment:null,
++	divComments:null,
++	divLoading:null,
++  
++	getSubclass:function() { return "showCommentsTabBar"; },
++	getName:function() { return "es.upv.paella.commentsPlugin"; },
++	getTabName:function() { return "Comentarios"; },
++			
++	domElement:null,
++			
++	buildContent:function(domElement) {
++		this.domElement = domElement;
++		this.loadContent();
++	},
++			
++	action:function(tab) {
++		this.loadContent();
++	},
++			
++	loadContent:function() {
++		var container = this.domElement;
++		container.innerHTML = "Loading...";
++		new paella.Timer(function(t) {
++			container.innerHTML = "Loading done";
++		},2000);
++		
++		/*var container = this.domElement;
++		
++		this.divPublishComment = document.createElement('div');
++		this.divPublishComment.className = 'CommentPlugin_Publish';
++		
++		this.divLoading = document.createElement('div');
++		this.divLoading.className = 'CommentPlugin_Loading';		
++		
++		this.divComments = document.createElement('div'); 
++		this.divComments.className = 'CommentPlugin_Comments';
++		this.divComments.innerHTML = "Texto";
++
++		
++		container.appendChild(this.divPublishComment);
++		container.appendChild(this.divLoading);
++		container.appendChild(this.divComments);*/
++		
++		
++		
++	}
++	
++});
++  
++
++paella.plugins.commentsPlugin = new paella.plugins.CommentsPlugin();
++
+diff --git a/plugins/description.css b/plugins/description.css
+new file mode 100644
+index 0000000..e69de29
+diff --git a/plugins/description.js b/plugins/description.js
+new file mode 100644
+index 0000000..2ba786a
+--- /dev/null
++++ b/plugins/description.js
+@@ -0,0 +1,28 @@
++paella.plugins.DescriptionPlugin = Class.create(paella.TabBarPlugin,{
++	getSubclass:function() { return "showDescriptionTabBar"; },
++	getName:function() { return "es.upv.paella.descriptionPlugin"; },
++	getTabName:function() { return "Descripción"; },
++			
++	domElement:null,
++			
++	buildContent:function(domElement) {
++		this.domElement = domElement;
++		this.loadContent();
++	},
++			
++	action:function(tab) {
++		this.loadContent();
++	},
++			
++	loadContent:function() {
++		var container = this.domElement;
++		container.innerHTML = "Loading...";
++		new paella.Timer(function(t) {
++			container.innerHTML = "Loading done";
++		},2000);
++	}
++	
++});
++  
++
++paella.plugins.descriptionPlugin = new paella.plugins.DescriptionPlugin();
+\ No newline at end of file
+diff --git a/plugins/extended_profiles.css b/plugins/extended_profiles.css
+index ea5c268..2f86097 100644
+--- a/plugins/extended_profiles.css
++++ b/plugins/extended_profiles.css
+@@ -45,3 +45,7 @@
+ .extendedProfilesItemButton.small {
+ 	background-image: url(extended_player_profile_small.png);
+ }
++
++.extendedProfilesItemButton.fullScr {
++	background-image: url(fullscreen_button.png);
++}
+diff --git a/plugins/extended_profiles.js b/plugins/extended_profiles.js
+index f4db211..c84d175 100644
+--- a/plugins/extended_profiles.js
++++ b/plugins/extended_profiles.js
+@@ -13,7 +13,7 @@ paella.plugins.ExtendedProfilesPlugin = Class.create(paella.ButtonPlugin,{
+ 	buildContent:function(domElement) {
+ 		var thisClass = this;
+ 		this.buttonItems = {};
+-		extendedModes = ['full','big','small'];
++		extendedModes = ['fullScr','full','big','small'];
+ 		for (var mode in extendedModes){
+ 		  var modeData = extendedModes[mode];
+ 		  var buttonItem = thisClass.getProfileItemButton(mode,modeData);
+@@ -38,14 +38,83 @@ paella.plugins.ExtendedProfilesPlugin = Class.create(paella.ButtonPlugin,{
+ 	},
+ 	
+ 	onItemClick:function(button,profile,profileData) {
+-	  this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
+-	  this.buttonItems[profile].className = this.getButtonItemClass(profileData,true);
+-	  paella.extended.setProfile(button.data.profileData);
+-	  paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
++		if (profileData == "fullScr") {
++			//paella.extended.setProfile('full');
++			this.switchFullScreen(profile,profileData);
++		} else {
++			if (this.isFullscreen()) {
++				if (document.webkitCancelFullScreen) {
++					document.webkitCancelFullScreen();
++				}
++				else if (document.mozCancelFullScreen) {
++					document.mozCancelFullScreen();
++				}
++				else if (document.cancelFullScreen) {
++					document.cancelFullScreen();
++				}
++				this.buttonItems[0].className  = this.getButtonItemClass(profileData,false);
++			}
++			
++			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
++			this.buttonItems[profile].className = this.getButtonItemClass(profileData,true);
++			paella.extended.setProfile(button.data.profileData);
++	  }
++	    paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
+ 	},
+ 	
+ 	getButtonItemClass:function(profileName,selected) {
+ 		return 'extendedProfilesItemButton ' + profileName  + ((selected) ? ' selected':'');
++	},
++	
++	switchFullScreen:function(profile,profileData){
++		var fs = document.getElementById(paella.player.mainContainer.id);
++		fs.style.width = '100%';
++		fs.style.height = '100%';
++		if (this.isFullscreen()) {
++			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),true);
++			if (document.webkitCancelFullScreen) {
++				document.webkitCancelFullScreen();
++				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,false);
++			}
++			else if (document.mozCancelFullScreen) {
++				document.mozCancelFullScreen();
++				this.buttonItems[profile].className = this.getButtonItemClass(profileData,false);
++			}
++			else if (document.cancelFullScreen) {
++				document.cancelFullScreen();
++				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,false);
++			}
++		}
++		else {
++			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
++			if (fs.webkitRequestFullScreen) {
++				fs.webkitRequestFullScreen();
++				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
++				
++			}
++			else if (fs.mozRequestFullScreen){
++				fs.mozRequestFullScreen();
++				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
++			}
++			else if (fs.requestFullScreen()) {
++				fs.requestFullScreen();
++				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
++			  
++			}
++			else {
++				alert('Your browser does not support fullscreen mode');
++			}
++		}
++	},
++	
++	isFullscreen:function() {
++		if (document.webkitIsFullScreen!=undefined) {
++			return document.webkitIsFullScreen;
++		}
++		else if (document.mozFullScreen!=undefined) {
++			return document.mozFullScreen;
++		}
++		return false;
+ 	}
+ 	
+ });
+diff --git a/plugins/facebook_button.png b/plugins/facebook_button.png
+new file mode 100644
+index 0000000000000000000000000000000000000000..46028a4e952a55322997c819ccd8c6a45c927289
+GIT binary patch
+literal 2281
+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
+H#%=inM7xtJ
+
+literal 0
+HcmV?d00001
+
+diff --git a/plugins/fullscreen_button.png b/plugins/fullscreen_button.png
+new file mode 100644
+index 0000000000000000000000000000000000000000..d9d29b99f9492c1d4748eb478d891ef6cdfb3857
+GIT binary patch
+literal 2714
+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
+
+literal 0
+HcmV?d00001
+
+diff --git a/plugins/fullscreenbutton.css b/plugins/fullscreenbutton.css
+new file mode 100644
+index 0000000..aa37031
+--- /dev/null
++++ b/plugins/fullscreenbutton.css
+@@ -0,0 +1,12 @@
++.showFullScreenButton {
++	background-image: url(fullscreen_button.png);
++	background-size: 200%;	
++}
++
++.showFullScreenButton:hover {
++	background-color: rgb(171,178,178);
++}
++
++.showFullScreenButton.active {
++	background-position:-40px 0px;
++}
+\ No newline at end of file
+diff --git a/plugins/fullscreenbutton.js b/plugins/fullscreenbutton.js
+new file mode 100644
+index 0000000..32f5945
+--- /dev/null
++++ b/plugins/fullscreenbutton.js
+@@ -0,0 +1,64 @@
++paella.plugins.FullScreenPlugin = Class.create(paella.ButtonPlugin, {
++	getIndex:function() { return 104; },
++	getAlignment:function() { return 'right'; },
++	getSubclass:function() { return "showFullScreenButton"; },
++	getName:function() { return "es.upv.paella.fullScreenButtonPlugin"; },
++	checkEnabled:function(onSuccess) { onSuccess(!paella.extended); },
++
++					       
++	action:function(button) {
++		var fs = document.getElementById(paella.player.mainContainer.id);
++		fs.style.width = '100%';
++		fs.style.height = '100%';
++		if (this.isFullscreen()) {
++		 
++			if (document.webkitCancelFullScreen) {
++				document.webkitCancelFullScreen();
++				button.className = this.getButtonItemClass(false);
++			}
++			else if (document.mozCancelFullScreen) {
++				document.mozCancelFullScreen();
++				button.className = this.getButtonItemClass(false);
++			}
++			else if (document.cancelFullScreen) {
++				document.cancelFullScreen();
++				button.className = this.getButtonItemClass(false);
++			}
++			
++			
++		}
++		else {
++			if (fs.webkitRequestFullScreen) {
++				fs.webkitRequestFullScreen();
++				button.className = this.getButtonItemClass(true);
++			}
++			else if (fs.mozRequestFullScreen){
++				fs.mozRequestFullScreen();
++				button.className = this.getButtonItemClass(true);
++			}
++			else if (fs.requestFullScreen()) {
++				fs.requestFullScreen();
++				button.className = this.getButtonItemClass(true);
++			}
++			else {
++				alert('Your browser does not support fullscreen mode');
++			}
++		}
++	},
++	
++	isFullscreen:function() {
++		if (document.webkitIsFullScreen!=undefined) {
++			return document.webkitIsFullScreen;
++		}
++		else if (document.mozFullScreen!=undefined) {
++			return document.mozFullScreen;
++		}
++		return false;
++	},
++	
++	getButtonItemClass:function(selected) {
++		return 'buttonPlugin '+this.getAlignment() +' '+ this.getSubclass() + ((selected) ? ' active':'');
++	}
++});
++
++paella.plugins.fullScreenPlugin = new paella.plugins.FullScreenPlugin();
+diff --git a/plugins/pluginloading.gif b/plugins/pluginloading.gif
+new file mode 100644
+index 0000000000000000000000000000000000000000..9d67a22ab137599f4cc1f7dce547e7830aa8e284
+GIT binary patch
+literal 404
+zcmZ?wbhEHb)Mnsj_{hNU_xZVB`KrIyR0B!H|J;7AA;Hd$0j@@R2F#2M3=E3@q@0UV
+z6H8K46v{J8G87WC5-W1@6I1ju^V0Ge6o0aCasgH805Jo|Kn5nGmOhTt({A2q{(O{6
+z`d--Q)2$E8+9Dzsrm5H7o3(E_Pr9z>_4ZSGzm9DFX}4p6f{~9X&=O2zY>xnqQQ%KZ
+z-Z-n}_?nu}GZOE8?@5_4WB#dyUd~<xIy>02&u(1%QiX35W2%T$e#EERzEggeAI;K9
+z3Oc?XyNMu&830XOIV&srPW~f)F5&H!4=a0?Tv@PU7vD1OL$7_3%{rf-JooZv(5xA2
+zOwSnfxSx9YX(rIb73;8?=m7QVj48X=rRz5S+L`LJ!eqX?T%cBo`q6bOfAeiLo4s{z
+m|KClIC#E>ZzI~?cRd&KvSYS_r(m4UqUrZtl4A!7<0|NjRZI|N!
+
+literal 0
+HcmV?d00001
+
+diff --git a/plugins/social.css b/plugins/social.css
+new file mode 100644
+index 0000000..6a16420
+--- /dev/null
++++ b/plugins/social.css
+@@ -0,0 +1,42 @@
++.showSocialPluginButton {
++	background-image: url(social_button.png);
++	background-size: 200%;
++}
++
++.buttonPluginPopUp.showSocialPluginButton {
++	background-image:none;
++}
++
++.buttonPlugin.showSocialPluginButton:hover {
++	background-color: rgb(171,178,178);
++}
++
++.buttonPlugin.showSocialPluginButton.selected {
++	background-position:-40px 0px;
++}
++
++.socialItemButton {  /*crea el popup*/
++	background-repeat:no-repeat;
++	background-size: 200% auto;
++	width: 40px;
++	height: 40px;
++	cursor: pointer;
++	background-color: rgba(128,128,128,0.8);
++}
++
++.socialItemButton:hover {
++	background-color: rgba(90,90,90,0.8);
++}
++
++.socialItemButton.selected {
++	background-position:-40px 0px;
++}
++
++.socialItemButton.facebook{
++	background-image: url(facebook_button.png);
++}
++
++.socialItemButton.twitter {
++	background-image: url(twitter_button.png);
++}
++
+diff --git a/plugins/social.js b/plugins/social.js
+new file mode 100644
+index 0000000..96f389c
+--- /dev/null
++++ b/plugins/social.js
+@@ -0,0 +1,59 @@
++paella.plugins.SocialPlugin = Class.create(paella.ButtonPlugin,{
++	buttonItems: null,
++	socialMedia: null,
++	getAlignment:function() { return 'right'; },
++	getSubclass:function() { return "showSocialPluginButton"; },
++	getIndex:function() { return 103; },
++	getMinWindowSize:function() { return 300; },
++	getName:function() { return "es.upv.paella.socialPlugin"; },
++	checkEnabled:function(onSuccess) { onSuccess(true); },
++	
++	getButtonType:function() { return paella.ButtonPlugin.type.popUpButton; },
++	
++	buildContent:function(domElement) {
++		var thisClass = this;
++		this.buttonItems = {};
++		socialMedia = ['facebook','twitter'];
++		for (var media in socialMedia){
++		  var mediaData = socialMedia[media];
++		  var buttonItem = thisClass.getSocialMediaItemButton(mediaData);
++		  thisClass.buttonItems[media] = buttonItem;
++		  domElement.appendChild(buttonItem);
++		}
++	},
++	
++	getSocialMediaItemButton:function(mediaData) {
++		var elem = document.createElement('div');
++		elem.className = 'socialItemButton ' + mediaData
++		elem.id = mediaData + '_button';
++		elem.data = {
++			mediaData:mediaData,
++			plugin:this
++		}
++		$(elem).click(function(event) {
++			this.data.plugin.onItemClick(this.data.mediaData);
++		});
++		return elem;
++	},
++	
++	onItemClick:function(mediaData) {
++		var url = this.getVideoUrl();
++		switch (mediaData) {
++			case ('twitter'):
++				window.open('http://twitter.com/home?status=' + url);
++				break;
++			case ('facebook'):
++				window.open('http://www.facebook.com/sharer.php?u=' + url);
++				break;  
++                }
++		paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
++	},
++	
++	getVideoUrl:function() {
++		var url = document.location.href;
++		return url;
++	}
++});
++  
++
++paella.plugins.socialPlugin = new paella.plugins.SocialPlugin();
+diff --git a/plugins/social_button.png b/plugins/social_button.png
+new file mode 100644
+index 0000000000000000000000000000000000000000..4fab9d65426b2421f16f09cec43e91b3ec5e8782
+GIT binary patch
+literal 5161
+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
+
+literal 0
+HcmV?d00001
+
+diff --git a/plugins/twitter_button.png b/plugins/twitter_button.png
+new file mode 100644
+index 0000000000000000000000000000000000000000..c090e0f9461e6878ca5672bce46101b0b4c99d65
+GIT binary patch
+literal 2677
+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
+Jalt1l?ccz^Y2^R_
+
+literal 0
+HcmV?d00001
+
+diff --git a/src/00_base.js b/src/00_base.js
+index 115ae4e..3dd56c7 100644
+--- a/src/00_base.js
++++ b/src/00_base.js
+@@ -47,7 +47,13 @@ paella.pluginList = [
+ 	'extended_profiles.js',
+ 	'trimming.js',
+ 	'annotations.js',
+-	'consolidate.js'
++	'consolidate.js',
++	'social.js',
++	'fullscreenbutton.js',
++	'caption_editor.js',
++	'break.js',
++	'comments.js',
++	'description.js'
+ ];
+ 
+ paella.events = {
+-- 
+1.7.9.5
+
diff --git a/plugins/caption_editor.css b/plugins/caption_editor.css
index 520b1b0..8908e56 100644
--- a/plugins/caption_editor.css
+++ b/plugins/caption_editor.css
@@ -7,4 +7,17 @@
 	padding-top: 10px;
 	padding-bottom: 10px;
 	border-radius: 12px;
+}
+
+.showCaptionsPluginButton{
+	background-image: url(caption_icon.png);
+	background-size: 300%;
+}
+
+.showCaptionsPluginButton:hover {
+	background-color: rgb(171,178,178);
+}
+
+.showCaptionsPluginButton.selected {
+	background-position:-80px 0px;
 }
\ No newline at end of file
diff --git a/plugins/caption_editor.js b/plugins/caption_editor.js
index 47407dd..16376ad 100644
--- a/plugins/caption_editor.js
+++ b/plugins/caption_editor.js
@@ -135,8 +135,8 @@ paella.plugins.captionsEditorPlugin = new paella.plugins.CaptionsEditorPlugin();
 paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
 	captions:null,
 	lastEvent:0,
-	
 	visibleCaptions:null,
+	captionsEnabled:null,
 
 	getName:function() { return "es.upv.paella.CaptionsPlayerPlugin"; },
 	checkEnabled:function(onSuccess) {
@@ -160,15 +160,16 @@ paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
 	checkCaptions:function(params) {
 		for (var i=0; i<this.captions.length; ++i) {
 			var a = this.captions[i];
-			if (a.s<params.currentTime && a.e>params.currentTime) {
+			if (this.captionsEnabled && a.s<params.currentTime && a.e>params.currentTime) {
 				this.showCaption(a);
+				console.log('muestro');
 			}
 		}
 		
 		for (var key in this.visibleCaptions) {
 			if (typeof(a)=='object') {
 				var a = this.visibleCaptions[key];
-				if (a && (a.s>=params.currentTime || a.e<=params.currentTime)) {
+				if (a && (a.s>=params.currentTime || a.e<=params.currentTime || !this.captionsEnabled)) {
 					this.removeCaption(a);
 				}
 			}
@@ -177,7 +178,7 @@ paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
 	
 	showCaption:function(caption) {
 		if (!this.visibleCaptions[caption.s]) {
-			var rect = {left:100,top:650,width:1080,height:20};
+			var rect = {left:100,top:620,width:1080,height:20};
 			caption.elem = paella.player.videoContainer.overlayContainer.addText(caption.content,rect);
 			caption.elem.className = 'textCaption';
 			this.visibleCaptions[caption.s] = caption;
@@ -194,3 +195,31 @@ paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
 });
 
 paella.plugins.captionsPlayerlugin = new paella.plugins.CaptionsPlayerPlugin();
+
+paella.plugins.ActiveCaptionsPlugin = Class.create(paella.ButtonPlugin,{
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showCaptionsPluginButton"; },
+	getIndex:function() { return 105; },
+	getMinWindowSize:function() { return 300; },
+	getName:function() { return "es.upv.paella.activeCaptionsPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(true); },
+						  
+	action:function(button) {
+		if (this.activeCaptions) {
+			button.className = this.getButtonItemClass(false);
+			paella.plugins.captionsPlayerlugin.captionsEnabled = false;
+			this.activeCaptions = false;
+		} else { 
+			button.className = this.getButtonItemClass(true);
+			paella.plugins.captionsPlayerlugin.captionsEnabled = true;
+			this.activeCaptions = true;
+		}
+	},
+	
+	getButtonItemClass:function(selected) {
+		return 'buttonPlugin '+this.getAlignment() +' '+ this.getSubclass() + ((selected) ? ' selected':'');
+	}
+});
+  
+
+paella.plugins.activeCaptionsPlugin = new paella.plugins.ActiveCaptionsPlugin();
diff --git a/plugins/caption_icon.png b/plugins/caption_icon.png
new file mode 100644
index 0000000000000000000000000000000000000000..2b23a362a754609c75024d83d7a29095e069efff
GIT binary patch
literal 2133
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
KK_xF{|9=4Q(P3u*

literal 0
HcmV?d00001

diff --git a/plugins/extended_profiles.js b/plugins/extended_profiles.js
index c84d175..cf9033d 100644
--- a/plugins/extended_profiles.js
+++ b/plugins/extended_profiles.js
@@ -52,7 +52,7 @@ paella.plugins.ExtendedProfilesPlugin = Class.create(paella.ButtonPlugin,{
 				else if (document.cancelFullScreen) {
 					document.cancelFullScreen();
 				}
-				this.buttonItems[0].className  = this.getButtonItemClass(profileData,false);
+				this.buttonItems[0].className  = this.getButtonItemClass('fullScr',false);
 			}
 			
 			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
diff --git a/plugins/social.css.orig b/plugins/social.css.orig
new file mode 100644
index 0000000..fceefbc
--- /dev/null
+++ b/plugins/social.css.orig
@@ -0,0 +1,50 @@
+.showSocialPluginButton {
+	background-image: url(social_button.png);
+<<<<<<< HEAD
+	background-size: 200%;
+=======
+	background-size: 300%;
+>>>>>>> d027a965abc07db0815fd07eb2cb077852d5d4d2
+}
+
+.buttonPluginPopUp.showSocialPluginButton {
+	background-image:none;
+}
+
+.buttonPlugin.showSocialPluginButton:hover {
+	background-color: rgb(171,178,178);
+}
+
+.buttonPlugin.showSocialPluginButton.selected {
+<<<<<<< HEAD
+	background-position:-40px 0px;
+=======
+	background-position:-80px 0px;
+>>>>>>> d027a965abc07db0815fd07eb2cb077852d5d4d2
+}
+
+.socialItemButton {  /*crea el popup*/
+	background-repeat:no-repeat;
+	background-size: 200% auto;
+	width: 40px;
+	height: 40px;
+	cursor: pointer;
+	background-color: rgba(128,128,128,0.8);
+}
+
+.socialItemButton:hover {
+	background-color: rgba(90,90,90,0.8);
+}
+
+.socialItemButton.selected {
+	background-position:-40px 0px;
+}
+
+.socialItemButton.facebook{
+	background-image: url(facebook_button.png);
+}
+
+.socialItemButton.twitter {
+	background-image: url(twitter_button.png);
+}
+
diff --git a/plugins/statistics_icon.png b/plugins/statistics_icon.png
new file mode 100644
index 0000000000000000000000000000000000000000..4eaf6492311ae092dd7e1044fbd8f9c30eebfc4a
GIT binary patch
literal 4433
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

literal 0
HcmV?d00001

-- 
1.7.9.5


From a1f31ca7f767c29a5e5cda6816c6f6e04b8d32e6 Mon Sep 17 00:00:00 2001
From: Sergio Peiro <serpeilop@gmail.com>
Date: Tue, 29 Oct 2013 13:14:49 +0100
Subject: [PATCH 3/6] Comments in progress...

---
 plugins/caption_editor.js |    1 -
 plugins/comments.css      |   36 +++++++++++++---
 plugins/comments.js       |  100 +++++++++++++++++++++++++++++++++++++++------
 plugins/silhouette32.png  |  Bin 0 -> 1095 bytes
 4 files changed, 118 insertions(+), 19 deletions(-)
 create mode 100644 plugins/silhouette32.png

diff --git a/plugins/caption_editor.js b/plugins/caption_editor.js
index 16376ad..24b7601 100644
--- a/plugins/caption_editor.js
+++ b/plugins/caption_editor.js
@@ -162,7 +162,6 @@ paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
 			var a = this.captions[i];
 			if (this.captionsEnabled && a.s<params.currentTime && a.e>params.currentTime) {
 				this.showCaption(a);
-				console.log('muestro');
 			}
 		}
 		
diff --git a/plugins/comments.css b/plugins/comments.css
index 544b124..420c0e0 100644
--- a/plugins/comments.css
+++ b/plugins/comments.css
@@ -20,8 +20,34 @@
 	padding-left: 13px;
 }
 
-/*.bottomContainer.big{
-width: 300px;
-overflow-x:auto;
-overflow-y:hidden;
-}*/
\ No newline at end of file
+.comments_entry {
+	margin-top: 5px;	
+	margin-bottom: 5px;	
+}
+
+.comments_entry_silhouette {
+	margin-top:10px;
+	float:left;
+	width:7%;
+}
+
+.comments_entry_container{
+	vertical-align: top;
+	margin-left: 55px;
+	width: 90%;
+}
+
+.comments_entry_container textarea {
+	width: 95%;
+	height: 45px;
+	margin-top:10px;
+	margin-bottom: 5px;
+	color: #52575c;
+}
+
+.publish {
+	margin-bottom: 10px;
+}
+
+
+
diff --git a/plugins/comments.js b/plugins/comments.js
index ff2f212..2b79bc8 100644
--- a/plugins/comments.js
+++ b/plugins/comments.js
@@ -4,6 +4,8 @@ paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
 	divPublishComment:null,
 	divComments:null,
 	divLoading:null,
+	publishCommentTextArea:null,
+	publishCommentButtons:null,
   
 	getSubclass:function() { return "showCommentsTabBar"; },
 	getName:function() { return "es.upv.paella.commentsPlugin"; },
@@ -21,33 +23,105 @@ paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
 	},
 			
 	loadContent:function() {
-		var container = this.domElement;
-		container.innerHTML = "Loading...";
-		new paella.Timer(function(t) {
-			container.innerHTML = "Loading done";
-		},2000);
-		
-		/*var container = this.domElement;
+		this.divRoot = this.domElement;
 		
 		this.divPublishComment = document.createElement('div');
 		this.divPublishComment.className = 'CommentPlugin_Publish';
+		this.divPublishComment.id = 'CommentPlugin_Publish';
 		
 		this.divLoading = document.createElement('div');
-		this.divLoading.className = 'CommentPlugin_Loading';		
+		this.divLoading.className = 'CommentPlugin_Loading';
+		this.divLoading.id = 'CommentPlugin_Loading';	
 		
 		this.divComments = document.createElement('div'); 
 		this.divComments.className = 'CommentPlugin_Comments';
-		this.divComments.innerHTML = "Texto";
+		this.divComments.id = 'CommentPlugin_Comments';
 
+		//container.appendChild(this.divPublishComment);
+		//container.appendChild(this.divLoading);
+		this.divRoot.appendChild(this.divComments);
+	  
+		/*var container = this.domElement;
+		container.innerHTML = "Loading...";
+		new paella.Timer(function(t) {
+			container.innerHTML = "Loading done";
+		},2000);*/
 		
-		container.appendChild(this.divPublishComment);
-		container.appendChild(this.divLoading);
-		container.appendChild(this.divComments);*/
+		this.createPublishComment();
 		
+	},
+	
+	createPublishComment:function() {
 		
 		
-	}
+		var thisClass = this;
+		var rootID = this.divPublishComment.identifier+"_entry";
+		
+		this.divEntry = document.createElement('div');
+		this.divEntry.className = 'comments_entry';
+		
+		this.divComments.appendChild(this.divEntry);
+		
+		var divSil;
+		this.divSil = document.createElement('img');
+		this.divSil.className = 'comments_entry_silhouette';
+		this.divSil.src = "plugins/silhouette32.png";
+		this.divEntry.appendChild(this.divSil);
+		
+		var divTextAreaContainer;
+		this.divTextAreaContainer = document.createElement('div');
+		this.divTextAreaContainer.className = "comments_entry_container";
+		this.divEntry.appendChild(this.divTextAreaContainer);
+		//this.divTextAreaContainer.onclick = function(){thisClass.onClickTextAreaContainer(divTextAreaContainer)};
+		
+		this.publishCommentTextArea = document.createElement('textarea');
+		this.divTextAreaContainer.appendChild(this.publishCommentTextArea);
+		
+		this.publishCommentButtons = document.createElement('div');
+		this.divTextAreaContainer.className = "comments_entry_container"; 
+		this.divTextAreaContainer.appendChild(this.publishCommentButtons);
+		
+		var btnAddComment;
+		this.btnAddComment = document.createElement('button');
+		this.btnAddComment.className = "publish";
+		this.btnAddComment.onclick = function(){thisClass.addComment();};
+		this.btnAddComment.innerHTML = "Publicar";
+		
+		this.publishCommentButtons.appendChild(this.btnAddComment);
+		
+		this.divTextAreaContainer.commentsTextArea = this.publishCommentTextArea;
+		this.divTextAreaContainer.commentsBtnAddComment = this.btnAddComment;
+		this.divTextAreaContainer.commentsBtnAddCommentToInstant = this.btnAddCommentToInstant;
+	},
+		
+	addComment:function(){
+		var thisClass = this;
+		var txtValue = this.publishCommentTextArea.value;
+		txtValue = txtValue.replace(/<>/g, "< >");  //TODO: Hacer este replace bien!
+	
+		console.log('Texto: '+txtValue)
+		
+		//TODO: Guardar comentario
+	},
+	
+	addReply:function(annotationID, domNodeId){
+		var thisClass = this;
+                
+                var textArea = document.getElementById(domNodeId);
+
+		var txtValue = textArea.value;
+		txtValue = txtValue.replace(/<>/g, "< >");  //TODO: Hacer este replace bien!
+		
+		var commentValue = paella.matterhorn.me.username + "<>" + txtValue + "<>reply<>"+annotationID;
 	
+		textArea.value = "";
+		
+		var restEndpoint = paella.player.config.restServer.url + "annotation"; 		
+		new paella.Ajax(restEndpoint,{episode:paella.matterhorn.episode.id, type:"comment", in:0, out:0, value:commentValue}, function(response) {
+			thisClass.reloadComments();
+		}, thisClass.proxyUrl, thisClass.useJsonp, 'PUT'); 
+	}
+
 });
   
 
diff --git a/plugins/silhouette32.png b/plugins/silhouette32.png
new file mode 100644
index 0000000000000000000000000000000000000000..6ffe48f2ee4a41a4451c3cbb94ac1bad0714cdd4
GIT binary patch
literal 1095
zcmV-N1i1T&P)<h;3K|Lk000e1NJLTq001BW001Be0ssI2{21+{00003b3#c}2nYz<
z;ZNWI00aL?L_t(Y$F)|Aa??f>)$bQOwopiUOj|mA#F8yPC@}>W!jO`*@gsJ4Si927
z!GX3w5=+h(^xR!ZmP`!tOgpo)BdxUe?78PYR=ZyJ|JR{?=?{Tfx78et{{~>mC|+qr
z&dC70T3jC>+9ULOWN5SD8x8toG$!%0Sg=`*@i_+a;2xe!RZ*z$qRC4ZE0`EAM#4as
zZoF>i21q-hToW56yK|4%c2C;-Z+8cOxAvyy<C7nL73C_!S72b)*JYsBB7kDWX&;>S
z`E2BeBmeTq3y&w4L(C#<?@!CtI6BH|jFk+GhA5c4{&aFI<~<g4S%A66gRV29S0?}r
z2$jsSPFp<E!_Ef~6ZbZ4=g-$?eGb#Jfg7d=IAOiZE^fDYsp=_5<!9g-b^lt0S9ecF
zBE;FH#l<W~&~pNOtv;E2wapM$5s91(5QPBP?o8kZIHd0esk192tj~rbd~k4Dw0IJA
zc^P0XTHf8Z*XI|oHINR;c!~TL48{D>;oA)YfOYRmFKH`s7z(@JKM*htVVAAT0kx0)
z%jUB;g$e`X@;VF%V592YYC7HVd0zr#F#^Tl$PIpc=popQcvn6RAhOf|0uBX2W!C?c
zgj_jt!%p{I$>LG~PhZPL(BQirXmF*AAUlaa5|=ysr$v*=V~PAx6vbS*>O6n(;fQR_
zvPl3u$~fe+^<)CB6s9##uZuM@S<2vkyTg0zB63lR2ZfL~|E>GZuvt>Z^Ja2f^eI>i
z6$e&ei?V^o{)u8V-0t|uG76!Zr>{{>WuH;$hG6}<;}1P@h%yZrCCuUY{OcxDrBqdy
z{M9rr^vE3`S?t;HpCOezr3A&*u|IF^y}4Fl@t^B;w5VCC(;*>lx7hy6k4jz&e-F|5
zSIKh9i{2R>>x%#)Ewu#jHk*hOhMF^yBxC~5Evj++Msp%rs=gNA2eOSp%L<!`B5Ia3
zfhgQ+I0vsj_LaOczxGD&4coz|sQzSb0?}&>V9WPxvxK}G)Q8#47H|DN{o~bHQZVAI
z4&XHV>B$Y7fgjFcs7pf1v<hF1?hOk}GK~fT)3;h2S=x2Z;h7}45`dn}3G@SCquy;b
zIJV$!K(~z)6@9@#T8B63)J=XrG9AjcHH+<Lt3}-D&{Gkz_x7gPScuq&<Q}CZ9xs}%
zQDX=`{Ebs5rk9K^6~6d4upyXVo=>+LtQd6&8k$n6Xt{UWE|eV7snI4Wt<qMO>fI_B
zqzkBTcj&^P8oOpt;dH;b&j<WMwUMQrS9Y6p(N6!|liQK`KRtqw)F(75;x$yw_k-oC
z`B~G;#dYz}lT;4JXDB4lLqjZ^k0*3{plb8!?IG_-Z<LjMj!OxQ{|j#e3dFj$vOxd<
N002ovPDHLkV1jp&4|4zj

literal 0
HcmV?d00001

-- 
1.7.9.5


From e6c8bc891c8ddeaf1c3f37ab45c2b8ecd063bbb2 Mon Sep 17 00:00:00 2001
From: Sergio Peiro <serpeilop@gmail.com>
Date: Wed, 30 Oct 2013 10:19:00 +0100
Subject: [PATCH 4/6] Comments in progress

---
 plugins/comments.js |    3 ---
 1 file changed, 3 deletions(-)

diff --git a/plugins/comments.js b/plugins/comments.js
index 2b79bc8..0fdb8bc 100644
--- a/plugins/comments.js
+++ b/plugins/comments.js
@@ -1,5 +1,4 @@
 paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
-	id:null,
 	divRoot:null,
 	divPublishComment:null,
 	divComments:null,
@@ -52,8 +51,6 @@ paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
 	},
 	
 	createPublishComment:function() {
-		
-		
 		var thisClass = this;
 		var rootID = this.divPublishComment.identifier+"_entry";
 		
-- 
1.7.9.5


From 5d996c7a423bc2d27100b199034d3b2785a2e43a Mon Sep 17 00:00:00 2001
From: Sergio Peiro <serpeilop@gmail.com>
Date: Wed, 30 Oct 2013 10:48:44 +0100
Subject: [PATCH 5/6] Comments in progress

---
 javascript/paella_player.js      |    2 +-
 plugins/plugins.css              |  476 +++++++++++++-----------
 tmp/00_base.js                   |   98 +++++
 tmp/01_utils.js                  |  536 +++++++++++++++++++++++++++
 tmp/02_nodes.js                  |   99 +++++
 tmp/03_video_nodes.js            |  687 ++++++++++++++++++++++++++++++++++
 tmp/04_video_container.js        |  758 ++++++++++++++++++++++++++++++++++++++
 tmp/05_plugin_base.js            |  375 +++++++++++++++++++
 tmp/06_ui_controls.js            |    1 +
 tmp/07_ui_extras.js              |  321 ++++++++++++++++
 tmp/08_paella_core.js            |  312 ++++++++++++++++
 tmp/09_paella_player.js          |  283 ++++++++++++++
 tmp/10_paella_extended.js        |  269 ++++++++++++++
 tmp/11_editor_base.js            |    1 +
 tmp/12_editor_bootstrap_utils.js |   97 +++++
 tmp/13_editor_plugin_base.js     |  299 +++++++++++++++
 tmp/14_editor_ui_controls.js     |  579 +++++++++++++++++++++++++++++
 tmp/15_editor_track.js           |    1 +
 tmp/16_embed_player.js           |   58 +++
 tmp/17_paella_editor.js          |  113 ++++++
 tmp/basic_editor_plugins.js      |  293 +++++++++++++++
 tmp/break.js                     |  206 +++++++++++
 tmp/caption_editor.js            |  226 ++++++++++++
 tmp/comments.js                  |  128 +++++++
 tmp/consolidate.js               |  306 +++++++++++++++
 tmp/description.js               |   29 ++
 tmp/extended_profiles.js         |  125 +++++++
 tmp/footprints.js                |  145 ++++++++
 tmp/framecontrol.js              |  210 +++++++++++
 tmp/fullscreenbutton.js          |   66 ++++
 tmp/playbutton.js                |  152 ++++++++
 tmp/repeatbutton.js              |   16 +
 tmp/social.js                    |   61 +++
 tmp/trimming.js                  |  108 ++++++
 tmp/viewmode.js                  |   62 ++++
 35 files changed, 7279 insertions(+), 219 deletions(-)
 create mode 100644 tmp/00_base.js
 create mode 100644 tmp/01_utils.js
 create mode 100644 tmp/02_nodes.js
 create mode 100644 tmp/03_video_nodes.js
 create mode 100644 tmp/04_video_container.js
 create mode 100644 tmp/05_plugin_base.js
 create mode 100644 tmp/06_ui_controls.js
 create mode 100644 tmp/07_ui_extras.js
 create mode 100644 tmp/08_paella_core.js
 create mode 100644 tmp/09_paella_player.js
 create mode 100644 tmp/10_paella_extended.js
 create mode 100644 tmp/11_editor_base.js
 create mode 100644 tmp/12_editor_bootstrap_utils.js
 create mode 100644 tmp/13_editor_plugin_base.js
 create mode 100644 tmp/14_editor_ui_controls.js
 create mode 100644 tmp/15_editor_track.js
 create mode 100644 tmp/16_embed_player.js
 create mode 100644 tmp/17_paella_editor.js
 create mode 100644 tmp/basic_editor_plugins.js
 create mode 100644 tmp/break.js
 create mode 100644 tmp/caption_editor.js
 create mode 100644 tmp/comments.js
 create mode 100644 tmp/consolidate.js
 create mode 100644 tmp/description.js
 create mode 100644 tmp/extended_profiles.js
 create mode 100644 tmp/footprints.js
 create mode 100644 tmp/framecontrol.js
 create mode 100644 tmp/fullscreenbutton.js
 create mode 100644 tmp/playbutton.js
 create mode 100644 tmp/repeatbutton.js
 create mode 100644 tmp/social.js
 create mode 100644 tmp/trimming.js
 create mode 100644 tmp/viewmode.js

diff --git a/javascript/paella_player.js b/javascript/paella_player.js
index 56c5289..b26b81f 100644
--- a/javascript/paella_player.js
+++ b/javascript/paella_player.js
@@ -1 +1 @@
-var GlobalParams={video:{zIndex:1},background:{zIndex:0}};var paella={};paella.player=null;paella.debug={init:false,debug:false,log:function(a){if(!this.init){this.debug=/debug/.test(location.href);this.init=true}if(this.debug){console.log(a)}}};paella.pluginList=["framecontrol.js","playbutton.js","viewmode.js","basic_editor_plugins.js","repeatbutton.js","extended_profiles.js","trimming.js","annotations.js","consolidate.js","social.js","fullscreenbutton.js","caption_editor.js","break.js","comments.js","description.js","footprints.js"];paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToFrame:"paella:seektotime",seekToTime:"paella:seektotime",setTrim:"paella:settrim",showEditor:"paella:showeditor",hideEditor:"paella:hideeditor",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",trigger:function(a,b){$(document).trigger(a,b)},bind:function(a,b){$(document).bind(a,function(c,d){b(c,d)})}};paella.AsyncLoaderCallback=Class.create({name:"",prevCb:null,nextCb:null,loader:null,initialize:function(a){this.name=a},load:function(b,a){paella.debug.log("loading "+this.name);b()}});paella.AsyncLoader=Class.create({firstCb:null,lastCb:null,callbackArray:null,generatedId:0,currentCb:null,initialize:function(){this.callbackArray={};this.generatedId=0},addCallback:function(a,b){if(!b){b="callback_"+this.generatedId++}this.callbackArray[b]=a;if(!this.firstCb){this.firstCb=a;this.currentCb=a}a.prevCb=this.lastCb;if(this.lastCb){this.lastCb.nextCb=a}this.lastCb=a;a.loader=this;return a},getCallback:function(a){return this.callbackArray[a]},load:function(c,a){var b=this;if(this.currentCb){this.currentCb.load(function(){b.currentCb=b.currentCb.nextCb;b.load(c)},function(){if(typeof(onFail)=="function"){onFail()}})}else{if(typeof(c)=="function"){c()}}}});paella.JSONLoader=Class.create(paella.AsyncLoaderCallback,{params:null,type:"get",data:null,mimeType:null,statusCode:null,initialize:function(b,a){if(a){this.type=a}if(typeof(b)=="string"){this.params={url:b}}else{if(typeof(b)=="object"){this.params=b}else{this.params={}}}},getParams:function(){return this.params},load:function(c,a){var b=this;paella.ajax.send(this.type,this.getParams(),function(f,d,e){b.data=f;b.mimeType=d;b.statusCode=e;c()},function(f,e,d){b.data=f;b.mimeType=e;b.statusCode=code;onFail()})}});paella.DictionaryLoader=Class.create(paella.AsyncLoaderCallback,{dictionaryUrl:"",initialize:function(a){this.parent("dictionaryLoader");this.dictionaryUrl=a},load:function(d,a){var c=paella.utils.language();var b={};b.url=this.dictionaryUrl+"_"+c+".json";paella.ajax.get(b,function(h,g,f){if(typeof(h)=="string"){try{h=JSON.parse(h)}catch(i){a()}}paella.dictionary.addDictionary(h);d()},function(g,f,e){a()})}});paella.Dictionary=Class.create({dictionary:{},initialize:function(){},addDictionary:function(b){for(var a in b){this.dictionary[a]=b[a]}},translate:function(a){var b=this.dictionary[a];if(b){return b}else{return a}}});paella.dictionary=new paella.Dictionary();paella.ajax=base.ajax;paella.Ajax=Class.create({callback:null,initialize:function(b,e,d,g,c,f){paella.debug.log("WARNING: paella.Ajax() is deprecated, use base.ajax.get/paella.ajax.post/paella.ajax.delete/paella.ajax.put instead.");var a=this;this.callback=d;var a=this;if(!f){f="get"}if(c){jQuery.ajax({url:b,type:f,dataType:"jsonp",jsonp:"jsonp",jsonpCallback:"callback",data:e,cache:false}).always(function(h){a.callCallback(h)})}else{if(g&&g!=""){e.url=b;jQuery.ajax({url:g,type:f,data:e,cache:false}).always(function(h){a.callCallback(h)})}else{jQuery.ajax({url:b,type:f,data:e,cache:false}).always(function(h){a.callCallback(h)})}}},callCallback:function(a){if(this.callback&&a!=null){if(typeof(a)=="object"&&a.responseText){this.callback(a.responseText)}else{this.callback(a)}}else{if(this.callback){this.callback('{"result":"ok"}')}}}});paella.Timer=Timer;paella.utils={cookies:{set:function(a,b){document.cookie=a+"="+b},get:function(b){var c,a,e,d=document.cookie.split(";");for(c=0;c<d.length;c++){a=d[c].substr(0,d[c].indexOf("="));e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(e)}}}},parameters:{get:function(d){var c=location.href;var b=c.indexOf("?");b=c.indexOf(d,b)+d.length;if(c.charAt(b)=="="){var a=c.indexOf("&",b);if(a==-1){a=c.length}return c.substring(b+1,a)}return""}},require:function(b){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.getElementsByTagName("head")[0].appendChild(a)},importStylesheet:function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet");b.setAttribute("href",a);b.setAttribute("type","text/css");b.setAttribute("media","screen");document.getElementsByTagName("head")[0].appendChild(b)},Timer:Class.create({timerId:0,callback:null,params:null,jsTimerId:0,repeat:false,timeout:0,initialize:function(c,a,b){this.callback=c;this.params=b;timerManager.setupTimer(this,a)},cancel:function(){clearTimeout(this.jsTimerId)}}),timeParse:{secondsToTime:function(d){var b=~~(d/3600);if(b<10){b="0"+b}var c=~~((d%3600)/60);if(c<10){c="0"+c}var a=Math.floor(d%60);if(a<10){a="0"+a}return b+":"+c+":"+a},secondsToText:function(e){if(e<=1){return paella.dictionary.translate("1 second ago")}if(e<60){return paella.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,e)}var b=Math.round(e/60);if(b<=1){return paella.dictionary.translate("1 minute ago")}if(b<60){return paella.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,b)}var a=Math.round(e/(60*60));if(a<=1){return paella.dictionary.translate("1 hour ago")}if(a<24){return paella.dictionary.translate("{0} hours ago").replace(/\{0\}/g,a)}var c=Math.round(e/(60*60*24));if(c<=1){return paella.dictionary.translate("1 day ago")}if(c<24){return paella.dictionary.translate("{0} days ago").replace(/\{0\}/g,c)}var d=Math.round(e/(60*60*24*30));if(d<=1){return paella.dictionary.translate("1 month ago")}if(d<12){return a+paella.dictionary.translate("{0} months ago").replace(/\{0\}/g,d)}var f=Math.round(e/(60*60*24*365));if(f<=1){return paella.dictionary.translate("1 year ago")}return paella.dictionary.translate("{0} years ago").replace(/\{0\}/g,f)},matterhornTextDateToDate:function(a){var b=new Date();b.setFullYear(parseInt(a.substring(0,4),10));b.setMonth(parseInt(a.substring(5,7),10)-1);b.setDate(parseInt(a.substring(8,10),10));b.setHours(parseInt(a.substring(11,13),10));b.setMinutes(parseInt(a.substring(14,16),10));b.setSeconds(parseInt(a.substring(17,19),10));return b}},language:function(){var a=navigator.language||window.navigator.userLanguage;return a.substr(0,2).toLowerCase()},userAgent:new UserAgent()};paella.MouseManager=Class.create({targetObject:null,initialize:function(){var a=this;paella.events.bind("mouseup",function(b){a.up(b)});paella.events.bind("mousemove",function(b){a.move(b)});paella.events.bind("mouseover",function(b){a.over(b)})},down:function(a,b){this.targetObject=a;if(this.targetObject&&this.targetObject.down){this.targetObject.down(b,b.pageX,b.pageY);b.cancelBubble=true}return false},up:function(a){if(this.targetObject&&this.targetObject.up){this.targetObject.up(a,a.pageX,a.pageY);a.cancelBubble=true}this.targetObject=null;return false},out:function(a){if(this.targetObject&&this.targetObject.out){this.targetObject.out(a,a.pageX,a.pageY);a.cancelBubble=true}return false},move:function(a){if(this.targetObject&&this.targetObject.move){this.targetObject.move(a,a.pageX,a.pageY);a.cancelBubble=true}return false},over:function(a){if(this.targetObject&&this.targetObject.over){this.targetObject.over(a,a.pageX,a.pageY);a.cancelBubble=true}return false}});paella.utils.mouseManager=new paella.MouseManager();paella.ui={};paella.ui.Container=function(b){var a=document.createElement("div");if(b.id){a.id=b.id}if(b.className){a.className=b.className}if(b.style){$(a).css(b.style)}return a};paella.DataDelegate=Class.create({read:function(a,c,b){if(typeof(b)=="function"){b({},true)}},write:function(a,d,b,c){if(typeof(c)=="function"){c({},true)}},remove:function(a,c,b){if(typeof(b)=="function"){b({},true)}}});paella.dataDelegates={};paella.dataDelegates.CookieDataDelegate=Class.create(paella.DataDelegate,{initialize:function(){},serializeKey:function(a,b){if(typeof(b)=="object"){b=JSON.stringify(b)}return a+"|"+b},read:function(b,g,f){var a=this.serializeKey(b,g);var c=paella.utils.cookies.get(a);try{c=JSON.parse(c)}catch(d){}if(typeof(f)=="function"){f(c,true)}},write:function(b,e,c,d){var a=this.serializeKey(b,e);if(typeof(c)=="object"){c=JSON.stringify(c)}paella.utils.cookies.set(a,c);if(typeof(d)=="function"){d({},true)}},remove:function(b,d,c){var a=this.serializeKey(b,d);if(typeof(value)=="object"){value=JSON.stringify(value)}paella.utils.cookies.set(a,"");if(typeof(c)=="function"){c({},true)}}});paella.dataDelegates.DefaultDataDelegate=paella.dataDelegates.CookieDataDelegate;paella.Data=Class.create({enabled:false,dataDelegates:{},initialize:function(a){this.enabled=a.data.enabled;for(var b in a.data.dataDelegates){this.dataDelegates[b]=new paella.dataDelegates[a.data.dataDelegates[b]]()}if(!this.dataDelegates["default"]){this.dataDelegates["default"]=new paella.dataDelegates.DefaultDataDelegate()}},read:function(c,b,d){var a=this.getDelegate(c);a.read(c,b,d)},write:function(c,b,e,d){var a=this.getDelegate(c);a.write(c,b,e,d)},remove:function(c,b,d){var a=this.getDelegate(c);a.remove(c,b,d)},getDelegate:function(a){if(this.dataDelegates[a]){return this.dataDelegates[a]}else{return this.dataDelegates["default"]}}});paella.data=null;paella.Node=Class.create({identifier:"",nodeList:null,initialize:function(a){this.nodeList={};this.identifier=a},addTo:function(a){a.addNode(this)},addNode:function(a){this.nodeList[a.identifier]=a;return a},getNode:function(a){return this.nodeList[a]}});paella.DomNode=Class.create(paella.Node,{domElement:null,initialize:function(a,c,b){this.parent(c);this.domElement=document.createElement(a);this.domElement.id=c;if(b){$(this.domElement).css(b)}},addNode:function(a){var b=this.parent(a);this.domElement.appendChild(a.domElement);return b},onresize:function(){}});paella.Button=Class.create(paella.DomNode,{isToggle:false,initialize:function(f,c,d,e){this.isToggle=e;var b={};this.parent("div",f,b);this.domElement.className=c;if(e){var a=this;$(this.domElement).click(function(g){a.toggleIcon()})}$(this.domElement).click("click",d)},isToggled:function(){if(this.isToggle){var a=$("#"+this.identifier)[0];return/([a-zA-Z0-9_]+)_active/.test(a.className)}else{return false}},toggle:function(){this.toggleIcon()},toggleIcon:function(){var a=$("#"+this.identifier)[0];if(/([a-zA-Z0-9_]+)_active/.test(a.className)){a.className=RegExp.$1}else{a.className=a.className+"_active"}},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}});paella.Profiles={loadProfile:function(b,a){var c={url:"config/profiles/profiles.json"};paella.ajax.get(c,function(f,d,e){if(typeof(f)=="string"){f=JSON.parse(f)}a(f[b])},function(f,d,e){paella.debug.log("Error loading video profiles. Check your Paella Player configuration")})},loadProfileList:function(a){var b={url:"config/profiles/profiles.json"};paella.ajax.get(b,function(e,c,d){if(typeof(e)=="string"){e=JSON.parse(e)}a(e)},function(e,c,d){paella.debug.log("Error loading video profiles. Check your Paella Player configuration")})}};paella.RelativeVideoSize=Class.create({w:1280,h:720,proportionalHeight:function(a){return Math.floor(this.h*a/this.w)},proportionalWidth:function(a){return Math.floor(this.w*a/this.h)},percentVSize:function(a){return a*100/this.h},percentWSize:function(a){return a*100/this.w},aspectRatio:function(){return this.w/this.h}});paella.VideoElementBase=Class.create(paella.DomNode,{isReady:false,initialize:function(b,i,d,j,c,m){var k=this;var f=new paella.RelativeVideoSize();var l=f.percentVSize(j)+"%";var h=f.percentWSize(d)+"%";var e=f.percentWSize(c)+"%";var g=f.percentVSize(m)+"%";var a={top:l,left:h,width:e,height:g,position:"absolute",zIndex:GlobalParams.video.zIndex};this.parent(i,b,a);$(this.domElement).bind("canplay",function(n){k.ready=true})},isReady:function(){return this.ready},play:function(){console.log("TODO: implement play() function in your VideoElementBase subclass")},pause:function(){console.log("TODO: implement pause() function in your VideoElementBase subclass")},isPaused:function(){console.log("TODO: implement isPaused() function in your VideoElementBase subclass");return false},duration:function(){console.log("TODO: implement duration() function in your VideoElementBase subclass");return -1},setCurrentTime:function(a){console.log("TODO: implement setCurrentTime() function in your VideoElementBase subclass")},currentTime:function(){console.log("TODO: implement currentTime() function in your VideoElementBase subclass");return 0},setVolume:function(a){console.log("TODO: implement setVolume() function in your VideoElementBase subclass");return false},volume:function(){console.log("TODO: implement volume() function in your VideoElementBase subclass");return -1},setPlaybackRate:function(a){console.log("TODO: implement setPlaybackRate() function in your VideoElementBase subclass")},addSource:function(a){console.log("TODO: implement addSource() function in your VideoElementBase subclass")},setClassName:function(a){this.domElement.className=a},getDimensions:function(){return{width:this.domElement.videoWidth,height:this.domElement.videoHeight}},setRect:function(g,b){var d=new paella.RelativeVideoSize();var i=d.percentVSize(g.top)+"%";var e=d.percentWSize(g.left)+"%";var c=d.percentWSize(g.width)+"%";var f=d.percentVSize(g.height)+"%";var a={top:i,left:e,width:c,height:f,position:"absolute"};if(b){this.disableClassName();var h=this;$(this.domElement).animate(a,400,function(){h.enableClassName()});this.enableClassNameAfter(400)}else{$(this.domElement).css(a)}},disableClassName:function(){this.classNameBackup=this.domElement.className;this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(a){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",a)},setClassName:function(a){this.domElement.className=a},setVisible:function(b,a){if(b=="true"&&a){$(this.domElement).animate({opacity:1},300)}else{if(b=="true"&&!a){$(this.domElement).show()}else{if(b=="false"&&a){$(this.domElement).animate({opacity:0},300)}else{if(b=="false"&&!a){$(this.domElement).hide()}}}}},setLayer:function(a){this.domElement.style.zIndex=a}});paella.FlashVideo=Class.create(paella.VideoElementBase,{classNameBackup:"",flashVideo:null,paused:true,streamingMode:true,flashId:"",initialize:function(e,d,c,b,a){this.parent(e,"div",d,c,b,a);this.flashId=e+"Movie"},isReady:function(){return true},addParameter:function(b,a,c){var d=document.createElement("param");d.setAttribute("name",a);d.setAttribute("value",c);b.appendChild(d)},createSwf:function(b,h){var e=document.createElement("object");e.setAttribute("id",this.flashId+"IE");e.setAttribute("classid","clsid:d27cdb6e-ae6d-11cf-96b8-444553540000");e.setAttribute("codebase",'"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0"');e.setAttribute("width","100%");e.setAttribute("height","100%");this.addParameter(e,"movie",b);this.addParameter(e,"quality","high");this.addParameter(e,"bgcolor","#efefef");this.addParameter(e,"play","true");this.addParameter(e,"loop","true");this.addParameter(e,"wmode","window");this.addParameter(e,"scale","default");this.addParameter(e,"menu","true");this.addParameter(e,"devicefont","false");this.addParameter(e,"salign","");this.addParameter(e,"allowScriptAccess","sameDomain");var a=document.createElement("object");a.setAttribute("id",this.flashId);a.setAttribute("type","application/x-shockwave-flash");a.setAttribute("data",b);a.setAttribute("width","100%");a.setAttribute("height","100%");this.addParameter(a,"movie",b);this.addParameter(a,"quality","high");this.addParameter(a,"bgcolor","#efefef");this.addParameter(a,"play","true");this.addParameter(a,"loop","true");this.addParameter(a,"wmode","window");this.addParameter(a,"scale","default");this.addParameter(a,"menu","true");this.addParameter(a,"devicefont","false");this.addParameter(a,"salign","");this.addParameter(a,"allowScriptAccess","sameDomain");e.appendChild(a);var g="";var f="";for(var c in h){g+=f+c+"="+encodeURIComponent(h[c]);f="&"}this.addParameter(e,"flashvars",g);this.addParameter(a,"flashvars",g);var d=document.createElement("a");d.setAttribute("href","http://www.adobe.com/go/getflash");d.innerHTML='<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />';a.appendChild(d);return e},play:function(){if(this.flashVideo){try{this.flashVideo.play();this.paused=false;return true}catch(a){}}return false},pause:function(){if(this.flashVideo){try{this.flashVideo.pause();this.paused=true;return true}catch(a){}}return false},isPaused:function(){return this.paused},duration:function(){if(this.flashVideo){try{return this.flashVideo.duration()}catch(a){return -1}}},setCurrentTime:function(b){if(this.flashVideo){try{this.flashVideo.seekToTime(b)}catch(a){}}},currentTime:function(){if(this.flashVideo){try{return this.flashVideo.getCurrentTime()}catch(a){return 0}}return -1},setVolume:function(b){if(this.flashVideo){var a=this;try{this.flashVideo.setVolume(b);return true}catch(c){new Timer(function(e){try{a.flashVideo.setVolume(b);e.repeat=false}catch(d){paella.debug.log("Fail to set volume on "+a.identifier);e.repeat=true}},100)}}return false},volume:function(){return this.flashVideo.getVolume()},setPlaybackRate:function(a){},createSwfObject:function(c,e){var f=this.identifier;var b={wmode:"transparent"};var d=document.createElement("div");this.domElement.appendChild(d);d.id=f+"Movie";swfobject.embedSWF(c,d.id,"100%","100%","9.0.0","",e,b);var a=$("#"+d.id)[0];return a},addSourceProgresiveDownload:function(b){if(b.type=="video/mp4"){var a={};if(!/rtmp:\/\//.test(b.src)){a.url=b.src;this.flashVideo=this.createSwfObject("player.swf",a)}}else{if(b.type=="video/x-flv"){var a={};a.url=b.src;this.flashVideo=this.createSwfObject("player.swf",a)}}},addSourceStreaming:function(b){if(b.type=="video/mp4"){var a={};if(/(rtmp:\/\/[\w\d\.\-_]+[:+\d]*\/[\w\d\-_]+\/)(mp4:)([\w\d\.\/\-_]+)/i.test(b.src)){b.src=RegExp.$1+RegExp.$3}if(/(rtmp:\/\/)([\w\d\.\-_]+[:+\d]*)\/([\w\d\-_]+\/)([\w\d\.\/\-_]+)/.test(b.src)){a.connect=RegExp.$1+RegExp.$2+"/"+RegExp.$3;a.url="mp4:"+RegExp.$4}this.flashVideo=this.createSwfObject("player.swf",a)}else{if(b.type=="video/x-flv"){var a={};if(/(rtmp:\/\/)([\w\d\.\-_]+[:+\d]*)\/([\w\d\-_]+\/)([\w\d\.\/\-_]+)(\.flv)+/.test(b.src)){a.connect=RegExp.$1+RegExp.$2+"/"+RegExp.$3;a.url=RegExp.$4}this.flashVideo=this.createSwfObject("player.swf",a)}}},addSource:function(a){if(this.streamingMode){this.addSourceStreaming(a)}else{this.addSourceProgresiveDownload(a)}},getDimensions:function(){var b={width:640,height:480};try{b.width=this.flashVideo.getWidth();b.height=this.flashVideo.getHeight()}catch(a){paella.debug.log("Warning: flash video is not loaded")}return b}});paella.Html5Video=Class.create(paella.VideoElementBase,{classNameBackup:"",ready:false,initialize:function(f,e,d,c,a){this.parent(f,"video",e,d,c,a);var b=this;$(this.domElement).bind("canplay",function(g){b.ready=true})},isReady:function(){return this.ready},play:function(){if(this.domElement&&this.domElement.play){this.domElement.play()}},pause:function(){if(this.domElement&&this.domElement.pause){this.domElement.pause()}},isPaused:function(){return this.domElement.paused},duration:function(){if(this.domElement&&this.domElement.duration){return this.domElement.duration}},setCurrentTime:function(a){if(this.domElement&&this.domElement.currentTime){this.domElement.currentTime=a}},currentTime:function(){if(this.domElement&&this.domElement.currentTime){return this.domElement.currentTime}return 0},setVolume:function(a){this.domElement.volume=a;return true},volume:function(){return this.domElement.volume},setPlaybackRate:function(a){this.domElement.playbackRate=a},addSource:function(b){var c=document.createElement("source");c.src=b.src;c.type=b.type;this.domElement.appendChild(c);var a=new UserAgent();if(a.browser.IsMobileVersion){this.ready=true}},getDimensions:function(){return{width:this.domElement.videoWidth,height:this.domElement.videoHeight}},setRect:function(g,b){var d=new paella.RelativeVideoSize();var i=d.percentVSize(g.top)+"%";var e=d.percentWSize(g.left)+"%";var c=d.percentWSize(g.width)+"%";var f=d.percentVSize(g.height)+"%";var a={top:i,left:e,width:c,height:f,position:"absolute"};if(b){this.disableClassName();var h=this;$(this.domElement).animate(a,400,function(){h.enableClassName()});this.enableClassNameAfter(400)}else{$(this.domElement).css(a)}},disableClassName:function(){this.classNameBackup=this.domElement.className;this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(a){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",a)},setVisible:function(b,a){if(b=="true"&&a){$(this.domElement).animate({opacity:1},300)}else{if(b=="true"&&!a){$(this.domElement).show()}else{if(b=="false"&&a){$(this.domElement).animate({opacity:0},300)}else{if(b=="false"&&!a){$(this.domElement).hide()}}}}},setLayer:function(a){this.domElement.style.zIndex=a}});paella.SlideshowVideo=Class.create(paella.VideoElementBase,{isReady:false,img:null,_frames:null,_duration:0,_currentTime:0,_playTime:0,_lastFrame:-1,updateTimer:null,initialize:function(f,e,d,c,a){this.parent(f,"div",e,d,c,a);this.img=document.createElement("img");this.img.style.width="100%";this.img.style.height="100%";this.domElement.appendChild(this.img);var b=this;b.ready=false},isReady:function(){return this.ready},checkFrame:function(){var e=null;var d="";var c=-1;for(var a=0;a<this._frames.length;++a){var b=this._frames[a];if(this._currentTime<b.time){break}e=b.image;d="frame_"+b.time;c=b.time}if(this._lastFrame!=c){this.img.src=e;this.img.alt=d;this._lastFrame=c}},play:function(){if(!this.updateTimer){this._playTime=new Date().getTime();this.updateTimer=new Timer(function(d,c){var b=new Date().getTime();var a=Math.round((b-c.player._playTime)/1000);c.player._currentTime+=a;c.player._playTime=b;c.player.checkFrame();if(c.player_currentTime>=c.player._duration){c.player.pause()}},1000,{player:this});this.updateTimer.repeat=true}},pause:function(){if(this.updateTimer){this.updateTimer.cancel();this.updateTimer=null}},isPaused:function(){return this.updateTimer==null},duration:function(){return _duration},setCurrentTime:function(a){if(this._duration>=a){this._currentTime=a;this.checkFrame()}},currentTime:function(){return this._currentTime},setVolume:function(a){return false},volume:function(){return -1},setPlaybackRate:function(a){},addSource:function(c){this._duration=c.duration;this._currentTime=0;this.loadFrames(c.frames,c.duration);var b=new Image();var a=this;b.onload=function(d){a.ready=true;a.checkFrame()};b.src=this._frames[0].image},loadFrames:function(d,b){this._frames=[];for(var a=0;a<b;++a){var c=d["frame_"+a];if(c){this._frames.push({time:a,image:c})}}}});paella.BackgroundContainer=Class.create(paella.DomNode,{initialize:function(b,a){this.parent("img",b,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex});this.domElement.setAttribute("src",a);this.domElement.setAttribute("alt","");this.domElement.setAttribute("width","100%");this.domElement.setAttribute("height","100%")},setImage:function(a){this.domElement.setAttribute("src",a)}});paella.VideoOverlay=Class.create(paella.DomNode,{size:{w:1280,h:720},initialize:function(){var a={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10};this.parent("div","overlayContainer",a)},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerHTML=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(d,b,a){var c=document.createElement("div0");c.innerHTML=d;c.className="videoOverlayText";if(a){c.style.backgroundColor="red"}return this.addElement(c,b)},addElement:function(a,b){this.domElement.appendChild(a);a.style.position="absolute";a.style.left=this.getHSize(b.left)+"%";a.style.top=this.getVSize(b.top)+"%";a.style.width=this.getHSize(b.width)+"%";a.style.height=this.getVSize(b.height)+"%";return a},removeElement:function(a){this.domElement.removeChild(a)},getVSize:function(a){return a*100/this.size.h},getHSize:function(a){return a*100/this.size.w}});paella.VideoContainerBase=Class.create(paella.DomNode,{trimming:{enabled:false,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,initialize:function(b){var a={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"};this.parent("div",b,a)},initEvents:function(){var a=this;paella.events.bind(paella.events.play,function(b){a.play();a.startTimeupdate()});paella.events.bind(paella.events.pause,function(b){a.pause();a.stopTimeupdate()});paella.events.bind(paella.events.next,function(b){a.next();a.triggerTimeupdate()});paella.events.bind(paella.events.previous,function(b){a.previous();a.triggerTimeupdate()});paella.events.bind(paella.events.seekTo,function(b,c){a.setCurrentPercent(c.newPositionPercent);a.triggerTimeupdate()});paella.events.bind(paella.events.seekToTime,function(b,c){a.setCurrentTime(c.time);a.triggerTimeupdate()});paella.events.bind(paella.events.setPlaybackRate,function(b,c){a.setPlaybackRate(c)});paella.events.bind(paella.events.setVolume,function(b,c){a.setVolume(c)});paella.events.bind(paella.events.setTrim,function(b,c){a.setTrim})},triggerTimeupdate:function(){var a=this;paella.events.trigger(paella.events.timeupdate,{videoContainer:a,currentTime:a.currentTime()})},startTimeupdate:function(){var a=this;this.timeupdateEventTimer=new Timer(function(b){a.triggerTimeupdate()},this.timeupdateInterval);this.timeupdateEventTimer.repeat=true},stopTimeupdate:function(){this.timeupdateEventTimer.repeat=false;this.timeupdateEventTimer=null},play:function(){paella.debug.log("VideoContainerBase.play()")},pause:function(){paella.debug.log("VideoContainerBase.pause()")},trimStart:function(){return 0},trimEnd:function(){return this.duration()},trimEnabled:function(){return false},enableTrimming:function(){this.trimming.enabled=true;paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end})},disableTrimming:function(){this.trimming.enabled=false;paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end})},setTrimming:function(b,a){this.trimming.start=b;this.trimming.end=a;if(this.currentTime()<this.trimming.start){this.setCurrentTime(this.trimming.start)}if(this.currentTime()>this.trimming.end){this.setCurrentTime(this.trimming.end)}paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end})},setTrimmingStart:function(a){this.setTrimming(a,this.trimming.end)},setTrimmingEnd:function(a){this.setTrimming(this.trimming.start,a)},setCurrentPercent:function(c){var f=this.trimStart();var a=this.trimEnd();var e=a-f;var b=c*e/100;var d=parseFloat(b)+parseFloat(f);this.setCurrentTime(d)},setCurrentTime:function(a){paella.debug.log("VideoContainerBase.setCurrentTime("+a+")")},currentTime:function(){paella.debug.log("VideoContainerBase.currentTime()");return 0},duration:function(){paella.debug.log("VideoContainerBase.duration()");return 0},paused:function(){paella.debug.log("VideoContainerBase.paused()");return true},setupVideo:function(a){paella.debug.log("VideoContainerBase.setupVide()")},setPlaybackRate:function(a){paella.debug.log("VideoContainerBase.setPlaybackBase("+a.rate+")")},setVolume:function(a){paella.debug.log("VideoContainerBase.setVolume("+a.master+")")},volume:function(){paella.debug.log("VideoContainerBase.volume()");return 1},isReady:function(){paella.debug.log("VideoContainerBase.isReady()");return true},onresize:function(){this.parent(onresize)}});paella.VideoContainer=Class.create(paella.VideoContainerBase,{containerId:"",video1Id:"",video2Id:"",backgroundId:"",container:null,video1ClassName:"video masterVideo",video2ClassName:"video slaveVideo",isHidden:false,maxSyncDelay:0.5,logos:null,isMasterReady:false,isSlaveReady:false,isMonostream:false,sourceData:[],overlayContainer:null,videoSyncTimeMillis:5000,currentMasterVideoRect:{},currentSlaveVideoRect:{},initialize:function(c){this.parent(c);this.containerId=c+"_container";this.video1Id=c+"_1";this.video2Id=c+"_2";this.backgroundId=c+"_bkg";this.logos=[];this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"});this.addNode(this.container);this.overlayContainer=new paella.VideoOverlay(this.domElement);this.container.addNode(this.overlayContainer);this.container.addNode(new paella.BackgroundContainer(this.backgroundId,"config/profiles/resources/default_background_paella.jpg"));var a=this;this.initEvents();paella.events.bind(paella.events.timeupdate,function(d){a.checkVideoTrimming()});var a=this;var b=new paella.utils.Timer(function(d){a.syncVideos()},a.videoSyncTimeMillis);b.repeat=true},getMasterVideoRect:function(){return this.currentMasterVideoRect},getSlaveVideoRect:function(){return this.currentSlaveVideoRect},createVideoPlayers:function(){var b=new paella.FlashVideo(this.video1Id,850,140,360,550);b.setClassName(this.video1ClassName);this.container.addNode(b);var a=new paella.FlashVideo(this.video2Id,10,40,800,600);a.setClassName(this.video2ClassName);a.setVolume(0);this.container.addNode(a)},setHidden:function(a){this.isHidden=a},hideVideo:function(){this.setHidden(true)},publishVideo:function(){this.setHidden(false)},syncVideos:function(){var c=this.masterVideo();var b=this.slaveVideo();if(!this.isMonostream&&c&&b&&c.currentTime&&b.currentTime){var a=Math.abs(c.currentTime()-b.currentTime());if(a>this.maxSyncDelay){paella.debug.log("Sync videos performed, diff="+a);b.setCurrentTime(c.currentTime())}}},checkVideoTrimming:function(){var c=this.currentTime();var b=this.duration();var d=0;if(this.trimming.enabled){b=this.trimming.end;d=parseFloat(this.trimming.start)}if(c>=Math.floor(b)){var a=this;paella.events.trigger(paella.events.endVideo,{videoContainer:a});this.pause()}else{if(c<d){this.setCurrentTime(d+1)}}},play:function(){var b=this.masterVideo();var a=this.slaveVideo();if(b){b.play()}if(a){a.play()}},pause:function(){var b=this.masterVideo();var a=this.slaveVideo();if(b){b.pause()}if(a){a.pause()}},next:function(){if(this.trimming.end!=0){this.setCurrentTime(this.trimming.end)}else{this.setCurrentTime(this.duration(true))}},previous:function(){this.setCurrentTime(this.trimming.start)},setCurrentTime:function(a){if(this.trimming.enabled){if(a<this.trimming.start){a=this.trimming.start}if(a>this.trimming.end){a=this.trimming.end}}var c=this.masterVideo();var b=this.slaveVideo();if(c){c.setCurrentTime(a)}if(b){b.setCurrentTime(a)}},currentTime:function(){var b=this.masterVideo();var a=this.slaveVideo();if(b){return b.currentTime()}else{if(a){return a.currentTime()}else{return 0}}},setPlaybackRate:function(a){var c=this.masterVideo();var b=this.slaveVideo();if(c){c.setPlaybackRate(a.rate)}if(b){b.setPlaybackRate(a.rate)}},setVolume:function(a){var c=this.masterVideo();var b=this.slaveVideo();if(c&&a.master){c.setVolume(a.master)}else{if(c){c.setVolume(0)}}if(b&&a.slave){b.setVolume(a.slave)}else{if(b){b.setVolume(0)}}},volume:function(a){if(!a&&this.masterVideo()){return this.masterVideo().volume()}else{if(a=="master"&&this.masterVideo()){return this.masterVideo().volume()}else{if(a=="slave"&&this.slaveVideo()){return this.slaveVideo().volume()}else{return 0}}}},masterVideo:function(){return this.container.getNode(this.video1Id)},slaveVideo:function(){return this.container.getNode(this.video2Id)},duration:function(a){if(this.trimming.enabled&&!a){return this.trimming.end-this.trimming.start}else{if(!this.videoDuration){this.videoDuration=this.masterVideo().duration()}return this.videoDuration}},paused:function(){return this.masterVideo().isPaused()},trimEnabled:function(){return this.trimming.enabled},trimStart:function(){if(this.trimming.enabled){return this.trimming.start}else{return 0}},trimEnd:function(){if(this.trimming.enabled){return this.trimming.end}else{return this.duration()}},setMasterSource:function(c,b){if(b=="html"){var d=new paella.Html5Video(this.video1Id,850,140,360,550)}else{if(b=="flash"){var d=new paella.FlashVideo(this.video1Id,850,140,360,550);d.streamingMode=false}else{if(b=="streaming"){var d=new paella.FlashVideo(this.video1Id,850,140,360,550);d.streamingMode=true}else{if(b=="image"){var d=new paella.SlideshowVideo(this.video1Id,850,140,360,550)}}}}d.setClassName(this.video1ClassName);this.container.addNode(d);var a=this;this.sourceData.push(c);this.setupVideo(d,c,b);new Timer(function(e){if(d.isReady()){a.isMasterReady=true;e.repeat=false}else{e.repeat=true}},100);return true},setSlaveSource:function(b,c){if(c=="html"||!b){var d=new paella.Html5Video(this.video2Id,10,40,800,600)}else{if(c=="flash"){var d=new paella.FlashVideo(this.video2Id,10,40,800,600);d.streamingMode=false}else{if(c=="streaming"){var d=new paella.FlashVideo(this.video2Id,10,40,800,600);d.streamingMode=true}else{if(c=="image"){var d=new paella.SlideshowVideo(this.video2Id,850,140,360,550)}}}}d.setClassName(this.video2ClassName);this.container.addNode(d);if(!b){setMonoStreamMode();return false}var a=this;this.sourceData.push(b);this.setupVideo(d,b,c);new Timer(function(e){if(d.isReady()){a.isSlaveReady=true;d.setVolume(0);e.repeat=false}else{e.repeat=true}},100);return true},setMonoStreamMode:function(){this.isMonoStream=true;this.isSlaveReady=true},setupVideo:function(c,e,g){if(c&&e){var d=e.sources.mp4;var f=e.sources.ogg;var a=e.sources.webm;var i=e.sources.flv;var b=e.sources.rtmp;var h=e.sources.image;if(g=="html"){if(d){c.addSource(d)}if(f){c.addSource(f)}if(a){c.addSource(a)}}else{if(i&&g=="flash"){c.addSource(i)}else{if(d&&g=="flash"){c.addSource(d)}else{if(b&&g=="streaming"){c.addSource(b)}else{if(h&&g=="image"){c.addSource(h)}}}}}}},numberOfStreams:function(){return this.sourceData.length},getMonostreamMasterProfile:function(){return{content:"presenter",visible:true,layer:1,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720},]}},getMonostreamSlaveProfile:function(){return{content:"slides",visible:false,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0},]}},setProfile:function(b,c){var a=this;paella.Profiles.loadProfile(b,function(d){if(a.numberOfStreams()==1){d.masterVideo=a.getMonostreamMasterProfile();d.slaveVideo=a.getMonostreamSlaveProfile()}a.applyProfileWithJson(d);c(b);paella.utils.cookies.set("lastProfile",b)})},isReady:function(){return this.isMasterReady&&this.isSlaveReady},hideAllLogos:function(){for(var a=0;a<this.logos.length;++a){var b=this.logos[a];var c=this.container.getNode(b);$(c.domElement).hide()}},showLogos:function(e){var g=new paella.RelativeVideoSize();for(var f=0;f<e.length;++f){var c=e[f];var m=c.content;var b=this.container.getNode(m);var k=c.rect;if(!b){a={};b=this.container.addNode(new paella.DomNode("img",m,a));b.domElement.setAttribute("src","config/profiles/resources/"+m);b.domElement.setAttribute("src","config/profiles/resources/"+m)}else{$(b.domElement).show()}var l=g.percentVSize(k.top)+"%";var j=g.percentWSize(k.left)+"%";var d=g.percentWSize(k.width)+"%";var h=g.percentVSize(k.height)+"%";var a={top:l,left:j,width:d,height:h,position:"absolute",zIndex:c.zIndex};$(b.domElement).css(a)}},applyProfileWithJson:function(e){var t=this.container.getNode(this.video1Id);var q=this.container.getNode(this.video2Id);var r=this.container.getNode(this.backgroundId);var k=e.masterVideo.rect[0];var c=e.slaveVideo.rect[0];var m=t.getDimensions();var a={width:360,height:240};if(q){a=q.getDimensions()}var g=(m.height==0)?1.3333:m.width/m.height;var n=(a.height==0)?1.3333:a.width/a.height;var o=1.333;var f=1.333;var h=10;for(var p=0;p<e.masterVideo.rect.length;++p){var d=e.masterVideo.rect[p];if(/([0-9]+)\/([0-9]+)/.test(d.aspectRatio)){o=Number(RegExp.$1)/Number(RegExp.$2)}var l=Math.abs(o-g);if(h>l){h=l;k=d}}var b=10;for(var p=0;p<e.slaveVideo.rect.length;++p){var s=e.slaveVideo.rect[p];if(/([0-9]+)\/([0-9]+)/.test(s.aspectRatio)){f=Number(RegExp.$1)/Number(RegExp.$2)}var j=Math.abs(f-n);if(b>j){b=j;c=s}}this.hideAllLogos();this.showLogos(e.logos);t.setRect(k,true);this.currentMasterVideoRect=k;t.setVisible(e.masterVideo.visible,true);if(q){q.setRect(c,true);this.currentSlaveVideoRect=c;q.setVisible(e.slaveVideo.visible,true);q.setLayer(e.slaveVideo.layer)}t.setLayer(e.masterVideo.layer);r.setImage("config/profiles/resources/"+e.background.content)},resizePortrail:function(){var c=$(this.domElement).width();var e=new paella.RelativeVideoSize();var a=e.proportionalHeight(c);this.container.domElement.style.width=c+"px";this.container.domElement.style.height=a+"px";var d=$(this.domElement).height();var b=d/2-a/2;this.container.domElement.style.top=b+"px"},resizeLandscape:function(){var a=$(this.domElement).height();var c=new paella.RelativeVideoSize();var b=c.proportionalWidth(a);this.container.domElement.style.width=b+"px";this.container.domElement.style.height=a+"px";this.container.domElement.style.top="0px"},onresize:function(){this.parent();var e=new paella.RelativeVideoSize();var d=e.aspectRatio();var c=$(this.domElement).width();var a=$(this.domElement).height();var b=c/a;if(b>d){this.resizeLandscape()}else{this.resizePortrail()}}});paella.PluginManager=Class.create({targets:null,pluginList:new Array(),eventDrivenPlugins:new Array(),initialize:function(){this.targets={};var a=this;paella.events.bind(paella.events.loadPlugins,function(b){a.loadPlugins()})},setTarget:function(b,a){if(a.addPlugin){this.targets[b]=a}},getTarget:function(b){if(b=="eventDriven"){return this}else{var a=this.targets[b];return a}},registerPlugin:function(a){this.pluginList.push(a);this.pluginList.sort(function(d,c){return d.getIndex()-c.getIndex()})},loadPlugins:function(){for(var a=0;a<this.pluginList.length;++a){var b=this.pluginList[a];paella.debug.log("loading plugin "+b.getName());b.load(this)}},addPlugin:function(b){var a=this;b.checkEnabled(function(f){if(b.type=="eventDriven"&&f){b.setup();a.eventDrivenPlugins.push(b);var e=b.getEvents();for(var d=0;d<e.length;++d){var c=e[d];paella.events.bind(c,function(g,h){b.onEvent(g.type,h)})}}})},getPlugin:function(a){for(var b=0;b<this.pluginList.length;++b){if(this.pluginList[b].getName()==a){return this.pluginList[b]}}return null}});paella.pluginManager=new paella.PluginManager();paella.Plugin=Class.create({type:"",initialize:function(){var a=this;paella.pluginManager.registerPlugin(this)},load:function(b){var a=b.getTarget(this.type);if(a&&a.addPlugin){a.addPlugin(this)}},getRootNode:function(a){return null},checkEnabled:function(a){a(true)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}});paella.PopUpContainer=Class.create(paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(d,b){var c=this;var a={};this.parent("div",d,a);this.domElement.className=b;this.containers={};paella.events.bind(paella.events.hidePopUp,function(e,f){c.hideContainer(f.identifier,f.button)});paella.events.bind(paella.events.showPopUp,function(e,f){c.showContainer(f.identifier,f.button)})},hideContainer:function(b,c){var a=this.containers[b];if(a&&this.currentContainerId==b){a.plugin.willHideContent();$(a.element).hide();a.button.className=a.button.className.replace(" selected","");$(this.domElement).css({width:"0px"});this.currentContainerId=-1;a.plugin.didHideContent()}},showContainer:function(b,d){var a=this.containers[b];var c=$(d.parentElement).width()-$(d).position().left-$(d).width();if(a&&this.currentContainerId!=b&&this.currentContainerId!=-1){var f=this.containers[this.currentContainerId];f.plugin.willHideContent();f.button.className=f.button.className.replace(" selected","");a.button.className=a.button.className+" selected";$(f.element).hide();f.plugin.didHideContent();a.plugin.willShowContent();$(a.element).show();var e=$(a.element).width();$(this.domElement).css({width:e+"px",right:c+"px"});this.currentContainerId=b;a.plugin.didShowContent()}else{if(a&&this.currentContainerId==b){a.plugin.willHideContent();$(a.element).hide();$(this.domElement).css({width:"0px"});a.button.className=a.button.className.replace(" selected","");this.currentContainerId=-1;a.plugin.didHideContent()}else{if(a){a.button.className=a.button.className+" selected";a.plugin.willShowContent();$(a.element).show();var e=$(a.element).width();$(this.domElement).css({width:e+"px",right:c+"px"});this.currentContainerId=b;a.plugin.didShowContent()}}}},registerContainer:function(b,e,c,d){var a={button:c,element:e,plugin:d};this.containers[b]=a;$(e).hide();c.popUpIdentifier=b;c.sourcePlugin=d;$(c).click(function(f){paella.events.trigger(paella.events.showPopUp,{identifier:this.popUpIdentifier,button:this})})}});paella.TimelineContainer=Class.create(paella.PopUpContainer,{hideContainer:function(b,c){var a=this.containers[b];if(a&&this.currentContainerId==b){a.plugin.willHideContent();$(a.element).hide();a.button.className=a.button.className.replace(" selected","");this.currentContainerId=-1;$(this.domElement).css({height:"0px"});a.plugin.didHideContent()}},showContainer:function(c,d){var b=this.containers[c];if(b&&this.currentContainerId!=c&&this.currentContainerId!=-1){var e=this.containers[this.currentContainerId];e.button.className=e.button.className.replace(" selected","");b.button.className=b.button.className+" selected";e.plugin.willHideContent();$(e.element).hide();e.plugin.didHideContent();b.plugin.willShowContent();$(b.element).show();this.currentContainerId=c;var a=$(b.element).height();$(this.domElement).css({height:a+"px"});b.plugin.didShowContent()}else{if(b&&this.currentContainerId==c){b.plugin.willHideContent();$(b.element).hide();b.button.className=b.button.className.replace(" selected","");$(this.domElement).css({height:"0px"});this.currentContainerId=-1;b.plugin.didHideContent()}else{if(b){b.plugin.willShowContent();b.button.className=b.button.className+" selected";$(b.element).show();this.currentContainerId=c;var a=$(b.element).height();$(this.domElement).css({height:a+"px"});b.plugin.didShowContent()}}}}});paella.ButtonPlugin=Class.create(paella.Plugin,{type:"button",subclass:"",container:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},action:function(a){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(a){},willShowContent:function(){paella.debug.log(this.getName()+" willDisplayContent")},didShowContent:function(){paella.debug.log(this.getName()+" didDisplayContent")},willHideContent:function(){paella.debug.log(this.getName()+" willHideContent")},didHideContent:function(){paella.debug.log(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},changeSubclass:function(a){this.subclass=a;this.container.className=this.getClassName()},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){if(this.getButtonType()==paella.ButtonPlugin.type.timeLineButton){return paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass()}else{if(this.getButtonType()==paella.ButtonPlugin.type.popUpButton){return paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass()}}}});paella.ButtonPlugin.alignment={left:"left",right:"right"};paella.ButtonPlugin.kClassName="buttonPlugin";paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp";paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine";paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3};paella.ButtonPlugin.buildPluginButton=function(b,c){b.subclass=b.getSubclass();var a=document.createElement("div");a.className=b.getClassName();a.id=c;a.plugin=b;b.container=a;$(a).click(function(d){this.plugin.action(this)});return a};paella.ButtonPlugin.buildPluginPopUp=function(a,c,d){c.subclass=c.getSubclass();var b=document.createElement("div");a.appendChild(b);b.className=c.getContainerClassName();b.id=d;b.plugin=c;c.buildContent(b);return b};paella.EventDrivenPlugin=Class.create(paella.Plugin,{type:"eventDriven",initialize:function(){this.parent();var b=this.getEvents();for(var a=0;a<b.length;++a){var c=b[a];if(c==paella.events.loadStarted){this.onEvent(paella.events.loadStarted)}}},getEvents:function(){return new Array()},onEvent:function(a,b){},getName:function(){return"EventDrivenPlugin"}});paella.TimeControl=Class.create(paella.DomNode,{initialize:function(b){this.parent("div",b,{left:"0%"});this.domElement.className="timeControlOld";this.domElement.className="timeControl";var a=this;paella.events.bind(paella.events.timeupdate,function(c,d){a.onTimeUpdate(d)})},onTimeUpdate:function(a){var b=a.videoContainer;var g={start:0,end:b.duration};var f={start:b.trimStart(),end:b.trimEnd()};var d=a.currentTime-f.start;var e=f.end-f.start;var c=d*100/e;if(this.domElement.className=="timeControlOld"){this.domElement.style.left=c+"%"}this.domElement.innerHTML=this.secondsToHours(parseInt(d))},secondsToHours:function(b){var a=Math.floor(b/3600);var c=Math.floor((b-(a*3600))/60);var d=b-(a*3600)-(c*60);if(c<10){c="0"+c}if(d<10){d="0"+d}return a+":"+c+":"+d}});paella.PlaybackBar=Class.create(paella.DomNode,{playbackFullId:"",updatePlayBar:true,timeControlId:"",initialize:function(d){var c={};this.parent("div",d,c);this.domElement.className="playbackBar";this.playbackFullId=d+"_full";this.timeControlId=d+"_timeControl";var b=new paella.DomNode("div",this.playbackFullId,{width:"0%"});b.domElement.className="playbackBarFull";this.addNode(b);this.addNode(new paella.TimeControl(this.timeControlId));var a=this;paella.events.bind(paella.events.timeupdate,function(e,f){a.onTimeUpdate(f)});$(this.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(b.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(this.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(b.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(this.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)});$(b.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)})},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(a){this.playbackFull().domElement.style.width=a+"%"},isSeeking:function(){return !this.updatePlayBar},onTimeUpdate:function(a){if(this.updatePlayBar){var b=a.videoContainer;var f={start:0,end:b.duration};var e={start:b.trimStart(),end:b.trimEnd()};var c=a.currentTime-e.start;var d=e.end-e.start;this.setPlaybackPosition(c*100/d)}},down:function(b,a,c){this.updatePlayBar=false;this.move(b,a,c)},move:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}this.setPlaybackPosition(b)},up:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}paella.events.trigger(paella.events.seekTo,{newPositionPercent:b});this.updatePlayBar=true}});paella.PlaybackControl=Class.create(paella.DomNode,{playbackBarId:"",pluginsContainer:null,popUpPluginContainer:null,timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(c){var a=this;var d="buttonPlugin"+this.buttonPlugins.length;var b=paella.ButtonPlugin.buildPluginButton(c,d);c.button=b;this.pluginsContainer.domElement.appendChild(b);$(b).hide();c.checkEnabled(function(g){if(g){$(c.button).show();c.setup();var i="buttonPlugin"+a.buttonPlugins.length;if(c.getButtonType()==paella.ButtonPlugin.type.popUpButton){var f=a.popUpPluginContainer.domElement;var e=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_container");a.popUpPluginContainer.registerContainer(c.getName(),e,b,c)}else{if(c.getButtonType()==paella.ButtonPlugin.type.timeLineButton){var f=a.timeLinePluginContainer.domElement;var h=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_timeline");a.timeLinePluginContainer.registerContainer(c.getName(),h,b,c)}}}})},initialize:function(c){var b={};this.parent("div",c,b);this.domElement.className="playbackControls";this.playbackBarId=c+"_playbackBar";var a=this;this.pluginsContainer=new paella.DomNode("div",c+"_playbackBarPlugins");this.pluginsContainer.domElement.className="playbackBarPlugins";this.addNode(this.pluginsContainer);this.popUpPluginContainer=new paella.PopUpContainer(c+"_popUpPluginContainer","popUpPluginContainer");this.addNode(this.popUpPluginContainer);this.timeLinePluginContainer=new paella.TimelineContainer(c+"_timelinePluginContainer","timelinePluginContainer");this.addNode(this.timeLinePluginContainer);this.addNode(new paella.PlaybackBar(this.playbackBarId));paella.pluginManager.setTarget("button",this)},playbackBar:function(){if(this.playbackBarInstance==null){this.playbackBarInstance=this.getNode(this.playbackBarId)}return this.playbackBarInstance},onresize:function(){paella.debug.log("resize playback bar");var a=$(this.domElement).width();for(var b=0;b<this.buttonPlugins.length;++b){var c=this.buttonPlugins[b];var d=c.getMinWindowSize();if(d>0&&a<d){$(c.container).hide()}else{$(c.container).show()}}}});paella.ControlsContainer=Class.create(paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:true,autohideTimer:null,hideControlsTimeMillis:3000,playbackControlInstance:null,initialize:function(b){this.parent("div",b);this.viewControlId=b+"_view";this.playbackControlId=b+"_playback";this.editControlId=b+"_editor";this.addNode(new paella.PlaybackControl(this.playbackControlId));var a=this;paella.events.bind(paella.events.showEditor,function(c){a.onShowEditor()});paella.events.bind(paella.events.hideEditor,function(c){a.onHideEditor()});paella.events.bind(paella.events.play,function(c){a.onPlayEvent()});paella.events.bind(paella.events.pause,function(c){a.onPauseEvent()});paella.events.bind("mousemove",function(c){a.onMouseMoveEvent()});paella.events.bind(paella.events.endVideo,function(c){a.onEndVideoEvent()})},onShowEditor:function(){var a=this.editControl();if(a){$(a.domElement).hide()}},onHideEditor:function(){var a=this.editControl();if(a){$(a.domElement).show()}},showEditorButton:function(){this.addNode(new EditControl(this.editControlId))},enterEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).hide()}},exitEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).show()}},playbackControl:function(){if(this.playbackControlInstance==null){this.playbackControlInstance=this.getNode(this.playbackControlId)}return this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=false;this.hide()},enable:function(){this.isEnabled=true;this.show()},hide:function(){var a=new UserAgent();if(!a.browser.IsMobileVersion){$(this.domElement).animate({opacity:0},300);paella.events.trigger(paella.events.controlBarWillHide)}else{paella.debug.log("Mobile version: controls will not hide")}},show:function(){if(this.isEnabled){if(this.domElement.style.opacity!=1){this.domElement.style.opacity=1;paella.events.trigger(paella.events.controlBarDidShow)}}},autohideTimeout:function(){var a=this.playbackControl().playbackBar();if(a.isSeeking()){this.restartAutohideTimer()}else{this.hideControls()}},hideControls:function(){this.hide()},showControls:function(){this.show()},onPlayEvent:function(){this.restartAutohideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show();this.clearAutohideTimer()},onMouseMoveEvent:function(){this.showControls();if(paella.player.videoContainer.isReady()&&!paella.player.videoContainer.paused()){this.restartAutohideTimer()}},clearAutohideTimer:function(){if(this.autohideTimer!=null){this.autohideTimer.cancel();this.autohideTimer=null}},restartAutohideTimer:function(){this.clearAutohideTimer();var a=this;this.autohideTimer=new paella.utils.Timer(function(b){a.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}});paella.LoaderContainer=Class.create(paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(b){this.parent("div",b,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:10000});this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url(resources/images/loader.png)"}));var a=this;paella.events.bind(paella.events.loadComplete,function(c,d){a.loadComplete(d)});this.timer=new paella.utils.Timer(function(c){a.loaderPosition-=128;a.loader.domElement.style.backgroundPosition=a.loaderPosition+"px";c.timeout=c.timeout*2},1000);this.timer.repeat=true},loadComplete:function(a){$(this.domElement).hide();this.timer.repeat=false}});paella.KeyManager=Class.create({isPlaying:false,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:true,initialize:function(){var a=this;paella.events.bind(paella.events.loadComplete,function(b,c){a.loadComplete(b,c)});paella.events.bind(paella.events.play,function(b){a.onPlay()});paella.events.bind(paella.events.pause,function(b){a.onPause()})},loadComplete:function(b,c){var a=this;paella.events.bind("keyup",function(d){a.keyUp(d)})},onPlay:function(){this.isPlaying=true},onPause:function(){this.isPlaying=false},keyUp:function(a){if(!this.enabled){return}if(a.altKey&&a.ctrlKey){if(a.which==this.Keys.P){this.togglePlayPause()}else{if(a.which==this.Keys.S){this.pause()}else{if(a.which==this.Keys.M){this.mute()}else{if(a.which==this.Keys.U){this.volumeUp()}else{if(a.which==this.Keys.D){this.volumeDown()}}}}}}else{if(a.which==this.Keys.Space){this.togglePlayPause()}else{if(a.which==this.Keys.Up){this.volumeUp()}else{if(a.which==this.Keys.Down){this.volumeDown()}else{if(a.which==this.Keys.M){this.mute()}}}}}},togglePlayPause:function(){if(this.isPlaying){paella.events.trigger(paella.events.pause)}else{paella.events.trigger(paella.events.play)}},pause:function(){paella.events.trigger(paella.events.pause)},mute:function(){var a=paella.player.videoContainer;var b=0;if(a.volume()==0){b=1}paella.events.trigger(paella.events.setVolume,{master:b,slave:0})},volumeUp:function(){var a=paella.player.videoContainer;var b=a.volume();b+=0.1;b=(b>1)?1:b;paella.events.trigger(paella.events.setVolume,{master:b,slave:0})},volumeDown:function(){var a=paella.player.videoContainer;var b=a.volume();b-=0.1;b=(b<0)?0:b;paella.events.trigger(paella.events.setVolume,{master:b,slave:0})}});paella.keyManager=new paella.KeyManager();paella.MessageBox=Class.create({modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var a=this;$(window).resize(function(b){a.adjustTop()})},showFrame:function(f,e){var c=true;var d="80%";var a="80%";var b=null;if(e){c=e.closeButton;d=e.width;a=e.height;b=e.onClose}this.doShowFrame(f,c,d,a,b)},doShowFrame:function(a,d,c,i,f){this.onClose=f;if(this.currentMessageBox){this.close()}if(!c){c="80%"}if(!i){i="80%"}var e=document.createElement("div");e.className=this.modalContainerClassName;e.style.position="fixed";e.style.top="0px";e.style.left="0px";e.style.right="0px";e.style.bottom="0px";e.style.zIndex=999999;var b=document.createElement("div");b.className=this.frameClassName;b.style.width=c;b.style.height=i;b.style.position="relative";e.appendChild(b);var g=document.createElement("iframe");g.src=a;g.setAttribute("frameborder","0");g.style.width="100%";g.style.height="100%";b.appendChild(g);$("body")[0].appendChild(e);this.currentMessageBox=e;this.messageContainer=b;var h=this;this.adjustTop();if(d){this.createCloseButton()}},showMessage:function(f,g){var c=true;var e="60%";var a="40%";var b=null;var d=this.messageClassName;if(g){d=g.className;c=g.closeButton;e=g.width;a=g.height;b=g.onClose}this.doShowMessage(f,c,e,a,d,b)},doShowMessage:function(i,c,b,h,e,f){this.onClose=f;if(this.currentMessageBox){this.close()}if(!e){e=this.messageClassName}if(!b){b="80%"}if(!h){h="30%"}var d=document.createElement("div");d.className=this.modalContainerClassName;d.style.position="fixed";d.style.top="0px";d.style.left="0px";d.style.right="0px";d.style.bottom="0px";d.style.zIndex=999999;var a=document.createElement("div");a.className=e;a.style.width=b;a.style.height=h;a.style.position="relative";a.innerHTML=i;d.appendChild(a);$("body")[0].appendChild(d);this.currentMessageBox=d;this.messageContainer=a;var g=this;this.adjustTop();if(c){this.createCloseButton()}},showError:function(e,f){var c=false;var d="60%";var a="20%";var b=null;if(f){c=f.closeButton;d=f.width;a=f.height;b=f.onClose}this.doShowError(e,c,d,a,b)},doShowError:function(e,c,d,a,b){this.doShowMessage(e,c,d,a,this.errorClassName,b)},createCloseButton:function(){if(this.messageContainer){var a=this;var b=document.createElement("div");this.messageContainer.appendChild(b);b.className="paella_messageContainer_closeButton";$(b).click(function(c){a.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var b=$(this.messageContainer).outerHeight();var a=$(this.currentMessageBox).height();var c=a/2-b/2;this.messageContainer.style.marginTop=c+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var a=this.currentMessageBox;var b=a.parentNode;$(a).animate({opacity:0},300,function(){b.removeChild(a)});if(this.onClose){this.onClose()}}},onCloseButtonClick:function(){this.close()}});paella.messageBox=new paella.MessageBox();paella.AccessControl=Class.create({permissions:{canRead:false,canContribute:false,canWrite:false,loadError:true,isAnonymous:false},checkAccess:function(a){a(this.permissions)}});paella.DefaultAccessControl=Class.create(paella.AccessControl,{checkAccess:function(a){this.permissions.canRead=false;this.permissions.canContribute=false;this.permissions.canWrite=false;this.permissions.loadError=false;this.permissions.isAnonymous=true;a(this.permissions)}});paella.VideoLoader=Class.create({streams:[],frameList:[],loadStatus:false,codecStatus:false,isH264Capable:function(){var b=document.createElement("video");var a=b.canPlayType('video/mp4; codecs="avc1.42E01E"');if(a==""){a=b.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}a=(a=="probably")||(a=="maybe");return a},isOggCapable:function(){var a=document.createElement("video");var b=a.canPlayType('video/ogg; codecs="theora"');b=(b=="probably")||(b=="maybe");return b},isWebmCapable:function(){var a=document.createElement("video");var b=a.canPlayType('video/webm; codecs="vp8, vorbis"');b=(b=="probably")||(b=="maybe");return b},isImageCapable:function(){return true},isHtmlVideoCompatible:function(e){var a=false;if(this.streams.length>e){var d=this.streams[e];var b=this.isH264Capable();var f=this.isOggCapable();var c=this.isWebmCapable();paella.debug.log("Browser video capabilities: mp4="+((b)?"yes":"no")+", ogg="+((f)?"yes":"no")+", webm="+((c)?"yes":"no"));if(d.sources.mp4&&b&&!/rtmp:\/\//.test(d.sources.mp4.src)){a=true}else{if(d.sources.ogg&&f){a=true}else{if(d.sources.webm&&c){a=true}}}}return a},isImageCompatible:function(c){var a=false;if(this.streams.length>c){var b=this.streams[c];if(b.sources.image){a=true}}return a},isFlashCompatible:function(d){var b=new UserAgent();var a=false;if(this.streams.length>d){var c=this.streams[d];if(c.sources.mp4){a=true}else{if(c.sources.flv){a=true}}}return a&&!b.browser.IsMobileVersion},isStreamingCompatible:function(d){var b=new UserAgent();var a=false;if(this.streams.length>d){var c=this.streams[d];if(c.sources.rtmp){a=true}else{a=false}}return a&&!b.browser.IsMobileVersion},isStreamCompatible:function(b,c){var a=false;if(c.name=="html"&&this.isHtmlVideoCompatible(b)){a=true}else{if(c.name=="flash"&&this.isFlashCompatible(b)){a=true}else{if(c.name=="streaming"&&this.isStreamingCompatible(b)){a=true}else{if(c.name=="image"&&this.isImageCompatible(b)){a=true}}}}return a},getPreferredMethod:function(e){var d=new UserAgent();var c=null;var a=paella.player.config.player.methods;if(d.browser.isMobileVersion&&e>=1){for(var b=0;b<a.length;++b){if(a[b].name=="image"&&a[b].enabled&&this.isStreamCompatible(e,a[b])){c=method}}}else{for(var b=0;b<a.length;++b){if(this.isStreamCompatible(e,a[b])){c=a[b];break}}}return c},loadVideo:function(a,b){b()}});paella.PlayerBase=Class.create({config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){if(paella.utils.parameters.get("ignoreBrowserCheck")){return true}var c=new UserAgent();if(c.browser.IsMobileVersion){return true}if(c.browser.Chrome||c.browser.Safari||c.browser.Firefox||c.browser.Opera||(c.browser.Explorer&&c.browser.Version.major>=9)){return true}else{var a=paella.dictionary.translate("It seems that your browser is not HTML 5 compatible");paella.events.trigger(paella.events.error,{error:a});var b=a+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="resources/images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="resources/images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>';b+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+paella.dictionary.translate("Continue anyway")+"</a></div>";paella.messageBox.showError(b,{height:"40%"})}return false},initialize:function(b){if(!this.checkCompatibility()){paella.debug.log("It seems that your browser is not HTML 5 compatible")}else{paella.player=this;this.playerId=b;this.mainContainer=$("#"+this.playerId)[0];this.accessControl=paella.initDelegate.initParams.accessControl;var a=this;paella.events.bind(paella.events.loadComplete,function(c,d){a.loadComplete(c,d)})}},includePlugins:function(b,f,g,c){if(!c){c="plugins/plugins.css"}if(/debug/.test(window.location.href)){paella.debug.debug=true;for(var e=0;e<g.length;e++){var d=g[e];var a=d.substr(0,d.lastIndexOf("."))+".css";paella.debug.log(f+d+", "+f+a);paella.utils.require(f+d);paella.utils.importStylesheet(f+a)}}else{paella.utils.importStylesheet(c)}},loadComplete:function(a,b){}});paella.InitDelegate=Class.create({initParams:{configUrl:"config/config.json",dictionaryUrl:"config/dictionary",editorDictionaryUrl:"config/editor_dictionary",accessControl:new paella.DefaultAccessControl(),videoLoader:new paella.VideoLoader()},initialize:function(b){if(b){for(var a in b){this.initParams[a]=b[a]}}},getId:function(){return paella.utils.parameters.get("id")},loadDictionary:function(b){var a=new paella.AsyncLoader();a.addCallback(new paella.DictionaryLoader(this.initParams.dictionaryUrl));a.addCallback(new paella.DictionaryLoader(this.initParams.editorDictionaryUrl));a.load(function(){b()},function(){b()})},loadConfig:function(c){var a=this.initParams.configUrl;var b={};b.url=a;paella.ajax.get(b,function(g,f,d){if(typeof(g)=="string"){try{g=JSON.parse(g)}catch(h){c({})}}paella.dictionary.addDictionary(g);c(g)},function(f,e,d){c({})})},loadEditorConfig:function(b){var a={cssPath:"resources/ui/jquery-ui.css"};b(a)}});var paellaPlayer=null;paella.plugins={};paella.plugins.events={};paella.initDelegate=null;var PaellaPlayer=Class.create(paella.PlayerBase,{player:null,selectedProfile:"",videoIdentifier:"",editor:null,loader:null,videoData:null,setProfile:function(b){var a=this;this.videoContainer.setProfile(b,function(c){a.selectedProfile=c})},initialize:function(b){this.parent(b);if(this.playerId==b){this.loadPaellaPlayer();this.includePlugins("javascript/paella_plugins.js","plugins/",paella.pluginList);var a=this;paella.events.bind(paella.events.setProfile,function(c,d){a.setProfile(d.profileName)})}},loadPaellaPlayer:function(){var a=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader");$("body")[0].appendChild(this.loader.domElement);paella.events.trigger(paella.events.loadStarted);paella.initDelegate.loadDictionary(function(){paella.initDelegate.loadConfig(function(b){a.onLoadConfig(b)})})},onLoadConfig:function(a){paella.data=new paella.Data(a);this.config=a;this.videoIdentifier=paella.initDelegate.getId();if(this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");this.controls=new paella.ControlsContainer(this.playerId+"_controls");this.mainContainer.appendChild(this.videoContainer.domElement);this.mainContainer.appendChild(this.controls.domElement)}$(window).resize(function(b){paella.player.onresize()});this.onload()}},onload:function(){var a=this;this.accessControl.checkAccess(function(c){if(!c.loadError){paella.debug.log("read:"+c.canRead+", contribute:"+c.canContribute+", write:"+c.canWrite);if(c.canWrite){a.setupEditor();paella.events.bind(paella.events.showEditor,function(d){a.showEditor()});paella.events.bind(paella.events.hideEditor,function(d){a.hideEditor()})}if(c.canRead){a.loadVideo();a.videoContainer.publishVideo()}else{a.unloadAll(paella.dictionary.translate("You are not authorized to view this resource"))}}else{if(c.isAnonymous){var b=paella.dictionary.translate("You are not logged in");a.unloadAll(b);paella.events.trigger(paella.events.error,{error:b})}else{var b=paella.dictionary.translate("You are not authorized to view this resource");a.unloadAll(b);paella.events.trigger(paella.events.error,{error:b})}}})},onresize:function(){this.videoContainer.onresize();this.controls.onresize();if(this.editor){this.editor.resize()}},unloadAll:function(a){$("#playerContainer")[0].innerHTML="";var b=$("#paellaPlayer_loader")[0];paella.messageBox.showError(a)},setupEditor:function(){if(paella.editor&&paella.player.config.editor&&paella.player.config.editor.enabled){this.controls.showEditorButton()}else{setTimeout("paella.player.setupEditor()",500)}},showEditor:function(){new paella.editor.Editor()},hideEditor:function(){},loadVideo:function(){if(this.videoIdentifier){var b=this;var a=paella.initDelegate.initParams.videoLoader;a.loadVideo(this.videoIdentifier,function(){var g=a.streams[0];var e=a.streams[1];var i=a.frameList;if(a.loadStatus){var h=a.getPreferredMethod(0);var d=a.getPreferredMethod(1);var c=true;if(h){c=paella.player.videoContainer.setMasterSource(g,h.name)}if(d){c=paella.player.videoContainer.setSlaveSource(e,d.name)}else{paella.player.videoContainer.setMonoStreamMode()}if(c){paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager});new paella.utils.Timer(function(j){if(b.videoContainer.isReady()){paella.events.trigger(paella.events.loadComplete,{masterVideo:g,slaveVideo:e,frames:i});b.onresize();j.repeat=false}else{j.repeat=true}},500)}else{var f=paella.dictionary.translate("Your browser is not compatible with the required video codec");paella.messageBox.showError(f);paella.events.trigger(paella.events.error,{error:f})}}else{var f=paella.dictionary.translate("Error loading video data");paella.messageBox.showError(f);paella.events.trigger(paella.events.error,{error:f})}})}},loadPreviews:function(){var e=paella.initDelegate.initParams.videoLoader.streams;var b=null;var c=e[0].preview;if(e.length>=2){b=e[1].preview}if(c){var a=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img");this.masterPreviewElem.src=c;paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,a)}if(b){var d=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img");this.slavePreviewElem.src=b;paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,d)}paella.events.bind(paella.events.timeUpdate,function(f){paella.player.unloadPreviews()})},unloadPreviews:function(){if(this.masterPreviewElem){paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem);this.masterPreviewElem=null}if(this.slavePreviewElem){paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem);this.slavePreviewElem=null}},loadComplete:function(c,f){var a=this;var e=paella.utils.parameters.get("time");var b=paella.player.videoContainer.masterVideo();var d=paella.utils.parameters.get("profile");var g=paella.utils.cookies.get("lastProfile");if(d){this.setProfile(d)}else{if(g){this.setProfile(g)}else{this.setProfile(this.config.defaultProfile)}}paella.events.trigger(paella.events.play);new paella.utils.Timer(function(i){var k=paella.utils.parameters.get("autoplay");k=k.toLowerCase();if(k!="true"&&k!="yes"){paella.events.trigger(paella.events.pause)}if(e){var m=b.duration();var q=a.videoContainer.trimStart();var p=a.videoContainer.trimEnd();if(a.videoContainer.trimEnabled()){m=p-q}var n=0;var l=0;var j=0;if(/([0-9]+)h/.test(e)){n=Number(RegExp.$1)}if(/([0-9]+)m/.test(e)){l=Number(RegExp.$1)}if(/([0-9]+)s/.test(e)){j=Number(RegExp.$1)}var h=n*60*60+l*60+j;var o=h*100/m;paella.events.trigger(paella.events.seekTo,{newPositionPercent:o})}a.loadPreviews();if(paella.player.config.editor&&paella.player.config.editor.enabled&&paella.player.config.editor.loadOnStartup){paella.events.trigger(paella.events.showEditor)}},1000)}});function initPaellaEngage(a,b){if(!b){b=new paella.InitDelegate()}paella.initDelegate=b;var c=navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(a,paella.initDelegate)};paella.ExtendedPlugin=Class.create(paella.Plugin,{type:"extendedPlugin",getName:function(){return"es.upv.paella.extended.Plugin"},checkEnabled:function(a){a(paella.extended!=null)},getIndex:function(){return 10000}});paella.RightBarPlugin=Class.create(paella.ExtendedPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.extended.RightBarPlugin"},buildContent:function(a){}});paella.TabBarPlugin=Class.create(paella.ExtendedPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.extended.TabBarPlugin"},getTabName:function(){return"New Tab"},buildContent:function(a){}});paella.Extended=Class.create({container:null,paellaContainer:null,rightContainer:null,bottomContainer:null,settings:{containerId:"paellaExtendedContainer",paellaContainerId:"playerContainer",rightContainerId:"paella_right",bottomContainerId:"paella_bottom",containerClass:"paellaExtendedContainer",playerContainerClass:"playerContainer",rightContainerClass:"rightContainer",bottomContainerClass:"bottomContainer",aspectRatio:1.777777,initDelegate:new paella.InitDelegate({accessControl:new paella.AccessControl(),videoLoader:new paella.VideoLoader})},rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(b){this.saveSettings(b);this.loadPaellaExtended();var a=this;$(window).resize(function(c){a.onresize()})},saveSettings:function(b){if(b){for(var a in b){this.settings[a]=b[a]}}},loadPaellaExtended:function(){this.container=$("#"+this.settings.containerId)[0];if(!this.container){var a=$("body")[0];a.innerHTML="";this.container=document.createElement("div");this.container.id=this.settings.containerId;this.container.className=this.settings.containerClass;a.appendChild(this.container)}else{this.container.innerHTML="";this.container.className=this.settings.containerClass}this.paellaContainer=document.createElement("div");this.paellaContainer.id=this.settings.paellaContainerId;this.paellaContainer.className=this.settings.playerContainerClass;this.container.appendChild(this.paellaContainer);this.rightContainer=document.createElement("div");this.rightContainer.id=this.settings.rightContainerId;this.rightContainer.className=this.settings.rightContainerClass;this.container.appendChild(this.rightContainer);this.bottomContainer=document.createElement("div");this.bottomContainer.id=this.settings.bottomContainerId;this.bottomContainer.className=this.settings.bottomContainerClass;this.container.appendChild(this.bottomContainer);var c=document.createElement("div");c.id="bottomContainer_tabs";c.className="bottomContainerTabs";this.bottomContainerTabs=c;this.bottomContainer.appendChild(c);var d=document.createElement("div");d.id="bottomContainer_content";d.className="bottomContainerContent";this.bottomContainerContent=d;this.bottomContainer.appendChild(d);var b=this;$(document).bind(paella.events.loadComplete,function(e,f){b.setMainProfile()});this.initPlugins();initPaellaEngage(this.paellaContainer.id,this.settings.initDelegate);this.onresize()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this);paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(b){var a=this;b.checkEnabled(function(c){if(c){b.setup();if(b.type=="rightBarPlugin"){a.rightBarPlugins.push(b);a.addRightBarPlugin(b)}if(b.type=="tabBarPlugin"){a.tabBarPlugins.push(b);a.addTabPlugin(b)}}})},showTab:function(a){for(var b=0;b<this.tabBarPlugins.length;++b){var d=$("#tab_"+b)[0];var c=$("#tab_content_"+b)[0];if(b==a){d.className="bottomContainerTabItem enabledTabItem";c.className="bottomContainerContent enabledTabContent"}else{d.className="bottomContainerTabItem disabledTabItem";c.className="bottomContainerContent disabledTabContent"}}},addTabPlugin:function(d){var a=this.currentTabIndex;var e=document.createElement("div");e.id="tab_"+a;e.className="bottomContainerTabItem disabledTabItem";e.innerHTML=d.getTabName();e.plugin=d;var b=this;$(e).click(function(f){if(/disabledTabItem/.test(this.className)){b.showTab(a);this.plugin.action(this)}});this.bottomContainerTabs.appendChild(e);var c=document.createElement("div");c.id="tab_content_"+a;c.className="bottomContainerContent disabledTabContent "+d.getSubclass();this.bottomContainerContent.appendChild(c);d.buildContent(c);this.showTab(a);++this.currentTabIndex},addRightBarPlugin:function(b){var a=document.createElement("div");a.className="rightBarPluginContainer "+b.getSubclass();this.rightContainer.appendChild(a);b.buildContent(a)},setMainProfile:function(){var a="full";var b=paella.utils.cookies.get("paella.extended.profile");if(b){a=b}else{if((paella)&&(paella.player)&&(paella.player.config)&&(paella.player.config.player)&&(paella.player.config.player.defaultProfile)){a=paella.player.config.player.defaultProfile}}this.setProfile(a)},setProfile:function(b){paella.utils.cookies.set("paella.extended.profile",b);var a=this;this.container.className=this.settings.containerClass+" "+b;this.paellaContainer.className=this.settings.playerContainerClass+" "+b;this.rightContainer.className=this.settings.rightContainerClass+" "+b;this.bottomContainer.className=this.settings.bottomContainerClass+" "+b;this.onresize();if(paella.player){paella.player.onresize()}},getProfile:function(){var a=new RegExp(this.settings.containerClass+" ([a-zA-Z0-9]+)");if(a.test(paella.extended.container.className)){return RegExp.$1}return""},onresize:function(){}});function initPaellaExtended(a){paella.extended=new paella.Extended(a)};paella.editor={};paella.editor.utils={mouse:{mouseDownTarget:"",}};var bootstrapUtils={elem:function(c,e,b){var d=document.createElement(c);for(var a in e){d.setAttribute(a,e[a])}if(b){d.innerHTML=b}return d},append:function(a,b){a.appendChild(b);return b},navbar:function(d,a){var c=this.elem("div",{"class":"navbar tiny "+a});var b=this.append(c,this.elem("div",{"class":"navbar-inner tiny"}));if(d){this.append(b,this.elem("div",{"class":"brand",href:"JavaScript:void(0);"},d))}return c},dropdown:function(f,a,b,c,e,d){return this.dropButton(f,a,b,c,e,d,"")},dropup:function(f,a,b,c,e,d){return this.dropButton(f,a,b,c,e,d,"dropup")},dropButton:function(j,b,g,n,i,m,h){var f="";if(m){f="pull-right"}var e=this.elem("div",{"class":"btn-group "+h+" "+b+" "+f});if(i){j='<i class="'+i+'"></i>&nbsp;<span class="text">'+j+"</span>&nbsp;"}else{j='&nbsp;<span class="text">'+j+"</span>&nbsp;"}var a=this.append(e,this.elem("a",{"class":"btn dropdown-toggle "+n,"data-toggle":"dropdown",href:"JavaScript:void(0);"},j+'<span class="caret"></span>'));var d=this.append(e,this.elem("ul",{"class":"dropdown-menu"}));for(var l in g){var c=g[l];var k=this.append(d,this.elem("li"));this.append(k,this.elem("a",{href:"JavaScript:void(0);",onclick:c,"class":"listItem"},l))}return e},buttonGroup:function(d,c,f){var e=document.createElement("div");e.className="btn-group";for(var b=0;b<d.length;++b){var a=document.createElement("button");a.className="btn "+c;a.innerHTML=d[b].label;a.buttonData=d[b];a.buttonData.disabledClass=a.className;a.title=d[b].hint;if(f){$(a).click(function(g){this.buttonData.onclick(this.buttonData)})}else{$(a).click(function(h){for(var g=0;g<this.parentNode.childNodes.length;++g){this.parentNode.childNodes[g].className=this.buttonData.disabledClass}this.className=this.className+" active";this.buttonData.onclick(this.buttonData)})}e.appendChild(a)}return e},button:function(b,d,e,a){var c=document.createElement("button");c.className="btn "+d;c.innerHTML=b;c.title=e;$(c).click(function(f){a(this)});return c}};paella.editor.PluginSaveCallback=Class.create(paella.AsyncLoaderCallback,{plugin:null,initialize:function(a){this.parent("pluginSaveCallback");this.plugin=a},load:function(b,a){this.plugin.onSave(function(){b()})}});paella.editor.PluginDiscardCallback=Class.create(paella.AsyncLoaderCallback,{plugin:null,initialize:function(a){this.parent("pluginDiscardCallback");this.plugin=a},load:function(b,a){this.plugin.onDiscard(function(){b()})}});paella.editor.PluginManager=Class.create({trackPlugins:[],rightBarPlugins:[],toolbarPlugins:[],initialize:function(){this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("editorTrackPlugin",this);paella.pluginManager.setTarget("editorRightBarPlugin",this);paella.pluginManager.setTarget("editorToolbarPlugin",this)},addPlugin:function(b){var a=this;b.checkEnabled(function(c){if(c){b.setup();if(b.type=="editorTrackPlugin"){a.trackPlugins.push(b)}if(b.type=="editorRightBarPlugin"){a.rightBarPlugins.push(b)}if(b.type=="editorToolbarPlugin"){a.toolbarPlugins.push(b)}}})},onTrackChanged:function(a){for(var b=0;b<this.rightBarPlugins.length;++b){var c=this.rightBarPlugins[b];c.onTrackSelected(a)}for(var b=0;b<this.toolbarPlugins.length;++b){var c=this.toolbarPlugins[b];c.onTrackSelected(a)}},onSave:function(c){var b=new paella.AsyncLoader();for(var a=0;a<this.trackPlugins.length;++a){b.addCallback(new paella.editor.PluginSaveCallback(this.trackPlugins[a]))}for(var a=0;a<this.rightBarPlugins.length;++a){b.addCallback(new paella.editor.PluginSaveCallback(this.rightBarPlugins[a]))}for(var a=0;a<this.toolbarPlugins.length;++a){b.addCallback(new paella.editor.PluginSaveCallback(this.toolbarPlugins[a]))}b.load(function(){paella.events.trigger(paella.events.didSaveChanges);c(true)},function(){c(false)})},onDiscard:function(c){var b=new paella.AsyncLoader();for(var a=0;a<this.trackPlugins.length;++a){b.addCallback(new paella.editor.PluginDiscardCallback(this.trackPlugins[a]))}for(var a=0;a<this.rightBarPlugins.length;++a){b.addCallback(new paella.editor.PluginDiscardCallback(this.rightBarPlugins[a]))}for(var a=0;a<this.toolbarPlugins.length;++a){b.addCallback(new paella.editor.PluginDiscardCallback(this.toolbarPlugins[a]))}b.load(function(){c(true)},function(){c(false)})}});paella.editor.pluginManager=new paella.editor.PluginManager();paella.editor.EditorPlugin=Class.create(paella.Plugin,{onTrackSelected:function(a){if(a){paella.debug.log(this.getName()+": New track selected "+a.getName())}else{paella.debug.log("No track selected")}},onSave:function(a){a()},onDiscard:function(a){a()},contextHelpString:function(){return""}});paella.editor.TrackPlugin=Class.create(paella.editor.EditorPlugin,{type:"editorTrackPlugin",getIndex:function(){return 10000},getName:function(){return"editorTrackPlugin"},getTrackName:function(){return"My Track"},getColor:function(){return"#5500FF"},getTextColor:function(){return"#F0F0F0"},getTrackType:function(){return"secondary"},getTrackItems:function(){var a=[{id:1,s:10,e:70},{id:2,s:110,e:340}];return a},allowResize:function(){return true},allowDrag:function(){return true},allowEditContent:function(){return true},onTrackChanged:function(c,b,a){paella.events.trigger(paella.events.documentChanged)},onTrackContentChanged:function(b,a){paella.events.trigger(paella.events.documentChanged)},onSelect:function(a){paella.debug.log("Track list selected: "+this.getTrackName())},onUnselect:function(){paella.debug.log("Track list unselected: "+this.getTrackName())},onDblClick:function(a){},getTools:function(){return[]},onToolSelected:function(a){paella.events.trigger(paella.events.documentChanged)},isToolEnabled:function(a){return true},buildToolTabContent:function(a){},getSettings:function(){return null}});paella.editor.MainTrackPlugin=Class.create(paella.editor.TrackPlugin,{getTrackType:function(){return"master"},getTrackItems:function(){var a=[{id:1,s:30,e:470}];return a},getName:function(){return"editorMainTrackPlugin"},});paella.editor.RightBarPlugin=Class.create(paella.editor.EditorPlugin,{type:"editorRightBarPlugin",getIndex:function(){return 10000},getName:function(){return"editorRightbarPlugin"},getTabName:function(){return"My Rightbar Plugin"},getContent:function(){var a=document.createElement("div");a.innerHTML="Rightbar plugin";return a},onLoadFinished:function(){}});paella.editor.EditorToolbarPlugin=Class.create(paella.editor.EditorPlugin,{type:"editorToolbarPlugin",trackList:[],getIndex:function(){return 10000},getName:function(){return"editorToolbarPlugin"},getButtonName:function(){return"Toolbar Plugin"},getIcon:function(){return"icon-edit"},getOptions:function(){return[]},onOptionSelected:function(a){}});paella.editor.Tabbar=Class.create({navbar:null,container:null,initialize:function(a){this.navbar=bootstrapUtils.navbar("","navbar-inverse");a.appendChild(this.navbar);this.container=$(this.navbar).find(".navbar-inner")[0]}});paella.editor.Toolbar=Class.create({navbar:null,container:null,toolButton:null,selectedToolUtils:null,editorMenu:null,toolbarPlugins:null,initialize:function(a){this.navbar=bootstrapUtils.navbar("","navbar-inverse");a.appendChild(this.navbar);this.container=$(this.navbar).find(".navbar-inner")[0];this.buildTrackTools();this.buildPlaybackControls();this.buildEditorMenu();this.buildPlugins()},buildTrackTools:function(){var h=paella.dictionary.translate("Selection");var g={};g[h]="paella.editor.instance.bottomBar.toolbar.onToolChanged('select','"+h+"')";var a=paella.editor.pluginManager.trackPlugins;for(var d in a){var e=a[d];var c=e.getTrackName();var f="paella.editor.instance.bottomBar.toolbar.onToolChanged('"+e.getName()+"','"+e.getTrackName()+"')";g[c]=f}var b=paella.dictionary.translate("Tool")+": "+paella.dictionary.translate("Selection");this.toolButton=bootstrapUtils.dropdown(b,"toolDropdown",g,"btn-mini","",false);this.container.appendChild(this.toolButton);this.selectedToolUtils=document.createElement("span");this.selectedToolUtils.className="editorToolbar_selectedToolUtils";this.container.appendChild(this.selectedToolUtils)},buildPlaybackControls:function(){var b=document.createElement("span");b.className="editorToolbarPlaybackControls";this.container.appendChild(b);var a=[];a.push({label:'<i class="icon-step-backward icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.seekTo,{newPositionPercent:0})}});a.push({label:'<i class="icon-play icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.play)}});a.push({label:'<i class="icon-pause icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.pause)}});a.push({label:'<i class="icon-step-forward icon-white"></i>',hint:"",onclick:function(c){$(document).trigger(paella.events.seekTo,{newPositionPercent:99})}});b.appendChild(bootstrapUtils.buttonGroup(a,"btn-mini",true))},buildPlugins:function(){if(!this.toolbarPlugins){this.toolbarPlugins=document.createElement("span");this.container.appendChild(this.toolbarPlugins)}else{this.toolbarPlugins.innerHTML=""}var c=paella.editor.pluginManager.toolbarPlugins;for(var e=0;e<c.length;++e){var g=c[e];var h=g.getName();var a=g.getButtonName();var l=g.getOptions();var b={};var k=g.getIcon();if(k){k=k+" icon-white"}for(var d=0;d<l.length;++d){b[l[d]]="paella.editor.instance.bottomBar.toolbar.selectPluginOption('"+h+"',"+d+")"}var f=bootstrapUtils.dropdown(a,"editorDropdown",b,"btn-mini",k,true);this.toolbarPlugins.appendChild(f)}},buildEditorMenu:function(){var a={};a[paella.dictionary.translate("Save and close editor")]="paella.editor.instance.bottomBar.toolbar.saveAndClose();";a[paella.dictionary.translate("Save changes")]="paella.editor.instance.bottomBar.toolbar.save();";a[paella.dictionary.translate("Discard changes and close")]="paella.editor.instance.bottomBar.toolbar.discardAndClose();";this.editorMenu=bootstrapUtils.dropdown(paella.dictionary.translate("Paella Editor"),"editorDropdown",a,"btn-mini","icon-edit icon-white",true);this.container.appendChild(this.editorMenu)},selectPluginOption:function(e,d){var a=paella.editor.pluginManager.toolbarPlugins;for(var b=0;b<a.length;++b){var c=a[b];if(c.getName()==e){c.onOptionSelected(d)}}this.buildPlugins()},onToolChanged:function(b,a){paella.editor.instance.bottomBar.timeline.selectTrackList(b);var c=$(this.toolButton).find(".text")[0];c.innerHTML=paella.dictionary.translate("Tool")+": "+a;this.setupTrackTool(b)},setupTrackTool:function(d){this.selectedToolUtils.innerHTML="";var c=null;for(var b=0;b<paella.editor.pluginManager.trackPlugins.length;++b){c=paella.editor.pluginManager.trackPlugins[b];if(d==c.getName()){break}else{c=null}}if(c){var a=[];var f=c.getTools();for(var b=0;b<f.length;++b){a.push({label:f[b].label,plugin:c,toolName:f[b].name,hint:f[b].hint,onclick:function(g){if(g.plugin.onToolSelected(g.toolName)){paella.editor.instance.bottomBar.timeline.rebuildTrack(c.getName());paella.editor.pluginManager.onTrackChanged(c);paella.editor.instance.rightBar.updateCurrentTab()}}})}if(a.length>0){var e=document.createElement("span");e.innerHTML="&nbsp;"+paella.dictionary.translate("Options")+":";this.selectedToolUtils.appendChild(e);this.selectedToolUtils.appendChild(bootstrapUtils.buttonGroup(a,"btn-mini"))}}},saveAndClose:function(){paella.editor.pluginManager.onSave(function(a){paella.editor.instance.unloadEditor()})},save:function(){paella.editor.pluginManager.onSave(function(){})},discardAndClose:function(){paella.editor.pluginManager.onDiscard(function(a){paella.debug.log("Discard changes");paella.editor.instance.unloadEditor()})}});paella.editor.Timeline=Class.create({container:null,containerMinHeight:133,content:null,timeMarks:null,tracks:null,zoom:100,trackItemList:null,trackItemIndex:{back:5,front:10},trackItemOpacity:{back:0.5,front:0.9},currentTrackList:null,initialize:function(a){var b=this.containerMinHeight;this.trackItemList=[];this.container=document.createElement("div");this.container.className="editorTimelineContainer";$(this.container).css({height:b+"px"});a.appendChild(this.container);this.content=document.createElement("div");this.content.className="editorTimelineContent";$(this.content).css({width:this.zoom+"%",height:"100%"});this.container.appendChild(this.content);this.timeMarks=document.createElement("div");this.timeMarks.className="editorTimeLineTimeMarks";this.content.appendChild(this.timeMarks);this.buildTimeMarks();this.tracks=document.createElement("div");this.tracks.className="editorTimeLineTracks";this.tracks.style.minHeight=this.containerMinHeight+"px";this.content.appendChild(this.tracks);this.loadPlugins();this.setupCursors()},setupCursors:function(){var c=document.createElement("div");c.className="editorTimelineCursor";this.container.appendChild(c);var b=this.content;$(this.container).mousemove(function(f){var i=paella.player.videoContainer.duration(true);var e=$(b).width();var d=$(b).position().left;var h=f.pageX-d;$(c).css({left:h+"px"});var g=h*i/e;c.innerHTML=paella.utils.timeParse.secondsToTime(g)});var a=document.createElement("div");a.className="editorTimelineCursor currentTime";this.container.appendChild(a);$(document).bind(paella.events.timeUpdate,function(f,i){var h=paella.player.videoContainer.duration(true);var d=$(b).width();var e=i.currentTime;var g=e*d/h;$(a).css({left:g+"px"});a.innerHTML=paella.utils.timeParse.secondsToTime(e)});$(document).bind(paella.events.seekToTime,function(f,i){var h=paella.player.videoContainer.duration(true);var d=$(b).width();var e=i.time;var g=e*d/h;$(a).css({left:g+"px"});a.innerHTML=paella.utils.timeParse.secondsToTime(e)});$(this.container).mouseup(function(f){if(paella.editor.utils.mouse.mouseDownTarget!="track"){var i=paella.player.videoContainer.duration(true);var e=$(b).width();var d=$(b).position().left;var h=f.pageX-d;var g=h*100/e;$(document).trigger(paella.events.seekTo,{newPositionPercent:g})}})},loadPlugins:function(){var e=this;var d=this.tracks;d.innerHTML="";var c=paella.editor.pluginManager.trackPlugins;var g=0;var b="";for(var f in c){if(c[f].getTrackType()=="secondary"){b="track"+g;++g}else{b=""}var a=new paella.editor.Track(d,c[f],b);this.trackItemList.push(a)}this.selectTrackList(this.currentTrackList)},rebuildTrack:function(d){var b=paella.editor.pluginManager.trackPlugins;for(var c in this.trackItemList){var a=this.trackItemList[c];if(a.getName()==d){a.rebuild()}}},getHeight:function(){if($(this.container).height()<this.containerMinHeight){return this.containerMinHeight}else{return $(this.container).height()}},buildTimeMarks:function(){var k=this.zoom;this.timeMarks.innerHTML="";var n=$(this.timeMarks).width();var f=paella.player.videoContainer.duration(true);var c=70;var l=Math.ceil(n/c);var b=f/l;var j=n%c;var m=true;var a=0;for(var g=0;g<l;++g){var e=document.createElement("div");e.className="editorTimeLineMark";if(m){e.className=e.className+" odd"}if(g==(l-1)){c=j;e.className+=" last"}e.style.width=c+"px";e.innerHTML=paella.utils.timeParse.secondsToTime(a);a+=b;this.timeMarks.appendChild(e);var h=0;var d=c-h;e.style.width=d+"px";m=!m}},setZoom:function(b){var a=this;this.zoom=b;this.timeMarks.innerHTML="";$(this.content).animate({width:b+"%"},{complete:function(){a.buildTimeMarks()}})},onresize:function(){this.buildTimeMarks();var a=$(this.tracks).outerHeight();$(this.container).css("height",a+"px")},selectTrackList:function(g,e,b){if(g=="select"){this.currentTrackList=null}else{for(var d in this.trackItemList){var c=this.trackItemList[d];var a=c.container;if(c.getName()==g){this.currentTrackList=c;$(a).css({"z-index":this.trackItemIndex.front,opacity:this.trackItemOpacity.front})}else{$(a).css({"z-index":this.trackItemIndex.back,opacity:this.trackItemOpacity.back})}}}var f=null;if(this.currentTrackList){f=this.currentTrackList.plugin;if(b>0){this.currentTrackList.selectTrack(b,e)}}if(!e){paella.editor.pluginManager.onTrackChanged(f);paella.editor.instance.rightBar.updateCurrentTab()}},focusTrackListItem:function(c,f){this.selectTrackList(c,true,f);var b=$("#"+paella.editor.TrackUtils.buildTrackItemId(c,f))[0];if(b){var e=paella.editor.instance.bottomBar.timeline.container.scrollLeft;var d=$(b).offset().left-10;var a=e+d;$(paella.editor.instance.bottomBar.timeline.container).animate({scrollLeft:a},{duration:100})}}});paella.editor.BottomToolbar=Class.create({container:null,content:null,initialize:function(a){this.container=document.createElement("div");this.container.className="editorBottomToolbarContainer";a.appendChild(this.container);this.content=document.createElement("div");this.container.appendChild(this.content);this.content.appendChild(bootstrapUtils.dropup("Zoom","zoomDropup",{"100%":"paella.editor.instance.bottomBar.timeline.setZoom(100)","200%":"paella.editor.instance.bottomBar.timeline.setZoom(200)","500%":"paella.editor.instance.bottomBar.timeline.setZoom(200)","1000%":"paella.editor.instance.bottomBar.timeline.setZoom(1000)","3000%":"paella.editor.instance.bottomBar.timeline.setZoom(3000)","5000%":"paella.editor.instance.bottomBar.timeline.setZoom(5000)"},"btn-mini","icon-search",true))}});paella.editor.BottomBar=Class.create(paella.AsyncLoaderCallback,{editor:null,container:null,toolbar:null,timeline:null,bottomToolbar:null,initialize:function(){this.editor=paella.editor.instance},load:function(c,b){var a=this;this.container=document.createElement("div");this.container.className="paellaEditorBottomBar";this.editor.editorContainer.appendChild(this.container);this.build();c()},build:function(){this.toolbar=new paella.editor.Toolbar(this.container);this.timeline=new paella.editor.Timeline(this.container);this.bottomToolbar=new paella.editor.BottomToolbar(this.container)},getHeight:function(){return $(this.container).height()},onresize:function(){this.timeline.onresize()}});paella.editor.RightBar=Class.create(paella.AsyncLoaderCallback,{editor:null,container:null,tabBar:null,selectedTab:0,tabContent:null,initialize:function(){this.editor=paella.editor.instance},load:function(b,a){this.container=document.createElement("div");this.container.className="paellaEditorRightBar";this.container.style.width=this.getWidth()+"px";this.container.style.bottom=this.editor.bottomBar.getHeight()+"px";this.editor.editorContainer.appendChild(this.container);this.tabBar=new paella.editor.Tabbar(this.container);this.tabContent=document.createElement("div");this.tabContent.className="paellaEditorRightBarContent";this.container.appendChild(this.tabContent);this.loadPlugins();b()},loadPlugins:function(){var c=this;var b=this.tabBar.container;b.innerHTML="";var e=document.createElement("ul");e.className="nav";var g="active";var a=paella.editor.pluginManager.rightBarPlugins;if(a.length>0){var d=0;for(var d in a){var f=a[d];e.appendChild(this.getTab(f,d));++d}b.appendChild(e);var h=a[this.selectedTab];this.tabContent.innerHTML="";this.tabContent.appendChild(h.getContent());h.onLoadFinished()}},getTab:function(f,e){var d=this;var g="";if(e==this.selectedTab){g="active"}var b=document.createElement("li");b.className=g;var c=document.createElement("a");c.className="rightBarPlugin";c.setAttribute("href","JavaScript:void(0);");c.innerHTML='<span class="editorRightBarTabIcon '+f.getName()+'"></span>'+f.getTabName();c.tabIndex=e;$(c).click(function(a){d.loadTab(this.tabIndex)});b.appendChild(c);return b},updateCurrentTab:function(){if(this.tabBar){this.loadPlugins()}},getWidth:function(){return 300},loadTab:function(a){this.selectedTab=a;this.loadPlugins()},onresize:function(){this.container.style.bottom=this.editor.bottomBar.getHeight()+"px"}});paella.editor.TrackUtils={buildTrackItemId:function(b,a){return"paellaEditorTrack_"+b+"_"+a},};paella.editor.Track=Class.create({container:null,plugin:null,trackIndex:{back:10,front:20},trackOpacity:{back:0.7,front:1},trackElemList:null,buildTrackItemId:function(b,a){return paella.editor.TrackUtils.buildTrackItemId(b,a)},initialize:function(d,c,b){this.trackElemList=[];this.plugin=c;var a=document.createElement("div");this.container=a;d.appendChild(a);this.buildTracks(a);type=c.getTrackType();if(type=="master"){a.className="editorTrackListItem master "+b}else{if(type=="secondary"){a.className="editorTrackListItem secondary "+b}}},getName:function(){return this.plugin.getName()},rebuild:function(){this.container.innerHTML="";this.buildTracks(this.container)},buildTracks:function(a){var c=this.plugin;var e=c.getTrackItems();for(var b in e){var d=this.getTrack(e[b]);this.trackElemList.push(d);this.container.appendChild(d)}},getTrack:function(d){var k=this;var h=this.plugin;var f=paella.player.videoContainer.duration(true);d.d=d.e-d.s;var c=document.createElement("div");c.className="editorTrackItem "+h.getName();c.id=this.buildTrackItemId(h.getName(),d.id);var a=d.s*100/f;var b=d.d*100/f;$(c).css({left:a+"%",width:b+"%","background-color":h.getColor(),opacity:this.trackOpacity.back});c.trackInfo={trackData:d,plugin:h};var j=document.createElement("div");if(d.name&&d.name!=""){j.innerHTML=d.name}else{j.innerHTML=h.getTrackName()}j.className="editorTrackItemLabel "+this.plugin.getTrackType();j.style.color=h.getTextColor();c.appendChild(j);if(!d.lock){if(h.allowResize()){var i=document.createElement("div");i.className="editorTrackItemResizer left";i.track=c;c.appendChild(i);var e=document.createElement("div");e.className="editorTrackItemResizer right";e.track=c;c.appendChild(e);$(i).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"L",m)});$(e).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"R",m)})}if(h.allowDrag()){var g=document.createElement("div");g.className="editorTrackItemMoveArea";g.track=c;c.appendChild(g);$(g).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"M",m)})}}else{var l=document.createElement("i");l.className="editorTrackItemLock icon-lock icon-white";c.appendChild(l)}$(c).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onTrackDown(this,m)});$(document).mousemove(function(m){k.onResizerMove(m)});$(document).mouseup(function(m){paella.editor.utils.mouse.mouseDownTarget="";k.onResizerUp(this.track,m)});$(c).dblclick(function(m){k.onDblClick(this.trackInfo,m)});return c},currentTrack:null,resizeTrack:null,currentResizer:null,lastPos:{x:0,y:0},selectTrack:function(d,a){if(typeof(d)=="number"){for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c.trackInfo.trackData.id==d){d=c;break}}}if(typeof(d)!="number"&&this.currentTrack!=d){if(!a){this.onUnselect()}for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c==d){this.currentTrack=c;if(!a){this.onSelect(c.trackInfo)}$(c).css({"z-index":this.trackIndex.front,opacity:this.trackOpacity.front})}else{$(c).css({"z-index":this.trackIndex.back,opacity:this.trackOpacity.back})}}}},onSelect:function(a){this.plugin.onSelect(a.trackData)},onDblClick:function(a,b){this.plugin.onDblClick(a.trackData)},onUnselect:function(){this.plugin.onUnselect()},onTrackDown:function(a,b){this.selectTrack(a);paella.editor.instance.bottomBar.toolbar.onToolChanged(this.plugin.getName(),this.plugin.getTrackName())},onResizerDown:function(a,c,b){if(b){this.resizeTrack=a;this.currentResizer=c;this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}},onResizerUp:function(d,a){if(this.resizeTrack){var g=paella.player.videoContainer.duration(true);var i=$(this.container).width();var f=$(this.resizeTrack).position().left;var c=$(this.resizeTrack).width();f=f*100/i;c=c*100/i;var b=f*g/100;var h=(f+c)*g/100;var j=this.resizeTrack.trackInfo.plugin;var e=this.resizeTrack.trackInfo.trackData;j.onTrackChanged(e.id,b,h);paella.editor.pluginManager.onTrackChanged(j);paella.editor.instance.rightBar.updateCurrentTab();paella.editor.instance.bottomBar.timeline.rebuildTrack(j.getName());this.resizeTrack.trackInfo.trackData;$(this.resizeTrack).css({left:f+"%",width:c+"%"})}this.resizeTrack=null},onResizerMove:function(b){if(this.resizeTrack){var e={x:b.clientX-this.lastPos.x,y:b.clientY-this.lastPos.y};var d=paella.player.videoContainer.duration(true);var c=$(this.resizeTrack).position().left;var a=$(this.resizeTrack).width();if(this.currentResizer=="L"){c+=e.x;a-=e.x;$(this.resizeTrack).css({left:c+"px",width:a+"px"})}else{if(this.currentResizer=="R"){a+=e.x;$(this.resizeTrack).css({width:a+"px"})}else{if(this.currentResizer=="M"){c+=e.x;$(this.resizeTrack).css({left:c+"px"})}}}this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}}});paella.editor.EmbedPlayer=Class.create(paella.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(d,b){var c=this.editor.bottomBar.getHeight()+20;var a=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:c+"px",right:a+"px",left:"20px",top:"20px"});paella.player.mainContainer.className="paellaMainContainerEditorMode";new Timer(function(e){paella.player.controls.disable();paella.player.onresize();if(d){d()}},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer);paella.player.controls.enable();paella.player.mainContainer.className="";$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""});paella.player.onresize()},onresize:function(){var b=this.editor.bottomBar.getHeight()+20;var a=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:b+"px",right:a+"px",left:"20px",top:"20px"})}});paella.editor.Editor=Class.create({config:null,editorContainer:null,isLoaded:false,bottomBar:null,rightBar:null,embedPlayer:null,loader:null,initialize:function(){if(paella.player.accessControl.permissions.canWrite){var a=this;paella.editor.instance=this;paella.initDelegate.loadEditorConfig(function(b){a.config=b;a.loadEditor()})}},loadEditor:function(){paella.keyManager.enabled=false;var a=this;this.editorContainer=document.createElement("div");$("body")[0].appendChild(this.editorContainer);this.editorContainer.className="editorContainer";this.editorContainer.id="editorContainer";this.editorContainer.appendChild(paella.player.mainContainer);$("body")[0].style.backgroundImage="url(resources/images/editor_video_bkg.png)";this.loader=new paella.AsyncLoader();this.bottomBar=this.loader.addCallback(new paella.editor.BottomBar());this.rightBar=this.loader.addCallback(new paella.editor.RightBar());this.embedPlayer=this.loader.addCallback(new paella.editor.EmbedPlayer());this.loader.load(function(){a.onLoadSuccess()},function(){a.onLoadFail()})},onLoadSuccess:function(){this.isLoaded=true;var a=this;this.onresize();$(window).resize(function(b){a.onresize()});$(document).trigger(paella.events.play);new Timer(function(b){$(document).trigger(paella.events.pause)},100);paella.events.bind(paella.events.documentChanged,function(b,c){window.onbeforeunload=function(d){return paella.dictionary.translate("There are unsaved changes")}});paella.events.bind(paella.events.didSaveChanges,function(b,c){window.onbeforeunload=null})},onLoadFail:function(){},unloadEditor:function(){paella.keyManager.enabled=true;this.embedPlayer.restorePlayer();$("body")[0].removeChild(this.editorContainer);$("body")[0].style.backgroundImage="";this.editorContainer=null;this.isLoaded=false;$(document).trigger(paella.events.hideEditor)},onresize:function(){if(this.isLoaded){this.bottomBar.onresize();this.rightBar.onresize();this.embedPlayer.onresize()}}});var EditControl=Class.create(paella.DomNode,{buttonId:"",initialize:function(c){this.buttonId=c+"_button";var a={position:"absolute",top:"0px",right:"0px"};this.parent("div",c,a);this.domElement.className="editControlContainer";var b=this;this.addNode(new paella.Button(this.buttonId,"editButton",function(d){b.toggleEditor()},false))},toggleEditor:function(){if((paella.extended)||(window!=window.top)){window.open("index.html?id="+paella.player.videoIdentifier)}else{$(document).trigger(paella.events.showEditor)}},getButton:function(){return this.getNode(this.buttonId)}});paella.editor.ToolStatusPlugin=Class.create(paella.editor.RightBarPlugin,{currentTrack:null,currentTextField:null,trackItemContainer:null,selectedColor:"rgb(255, 255, 236)",initialize:function(){this.parent();if(paella.utils.language()=="es"){var a={Tool:"Herramienta","Selected tool":"Herramienta seleccionada","this track does not contain any item":"esta pista no contiene ningún elemento","Click on timeline outside any track to select current playback time.":"Haz clic en el fondo de la línea de tiempo para establecer el instante actual de reproducción","Quick help":"Ayuda rápida",item:"elemento",items:"elementos",from:"desde",to:"hasta"};paella.dictionary.addDictionary(a)}},getIndex:function(){return 10000},getName:function(){return"es.upv.paella.editor.toolStatusPlugin"},getTabName:function(){return paella.dictionary.translate("Tool")},getContent:function(){this.currentTextField=null;var d=document.createElement("div");if(this.currentTrack){var c=paella.pluginManager.getPlugin(this.currentTrack.getName());d.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate(this.currentTrack.getTrackName())+"</h6>";var e=this.currentTrack.getTrackItems();var a=document.createElement("div");a.className="editorPluginToolStatus_trackItemList";this.trackItemContainer=a;c.buildToolTabContent(a);if(a.childNodes.length==0){for(var b=0;b<e.length;++b){this.addTrackData(a,e[b])}}d.appendChild(a)}else{d.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate("Selection")+"</h6>"}this.addToolHelp(d);return d},addTrackData:function(b,a){var d=document.createElement("div");var e=document.createElement("div");var c=Math.round((a.e-a.s)*100)/100;e.innerHTML=paella.dictionary.translate("from")+" "+paella.utils.timeParse.secondsToTime(a.s)+" "+paella.dictionary.translate("to")+" "+paella.utils.timeParse.secondsToTime(a.e)+", "+c+" sec";d.appendChild(e);if(a.content){this.addTrackContent(d,a.id,a.content,a.s,a.e)}b.appendChild(d)},addTrackContent:function(d,h,e,g,c){var a=null;var b=this;if(this.currentTrack.allowEditContent()){a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id","trackContentEditor_"+h);a.setAttribute("value",e);a.trackData={id:h,content:e,s:g,e:c};a.plugin=this.currentTrack;$(a).change(function(i){this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName())});$(a).click(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});$(a).focus(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});var f=paella.editor.instance.bottomBar.timeline.currentTrackList.currentTrack.trackInfo.trackData.id;if(f==h){this.currentTextField=a;this.currentTextField.style.backgroundColor=this.selectedColor}}else{a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id",h);a.setAttribute("disabled","disabled");a.setAttribute("style","color:rgb(119, 119, 119)");a.setAttribute("value",e)}d.appendChild(a)},onFocusChanged:function(d,a,c){if(this.currentTextField){this.currentTextField.style.backgroundColor="#fff"}d.style.backgroundColor=this.selectedColor;paella.editor.instance.bottomBar.timeline.focusTrackListItem(a.getName(),c.id);this.currentTextField=d;var b=c.e;$(document).trigger(paella.events.seekToTime,{time:b})},onLoadFinished:function(){if(this.currentTextField){this.trackItemContainer.scrollTop=$(this.currentTextField).position().top}},addToolHelp:function(c){var b="";if(this.currentTrack){b=this.currentTrack.contextHelpString()}else{b=paella.dictionary.translate("Click on timeline outside any track to select current playback time.")}if(b!=""){var a=document.createElement("div");a.className="editorPluginToolStatusHelp";c.appendChild(a);a.innerHTML="<strong>"+paella.dictionary.translate("Quick help")+": </strong>"+b}},onTrackSelected:function(a){this.currentTrack=a}});new paella.editor.ToolStatusPlugin();paella.plugins.BreaksEditorPlugin=Class.create(paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(b){var a=this;this.tracks=[];paella.data.read("breaks",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.breaks&&d.breaks.length>0){a.tracks=d.breaks}b(true)})},setup:function(){if(paella.utils.language()=="es"){var a={Breaks:"Descansos",Break:"Descanso","Create a new break in the current position":"Añade un descanso en el instante actual","Delete selected break":"Borra el descanso seleccionado"};paella.dictionary.addDictionary(a)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:paella.dictionary.translate("Create"),hint:paella.dictionary.translate("Create a new break in the current position")},{name:"delete",label:paella.dictionary.translate("Delete"),hint:paella.dictionary.translate("Delete selected break")}]},onToolSelected:function(c){if(this.selectedTrackItem&&c=="delete"&&this.selectedTrackItem){paella.events.trigger(paella.events.documentChanged);this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);return true}else{if(c=="create"){paella.events.trigger(paella.events.documentChanged);var e=paella.player.videoContainer.currentTime();var a=e+30;var d=this.getTrackUniqueId();var b=paella.dictionary.translate("Break");this.tracks.push({id:d,s:e,e:a,content:b,name:b});return true}}},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.trackBreaks"},getTrackName:function(){return paella.dictionary.translate("Breaks")},getColor:function(){return"rgb(226, 228, 204)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(d,c,a){paella.events.trigger(paella.events.documentChanged);var b=this.getTrackItem(d);if(b){b.s=c;b.e=a;this.selectedTrackItem=b}},onTrackContentChanged:function(c,b){paella.events.trigger(paella.events.documentChanged);var a=this.getTrackItem(c);if(a){a.content=b;a.name=b}},allowEditContent:function(){return true},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},contextHelpString:function(){if(paella.utils.language()=="es"){return"Utiliza esta herramienta para crear, borrar y editar descansos. Para crear un descanso, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los descansos"}else{return"Use this tool to create, delete and edit breaks. To create a break, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the break text."}},onSave:function(b){var a={breaks:this.tracks};paella.data.write("breaks",{id:paella.initDelegate.getId()},a,function(d,c){paella.plugins.breaksPlayerPlugin.breaks=a.breaks;b(c)})}});paella.plugins.breaksEditorPlugin=new paella.plugins.BreaksEditorPlugin();paella.plugins.BreaksPlayerPlugin=Class.create(paella.EventDrivenPlugin,{breaks:null,lastEvent:0,visibleBreaks:null,getName:function(){return"es.upv.paella.BreaksPlayerPlugin"},checkEnabled:function(b){var a=this;this.breaks=[];this.visibleBreaks=[];paella.data.read("breaks",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.breaks&&d.breaks.length>0){a.breaks=d.breaks}b(true)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(a,b){this.checkBreaks(b)},checkBreaks:function(e){for(var d=0;d<this.breaks.length;++d){var b=this.breaks[d];if(b.s<e.currentTime&&b.e>e.currentTime){this.showBreaks(b)}else{if(b.s.toFixed(0)==e.currentTime.toFixed(0)){this.avoidBreak(b)}}}for(var c in this.visibleBreaks){if(typeof(b)=="object"){var b=this.visibleBreaks[c];if(b&&(b.s>=e.currentTime||b.e<=e.currentTime)){this.removeBreak(b)}}}},showBreaks:function(a){if(!this.visibleBreaks[a.s]){var b={left:100,top:350,width:1080,height:20};a.elem=paella.player.videoContainer.overlayContainer.addText(a.content,b);a.elem.className="textBreak";this.visibleBreaks[a.s]=a}},removeBreak:function(a){if(this.visibleBreaks[a.s]){var b=this.visibleBreaks[a.s].elem;paella.player.videoContainer.overlayContainer.removeElement(b);this.visibleBreaks[a.s]=null}},avoidBreak:function(a){var b=a.e;paella.events.trigger(paella.events.seekToTime,{time:b})}});paella.plugins.breaksPlayerPlugin=new paella.plugins.BreaksPlayerPlugin();paella.plugins.CaptionsEditorPlugin=Class.create(paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(b){var a=this;this.tracks=[];paella.data.read("captions",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.captions&&d.captions.length>0){a.tracks=d.captions}b(true)})},setup:function(){if(paella.utils.language()=="es"){var a={Captions:"Subtítulos",Caption:"Subtítulo","Create a new caption in the current position":"Añade un subtítulo en el instante actual","Delete selected caption":"Borra el subtítulo seleccionado"};paella.dictionary.addDictionary(a)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:paella.dictionary.translate("Create"),hint:paella.dictionary.translate("Create a new caption in the current position")},{name:"delete",label:paella.dictionary.translate("Delete"),hint:paella.dictionary.translate("Delete selected caption")}]},onToolSelected:function(c){if(this.selectedTrackItem&&c=="delete"&&this.selectedTrackItem){paella.events.trigger(paella.events.documentChanged);this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);return true}else{if(c=="create"){paella.events.trigger(paella.events.documentChanged);var e=paella.player.videoContainer.currentTime();var a=e+30;var d=this.getTrackUniqueId();var b=paella.dictionary.translate("Caption");this.tracks.push({id:d,s:e,e:a,content:b,name:b});return true}}},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.trackCaptions"},getTrackName:function(){return paella.dictionary.translate("Captions")},getColor:function(){return"rgb(159, 166, 88)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(d,c,a){paella.events.trigger(paella.events.documentChanged);var b=this.getTrackItem(d);if(b){b.s=c;b.e=a;this.selectedTrackItem=b}},onTrackContentChanged:function(c,b){paella.events.trigger(paella.events.documentChanged);var a=this.getTrackItem(c);if(a){a.content=b;a.name=b}},allowEditContent:function(){return true},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},contextHelpString:function(){if(paella.utils.language()=="es"){return"Utiliza esta herramienta para crear, borrar y editar subtítulos. Para crear un subtítulo, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los subtítulos"}else{return"Use this tool to create, delete and edit video captions. To create a caption, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the caption text."}},onSave:function(b){var a={captions:this.tracks};paella.data.write("captions",{id:paella.initDelegate.getId()},a,function(d,c){paella.plugins.captionsPlayerlugin.captions=a.captions;b(c)})}});paella.plugins.captionsEditorPlugin=new paella.plugins.CaptionsEditorPlugin();paella.plugins.CaptionsPlayerPlugin=Class.create(paella.EventDrivenPlugin,{captions:null,lastEvent:0,visibleCaptions:null,getName:function(){return"es.upv.paella.CaptionsPlayerPlugin"},checkEnabled:function(b){var a=this;this.captions=[];this.visibleCaptions=[];paella.data.read("captions",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.captions&&d.captions.length>0){a.captions=d.captions}b(true)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(a,b){this.checkCaptions(b)},checkCaptions:function(e){for(var d=0;d<this.captions.length;++d){var b=this.captions[d];if(b.s<e.currentTime&&b.e>e.currentTime){this.showCaption(b)}}for(var c in this.visibleCaptions){if(typeof(b)=="object"){var b=this.visibleCaptions[c];if(b&&(b.s>=e.currentTime||b.e<=e.currentTime)){this.removeCaption(b)}}}},showCaption:function(a){if(!this.visibleCaptions[a.s]){var b={left:100,top:650,width:1080,height:20};a.elem=paella.player.videoContainer.overlayContainer.addText(a.content,b);a.elem.className="textCaption";this.visibleCaptions[a.s]=a}},removeCaption:function(a){if(this.visibleCaptions[a.s]){var b=this.visibleCaptions[a.s].elem;paella.player.videoContainer.overlayContainer.removeElement(b);this.visibleCaptions[a.s]=null}}});paella.plugins.captionsPlayerlugin=new paella.plugins.CaptionsPlayerPlugin();paella.plugins.CommentsPlugin=Class.create(paella.TabBarPlugin,{id:null,divRoot:null,divPublishComment:null,divComments:null,divLoading:null,getSubclass:function(){return"showCommentsTabBar"},getName:function(){return"es.upv.paella.commentsPlugin"},getTabName:function(){return"Comentarios"},domElement:null,buildContent:function(a){this.domElement=a;this.loadContent()},action:function(a){this.loadContent()},loadContent:function(){var a=this.domElement;a.innerHTML="Loading...";new paella.Timer(function(b){a.innerHTML="Loading done"},2000)}});paella.plugins.commentsPlugin=new paella.plugins.CommentsPlugin();paella.plugins.ConsolidateEditorPlugin=Class.create(paella.editor.TrackPlugin,{tracks:null,selectedTrackItem:null,checkEnabled:function(b){var a=this;this.tracks=[];paella.data.read("consolidate",{id:paella.initDelegate.getId()},function(d,c){if(d&&typeof(d)=="object"&&d.consolidate&&d.consolidate.length>0){a.tracks=d.consolidate}b(true)})},setup:function(){if(paella.utils.language()=="es"){var a={Create:"Crear",Delete:"Borrar",};paella.dictionary.addDictionary(a)}},getTrackItems:function(){return this.tracks},getTools:function(){return[{name:"create",label:paella.dictionary.translate("Create"),hint:paella.dictionary.translate("Create a new XX in the current position")},{name:"delete",label:paella.dictionary.translate("Delete"),hint:paella.dictionary.translate("Delete selected XX")}]},onToolSelected:function(c){if(this.selectedTrackItem&&c=="delete"&&this.selectedTrackItem){paella.events.trigger(paella.events.documentChanged);this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);return true}else{if(c=="create"){paella.events.trigger(paella.events.documentChanged);var e=paella.player.videoContainer.currentTime();var a=e+30;var d=this.getTrackUniqueId();var b=paella.dictionary.translate("Consolidate");this.tracks.push({id:d,s:e,e:a,content:b,name:b});return true}}},getTrackUniqueId:function(){var a=-1;if(this.tracks.length==0){return 1}for(var b=0;b<this.tracks.length;++b){if(a<=this.tracks[b].id){a=this.tracks[b].id+1}}return a},getName:function(){return"es.upv.paella.editor.TrackConsolidate"},getTrackName:function(){return paella.dictionary.translate("Consolidate")},getColor:function(){return"rgb(212, 212, 224)"},getTextColor:function(){return"rgb(90,90,90)"},onTrackChanged:function(e,d,a){paella.events.trigger(paella.events.documentChanged);var c=this.getTrackItem(e);if(c){if(this.tracks.length!=0){for(var b=0;b<this.tracks.length;++b){if(e!=this.tracks[b].id){if(a>this.tracks[b].s&&d<this.tracks[b].e){if(d<this.tracks[b].s){a=this.tracks[b].s}if(a>this.tracks[b].e){d=this.tracks[b].e}if(d>this.tracks[b].s&&a<this.tracks[b].e){a=0;d=0}}}}}c.s=d;c.e=a;c.d=a-d;this.selectedTrackItem=c}},onTrackContentChanged:function(c,b){paella.events.trigger(paella.events.documentChanged);var a=this.getTrackItem(c);if(a){a.content=b;a.name=b}},allowEditContent:function(){return true},getTrackItem:function(b){for(var a=0;a<this.tracks.length;++a){if(this.tracks[a].id==b){return this.tracks[a]}}},contextHelpString:function(){if(paella.utils.language()=="es"){return"Utiliza esta herramienta para crear, borrar y editar xxx. Para crear una xxx, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de las anotaciones"}else{return"Use this tool to create, delete and edit video consolidate. To create an xxx, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the xxx text."}},buildToolTabContent:function(a){},onSave:function(b){var a={consolidate:this.tracks};paella.data.write("consolidate",{id:paella.initDelegate.getId()},a,function(d,c){b(c)})}});paella.plugins.consolidateEditorPlugin=new paella.plugins.ConsolidateEditorPlugin();paella.editor.ConsolidatePlugin=Class.create(paella.editor.RightBarPlugin,{currentTrack:null,currentTextField:null,trackItemContainer:null,selectedColor:"rgb(255, 255, 236)",getIndex:function(){return 10001},getName:function(){return"es.upv.paella.editor.consolidatePlugin"},getTabName:function(){return"Consolidate"},getContent:function(){this.currentTextField=null;var c=document.createElement("div");if(this.currentTrack&&this.currentTrack.getTrackName()=="Consolidate"){c.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate(this.currentTrack.getTrackName())+"</h6>";var d=this.currentTrack.getTrackItems();var a=document.createElement("div");a.className="editorPluginConsolidate_trackItemList";this.trackItemContainer=a;for(var b=0;b<d.length;++b){this.addTrackData(a,d[b])}c.appendChild(a);this.addToolHelp(c)}else{c.innerHTML+="<p> No hay opciones que mostrar para esta herramienta.</p>"}return c},addTrackData:function(b,a){var d=document.createElement("div");var e=document.createElement("div");var c=Math.round((a.e-a.s)*100)/100;e.innerHTML=paella.dictionary.translate("from")+" "+paella.utils.timeParse.secondsToTime(a.s)+" "+paella.dictionary.translate("to")+" "+paella.utils.timeParse.secondsToTime(a.e)+", "+c+" sec";d.appendChild(e);if(a.content){this.addTrackContent(d,a.id,a.content,a.s,a.e)}b.appendChild(d)},addTrackContent:function(d,h,e,g,c){var a=null;var b=this;if(this.currentTrack.allowEditContent()){a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id","trackContentEditor_"+h);a.setAttribute("value",e);a.trackData={id:h,content:e,s:g,e:c};a.plugin=this.currentTrack;$(a).change(function(i){this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName())});$(a).click(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});$(a).focus(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});var f=paella.editor.instance.bottomBar.timeline.currentTrackList.currentTrack.trackInfo.trackData.id;if(f==h){this.currentTextField=a;this.currentTextField.style.backgroundColor=this.selectedColor}}else{a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id",h);a.setAttribute("disabled","disabled");a.setAttribute("style","color:rgb(119, 119, 119)");a.setAttribute("value",e)}d.appendChild(a)},onFocusChanged:function(d,a,c){if(this.currentTextField){this.currentTextField.style.backgroundColor="#fff"}d.style.backgroundColor=this.selectedColor;paella.editor.instance.bottomBar.timeline.focusTrackListItem(a.getName(),c.id);this.currentTextField=d;var b=c.e;$(document).trigger(paella.events.seekToTime,{time:b})},onLoadFinished:function(){if(this.currentTextField){this.trackItemContainer.scrollTop=$(this.currentTextField).position().top}},addToolHelp:function(c){var b="";if(this.currentTrack){b=this.currentTrack.contextHelpString()}else{b="Texto de ayuda PROVISIONAL"}if(b!=""){var a=document.createElement("div");a.className="editorPluginConsolidateHelp";c.appendChild(a);a.innerHTML="<strong>"+paella.dictionary.translate("Quick help")+": </strong>"+b}},onTrackSelected:function(a){this.currentTrack=a},addElement:function(){var a=document.createElement("div")}});new paella.editor.ConsolidatePlugin();paella.plugins.DescriptionPlugin=Class.create(paella.TabBarPlugin,{getSubclass:function(){return"showDescriptionTabBar"},getName:function(){return"es.upv.paella.descriptionPlugin"},getTabName:function(){return"Descripción"},domElement:null,buildContent:function(a){this.domElement=a;this.loadContent()},action:function(a){this.loadContent()},loadContent:function(){var a=this.domElement;a.innerHTML="Loading...";new paella.Timer(function(b){a.innerHTML="Loading done"},2000)}});paella.plugins.descriptionPlugin=new paella.plugins.DescriptionPlugin();paella.plugins.ExtendedProfilesPlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,extendedModes:null,getAlignment:function(){return"right"},getSubclass:function(){return"showExtendedProfilesButton"},getIndex:function(){return 102},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.extendedProfilesPlugin"},checkEnabled:function(a){a(paella.extended)},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(e){var a=this;this.buttonItems={};extendedModes=["fullScr","full","big","small"];for(var d in extendedModes){var c=extendedModes[d];var b=a.getProfileItemButton(d,c);a.buttonItems[d]=b;e.appendChild(b)}},getProfileItemButton:function(a,c){var b=document.createElement("div");b.className="extendedProfilesItemButton "+c;b.id=a+"_button";b.data={profile:a,profileData:c,plugin:this};$(b).click(function(d){this.data.plugin.onItemClick(b,this.data.profile,this.data.profileData)});return b},onItemClick:function(a,b,c){if(c=="fullScr"){this.switchFullScreen(b,c)}else{if(this.isFullscreen()){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.cancelFullScreen){document.cancelFullScreen()}}}this.buttonItems[0].className=this.getButtonItemClass(c,false)}this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className=this.getButtonItemClass(paella.extended.getProfile(),false);this.buttonItems[b].className=this.getButtonItemClass(c,true);paella.extended.setProfile(a.data.profileData)}paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})},getButtonItemClass:function(b,a){return"extendedProfilesItemButton "+b+((a)?" selected":"")},switchFullScreen:function(b,c){var a=document.getElementById(paella.player.mainContainer.id);a.style.width="100%";a.style.height="100%";if(this.isFullscreen()){this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className=this.getButtonItemClass(paella.extended.getProfile(),true);if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();this.buttonItems[b].className=this.getButtonItemClass(c,false)}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();this.buttonItems[b].className=this.getButtonItemClass(c,false)}else{if(document.cancelFullScreen){document.cancelFullScreen();this.buttonItems[b].className=this.getButtonItemClass(c,false)}}}}else{this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className=this.getButtonItemClass(paella.extended.getProfile(),false);if(a.webkitRequestFullScreen){a.webkitRequestFullScreen();this.buttonItems[b].className=this.getButtonItemClass(c,true)}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen();this.buttonItems[b].className=this.getButtonItemClass(c,true)}else{if(a.requestFullScreen()){a.requestFullScreen();this.buttonItems[b].className=this.getButtonItemClass(c,true)}else{alert("Your browser does not support fullscreen mode")}}}}},isFullscreen:function(){if(document.webkitIsFullScreen!=undefined){return document.webkitIsFullScreen}else{if(document.mozFullScreen!=undefined){return document.mozFullScreen}}return false}});paella.plugins.extendedProfilesPlugin=new paella.plugins.ExtendedProfilesPlugin();paella.plugins.FootPrintsPlugin=Class.create(paella.ButtonPlugin,{INTERVAL_LENGTH:5,inPosition:0,outPosition:0,canvas:null,footPrintsTimer:null,footPrintsData:{},getAlignment:function(){return"right"},getSubclass:function(){return"footPrints"},getIndex:function(){return 1002},getMinWindowSize:function(){return 700},getName:function(){return"es.upv.paella.FootPrintsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},setup:function(){var a=this;paella.events.bind(paella.events.timeUpdate,function(b){a.onTimeUpdate()})},checkEnabled:function(a){a(true)},buildContent:function(b){var a=document.createElement("div");a.className="footPrintsContainer";this.canvas=document.createElement("canvas");this.canvas.id="footPrintsCanvas";this.canvas.className="footPrintsCanvas";a.appendChild(this.canvas);b.appendChild(a)},onTimeUpdate:function(){var a=Math.round(paella.player.videoContainer.currentTime()+paella.player.videoContainer.trimStart());if(this.inPosition<=a&&a<=this.inPosition+this.INTERVAL_LENGTH){this.outPosition=a;if(this.inPosition+this.INTERVAL_LENGTH===this.outPosition){this.trackFootPrint(this.inPosition,this.outPosition);this.inPosition=this.outPosition}}else{this.trackFootPrint(this.inPosition,this.outPosition);this.inPosition=a;this.outPosition=a}},trackFootPrint:function(a,b){var c={"in":a,out:b};paella.data.write("footprints",{id:paella.initDelegate.getId()},c)},willShowContent:function(){var a=this;this.loadFootprints();this.footPrintsTimer=new paella.utils.Timer(function(b){a.loadFootprints()},5000);this.footPrintsTimer.repeat=true},didHideContent:function(){if(this.footPrintsTimer!=null){this.footPrintsTimer.cancel();this.footPrintsTimer=null}},loadFootprints:function(){var a=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(e,d){var l={};var b=Math.floor(paella.player.videoContainer.duration());var k=Math.floor(paella.player.videoContainer.trimStart());var g=-1;var h=0;for(var f=0;f<e.length;f++){position=e[f].position-k;if(position<b){views=e[f].views;if(position-1!=g){for(var c=g+1;c<position;c++){l[c]=h}}l[position]=views;g=position;h=views}}a.drawFootPrints(l)})},drawFootPrints:function(d){if(this.canvas){var e=Object.keys(d).length;var a=this.canvas.getContext("2d");var c=0;for(var b=0;b<e;++b){if(d[b]>c){c=d[b]}}this.canvas.setAttribute("width",e);this.canvas.setAttribute("height",c);a.clearRect(0,0,this.canvas.width,this.canvas.height);a.fillStyle="#9ED4EE";a.strokeStyle="#0000FF";a.lineWidth=2;a.webkitImageSmoothingEnabled=false;a.mozImageSmoothingEnabled=false;for(var b=0;b<e-1;++b){a.beginPath();a.moveTo(b,c);a.lineTo(b,c-d[b]);a.lineTo(b+1,c-d[b+1]);a.lineTo(b+1,c);a.closePath();a.fill();a.beginPath();a.moveTo(b,c-d[b]);a.lineTo(b+1,c-d[b+1]);a.closePath();a.stroke()}}}});paella.plugins.footPrintsPlugin=new paella.plugins.FootPrintsPlugin();paella.plugins.FrameControlPlugin=Class.create(paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,navButtons:null,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 100},getMinWindowSize:function(){return 400},getName:function(){return"es.upv.paella.FrameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},checkEnabled:function(a){a(paella.initDelegate.initParams.videoLoader.frameList!=null)},buildContent:function(e){this.frames=[];var a=document.createElement("div");a.className="frameControlContainer";var h=document.createElement("div");h.className="frameControlContent";this.navButtons={left:document.createElement("div"),right:document.createElement("div")};this.navButtons.left.className="frameControl navButton left";this.navButtons.right.className="frameControl navButton right";var c=this.getFrame(null);e.appendChild(this.navButtons.left);e.appendChild(a);a.appendChild(h);e.appendChild(this.navButtons.right);this.navButtons.left.scrollContainer=a;$(this.navButtons.left).click(function(k){this.scrollContainer.scrollLeft-=100});this.navButtons.right.scrollContainer=a;$(this.navButtons.right).click(function(k){this.scrollContainer.scrollLeft+=100});h.appendChild(c);var g=$(c).outerWidth(true);h.innerHTML="";var i=paella.initDelegate.initParams.videoLoader.frameList;if(i){var f=0;for(var j in i){var d=this.getFrame(i[j]);h.appendChild(d,"frameContrlItem_"+f);this.frames.push(d);++f}}$(h).css({width:(f*g)+"px"});var b=this;paella.events.bind(paella.events.setTrim,function(k,l){b.checkVisibility(l.trimEnabled,l.trimStart,l.trimEnd)});paella.events.bind(paella.events.timeupdate,function(k,l){b.onTimeUpdate(l.currentTime)});this.checkHighResFrames()},checkHighResFrames:function(){var a=paella.initDelegate.initParams.videoLoader.streams.length>=2?paella.initDelegate.initParams.videoLoader.streams[1]:null;if(a&&a.sources.image){this.highResFrames={};for(var b in a.sources.image.frames){var c=a.sources.image.frames[b];this.highResFrames[b]=c}}},showHiResFrame:function(b){var e=document.createElement("div");var c=document.createElement("div");var a=document.createElement("img");a.className="frameHiRes";a.setAttribute("src",b);a.setAttribute("style","width: 100%;");$(c).append(a);$(e).append(c);e.setAttribute("style","display: table;");c.setAttribute("style","display: table-cell; vertical-align:middle;");overlayContainer=paella.player.videoContainer.overlayContainer;var d=paella.initDelegate.initParams.videoLoader.streams;if(d.length==1){overlayContainer.addElement(e,overlayContainer.getMasterRect())}else{if(d.length>=2){overlayContainer.addElement(e,overlayContainer.getSlaveRect())}}overlayContainer.enableBackgroundMode();this.hiResFrame=e},removeHiResFrame:function(){overlayContainer=paella.player.videoContainer.overlayContainer;overlayContainer.removeElement(this.hiResFrame);overlayContainer.disableBackgroundMode()},checkVisibility:function(a,e,f){if(!a){for(var c=0;c<this.frames.length;++c){$(this.frames[c]).show()}}else{for(var c=0;c<this.frames.length;++c){var b=this.frames[c];var d=b.frameData;if(d.time<e){if(this.frames.length>c+1&&this.frames[c+1].frameData.time>e){$(b).show()}else{$(b).hide()}}else{if(d.time>f){$(b).hide()}else{$(b).show()}}}}},getFrame:function(a,c){var b=document.createElement("div");b.className="frameControlItem";if(c){b.id=c}if(a){b.frameData=a;b.frameControl=this;b.innerHTML='<img src="'+a.url+'" alt="" class="frameControlImage"></img>';$(b).mouseover(function(d){this.frameControl.onMouseOver(d,this.frameData)});$(b).mouseout(function(d){this.frameControl.onMouseOut(d,this.frameData)});$(b).click(function(d){this.frameControl.onClick(d,this.frameData)})}return b},onMouseOver:function(b,a){if(this.highResFrames){var c=this.highResFrames["frame_"+a.time];if(c){this.showHiResFrame(c)}}},onMouseOut:function(b,a){this.removeHiResFrame()},onClick:function(b,a){paella.events.trigger(paella.events.seekToTime,{time:a.time+1})},onTimeUpdate:function(b){var c=null;for(var a=0;a<this.frames.length;++a){if(this.frames[a].frameData.time<=b){c=this.frames[a]}else{break}}if(this.currentFrame!=c){if(this.currentFrame){this.currentFrame.className="frameControlItem"}this.currentFrame=c;this.currentFrame.className="frameControlItem current"}}});paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin();paella.plugins.FullScreenPlugin=Class.create(paella.ButtonPlugin,{getIndex:function(){return 104},getAlignment:function(){return"right"},getSubclass:function(){return"showFullScreenButton"},getName:function(){return"es.upv.paella.fullScreenButtonPlugin"},checkEnabled:function(a){a(!paella.extended)},action:function(b){var a=document.getElementById(paella.player.mainContainer.id);a.style.width="100%";a.style.height="100%";if(this.isFullscreen()){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();b.className=this.getButtonItemClass(false)}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();b.className=this.getButtonItemClass(false)}else{if(document.cancelFullScreen){document.cancelFullScreen();b.className=this.getButtonItemClass(false)}}}}else{if(a.webkitRequestFullScreen){a.webkitRequestFullScreen();b.className=this.getButtonItemClass(true)}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen();b.className=this.getButtonItemClass(true)}else{if(a.requestFullScreen()){a.requestFullScreen();b.className=this.getButtonItemClass(true)}else{alert("Your browser does not support fullscreen mode")}}}}},isFullscreen:function(){if(document.webkitIsFullScreen!=undefined){return document.webkitIsFullScreen}else{if(document.mozFullScreen!=undefined){return document.mozFullScreen}}return false},getButtonItemClass:function(a){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+((a)?" active":"")}});paella.plugins.fullScreenPlugin=new paella.plugins.FullScreenPlugin();paella.plugins.PlayPauseButtonPlugin=Class.create(paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"es.upv.paella.playPauseButtonPlugin"},setup:function(){var a=this;paella.events.bind(paella.events.play,function(b){a.changeSubclass(a.pauseSubclass)});paella.events.bind(paella.events.pause,function(b){a.changeSubclass(a.playSubclass)})},action:function(a){if(paella.player.videoContainer.paused()){paella.events.trigger(paella.events.play)}else{paella.events.trigger(paella.events.pause)}}});paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin();paella.plugins.PlayButtonOnScreen=Class.create(paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:true,isPlaying:false,initPlugin:function(){this.container=document.createElement("div");this.container.className="playButtonOnScreen";this.container.id=this.containerId;paella.player.videoContainer.domElement.appendChild(this.container);var b=this;$(this.container).click(function(d){b.onPlayButtonClick()});var c=document.createElement("canvas");c.className="playButtonOnScreenIcon";c.setAttribute("width",300);c.setAttribute("height",300);var a=c.getContext("2d");a.beginPath();a.arc(150,150,140,0,2*Math.PI,true);a.closePath();a.strokeStyle="white";a.lineWidth=10;a.stroke();a.fillStyle="#8f8f8f";a.fill();a.beginPath();a.moveTo(100,70);a.lineTo(250,150);a.lineTo(100,230);a.lineTo(100,70);a.closePath();a.fillStyle="white";a.fill();a.stroke();this.container.appendChild(c)},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor,paella.events.loadComplete]},onEvent:function(a,b){switch(a){case paella.events.loadComplete:this.initPlugin();break;case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor();break}},onPlayButtonClick:function(){$(document).trigger(paella.events.play)},endVideo:function(){this.isPlaying=false;this.checkStatus()},play:function(){this.isPlaying=true;this.checkStatus()},pause:function(){this.isPlaying=false;this.checkStatus()},showEditor:function(){this.enabled=false;this.checkStatus()},hideEditor:function(){this.enabled=true;this.checkStatus()},checkStatus:function(){if((this.enabled&&this.isPlaying)||!this.enabled){$(this.container).hide()}else{$(this.container).show()}},checkEnabled:function(a){a(true)},getIndex:function(){return 1010},getName:function(){return"es.upv.paella.playButtonOnScreen"}});new paella.plugins.PlayButtonOnScreen();paella.plugins.RepeatButtonPlugin=Class.create(paella.ButtonPlugin,{repeatSubclass:"repeatButton",getAlignment:function(){return"left"},getSubclass:function(){return this.repeatSubclass},getName:function(){return"es.upv.paella.repeatButtonPlugin"},action:function(a){var b=paella.player.videoContainer.currentTime()-30;paella.events.trigger(paella.events.seekToTime,{time:b})}});paella.plugins.repeatButtonPlugin=new paella.plugins.RepeatButtonPlugin();paella.plugins.SocialPlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,socialMedia:null,getAlignment:function(){return"right"},getSubclass:function(){return"showSocialPluginButton"},getIndex:function(){return 103},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.socialPlugin"},checkEnabled:function(a){a(true)},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(e){var a=this;this.buttonItems={};socialMedia=["facebook","twitter"];for(var d in socialMedia){var c=socialMedia[d];var b=a.getSocialMediaItemButton(c);a.buttonItems[d]=b;e.appendChild(b)}},getSocialMediaItemButton:function(a){var b=document.createElement("div");b.className="socialItemButton "+a;b.id=a+"_button";b.data={mediaData:a,plugin:this};$(b).click(function(c){this.data.plugin.onItemClick(this.data.mediaData)});return b},onItemClick:function(b){var a=this.getVideoUrl();switch(b){case ("twitter"):window.open("http://twitter.com/home?status="+a);break;case ("facebook"):window.open("http://www.facebook.com/sharer.php?u="+a);break}paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})},getVideoUrl:function(){var a=document.location.href;return a}});paella.plugins.socialPlugin=new paella.plugins.SocialPlugin();paella.plugins.TrimmingLoaderPlugin=Class.create(paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.TrimmingPlayerPlugin"},checkEnabled:function(a){a(paella.player.config.trimming&&paella.player.config.trimming.enabled)},getEvents:function(){return[paella.events.loadComplete,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(a,b){switch(a){case paella.events.loadComplete:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:if(paella.player.config.trimming&&paella.player.config.trimming.enabled){paella.player.videoContainer.enableTrimming()}break}},loadTrimming:function(){var a=paella.initDelegate.getId();paella.data.read("trimming",{id:a},function(c,b){if(c&&b&&c.end>0){paella.player.videoContainer.enableTrimming();paella.player.videoContainer.setTrimming(c.start,c.end)}})}});paella.plugins.trimmingLoaderPlugin=new paella.plugins.TrimmingLoaderPlugin();paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){if(this.trimmingTrack==null){this.trimmingTrack={id:1,s:0,e:0};this.trimmingTrack.s=paella.player.videoContainer.trimStart();this.trimmingTrack.e=paella.player.videoContainer.trimEnd();this.trimmingData.s=this.trimmingTrack.s;this.trimmingData.e=this.trimmingTrack.e}var a=[];a.push(this.trimmingTrack);return a},getName:function(){return"es.upv.paella.editor.TrimmingTrackPlugin"},getTrackName:function(){return paella.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},checkEnabled:function(a){a(paella.player.config.trimming&&paella.player.config.trimming.enabled)},onSave:function(a){paella.player.videoContainer.enableTrimming();paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s);paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e);paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(c,b){a(b)})},onDiscard:function(a){this.trimmingTrack.s=this.trimmingData.s;this.trimmingTrack.e=this.trimmingData.e;a(true)},allowDrag:function(){return false},onTrackChanged:function(c,b,a){this.trimmingTrack.s=b;this.trimmingTrack.e=a;this.parent(c,b,a)},contextHelpString:function(){if(paella.utils.language()=="es"){return'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.'}else{return"Use this tool to define the start and finish time."}}});paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin();paella.plugins.ViewModePlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 101},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.viewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(a){a(paella.initDelegate.initParams.videoLoader.streams.length>=2)},buildContent:function(b){var a=this;this.buttonItems={};paella.Profiles.loadProfileList(function(c){for(var e in c){var f=c[e];var d=a.getProfileItemButton(e,f);a.buttonItems[e]=d;b.appendChild(d)}})},getProfileItemButton:function(a,c){var b=document.createElement("div");b.className=this.getButtonItemClass(a,false);b.id=a+"_button";b.data={profile:a,profileData:c,plugin:this};$(b).click(function(d){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)});return b},onItemClick:function(b,c,d){var a=this.buttonItems[paella.player.selectedProfile];var e=this.buttonItems[c];if(e&&a!=e){a.className=this.getButtonItemClass(paella.player.selectedProfile,false);e.className=this.getButtonItemClass(c,true);paella.events.trigger(paella.events.setProfile,{profileName:c});paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})}},getButtonItemClass:function(b,a){return"viewModeItemButton "+b+((a)?" selected":"")}});paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin();
\ No newline at end of file
+paella.editor={};paella.editor.utils={mouse:{mouseDownTarget:"",}};paella.TimeControl=Class.create(paella.DomNode,{initialize:function(b){this.parent("div",b,{left:"0%"});this.domElement.className="timeControlOld";this.domElement.className="timeControl";var a=this;paella.events.bind(paella.events.timeupdate,function(c,d){a.onTimeUpdate(d)})},onTimeUpdate:function(a){var b=a.videoContainer;var g={start:0,end:b.duration};var f={start:b.trimStart(),end:b.trimEnd()};var d=a.currentTime-f.start;var e=f.end-f.start;var c=d*100/e;if(this.domElement.className=="timeControlOld"){this.domElement.style.left=c+"%"}this.domElement.innerHTML=this.secondsToHours(parseInt(d))},secondsToHours:function(b){var a=Math.floor(b/3600);var c=Math.floor((b-(a*3600))/60);var d=b-(a*3600)-(c*60);if(c<10){c="0"+c}if(d<10){d="0"+d}return a+":"+c+":"+d}});paella.PlaybackBar=Class.create(paella.DomNode,{playbackFullId:"",updatePlayBar:true,timeControlId:"",initialize:function(d){var c={};this.parent("div",d,c);this.domElement.className="playbackBar";this.playbackFullId=d+"_full";this.timeControlId=d+"_timeControl";var b=new paella.DomNode("div",this.playbackFullId,{width:"0%"});b.domElement.className="playbackBarFull";this.addNode(b);this.addNode(new paella.TimeControl(this.timeControlId));var a=this;paella.events.bind(paella.events.timeupdate,function(e,f){a.onTimeUpdate(f)});$(this.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(b.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(this.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(b.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(this.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)});$(b.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)})},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(a){this.playbackFull().domElement.style.width=a+"%"},isSeeking:function(){return !this.updatePlayBar},onTimeUpdate:function(a){if(this.updatePlayBar){var b=a.videoContainer;var f={start:0,end:b.duration};var e={start:b.trimStart(),end:b.trimEnd()};var c=a.currentTime-e.start;var d=e.end-e.start;this.setPlaybackPosition(c*100/d)}},down:function(b,a,c){this.updatePlayBar=false;this.move(b,a,c)},move:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}this.setPlaybackPosition(b)},up:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}paella.events.trigger(paella.events.seekTo,{newPositionPercent:b});this.updatePlayBar=true}});paella.PlaybackControl=Class.create(paella.DomNode,{playbackBarId:"",pluginsContainer:null,popUpPluginContainer:null,timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(c){var a=this;var d="buttonPlugin"+this.buttonPlugins.length;var b=paella.ButtonPlugin.buildPluginButton(c,d);c.button=b;this.pluginsContainer.domElement.appendChild(b);$(b).hide();c.checkEnabled(function(g){if(g){$(c.button).show();c.setup();var i="buttonPlugin"+a.buttonPlugins.length;if(c.getButtonType()==paella.ButtonPlugin.type.popUpButton){var f=a.popUpPluginContainer.domElement;var e=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_container");a.popUpPluginContainer.registerContainer(c.getName(),e,b,c)}else{if(c.getButtonType()==paella.ButtonPlugin.type.timeLineButton){var f=a.timeLinePluginContainer.domElement;var h=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_timeline");a.timeLinePluginContainer.registerContainer(c.getName(),h,b,c)}}}})},initialize:function(c){var b={};this.parent("div",c,b);this.domElement.className="playbackControls";this.playbackBarId=c+"_playbackBar";var a=this;this.pluginsContainer=new paella.DomNode("div",c+"_playbackBarPlugins");this.pluginsContainer.domElement.className="playbackBarPlugins";this.addNode(this.pluginsContainer);this.popUpPluginContainer=new paella.PopUpContainer(c+"_popUpPluginContainer","popUpPluginContainer");this.addNode(this.popUpPluginContainer);this.timeLinePluginContainer=new paella.TimelineContainer(c+"_timelinePluginContainer","timelinePluginContainer");this.addNode(this.timeLinePluginContainer);this.addNode(new paella.PlaybackBar(this.playbackBarId));paella.pluginManager.setTarget("button",this)},playbackBar:function(){if(this.playbackBarInstance==null){this.playbackBarInstance=this.getNode(this.playbackBarId)}return this.playbackBarInstance},onresize:function(){paella.debug.log("resize playback bar");var a=$(this.domElement).width();for(var b=0;b<this.buttonPlugins.length;++b){var c=this.buttonPlugins[b];var d=c.getMinWindowSize();if(d>0&&a<d){$(c.container).hide()}else{$(c.container).show()}}}});paella.ControlsContainer=Class.create(paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:true,autohideTimer:null,hideControlsTimeMillis:3000,playbackControlInstance:null,initialize:function(b){this.parent("div",b);this.viewControlId=b+"_view";this.playbackControlId=b+"_playback";this.editControlId=b+"_editor";this.addNode(new paella.PlaybackControl(this.playbackControlId));var a=this;paella.events.bind(paella.events.showEditor,function(c){a.onShowEditor()});paella.events.bind(paella.events.hideEditor,function(c){a.onHideEditor()});paella.events.bind(paella.events.play,function(c){a.onPlayEvent()});paella.events.bind(paella.events.pause,function(c){a.onPauseEvent()});paella.events.bind("mousemove",function(c){a.onMouseMoveEvent()});paella.events.bind(paella.events.endVideo,function(c){a.onEndVideoEvent()})},onShowEditor:function(){var a=this.editControl();if(a){$(a.domElement).hide()}},onHideEditor:function(){var a=this.editControl();if(a){$(a.domElement).show()}},showEditorButton:function(){this.addNode(new EditControl(this.editControlId))},enterEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).hide()}},exitEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).show()}},playbackControl:function(){if(this.playbackControlInstance==null){this.playbackControlInstance=this.getNode(this.playbackControlId)}return this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=false;this.hide()},enable:function(){this.isEnabled=true;this.show()},hide:function(){var a=new UserAgent();if(!a.browser.IsMobileVersion){$(this.domElement).animate({opacity:0},300);paella.events.trigger(paella.events.controlBarWillHide)}else{paella.debug.log("Mobile version: controls will not hide")}},show:function(){if(this.isEnabled){if(this.domElement.style.opacity!=1){this.domElement.style.opacity=1;paella.events.trigger(paella.events.controlBarDidShow)}}},autohideTimeout:function(){var a=this.playbackControl().playbackBar();if(a.isSeeking()){this.restartAutohideTimer()}else{this.hideControls()}},hideControls:function(){this.hide()},showControls:function(){this.show()},onPlayEvent:function(){this.restartAutohideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show();this.clearAutohideTimer()},onMouseMoveEvent:function(){this.showControls();if(paella.player.videoContainer.isReady()&&!paella.player.videoContainer.paused()){this.restartAutohideTimer()}},clearAutohideTimer:function(){if(this.autohideTimer!=null){this.autohideTimer.cancel();this.autohideTimer=null}},restartAutohideTimer:function(){this.clearAutohideTimer();var a=this;this.autohideTimer=new paella.utils.Timer(function(b){a.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}});paella.editor.TrackUtils={buildTrackItemId:function(b,a){return"paellaEditorTrack_"+b+"_"+a},};paella.editor.Track=Class.create({container:null,plugin:null,trackIndex:{back:10,front:20},trackOpacity:{back:0.7,front:1},trackElemList:null,buildTrackItemId:function(b,a){return paella.editor.TrackUtils.buildTrackItemId(b,a)},initialize:function(d,c,b){this.trackElemList=[];this.plugin=c;var a=document.createElement("div");this.container=a;d.appendChild(a);this.buildTracks(a);type=c.getTrackType();if(type=="master"){a.className="editorTrackListItem master "+b}else{if(type=="secondary"){a.className="editorTrackListItem secondary "+b}}},getName:function(){return this.plugin.getName()},rebuild:function(){this.container.innerHTML="";this.buildTracks(this.container)},buildTracks:function(a){var c=this.plugin;var e=c.getTrackItems();for(var b in e){var d=this.getTrack(e[b]);this.trackElemList.push(d);this.container.appendChild(d)}},getTrack:function(d){var k=this;var h=this.plugin;var f=paella.player.videoContainer.duration(true);d.d=d.e-d.s;var c=document.createElement("div");c.className="editorTrackItem "+h.getName();c.id=this.buildTrackItemId(h.getName(),d.id);var a=d.s*100/f;var b=d.d*100/f;$(c).css({left:a+"%",width:b+"%","background-color":h.getColor(),opacity:this.trackOpacity.back});c.trackInfo={trackData:d,plugin:h};var j=document.createElement("div");if(d.name&&d.name!=""){j.innerHTML=d.name}else{j.innerHTML=h.getTrackName()}j.className="editorTrackItemLabel "+this.plugin.getTrackType();j.style.color=h.getTextColor();c.appendChild(j);if(!d.lock){if(h.allowResize()){var i=document.createElement("div");i.className="editorTrackItemResizer left";i.track=c;c.appendChild(i);var e=document.createElement("div");e.className="editorTrackItemResizer right";e.track=c;c.appendChild(e);$(i).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"L",m)});$(e).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"R",m)})}if(h.allowDrag()){var g=document.createElement("div");g.className="editorTrackItemMoveArea";g.track=c;c.appendChild(g);$(g).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"M",m)})}}else{var l=document.createElement("i");l.className="editorTrackItemLock icon-lock icon-white";c.appendChild(l)}$(c).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onTrackDown(this,m)});$(document).mousemove(function(m){k.onResizerMove(m)});$(document).mouseup(function(m){paella.editor.utils.mouse.mouseDownTarget="";k.onResizerUp(this.track,m)});$(c).dblclick(function(m){k.onDblClick(this.trackInfo,m)});return c},currentTrack:null,resizeTrack:null,currentResizer:null,lastPos:{x:0,y:0},selectTrack:function(d,a){if(typeof(d)=="number"){for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c.trackInfo.trackData.id==d){d=c;break}}}if(typeof(d)!="number"&&this.currentTrack!=d){if(!a){this.onUnselect()}for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c==d){this.currentTrack=c;if(!a){this.onSelect(c.trackInfo)}$(c).css({"z-index":this.trackIndex.front,opacity:this.trackOpacity.front})}else{$(c).css({"z-index":this.trackIndex.back,opacity:this.trackOpacity.back})}}}},onSelect:function(a){this.plugin.onSelect(a.trackData)},onDblClick:function(a,b){this.plugin.onDblClick(a.trackData)},onUnselect:function(){this.plugin.onUnselect()},onTrackDown:function(a,b){this.selectTrack(a);paella.editor.instance.bottomBar.toolbar.onToolChanged(this.plugin.getName(),this.plugin.getTrackName())},onResizerDown:function(a,c,b){if(b){this.resizeTrack=a;this.currentResizer=c;this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}},onResizerUp:function(d,a){if(this.resizeTrack){var g=paella.player.videoContainer.duration(true);var i=$(this.container).width();var f=$(this.resizeTrack).position().left;var c=$(this.resizeTrack).width();f=f*100/i;c=c*100/i;var b=f*g/100;var h=(f+c)*g/100;var j=this.resizeTrack.trackInfo.plugin;var e=this.resizeTrack.trackInfo.trackData;j.onTrackChanged(e.id,b,h);paella.editor.pluginManager.onTrackChanged(j);paella.editor.instance.rightBar.updateCurrentTab();paella.editor.instance.bottomBar.timeline.rebuildTrack(j.getName());this.resizeTrack.trackInfo.trackData;$(this.resizeTrack).css({left:f+"%",width:c+"%"})}this.resizeTrack=null},onResizerMove:function(b){if(this.resizeTrack){var e={x:b.clientX-this.lastPos.x,y:b.clientY-this.lastPos.y};var d=paella.player.videoContainer.duration(true);var c=$(this.resizeTrack).position().left;var a=$(this.resizeTrack).width();if(this.currentResizer=="L"){c+=e.x;a-=e.x;$(this.resizeTrack).css({left:c+"px",width:a+"px"})}else{if(this.currentResizer=="R"){a+=e.x;$(this.resizeTrack).css({width:a+"px"})}else{if(this.currentResizer=="M"){c+=e.x;$(this.resizeTrack).css({left:c+"px"})}}}this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}}});
\ No newline at end of file
diff --git a/plugins/plugins.css b/plugins/plugins.css
index b14614e..1505f83 100644
--- a/plugins/plugins.css
+++ b/plugins/plugins.css
@@ -1,50 +1,47 @@
-.editorPluginToolStatusHelp, .editorPluginConsolidateHelp {
-	position: absolute;
-	height: 113px;
-	left: 10px;
-	right: 10px;
-	bottom: 10px;
-	overflow: auto;
+.showSocialPluginButton {
+	background-image: url(social_button.png);
+	background-size: 300%;
 }
 
-.editorPluginToolStatus_trackItemList, .editorPluginConsolidate_trackItemList{
-	position: absolute;
-	overflow: auto;
-	bottom: 123px;
-	top: 65px;
-	left: 10px;
-	right: 10px;
-	box-shadow: inset 0px 0px 10px 2px rgba(0, 0, 0, 0.39);
-	border-radius: 7px;
-	padding-left: 13px;
+.buttonPluginPopUp.showSocialPluginButton {
+	background-image:none;
 }
 
-.trackEditorFieldSelected {
-	background-color: red;
+.buttonPlugin.showSocialPluginButton:hover {
+	background-color: rgb(171,178,178);
 }
 
-.textBreak {
-	background-color: rgba(128,128,128,0.7);
-	text-align: center;
-	color: white;
-	line-height: 17px;
-	font-size: 18px;
-	padding-top: 10px;
-	padding-bottom: 10px;
-	border-radius: 12px;
+.buttonPlugin.showSocialPluginButton.selected {
+	background-position:-80px 0px;
 }
 
-.textCaption {
-	background-color: rgba(128,128,128,0.7);
-	text-align: center;
-	color: white;
-	line-height: 17px;
-	font-size: 18px;
-	padding-top: 10px;
-	padding-bottom: 10px;
-	border-radius: 12px;
+.socialItemButton {  /*crea el popup*/
+	background-repeat:no-repeat;
+	background-size: 200% auto;
+	width: 40px;
+	height: 40px;
+	cursor: pointer;
+	background-color: rgba(128,128,128,0.8);
+}
+
+.socialItemButton:hover {
+	background-color: rgba(90,90,90,0.8);
 }
 
+.socialItemButton.selected {
+	background-position:-40px 0px;
+}
+
+.socialItemButton.facebook{
+	background-image: url(facebook_button.png);
+}
+
+.socialItemButton.twitter {
+	background-image: url(twitter_button.png);
+}
+
+
+
 .CommentPlugin_Loading {
     background-image: url("pluginloading.gif");
     background-repeat: no-repeat;
@@ -67,13 +64,86 @@
 	padding-left: 13px;
 }
 
-/*.bottomContainer.big{
-width: 300px;
-overflow-x:auto;
-overflow-y:hidden;
-}*/
+.comments_entry {
+	margin-top: 5px;	
+	margin-bottom: 5px;	
+}
+
+.comments_entry_silhouette {
+	margin-top:10px;
+	float:left;
+	width:7%;
+}
+
+.comments_entry_container{
+	vertical-align: top;
+	margin-left: 55px;
+	width: 90%;
+}
+
+.comments_entry_container textarea {
+	width: 95%;
+	height: 45px;
+	margin-top:10px;
+	margin-bottom: 5px;
+	color: #52575c;
+}
+
+.publish {
+	margin-bottom: 10px;
+}
+
+
+
 
 
+.showFullScreenButton {
+	background-image: url(fullscreen_button.png);
+	background-size: 200%;	
+}
+
+.showFullScreenButton:hover {
+	background-color: rgb(171,178,178);
+}
+
+.showFullScreenButton.active {
+	background-position:-40px 0px;
+}
+
+.playButton {
+	background-size: 200%;
+	background-image:url(../resources/images/play_button.png);
+}
+
+.playButton:hover {
+	background-position:-40px 0px;
+}
+
+.pauseButton {
+	background-size: 200%;
+	background-image:url(../resources/images/pause_button.png);
+	
+}
+
+.pauseButton:hover {
+	background-position:-40px 0px;
+}
+
+.playButtonOnScreen {
+	position: absolute;
+	opacity: 0.7;
+	top: 30%;
+	left: 45%;
+	bottom: 30%;
+	right: 40%;
+	z-index: 500;
+}
+
+.playButtonOnScreenIcon {
+	display: block;
+	cursor: pointer;
+	height:100%;
+}
 
 .showExtendedProfilesButton {
 	/*background-image:url(../resources/images/view_icon.png);*/
@@ -157,6 +227,139 @@ overflow-y:hidden;
 
 
 
+.editorPluginToolStatusHelp, .editorPluginConsolidateHelp {
+	position: absolute;
+	height: 113px;
+	left: 10px;
+	right: 10px;
+	bottom: 10px;
+	overflow: auto;
+}
+
+.editorPluginToolStatus_trackItemList, .editorPluginConsolidate_trackItemList{
+	position: absolute;
+	overflow: auto;
+	bottom: 123px;
+	top: 65px;
+	left: 10px;
+	right: 10px;
+	box-shadow: inset 0px 0px 10px 2px rgba(0, 0, 0, 0.39);
+	border-radius: 7px;
+	padding-left: 13px;
+}
+
+.trackEditorFieldSelected {
+	background-color: red;
+}
+
+
+
+.buttonPluginPopUp.showViewModeButton {
+	background-image:none;
+}
+
+.buttonPlugin.showViewModeButton {
+	background-image:url(viewmode.png);
+	background-repeat:no-repeat;
+	background-size:auto 100%;
+}
+
+.buttonPlugin.showViewModeButton:hover {
+	background-color: rgb(171,178,178);
+}
+
+.buttonPlugin.showViewModeButton.selected {
+	background-position:-40px 0px;
+}
+
+/*.showViewModeButton_active {
+	background-image:url(../resources/images/view_icon.png);
+	background-repeat:no-repeat;
+	background-position:-80px 0px;
+}*/
+
+.viewModeItemButton {
+	background-image: url(view_mode_icons.png);
+	background-size: 200% auto;
+	width: 78px;
+	height: 41px;
+	cursor: pointer;
+}
+
+.viewModeItemButton.selected {
+	background-position: 78px 0;
+}
+
+.viewModeItemButton.slide_professor {
+	background-position: 0 82px;
+}
+
+.viewModeItemButton.slide_professor.selected {
+	background-position: 78px 82px;
+}
+
+.viewModeItemButton.professor_slide {
+	background-position: 0 124px;
+}
+
+.viewModeItemButton.professor_slide.selected {
+	background-position: 78px 124px;
+}
+
+.viewModeItemButton.professor {
+	background-position: 0 207px;
+}
+
+.viewModeItemButton.professor.selected {
+	background-position: 78px 207px;
+}
+
+.viewModeItemButton.slide_over_professor {
+	
+}
+
+.viewModeItemButton.slide_over_professor_right {
+	background-position: 0 41px;
+}
+
+.viewModeItemButton.slide_over_professor_right.selected {
+	background-position: 72px 41px;
+}
+
+.viewModeItemButton.slide {
+	background-position: 0 168px;
+}
+
+.viewModeItemButton.slide.selected {
+	background-position: 78px 168px;
+}
+
+
+
+
+
+.repeatButton {
+	background-size: 200%;
+	background-image:url(../resources/images/repeat_button.png);
+}
+
+.repeatButton:hover {
+	background-position:-40px 0px;
+}
+
+
+
+.textBreak {
+	background-color: rgba(128,128,128,0.7);
+	text-align: center;
+	color: white;
+	line-height: 17px;
+	font-size: 18px;
+	padding-top: 10px;
+	padding-bottom: 10px;
+	border-radius: 12px;
+}
+
 .buttonPlugin.frameControl {
 	background-size: 300%;
 	background-image:url(../resources/images/frame_button.png);
@@ -284,190 +487,27 @@ overflow-y:hidden;
 
 
 
-.showFullScreenButton {
-	background-image: url(fullscreen_button.png);
-	background-size: 200%;	
-}
-
-.showFullScreenButton:hover {
-	background-color: rgb(171,178,178);
-}
-
-.showFullScreenButton.active {
-	background-position:-40px 0px;
-}
-
-.playButton {
-	background-size: 200%;
-	background-image:url(../resources/images/play_button.png);
-}
-
-.playButton:hover {
-	background-position:-40px 0px;
-}
-
-.pauseButton {
-	background-size: 200%;
-	background-image:url(../resources/images/pause_button.png);
-	
-}
-
-.pauseButton:hover {
-	background-position:-40px 0px;
-}
-
-.playButtonOnScreen {
-	position: absolute;
-	opacity: 0.7;
-	top: 30%;
-	left: 45%;
-	bottom: 30%;
-	right: 40%;
-	z-index: 500;
-}
-
-.playButtonOnScreenIcon {
-	display: block;
-	cursor: pointer;
-	height:100%;
-}
-
-.repeatButton {
-	background-size: 200%;
-	background-image:url(../resources/images/repeat_button.png);
-}
-
-.repeatButton:hover {
-	background-position:-40px 0px;
+.textCaption {
+	background-color: rgba(128,128,128,0.7);
+	text-align: center;
+	color: white;
+	line-height: 17px;
+	font-size: 18px;
+	padding-top: 10px;
+	padding-bottom: 10px;
+	border-radius: 12px;
 }
 
-
-
-.showSocialPluginButton {
-	background-image: url(social_button.png);
+.showCaptionsPluginButton{
+	background-image: url(caption_icon.png);
 	background-size: 300%;
 }
 
-.buttonPluginPopUp.showSocialPluginButton {
-	background-image:none;
-}
-
-.buttonPlugin.showSocialPluginButton:hover {
+.showCaptionsPluginButton:hover {
 	background-color: rgb(171,178,178);
 }
 
-.buttonPlugin.showSocialPluginButton.selected {
-	background-position:-80px 0px;
-}
-
-.socialItemButton {  /*crea el popup*/
-	background-repeat:no-repeat;
-	background-size: 200% auto;
-	width: 40px;
-	height: 40px;
-	cursor: pointer;
-	background-color: rgba(128,128,128,0.8);
-}
-
-.socialItemButton:hover {
-	background-color: rgba(90,90,90,0.8);
-}
-
-.socialItemButton.selected {
-	background-position:-40px 0px;
-}
-
-.socialItemButton.facebook{
-	background-image: url(facebook_button.png);
-}
-
-.socialItemButton.twitter {
-	background-image: url(twitter_button.png);
-}
-
-
-
-
-
-.buttonPluginPopUp.showViewModeButton {
-	background-image:none;
-}
-
-.buttonPlugin.showViewModeButton {
-	background-image:url(viewmode.png);
-	background-repeat:no-repeat;
-	background-size:auto 100%;
-}
-
-.buttonPlugin.showViewModeButton:hover {
-	background-color: rgb(171,178,178);
-}
-
-.buttonPlugin.showViewModeButton.selected {
-	background-position:-40px 0px;
-}
-
-/*.showViewModeButton_active {
-	background-image:url(../resources/images/view_icon.png);
-	background-repeat:no-repeat;
+.showCaptionsPluginButton.selected {
 	background-position:-80px 0px;
-}*/
-
-.viewModeItemButton {
-	background-image: url(view_mode_icons.png);
-	background-size: 200% auto;
-	width: 78px;
-	height: 41px;
-	cursor: pointer;
-}
-
-.viewModeItemButton.selected {
-	background-position: 78px 0;
-}
-
-.viewModeItemButton.slide_professor {
-	background-position: 0 82px;
-}
-
-.viewModeItemButton.slide_professor.selected {
-	background-position: 78px 82px;
-}
-
-.viewModeItemButton.professor_slide {
-	background-position: 0 124px;
-}
-
-.viewModeItemButton.professor_slide.selected {
-	background-position: 78px 124px;
-}
-
-.viewModeItemButton.professor {
-	background-position: 0 207px;
-}
-
-.viewModeItemButton.professor.selected {
-	background-position: 78px 207px;
-}
-
-.viewModeItemButton.slide_over_professor {
-	
-}
-
-.viewModeItemButton.slide_over_professor_right {
-	background-position: 0 41px;
 }
 
-.viewModeItemButton.slide_over_professor_right.selected {
-	background-position: 72px 41px;
-}
-
-.viewModeItemButton.slide {
-	background-position: 0 168px;
-}
-
-.viewModeItemButton.slide.selected {
-	background-position: 78px 168px;
-}
-
-
-
diff --git a/tmp/00_base.js b/tmp/00_base.js
new file mode 100644
index 0000000..f4ec793
--- /dev/null
+++ b/tmp/00_base.js
@@ -0,0 +1,98 @@
+/*
+	Paella HTML 5 Multistream Player
+	Copyright (C) 2013  Universitat Politècnica de València
+
+	This program is free software: you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation, either version 3 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see <http://www.gnu.org/licenses/>.
+*/
+var GlobalParams = {
+	video:{zIndex:1},
+	background:{zIndex:0}
+};
+
+
+var paella = {};
+paella.player = null;
+
+paella.debug = {
+	init:false,
+	debug:false,
+
+	log:function(msg) {
+		if (!this.init) {
+			this.debug = /debug/.test(location.href);
+			this.init = true;
+		}
+		if (this.debug) {
+			console.log(msg);
+		}
+	}
+}
+
+paella.pluginList = [
+	'framecontrol.js',
+	'playbutton.js',
+	'viewmode.js',
+	'basic_editor_plugins.js',
+	'repeatbutton.js',
+	'extended_profiles.js',
+	'trimming.js',
+	'annotations.js',
+	'consolidate.js',
+	'social.js',
+	'fullscreenbutton.js',
+	'caption_editor.js',
+	'break.js',
+	'comments.js',
+	'description.js',
+	'footprints.js'
+];
+
+paella.events = {
+	play:"paella:play",
+	pause:"paella:pause",
+	next:"paella:next",
+	previous:"paella:previous",
+	seeking:"paella:seeking",
+	seeked:"paella:seeked",
+	timeupdate:"paella:timeupdate",
+	timeUpdate:"paella:timeupdate",
+	seekTo:"paella:setseek",
+	endVideo:"paella:endvideo",
+	seekToFrame:"paella:seektotime",	// deprecated, use seekToTime instead
+	seekToTime:"paella:seektotime",
+	setTrim:"paella:settrim",
+	showEditor:"paella:showeditor",
+	hideEditor:"paella:hideeditor",
+	setPlaybackRate:"paella:setplaybackrate",
+	setVolume:'paella:setVolume',
+	setComposition:'paella:setComposition',
+	loadStarted:'paella:loadStarted',
+	loadComplete:'paella:loadComplete',
+	loadPlugins:'paella:loadPlugins',
+	error:'paella:error',
+	setProfile:'paella:setprofile',
+	documentChanged:'paella:documentChanged',
+	didSaveChanges:'paella:didsavechanges',
+	controlBarWillHide:'paella:controlbarwillhide',
+	controlBarDidShow:'paella:controlbardidshow',
+	///beforeUnload:'paella:beforeUnload',		This event has been removed because it not work properly in any browser
+	hidePopUp:'paella:hidePopUp',
+	showPopUp:'paella:showPopUp',
+
+	trigger:function(event,params) { $(document).trigger(event,params); },
+	bind:function(event,callback) { $(document).bind(event,function(event,params) { callback(event,params);}) ;}
+};
+
+
+
diff --git a/tmp/01_utils.js b/tmp/01_utils.js
new file mode 100644
index 0000000..19b8110
--- /dev/null
+++ b/tmp/01_utils.js
@@ -0,0 +1,536 @@
+paella.AsyncLoaderCallback = Class.create({
+	name:"",
+	prevCb:null,
+	nextCb:null,
+	loader:null,
+
+	initialize:function(name) {
+		this.name = name;	
+	},
+	
+	load:function(onSuccess,onError) {
+		paella.debug.log("loading " + this.name);
+		onSuccess();
+		// If error: onError()
+	}
+});
+
+paella.AsyncLoader = Class.create({
+	firstCb:null,
+	lastCb:null,
+	callbackArray:null,
+	generatedId:0,
+	
+	currentCb:null,
+
+	initialize:function() {
+		this.callbackArray = {};
+		this.generatedId = 0;
+	},
+	
+	addCallback:function(cb,name) {
+		if (!name) {
+			name = "callback_" + this.generatedId++;
+		}
+		this.callbackArray[name] = cb;
+		if (!this.firstCb) {
+			this.firstCb = cb;
+			this.currentCb = cb;
+		}
+		cb.prevCb = this.lastCb;
+		if (this.lastCb) this.lastCb.nextCb = cb;
+		this.lastCb = cb;
+		cb.loader = this;
+		return cb;
+	},
+	
+	getCallback:function(name) {
+		return this.callbackArray[name];
+	},
+
+	load:function(onSuccess,onError) {
+		var This = this;
+		if (this.currentCb) {
+			this.currentCb.load(function() {
+				This.currentCb = This.currentCb.nextCb;
+				This.load(onSuccess);
+			},
+			function() {
+				if (typeof(onFail)=='function') onFail();
+			});
+		}
+		else if (typeof(onSuccess)=='function') {
+			onSuccess();
+		}
+	}
+});
+
+paella.JSONLoader = Class.create(paella.AsyncLoaderCallback,{
+	params:null,
+	type:'get',
+	
+	data:null,
+	mimeType:null,
+	statusCode:null,
+	
+	initialize:function(params,type) {
+		if (type) this.type = type;
+		if (typeof(params)=='string') this.params = {url:params}
+		else if (typeof(params)=='object') this.params = params;
+		else this.params = {}
+	},
+	
+	getParams:function() {
+		return this.params;
+	},
+	
+	load:function(onSuccess,onError) {
+		var This = this;
+		paella.ajax.send(this.type,this.getParams(),
+			function(data,type,code) {
+				This.data = data;
+				This.mimeType = type;
+				This.statusCode = code;
+				onSuccess();
+			},
+			function(data,type,returnCode) {
+				This.data = data;
+				This.mimeType = type;
+				This.statusCode = code;
+				onFail();
+			});
+	}
+});
+
+paella.DictionaryLoader = Class.create(paella.AsyncLoaderCallback,{
+	dictionaryUrl:'',
+
+	initialize:function(dictionaryUrl) {
+		this.parent("dictionaryLoader");
+		this.dictionaryUrl = dictionaryUrl;
+	},
+	
+	load:function(onSuccess,onError) {
+		var lang = paella.utils.language();
+		var params = {}
+		params.url = this.dictionaryUrl + '_' + lang + '.json';
+		paella.ajax.get(params,
+			function(data,type,returnCode) {
+				if (typeof(data)=='string') {
+					try {
+						data = JSON.parse(data);
+					}
+					catch (e) {
+						onError();
+					}
+				}
+				paella.dictionary.addDictionary(data);
+				onSuccess();
+			},
+			function(data,type,returnCode) {
+				onError();
+			});
+	}
+});
+
+paella.Dictionary = Class.create({
+	dictionary:{},
+
+	initialize:function() {
+		
+	},
+
+	addDictionary:function(dict) {
+		for (var key in dict) {
+			this.dictionary[key] = dict[key];
+		}
+	},
+	
+	translate:function(key) {
+		var value = this.dictionary[key];
+		if (value) return value;
+		else return key;
+	}
+});
+
+paella.dictionary = new paella.Dictionary();
+
+paella.ajax = base.ajax;
+
+// Deprecated: use paella.ajax.get/post/delete/put...
+paella.Ajax = Class.create({
+	callback:null,
+
+	// Params:
+	//	url:http://...
+	//	data:{param1:'param1',param2:'param2'...}
+	// 	onSuccess:function(response)
+	initialize:function(url,params,onSuccess,proxyUrl,useJsonp,method) {
+		paella.debug.log("WARNING: paella.Ajax() is deprecated, use base.ajax.get/paella.ajax.post/paella.ajax.delete/paella.ajax.put instead.");
+		var thisClass = this;
+		this.callback = onSuccess;
+		var thisClass = this;
+		if (!method) method = 'get';
+		if (useJsonp) {
+            jQuery.ajax({url:url,type:method,dataType:'jsonp', jsonp:'jsonp', jsonpCallback:'callback', data:params,cache:false}).always(function(data) {
+				//paella.debug.log('using jsonp');
+				thisClass.callCallback(data);
+			});
+		}
+		else if (proxyUrl && proxyUrl!="") {
+			params.url = url;
+			jQuery.ajax({url:proxyUrl,type:method,data:params,cache:false}).always(function(data) {
+				//paella.debug.log('using AJAX');
+				thisClass.callCallback(data);
+			});
+		}
+		else {
+			jQuery.ajax({url:url,type:method,data:params,cache:false}).always(function(data) {
+				//paella.debug.log('using AJAX whithout proxy');
+				thisClass.callCallback(data);
+			});
+		}
+	},
+
+	callCallback:function(data) {
+		if (this.callback && data!=null) {
+			if (typeof(data)=="object" && data.responseText) {
+				this.callback(data.responseText);
+			}
+			else {
+				this.callback(data);
+			}
+		}
+		else if (this.callback) {
+			this.callback('{"result":"ok"}');
+		}
+	}
+});
+
+paella.Timer = Timer;	// base.js Timer
+
+paella.utils = {
+	cookies:{
+		set:function(name,value) {
+			document.cookie = name + "=" + value;
+		},
+	
+		get:function(name) {
+			var i,x,y,ARRcookies=document.cookie.split(";");
+			for (i=0;i<ARRcookies.length;i++) {
+				x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
+				y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
+				x=x.replace(/^\s+|\s+$/g,"");
+				if (x==name) {
+					return unescape(y);
+				}
+			}
+		}
+	},
+
+	parameters:{
+		get:function(parameter) {
+			var url = location.href;
+			var index = url.indexOf("?");
+			index = url.indexOf(parameter,index) + parameter.length;
+			if (url.charAt(index)=="=") {
+				var result = url.indexOf("&",index);
+				if (result==-1) {
+					result = url.length;
+				}
+				return url.substring(index + 1, result);
+			}
+			return "";
+		}
+	},
+
+    require: function(libraryName) {
+        var script = document.createElement('script');
+        script.type = 'text/javascript';
+        script.src = libraryName;
+        document.getElementsByTagName('head')[0].appendChild(script);
+    },
+    
+    importStylesheet:function(stylesheetFile) {
+    	var link = document.createElement('link');
+    	link.setAttribute("rel","stylesheet");
+    	link.setAttribute("href",stylesheetFile);
+    	link.setAttribute("type","text/css");
+    	link.setAttribute("media","screen");
+    	document.getElementsByTagName('head')[0].appendChild(link);
+    },
+
+	// Deprecated. Use paella.Timer instead
+	Timer: Class.create({
+		timerId:0,
+		callback:null,
+		params:null,
+		jsTimerId:0,
+		repeat:false,
+		timeout:0,
+
+		initialize:function(callback,time,params) {
+			this.callback = callback;
+			this.params = params;
+			timerManager.setupTimer(this,time);
+		},
+
+		cancel:function() {
+			clearTimeout(this.jsTimerId);
+		}
+	}),
+	
+	timeParse:{
+		secondsToTime:function(seconds) {
+			var hrs = ~~ (seconds / 3600);
+			if (hrs<10) hrs = '0' + hrs;
+			var mins = ~~ ((seconds % 3600) / 60);
+			if (mins<10) mins = '0' + mins;
+			var secs = Math.floor(seconds % 60);
+			if (secs<10) secs = '0' + secs;
+			return hrs + ':' + mins + ':' + secs;
+		},
+		secondsToText:function(secAgo) {
+			// Seconds
+			if (secAgo <= 1) {
+				return paella.dictionary.translate("1 second ago")
+			}
+			if (secAgo < 60) {
+				return paella.dictionary.translate("{0} seconds ago").replace(/\{0\}/g, secAgo);
+			}
+			// Minutes
+			var minAgo = Math.round(secAgo/60);
+			if (minAgo <= 1) {
+				return paella.dictionary.translate("1 minute ago");
+			}
+			if (minAgo < 60) {
+				return paella.dictionary.translate("{0} minutes ago").replace(/\{0\}/g, minAgo);
+			}
+			//Hours
+			var hourAgo = Math.round(secAgo/(60*60));
+			if (hourAgo <= 1) {
+				return paella.dictionary.translate("1 hour ago");
+			}
+			if (hourAgo < 24) {
+				return paella.dictionary.translate("{0} hours ago").replace(/\{0\}/g, hourAgo);
+			}
+			//Days
+			var daysAgo = Math.round(secAgo/(60*60*24));
+			if (daysAgo <= 1) {
+				return paella.dictionary.translate("1 day ago");
+			}
+			if (daysAgo < 24) {
+				return paella.dictionary.translate("{0} days ago").replace(/\{0\}/g, daysAgo);
+			}
+			//Months
+			var monthsAgo = Math.round(secAgo/(60*60*24*30));
+			if (monthsAgo <= 1) {
+				return paella.dictionary.translate("1 month ago");
+			}
+			if (monthsAgo < 12) {
+				return hourAgo + paella.dictionary.translate("{0} months ago").replace(/\{0\}/g, monthsAgo);
+			}
+			//Years
+			var yearsAgo = Math.round(secAgo/(60*60*24*365));
+			if (yearsAgo <= 1) {
+				return paella.dictionary.translate("1 year ago");
+			}
+			return paella.dictionary.translate("{0} years ago").replace(/\{0\}/g, yearsAgo);			
+		},
+		matterhornTextDateToDate: function(mhdate) {
+			var d = new Date();
+			d.setFullYear(parseInt(mhdate.substring(0, 4), 10));
+			d.setMonth(parseInt(mhdate.substring(5, 7), 10) - 1);
+			d.setDate(parseInt(mhdate.substring(8, 10), 10));
+			d.setHours(parseInt(mhdate.substring(11, 13), 10));
+			d.setMinutes(parseInt(mhdate.substring(14, 16), 10));
+			d.setSeconds(parseInt(mhdate.substring(17, 19), 10));
+			
+			return d;
+		}	
+	},
+	
+	language:function() {
+		var lang = navigator.language || window.navigator.userLanguage;
+		return lang.substr(0, 2).toLowerCase();
+	},
+	
+	userAgent:new UserAgent()
+}
+
+paella.MouseManager = Class.create({
+	targetObject:null,
+
+	initialize:function() {
+		var thisClass = this;
+		paella.events.bind('mouseup',function(event) { thisClass.up(event); });
+		paella.events.bind('mousemove',function(event) { thisClass.move(event); });
+		paella.events.bind('mouseover',function(event) { thisClass.over(event); });
+	},
+
+	down:function(targetObject,event) {
+		this.targetObject = targetObject;
+		if (this.targetObject && this.targetObject.down) {
+			this.targetObject.down(event,event.pageX,event.pageY);
+			event.cancelBubble = true;
+		}
+		return false;
+	},
+
+	up:function(event) {
+		if (this.targetObject && this.targetObject.up) {
+			this.targetObject.up(event,event.pageX,event.pageY);
+			event.cancelBubble = true;
+		}
+		this.targetObject = null;
+		return false;
+	},
+	
+	out:function(event) {
+		if (this.targetObject && this.targetObject.out) {
+			this.targetObject.out(event,event.pageX,event.pageY);
+			event.cancelBubble = true;
+		}
+		return false;
+	},
+
+	move:function(event) {
+		if (this.targetObject && this.targetObject.move) {
+			this.targetObject.move(event,event.pageX,event.pageY);
+			event.cancelBubble = true;
+		}
+		return false;
+	},
+	
+	over:function(event) {
+		if (this.targetObject && this.targetObject.over) {
+			this.targetObject.over(event,event.pageX,event.pageY);
+			event.cancelBubble = true;
+		}
+		return false;
+	}
+});
+
+paella.utils.mouseManager = new paella.MouseManager();
+
+
+paella.ui = {}
+
+paella.ui.Container = function(params) {
+	var elem = document.createElement('div');
+	if (params.id) elem.id = params.id;
+	if (params.className) elem.className = params.className;
+	if (params.style) $(elem).css(params.style);
+	return elem;
+};
+
+paella.DataDelegate = Class.create({
+	// onSuccess => function(response,readStatus)
+	read:function(context,params,onSuccess) {
+		// TODO: read key with context
+		if (typeof(onSuccess)=='function') {
+			onSuccess({},true);
+		}
+	},
+
+	// onSuccess => function(response,writeStatus)
+	write:function(context,params,value,onSuccess) {
+		// TODO: write key with context
+		if(typeof(onSuccess)=='function') {
+			onSuccess({},true);
+		}
+	},
+	
+	remove:function(context,params,onSuccess) {
+		// TODO: write key with context
+		if(typeof(onSuccess)=='function') {
+			onSuccess({},true);
+		}
+	}
+});
+
+paella.dataDelegates = {}
+
+paella.dataDelegates.CookieDataDelegate = Class.create(paella.DataDelegate,{
+	initialize:function() {
+	},
+
+	serializeKey:function(context,params) {
+		if (typeof(params)=='object') params = JSON.stringify(params);
+		return context + '|' + params;
+	},
+
+	read:function(context,params,onSuccess) {
+		var key = this.serializeKey(context,params);
+		var value = paella.utils.cookies.get(key);
+		try {
+			value = JSON.parse(value);
+		}
+		catch (e) {}
+		if (typeof(onSuccess)=='function') {
+			onSuccess(value,true);
+		}
+	},
+
+	write:function(context,params,value,onSuccess) {
+		var key = this.serializeKey(context,params);
+		if (typeof(value)=='object') value = JSON.stringify(value);
+		paella.utils.cookies.set(key,value);
+		if(typeof(onSuccess)=='function') {
+			onSuccess({},true);
+		}
+	},
+	
+	remove:function(context,params,onSuccess) {
+		var key = this.serializeKey(context,params);
+		if (typeof(value)=='object') value = JSON.stringify(value);
+		paella.utils.cookies.set(key,'');
+		if(typeof(onSuccess)=='function') {
+			onSuccess({},true);
+		}
+		
+	}
+});
+
+paella.dataDelegates.DefaultDataDelegate = paella.dataDelegates.CookieDataDelegate;
+
+
+paella.Data = Class.create({
+	enabled:false,
+	dataDelegates:{},
+
+	initialize:function(config) {
+		this.enabled = config.data.enabled;
+		for (var key in config.data.dataDelegates) {
+			this.dataDelegates[key] = new paella.dataDelegates[config.data.dataDelegates[key]]();
+		}
+		if (!this.dataDelegates["default"]) {
+			this.dataDelegates["default"] = new paella.dataDelegates.DefaultDataDelegate();
+		}
+	},
+	
+	read:function(context,key,onSuccess) {
+		var del = this.getDelegate(context);
+		del.read(context,key,onSuccess);
+	},
+	
+	write:function(context,key,params,onSuccess) {
+		var del = this.getDelegate(context);
+		del.write(context,key,params,onSuccess);
+	},
+	
+	remove:function(context,key,onSuccess) {
+		var del = this.getDelegate(context);
+		del.remove(context,key,onSuccess);
+	},
+	
+	getDelegate:function(context) {
+		if (this.dataDelegates[context]) return this.dataDelegates[context];
+		else return this.dataDelegates["default"];
+	}
+});
+
+// Will be initialized inmediately after loading config.json, in PaellaPlayer.onLoadConfig()
+paella.data = null;
+
+
diff --git a/tmp/02_nodes.js b/tmp/02_nodes.js
new file mode 100644
index 0000000..ff2ebd3
--- /dev/null
+++ b/tmp/02_nodes.js
@@ -0,0 +1,99 @@
+
+paella.Node = Class.create({
+	identifier:'',
+	nodeList:null,
+	
+	initialize:function(id) {
+		this.nodeList = {};
+		this.identifier = id;
+	},
+	
+	addTo:function(parentNode) {
+		parentNode.addNode(this);
+	},
+	
+	addNode:function(childNode) {
+		this.nodeList[childNode.identifier] = childNode;
+		return childNode;
+	},
+	
+	getNode:function(id) {
+		return this.nodeList[id];
+	}
+});
+
+paella.DomNode = Class.create(paella.Node,{
+	domElement:null,
+	
+	initialize:function(elementType,id,style) {
+		this.parent(id);
+		this.domElement = document.createElement(elementType);
+		this.domElement.id = id;
+		if (style) $(this.domElement).css(style);
+	},
+	
+	addNode:function(childNode) {
+		var returnValue = this.parent(childNode);
+		this.domElement.appendChild(childNode.domElement);
+		return returnValue;
+	},
+
+	onresize:function() {
+	}
+});
+
+paella.Button = Class.create(paella.DomNode,{
+	isToggle:false,
+
+	initialize:function(id,className,action,isToggle) {
+		this.isToggle = isToggle;
+		var style = {};
+		this.parent('div',id,style);
+		this.domElement.className = className;
+		if (isToggle) {
+			var thisClass = this;
+			$(this.domElement).click(function(event) {
+				thisClass.toggleIcon();
+			});
+		}
+		$(this.domElement).click('click',action);
+	},
+	
+	isToggled:function() {
+		if (this.isToggle) {
+			var element = $('#' + this.identifier)[0];
+			return /([a-zA-Z0-9_]+)_active/.test(element.className);
+		}
+		else {
+			return false;
+		}
+	},
+
+	toggle:function() {
+		this.toggleIcon();
+	},
+
+	toggleIcon:function() {
+		var element = $('#' + this.identifier)[0];
+		if (/([a-zA-Z0-9_]+)_active/.test(element.className)) {
+			element.className = RegExp.$1;
+		}
+		else {
+			element.className = element.className + '_active';
+		}
+		
+	},
+	
+	show:function() {
+		$(this.domElement).show();
+	},
+	
+	hide:function() {
+		$(this.domElement).hide();
+	},
+	
+	visible:function() {
+		return this.domElement.visible();
+	}
+});
+
diff --git a/tmp/03_video_nodes.js b/tmp/03_video_nodes.js
new file mode 100644
index 0000000..f4bc94d
--- /dev/null
+++ b/tmp/03_video_nodes.js
@@ -0,0 +1,687 @@
+paella.Profiles = {
+	loadProfile:function(profileName,onSuccessFunction) {
+		var params = { url:"config/profiles/profiles.json" };
+		
+		paella.ajax.get(params,function(data,mimetype,code) {
+				if (typeof(data)=="string") {
+					data = JSON.parse(data);
+				}
+				onSuccessFunction(data[profileName]);
+			},
+			function(data,mimetype,code) {
+				paella.debug.log("Error loading video profiles. Check your Paella Player configuration");
+			});
+	},
+	
+	loadProfileList:function(onSuccessFunction) {
+		var params = { url:"config/profiles/profiles.json" };
+		
+		paella.ajax.get(params,function(data,mimetype,code) {
+				if (typeof(data)=="string") {
+					data = JSON.parse(data);
+				}
+				onSuccessFunction(data);
+			},
+			function(data,mimetype,code) {
+				paella.debug.log("Error loading video profiles. Check your Paella Player configuration");
+			});
+	}
+};
+
+paella.RelativeVideoSize = Class.create({
+	w:1280,h:720,
+	
+	proportionalHeight:function(newWidth) {
+		return Math.floor(this.h * newWidth / this.w);
+	},
+	
+	proportionalWidth:function(newHeight) {
+		return Math.floor(this.w * newHeight / this.h);
+	},
+	
+	percentVSize:function(pxSize) {
+		return pxSize * 100 / this.h;
+	},
+	
+	percentWSize:function(pxSize) {
+		return pxSize * 100 / this.w;
+	},
+	
+	aspectRatio:function() {
+		return this.w/this.h;
+	}
+});
+
+paella.VideoElementBase = Class.create(paella.DomNode,{
+	isReady:false,
+
+	initialize:function(id,containerType,left,top,width,height) {
+		var thisClass = this;
+		var relativeSize = new paella.RelativeVideoSize();
+		var percentTop = relativeSize.percentVSize(top) + '%';
+		var percentLeft = relativeSize.percentWSize(left) + '%';
+		var percentWidth = relativeSize.percentWSize(width) + '%';
+		var percentHeight = relativeSize.percentVSize(height) + '%';
+		var style = {top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:'absolute',zIndex:GlobalParams.video.zIndex};
+		this.parent(containerType,id,style);
+		$(this.domElement).bind('canplay',function(event) {
+			thisClass.ready = true;
+		});
+	},
+	
+	isReady:function() {
+		return this.ready;
+	},
+	
+	play:function() {
+		console.log("TODO: implement play() function in your VideoElementBase subclass");
+	},
+	
+	pause:function() {
+		console.log("TODO: implement pause() function in your VideoElementBase subclass");
+	},
+	
+	isPaused:function() {
+		console.log("TODO: implement isPaused() function in your VideoElementBase subclass");
+		return false;
+	},
+	
+	duration:function() {
+		console.log("TODO: implement duration() function in your VideoElementBase subclass");
+		return -1;
+	},
+
+	setCurrentTime:function(time) {
+		console.log("TODO: implement setCurrentTime() function in your VideoElementBase subclass");
+	},
+
+	currentTime:function() {
+		console.log("TODO: implement currentTime() function in your VideoElementBase subclass");
+		return 0;
+	},
+	
+	setVolume:function(volume) {
+		console.log("TODO: implement setVolume() function in your VideoElementBase subclass");
+		return false;
+	},
+	
+	volume:function() {
+		console.log("TODO: implement volume() function in your VideoElementBase subclass");
+		return -1;
+	},
+	
+	setPlaybackRate:function(rate) {
+		console.log("TODO: implement setPlaybackRate() function in your VideoElementBase subclass");
+	},
+	
+	addSource:function(sourceData) {
+		console.log("TODO: implement addSource() function in your VideoElementBase subclass");
+	},
+	
+	setClassName:function(className) {
+		this.domElement.className = className;
+	},
+	
+	getDimensions:function() {
+		return { width: this.domElement.videoWidth, height: this.domElement.videoHeight };
+	},
+
+	setRect:function(rect,animate) {
+		var relativeSize = new paella.RelativeVideoSize();
+		var percentTop = relativeSize.percentVSize(rect.top) + '%';
+		var percentLeft = relativeSize.percentWSize(rect.left) + '%';
+		var percentWidth = relativeSize.percentWSize(rect.width) + '%';
+		var percentHeight = relativeSize.percentVSize(rect.height) + '%';
+		var style = {top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:'absolute'};
+		if (animate) {
+			this.disableClassName();
+			var thisClass = this;
+			$(this.domElement).animate(style,400,function(){ thisClass.enableClassName(); })
+			this.enableClassNameAfter(400);
+		}
+		else {
+			$(this.domElement).css(style);
+		}
+	},
+
+	disableClassName:function() {
+		this.classNameBackup = this.domElement.className;
+		this.domElement.className = "";
+	},
+	
+	enableClassName:function() {
+		this.domElement.className = this.classNameBackup;
+	},
+	
+	enableClassNameAfter:function(millis) {
+		setTimeout("$('#" + this.domElement.id + "')[0].className = '" + this.classNameBackup + "'",millis);
+	},
+
+	setClassName:function(className) {
+		this.domElement.className = className;
+	},
+
+	setVisible:function(visible,animate) {
+		if (visible=="true" && animate) {
+			$(this.domElement).animate({opacity:1.0},300);
+		}
+		else if (visible=="true" && !animate) {
+			$(this.domElement).show();
+		}
+		else if (visible=="false" && animate) {
+			$(this.domElement).animate({opacity:0.0},300);
+		}
+		else if (visible=="false" && !animate) {
+			$(this.domElement).hide();
+		}
+	},
+	
+	setLayer:function(layer) {
+		this.domElement.style.zIndex = layer;
+	}
+});
+
+paella.FlashVideo = Class.create(paella.VideoElementBase,{
+	classNameBackup:'',
+	flashVideo:null,
+	paused:true,
+	streamingMode:true,
+	flashId:'',
+
+	initialize:function(id,left,top,width,height) {
+		this.parent(id,'div',left,top,width,height);
+		this.flashId = id + 'Movie';
+	},
+	
+	isReady:function() {
+		return true;
+	},
+
+	// Adobe Flash utils
+	addParameter:function(swf,name,value) {
+		var param = document.createElement('param');
+		param.setAttribute("name",name);
+		param.setAttribute("value",value);
+		swf.appendChild(param);
+	},
+
+	createSwf:function(url,params) {
+		var ieobject = document.createElement('object');
+		ieobject.setAttribute('id',this.flashId + 'IE');
+		ieobject.setAttribute('classid', 'clsid:d27cdb6e-ae6d-11cf-96b8-444553540000');
+		ieobject.setAttribute('codebase', '"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0"');
+		ieobject.setAttribute("width","100%");
+		ieobject.setAttribute("height","100%");
+		this.addParameter(ieobject,"movie",url);
+		this.addParameter(ieobject,"quality","high");
+		this.addParameter(ieobject,"bgcolor","#efefef");
+		this.addParameter(ieobject,"play","true");
+		this.addParameter(ieobject,"loop","true");
+		this.addParameter(ieobject,"wmode","window");
+		this.addParameter(ieobject,"scale","default");
+		this.addParameter(ieobject,"menu","true");
+		this.addParameter(ieobject,"devicefont","false");
+		this.addParameter(ieobject,"salign","");
+		this.addParameter(ieobject,"allowScriptAccess","sameDomain");
+	
+		var object = document.createElement('object');
+		object.setAttribute('id',this.flashId);
+		object.setAttribute("type","application/x-shockwave-flash");
+		object.setAttribute("data",url);
+		object.setAttribute("width","100%");
+		object.setAttribute("height","100%");
+		this.addParameter(object,"movie",url);
+		this.addParameter(object,"quality","high");
+		this.addParameter(object,"bgcolor","#efefef");
+		this.addParameter(object,"play","true");
+		this.addParameter(object,"loop","true");
+		this.addParameter(object,"wmode","window");
+		this.addParameter(object,"scale","default");
+		this.addParameter(object,"menu","true");
+		this.addParameter(object,"devicefont","false");
+		this.addParameter(object,"salign","");
+		this.addParameter(object,"allowScriptAccess","sameDomain");
+		ieobject.appendChild(object);
+		
+		var flashVars = "";
+		var separator = "";
+		for (var key in params) {
+			flashVars += separator + key + "=" + encodeURIComponent(params[key]);
+			separator = "&";
+		}
+		this.addParameter(ieobject,"flashvars",flashVars);
+		this.addParameter(object,"flashvars",flashVars);
+		
+		var link = document.createElement('a');
+		link.setAttribute("href", "http://www.adobe.com/go/getflash");
+		link.innerHTML = '<img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />';
+		object.appendChild(link);
+
+		return ieobject;
+	},
+	
+	play:function() {
+		if (this.flashVideo) {
+			try {
+				this.flashVideo.play();
+				this.paused = false;
+				return true;
+			}
+			catch(e) {
+			}
+		}
+		return false;
+	},
+	
+	pause:function() {
+		if (this.flashVideo) {
+			try {
+				this.flashVideo.pause();
+				this.paused = true;
+				return true;
+			}
+			catch(e) {
+			}
+		}
+		return false;
+	},
+	
+	isPaused:function() {
+		return this.paused;
+	},
+	
+	duration:function() {
+		if (this.flashVideo) {
+			try {
+				return this.flashVideo.duration();
+			}
+			catch (e) {
+				return -1;
+			}
+		}
+	},
+
+	setCurrentTime:function(time) {
+		if (this.flashVideo) {
+			try {
+				this.flashVideo.seekToTime(time);
+			}
+			catch(e) {
+			}
+		}
+	},
+
+	currentTime:function() {
+		if (this.flashVideo) {
+			try {
+				return this.flashVideo.getCurrentTime();
+			}
+			catch (e) {
+				return 0;
+			}
+		}
+		return -1;
+	},
+	
+	setVolume:function(volume) {
+		if (this.flashVideo) {
+			var thisClass = this;
+			try {
+				this.flashVideo.setVolume(volume);
+				return true;
+			}
+			catch(e) {
+				new Timer(function(timer) {
+					try {
+						thisClass.flashVideo.setVolume(volume);
+						timer.repeat = false;
+					}
+					catch(e2) {
+						paella.debug.log('Fail to set volume on ' + thisClass.identifier);
+						timer.repeat = true;
+					}
+				},100);
+			}
+		}
+		return false;
+	},
+	
+	volume:function() {
+		return this.flashVideo.getVolume();
+	},
+	
+	setPlaybackRate:function(rate) {
+	},
+	
+	createSwfObject:function(swfFile,flashVars) {
+		var id = this.identifier;
+		var parameters = { wmode:'transparent' };
+		
+		var domElement = document.createElement('div');
+		this.domElement.appendChild(domElement);
+		domElement.id = id + "Movie";
+		swfobject.embedSWF(swfFile,domElement.id,"100%","100%","9.0.0","",flashVars,parameters);
+		
+		var flashObj = $('#' + domElement.id)[0];
+		return flashObj;
+	},
+
+	addSourceProgresiveDownload:function(sourceData){
+		if (sourceData.type=='video/mp4') {
+			var parameters = {};
+			
+			if (!/rtmp:\/\//.test(sourceData.src)) {
+				parameters.url = sourceData.src;
+				
+				this.flashVideo = this.createSwfObject("player.swf",parameters);
+			}
+		}
+		else if (sourceData.type=='video/x-flv') {
+			var parameters = {};
+			parameters.url = sourceData.src;
+			this.flashVideo = this.createSwfObject("player.swf",parameters);
+		}
+	},
+	
+	addSourceStreaming:function(sourceData) {
+		if (sourceData.type=='video/mp4') {
+			var parameters = {};
+			if (/(rtmp:\/\/[\w\d\.\-_]+[:+\d]*\/[\w\d\-_]+\/)(mp4:)([\w\d\.\/\-_]+)/i.test(sourceData.src)) {
+				sourceData.src = RegExp.$1 + RegExp.$3;
+			}
+			
+			if (/(rtmp:\/\/)([\w\d\.\-_]+[:+\d]*)\/([\w\d\-_]+\/)([\w\d\.\/\-_]+)/.test(sourceData.src)) {
+				parameters.connect = RegExp.$1 + RegExp.$2 + '/' + RegExp.$3;
+				parameters.url = "mp4:" + RegExp.$4;
+			}
+			
+			this.flashVideo = this.createSwfObject("player.swf",parameters);
+		}
+		else if (sourceData.type=='video/x-flv') {
+			var parameters = {};
+			
+			if (/(rtmp:\/\/)([\w\d\.\-_]+[:+\d]*)\/([\w\d\-_]+\/)([\w\d\.\/\-_]+)(\.flv)+/.test(sourceData.src)) {
+				parameters.connect = RegExp.$1 + RegExp.$2 + '/' + RegExp.$3;
+				parameters.url = RegExp.$4;
+			}
+			
+			this.flashVideo = this.createSwfObject("player.swf",parameters);
+		}
+	},
+
+	addSource:function(sourceData) {
+		if (this.streamingMode) {
+			this.addSourceStreaming(sourceData);
+		}
+		else{
+			this.addSourceProgresiveDownload(sourceData);
+		}
+	},
+	
+	getDimensions:function() {
+		var dim = {width:640, height:480};
+		try {
+			dim.width = this.flashVideo.getWidth();
+			dim.height = this.flashVideo.getHeight();
+		}
+		catch (e) {
+			paella.debug.log("Warning: flash video is not loaded");
+		}
+		return dim;
+	}
+});
+
+paella.Html5Video = Class.create(paella.VideoElementBase,{
+	classNameBackup:'',
+	ready:false,
+
+	initialize:function(id,left,top,width,height) {
+		this.parent(id,'video',left,top,width,height);
+		var thisClass = this;
+		$(this.domElement).bind('canplay',function(event) {
+			thisClass.ready = true;
+		});
+	},
+	
+	isReady:function() {
+		return this.ready;
+	},
+	
+	play:function() {
+		if (this.domElement && this.domElement.play) {
+			this.domElement.play();
+		}
+	},
+	
+	pause:function() {
+		if (this.domElement && this.domElement.pause) {
+			this.domElement.pause();
+		}
+	},
+	
+	isPaused:function() {
+		return this.domElement.paused;
+	},
+	
+	duration:function() {
+		if (this.domElement && this.domElement.duration) {
+			return this.domElement.duration;
+		}
+	},
+
+	setCurrentTime:function(time) {
+		if (this.domElement && this.domElement.currentTime) {
+			this.domElement.currentTime = time;
+		}
+	},
+
+	currentTime:function() {
+		if (this.domElement && this.domElement.currentTime) {
+			return this.domElement.currentTime;
+		}
+		return 0;
+	},
+	
+	setVolume:function(volume) {
+		this.domElement.volume = volume;
+		return true;
+	},
+	
+	volume:function() {
+		return this.domElement.volume;
+	},
+	
+	setPlaybackRate:function(rate) {
+		this.domElement.playbackRate = rate;
+	},
+	
+	addSource:function(sourceData) {
+		var source = document.createElement('source');
+		source.src = sourceData.src;
+		source.type = sourceData.type;
+		this.domElement.appendChild(source);
+		var ua = new UserAgent();
+		if (ua.browser.IsMobileVersion) {
+			this.ready = true;
+		}
+	},
+	
+	getDimensions:function() {
+		return { width: this.domElement.videoWidth, height: this.domElement.videoHeight };
+	},
+
+	setRect:function(rect,animate) {
+		var relativeSize = new paella.RelativeVideoSize();
+		var percentTop = relativeSize.percentVSize(rect.top) + '%';
+		var percentLeft = relativeSize.percentWSize(rect.left) + '%';
+		var percentWidth = relativeSize.percentWSize(rect.width) + '%';
+		var percentHeight = relativeSize.percentVSize(rect.height) + '%';
+		var style = {top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:'absolute'};
+		if (animate) {
+			this.disableClassName();
+			var thisClass = this;
+			$(this.domElement).animate(style,400,function(){ thisClass.enableClassName(); })
+			this.enableClassNameAfter(400);
+		}
+		else {
+			$(this.domElement).css(style);
+		}
+	},
+	
+	disableClassName:function() {
+		this.classNameBackup = this.domElement.className;
+		this.domElement.className = "";
+	},
+	
+	enableClassName:function() {
+		this.domElement.className = this.classNameBackup;
+	},
+	
+	enableClassNameAfter:function(millis) {
+		setTimeout("$('#" + this.domElement.id + "')[0].className = '" + this.classNameBackup + "'",millis);
+	},
+	
+	setVisible:function(visible,animate) {
+		if (visible=="true" && animate) {
+			$(this.domElement).animate({opacity:1.0},300);
+		}
+		else if (visible=="true" && !animate) {
+			$(this.domElement).show();
+		}
+		else if (visible=="false" && animate) {
+			$(this.domElement).animate({opacity:0.0},300);
+		}
+		else if (visible=="false" && !animate) {
+			$(this.domElement).hide();
+		}
+	},
+	
+	setLayer:function(layer) {
+		this.domElement.style.zIndex = layer;
+	}
+});
+
+paella.SlideshowVideo = Class.create(paella.VideoElementBase,{
+	isReady:false,
+	img:null,
+	_frames:null,
+	_duration:0,
+	_currentTime:0,
+	_playTime:0,
+	_lastFrame:-1,
+
+	updateTimer:null,
+
+	initialize:function(id,left,top,width,height) {
+		this.parent(id,'div',left,top,width,height);
+		this.img = document.createElement('img');
+		this.img.style.width = '100%';
+		this.img.style.height = '100%';
+		this.domElement.appendChild(this.img);
+		
+		var thisClass = this;
+		thisClass.ready = false;
+	},
+
+	isReady:function() {
+		return this.ready;
+	},
+	
+	checkFrame:function() {
+		var src = null;
+		var alt = "";
+		var lastFrame = -1;
+	
+		for (var i=0;i<this._frames.length;++i) {
+			var frameData = this._frames[i];
+			if (this._currentTime<frameData.time) break;
+			src = frameData.image;
+			alt = "frame_" + frameData.time;
+			lastFrame = frameData.time;
+		}
+	
+		if (this._lastFrame!=lastFrame) {
+			this.img.src = src;
+			this.img.alt = alt;
+			this._lastFrame = lastFrame;
+		}
+	},
+
+	play:function() {
+		if (!this.updateTimer) {
+			this._playTime = new Date().getTime();
+			this.updateTimer = new Timer(function(timer,params){
+				var time = new Date().getTime();
+				var elapsed = Math.round((time - params.player._playTime) / 1000);
+				params.player._currentTime += elapsed;
+				params.player._playTime = time;
+				params.player.checkFrame();
+				if (params.player_currentTime>=params.player._duration) params.player.pause();
+			},1000,{player:this});
+			this.updateTimer.repeat = true;
+		}
+	},
+
+	pause:function() {
+		if (this.updateTimer) {
+			this.updateTimer.cancel();
+			this.updateTimer = null;
+		}
+	},
+
+	isPaused:function() {
+		return this.updateTimer==null;
+	},
+
+	duration:function() {
+		return _duration;
+	},
+
+	setCurrentTime:function(time) {
+		if (this._duration>=time) {
+			this._currentTime = time;
+			this.checkFrame();
+		}
+	},
+
+	currentTime:function() {
+		return this._currentTime;
+	},
+
+	setVolume:function(volume) {
+		return false;
+	},
+
+	volume:function() {
+		return -1;
+	},
+
+	setPlaybackRate:function(rate) {
+	},
+
+	// sourceData = {frames:{frame_1:'frame_1.jpg',frame_1:'frame_1.jpg',...frame_n:'frame_n.jpg'},duration:183}
+	addSource:function(sourceData) {
+		this._duration = sourceData.duration;
+		this._currentTime = 0;
+		this.loadFrames(sourceData.frames,sourceData.duration);
+		var frameZero = new Image();
+		var thisClass = this;
+		frameZero.onload = function(event) {
+			thisClass.ready = true;
+			thisClass.checkFrame();
+		}
+		frameZero.src = this._frames[0].image;
+	},
+	
+	loadFrames:function(frames,duration) {
+		this._frames = [];
+		for (var i=0;i<duration;++i) {
+			var frame = frames['frame_' + i];
+			if (frame) this._frames.push({time:i,image:frame});
+		}
+	}
+});
+
+
+
+
diff --git a/tmp/04_video_container.js b/tmp/04_video_container.js
new file mode 100644
index 0000000..8e8196f
--- /dev/null
+++ b/tmp/04_video_container.js
@@ -0,0 +1,758 @@
+paella.BackgroundContainer = Class.create(paella.DomNode,{
+	initialize:function(id,image) {
+		this.parent('img',id,{position:'relative',top:'0px',left:'0px',right:'0px',bottom:'0px',zIndex:GlobalParams.background.zIndex});
+		this.domElement.setAttribute('src',image);
+		this.domElement.setAttribute('alt','');
+		this.domElement.setAttribute('width','100%');
+		this.domElement.setAttribute('height','100%');
+	},
+	
+	setImage:function(image) {
+		this.domElement.setAttribute('src',image);
+	}
+});
+
+paella.VideoOverlay = Class.create(paella.DomNode,{
+	size:{w:1280,h:720},
+	
+	initialize:function() {
+		var style = {position:'absolute',left:'0px',right:'0px',top:'0px',bottom:'0px',overflow:'hidden',zIndex:10};
+		this.parent('div','overlayContainer',style);
+	},
+	
+	enableBackgroundMode:function() {
+		this.domElement.className = 'overlayContainer background';
+	},
+	
+	disableBackgroundMode:function() {
+		this.domElement.className = 'overlayContainer';
+	},
+	
+	clear:function() {
+		this.domElement.innerHTML = "";
+	},
+	
+	getMasterRect:function() {
+		return paella.player.videoContainer.getMasterVideoRect();
+	},
+	
+	getSlaveRect:function() {
+		return paella.player.videoContainer.getSlaveVideoRect()
+	},
+	
+	addText:function(text,rect,isDebug) {
+		var textElem = document.createElement('div0');
+		textElem.innerHTML = text;
+		textElem.className = "videoOverlayText";
+		if (isDebug) textElem.style.backgroundColor = "red";
+		return this.addElement(textElem,rect);
+	},
+	
+	addElement:function(element,rect) {
+		this.domElement.appendChild(element);
+		element.style.position = 'absolute';
+		element.style.left = this.getHSize(rect.left) + '%';
+		element.style.top = this.getVSize(rect.top) + '%';
+		element.style.width = this.getHSize(rect.width) + '%';
+		element.style.height = this.getVSize(rect.height) + '%';
+		return element;
+	},
+	
+	removeElement:function(element) {
+		this.domElement.removeChild(element);
+	},
+	
+	getVSize:function(px) {
+		return px*100/this.size.h;
+	},
+	
+	getHSize:function(px) {
+		return px*100/this.size.w;
+	}
+});
+
+paella.VideoContainerBase = Class.create(paella.DomNode,{
+	trimming:{enabled:false,start:0,end:0},
+	timeupdateEventTimer:null,
+	timeupdateInterval:250,
+
+	initialize:function(id) {
+		var style = {position:'absolute',left:'0px',right:'0px',top:'0px',bottom:'0px',overflow:'hidden'}
+		this.parent('div',id,style);
+	},
+	
+	initEvents:function() {
+		var thisClass = this;
+		paella.events.bind(paella.events.play,function(event) { thisClass.play(); thisClass.startTimeupdate(); });
+		paella.events.bind(paella.events.pause,function(event) { thisClass.pause(); thisClass.stopTimeupdate(); });
+		paella.events.bind(paella.events.next,function(event) { thisClass.next(); thisClass.triggerTimeupdate(); });
+		paella.events.bind(paella.events.previous,function(event) { thisClass.previous(); thisClass.triggerTimeupdate(); });
+		paella.events.bind(paella.events.seekTo,function(event,params) { thisClass.setCurrentPercent(params.newPositionPercent); thisClass.triggerTimeupdate(); });
+		paella.events.bind(paella.events.seekToTime,function(event,params) { thisClass.setCurrentTime(params.time); thisClass.triggerTimeupdate(); });
+		paella.events.bind(paella.events.setPlaybackRate,function(event,params) { thisClass.setPlaybackRate(params); });
+		paella.events.bind(paella.events.setVolume,function(event,params) { thisClass.setVolume(params); });
+		paella.events.bind(paella.events.setTrim,function(event,params) { thisClass.setTrim});
+	},
+	
+	triggerTimeupdate:function() {
+		var thisClass = this;
+		paella.events.trigger(paella.events.timeupdate,{videoContainer:thisClass, currentTime:thisClass.currentTime() });
+	},
+	
+	startTimeupdate:function() {
+		var thisClass = this;
+		this.timeupdateEventTimer = new Timer(function(timer) {
+			thisClass.triggerTimeupdate();
+		},this.timeupdateInterval);
+		this.timeupdateEventTimer.repeat = true;
+	},
+	
+	stopTimeupdate:function() {
+		this.timeupdateEventTimer.repeat = false;
+		this.timeupdateEventTimer = null;
+	},
+
+	play:function() {
+		paella.debug.log('VideoContainerBase.play()');
+	},
+	
+	pause:function() {
+		paella.debug.log('VideoContainerBase.pause()');
+	},
+	
+	trimStart:function() {
+		return 0;
+	},
+	
+	trimEnd:function() {
+		return this.duration();
+	},
+
+	trimEnabled:function() {
+		return false;
+	},
+	
+	enableTrimming:function() {
+		this.trimming.enabled = true;
+		paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end});
+	},
+	
+	disableTrimming:function() {
+		this.trimming.enabled = false;
+		paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end});
+	},
+	
+	setTrimming:function(start,end) {
+		this.trimming.start = start;
+		this.trimming.end = end;
+		if (this.currentTime()<this.trimming.start) {
+			this.setCurrentTime(this.trimming.start);
+		}
+		if (this.currentTime()>this.trimming.end) {
+			this.setCurrentTime(this.trimming.end);
+		}
+		paella.events.trigger(paella.events.setTrim,{trimEnabled:this.trimming.enabled,trimStart:this.trimming.start,trimEnd:this.trimming.end});
+	},
+	
+	setTrimmingStart:function(start) {
+		this.setTrimming(start,this.trimming.end);
+	},
+	
+	setTrimmingEnd:function(end) {
+		this.setTrimming(this.trimming.start,end);
+	},
+	
+	setCurrentPercent:function(percent) {
+		var start = this.trimStart();
+		var end = this.trimEnd();
+		var duration = end - start;
+		var trimedPosition = percent * duration / 100;
+		var realPosition = parseFloat(trimedPosition) + parseFloat(start);
+		this.setCurrentTime(realPosition);
+	},
+
+	setCurrentTime:function(time) {
+		paella.debug.log("VideoContainerBase.setCurrentTime(" +  time + ")");
+	},
+	
+	currentTime:function() {
+		paella.debug.log("VideoContainerBase.currentTime()");
+		return 0;
+	},
+	
+	duration:function() {
+		paella.debug.log("VideoContainerBase.duration()");
+		return 0
+	},
+	
+	paused:function() {
+		paella.debug.log("VideoContainerBase.paused()");
+		return true;
+	},
+	
+	setupVideo:function(onSuccess) {
+		paella.debug.log("VideoContainerBase.setupVide()");
+	},
+	
+	setPlaybackRate:function(params) {
+		paella.debug.log("VideoContainerBase.setPlaybackBase(" + params.rate + ")");
+	},
+	
+	setVolume:function(params) {
+		paella.debug.log("VideoContainerBase.setVolume(" + params.master + ")");
+	},
+	
+	volume:function() {
+		paella.debug.log("VideoContainerBase.volume()");
+		return 1;
+	},
+	
+	isReady:function() {
+		paella.debug.log("VideoContainerBase.isReady()");
+		return true;
+	},
+
+	onresize:function() { this.parent(onresize);
+	}
+});
+
+paella.VideoContainer = Class.create(paella.VideoContainerBase,{
+	containerId:'',
+	video1Id:'',
+	video2Id:'',
+	backgroundId:'',
+	container:null,
+	video1ClassName:'video masterVideo',
+	video2ClassName:'video slaveVideo',
+	//fitHorizontal:false,
+	isHidden:false,
+	maxSyncDelay:0.5,
+	logos:null,
+	isMasterReady:false,
+	isSlaveReady:false,
+	isMonostream:false,
+	sourceData:[],
+	overlayContainer:null,
+	videoSyncTimeMillis:5000,
+	currentMasterVideoRect:{},
+	currentSlaveVideoRect:{},
+
+	initialize:function(id) {
+		this.parent(id);
+		this.containerId = id + '_container';
+		this.video1Id = id + '_1';
+		this.video2Id = id + '_2';
+		this.backgroundId = id + '_bkg';
+		this.logos = [];
+				
+		this.container = new paella.DomNode('div',this.containerId,{position:'relative',display:'block',marginLeft:'auto',marginRight:'auto',width:'1024px',height:'567px'});
+		this.addNode(this.container);
+		
+		this.overlayContainer = new paella.VideoOverlay(this.domElement);
+		this.container.addNode(this.overlayContainer);
+		
+		this.container.addNode(new paella.BackgroundContainer(this.backgroundId,'config/profiles/resources/default_background_paella.jpg'));
+		var thisClass = this;
+
+		this.initEvents();
+		paella.events.bind(paella.events.timeupdate,function(event) { thisClass.checkVideoTrimming(); } );
+		
+		var thisClass = this;
+		var timer = new paella.utils.Timer(function(timer) {
+			thisClass.syncVideos();
+		},thisClass.videoSyncTimeMillis);
+		timer.repeat = true;
+	},
+	
+	getMasterVideoRect:function() {
+		return this.currentMasterVideoRect;
+	},
+	
+	getSlaveVideoRect:function() {
+		return this.currentSlaveVideoRect;
+	},
+	
+	createVideoPlayers:function() {
+		var masterVideo = new paella.FlashVideo(this.video1Id,850,140,360,550);
+		masterVideo.setClassName(this.video1ClassName);
+		this.container.addNode(masterVideo);
+		
+		var slaveVideo = new paella.FlashVideo(this.video2Id,10,40,800,600);
+		slaveVideo.setClassName(this.video2ClassName);
+		slaveVideo.setVolume(0);
+		this.container.addNode(slaveVideo);
+	},
+
+	setHidden:function(hidden) {
+		this.isHidden = hidden;
+	},
+
+	hideVideo:function() {
+		this.setHidden(true);
+	},
+	
+	publishVideo:function() {
+		this.setHidden(false);
+	},
+
+	syncVideos:function() {
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (!this.isMonostream && masterVideo && slaveVideo && masterVideo.currentTime && slaveVideo.currentTime) {
+			var diff = Math.abs(masterVideo.currentTime() - slaveVideo.currentTime());
+
+			if (diff>this.maxSyncDelay) {
+				paella.debug.log("Sync videos performed, diff=" + diff);
+				slaveVideo.setCurrentTime(masterVideo.currentTime());
+			}
+		}
+	},
+
+	checkVideoTrimming:function() {
+		var current = this.currentTime();
+		var end = this.duration();
+		var start = 0;
+		if (this.trimming.enabled) {
+			end = this.trimming.end;
+			start = parseFloat(this.trimming.start);
+		}
+		if (current>=Math.floor(end)) {
+			var thisClass = this;
+			paella.events.trigger(paella.events.endVideo,{videoContainer:thisClass});
+			this.pause();
+		}
+		else if (current<start) {
+			this.setCurrentTime(start + 1);
+		}
+	},
+	
+	play:function() {
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (masterVideo) masterVideo.play();
+		if (slaveVideo) slaveVideo.play();
+	},
+	
+	pause:function() {
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (masterVideo) masterVideo.pause();
+		if (slaveVideo) slaveVideo.pause();
+	},
+	
+	next:function() {
+		if (this.trimming.end!=0) {
+			this.setCurrentTime(this.trimming.end);			
+		}
+		else {
+			this.setCurrentTime(this.duration(true));
+		}
+	},
+	
+	previous:function() {
+		this.setCurrentTime(this.trimming.start);
+	},
+
+	setCurrentTime:function(time) {
+		if (this.trimming.enabled) {
+			if (time<this.trimming.start) time = this.trimming.start;
+			if (time>this.trimming.end) time = this.trimming.end;
+		}
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (masterVideo) masterVideo.setCurrentTime(time);
+		if (slaveVideo) slaveVideo.setCurrentTime(time);
+	},
+	
+	currentTime:function() {
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (masterVideo) return masterVideo.currentTime();
+		else if (slaveVideo) return slaveVideo.currentTime();
+		else return 0;
+	},
+	
+	setPlaybackRate:function(params) {
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (masterVideo) {
+			masterVideo.setPlaybackRate(params.rate);
+		}
+		if (slaveVideo) {
+			slaveVideo.setPlaybackRate(params.rate);
+		}
+	},
+	
+	setVolume:function(params) {
+		var masterVideo = this.masterVideo();
+		var slaveVideo = this.slaveVideo();
+		if (masterVideo && params.master) {
+			masterVideo.setVolume(params.master);
+		}
+		else if (masterVideo) {
+			masterVideo.setVolume(0);
+		}
+		if (slaveVideo && params.slave) {
+			slaveVideo.setVolume(params.slave);
+		}
+		else if (slaveVideo) {
+			slaveVideo.setVolume(0);
+		}
+	},
+	
+	volume:function(video) {
+		if (!video && this.masterVideo()) {
+			return this.masterVideo().volume();
+		}
+		else if (video=="master" && this.masterVideo()) {
+			return this.masterVideo().volume();
+		}
+		else if (video=="slave" && this.slaveVideo()) {
+			return this.slaveVideo().volume();
+		}
+		else {
+			return 0;
+		}
+	},
+
+	masterVideo:function() {
+		return this.container.getNode(this.video1Id);
+	},
+	
+	slaveVideo:function() {
+		return this.container.getNode(this.video2Id);
+	},
+	
+	duration:function(ignoreTrimming) {
+		if (this.trimming.enabled && !ignoreTrimming) {
+			return this.trimming.end - this.trimming.start;
+		}
+		else {
+			if (!this.videoDuration) {
+				this.videoDuration = this.masterVideo().duration();
+			}
+			return this.videoDuration;
+		}
+	},
+	
+	paused:function() {
+		return this.masterVideo().isPaused();
+	},
+
+	trimEnabled:function() {
+		return this.trimming.enabled;
+	},
+
+	trimStart:function() {
+		if (this.trimming.enabled) {
+			return this.trimming.start;
+		}
+		else {
+			return 0;
+		}
+	},
+	
+	trimEnd:function() {
+		if (this.trimming.enabled) {
+			return this.trimming.end;
+		}
+		else {
+			return this.duration();
+		}
+	},
+	
+	setMasterSource:function(masterVideoData,type) {
+		if (type=='html') {
+			var masterVideo = new paella.Html5Video(this.video1Id,850,140,360,550);
+		}
+		else if (type=='flash') {
+			var masterVideo = new paella.FlashVideo(this.video1Id,850,140,360,550);
+			masterVideo.streamingMode = false;
+		}
+		else if (type=='streaming') {
+			var masterVideo = new paella.FlashVideo(this.video1Id,850,140,360,550);
+			masterVideo.streamingMode = true;
+		}
+		else if (type=='image') {
+			var masterVideo = new paella.SlideshowVideo(this.video1Id,850,140,360,550);
+		}
+		masterVideo.setClassName(this.video1ClassName);
+		this.container.addNode(masterVideo);
+		
+		var thisClass = this;
+		this.sourceData.push(masterVideoData);
+		this.setupVideo(masterVideo,masterVideoData,type);
+		new Timer(function(timer) {
+			if (masterVideo.isReady()) {
+				thisClass.isMasterReady = true;
+				timer.repeat = false;
+			}
+			else {
+				timer.repeat = true;
+			}
+		},100);
+		
+		// TODO: Return false on video player error
+		return true;
+	},
+	
+	setSlaveSource:function(slaveVideoData,type) {
+		if (type=='html' || !slaveVideoData) {
+			var slaveVideo = new paella.Html5Video(this.video2Id,10,40,800,600);
+		}
+		else if (type=='flash') {
+			var slaveVideo = new paella.FlashVideo(this.video2Id,10,40,800,600);
+			slaveVideo.streamingMode = false;
+		}
+		else if (type=='streaming') {
+			var slaveVideo = new paella.FlashVideo(this.video2Id,10,40,800,600);
+			slaveVideo.streamingMode = true;
+		}
+		else if (type=='image') {
+			var slaveVideo = new paella.SlideshowVideo(this.video2Id,850,140,360,550);
+		}
+		slaveVideo.setClassName(this.video2ClassName);
+		this.container.addNode(slaveVideo);
+		
+		if (!slaveVideoData) {
+			setMonoStreamMode();
+			return false;
+		}
+		
+		var thisClass = this;
+		this.sourceData.push(slaveVideoData);
+		this.setupVideo(slaveVideo,slaveVideoData,type);
+		new Timer(function(timer) {
+			if (slaveVideo.isReady()) {
+				thisClass.isSlaveReady = true;
+				slaveVideo.setVolume(0);
+				timer.repeat = false;
+			}
+			else {
+				timer.repeat = true;
+			}
+		},100);
+		
+		// TODO: Return false on video player error
+		return true;
+	},
+
+	setMonoStreamMode:function() {
+		this.isMonoStream = true;
+		this.isSlaveReady = true;
+	},
+	
+	setupVideo:function(videoNode,videoData,type) {
+		if (videoNode && videoData) {
+			var mp4Source = videoData.sources.mp4;
+			var oggSource = videoData.sources.ogg;
+			var webmSource = videoData.sources.webm;
+			var flvSource = videoData.sources.flv;
+			var rtmpSource = videoData.sources.rtmp;
+			var imageSource = videoData.sources.image;
+			
+			if (type=="html") {
+				if (mp4Source) {
+					videoNode.addSource(mp4Source);
+				}
+				if (oggSource) {
+					videoNode.addSource(oggSource);
+				}
+				if (webmSource) {
+					videoNode.addSource(webmSource);
+				}
+			}
+			else if (flvSource && type=="flash") {
+				videoNode.addSource(flvSource);
+			}
+			else if (mp4Source && type=="flash") {
+				videoNode.addSource(mp4Source);
+			}
+			else if (rtmpSource && type=="streaming"){
+				videoNode.addSource(rtmpSource);
+			}
+			else if (imageSource && type=="image") {
+				videoNode.addSource(imageSource);
+			}
+		}
+	},
+	
+	numberOfStreams:function() {
+		return this.sourceData.length;
+	},
+
+	getMonostreamMasterProfile:function() {
+		return {
+			content:"presenter",
+			visible:true,
+			layer:1,
+			rect:[
+				{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},
+				{aspectRatio:"4/3",left:160,top:0,width:960,height:720},
+			]
+		}
+	},
+	
+	getMonostreamSlaveProfile:function() {
+		return {
+			content:"slides",
+			visible:false,
+			layer:0,
+			rect:[
+				{aspectRatio:"16/9",left:0,top:0,width:0,height:0},
+				{aspectRatio:"4/3",left:0,top:0,width:0,height:0},
+			]
+		}
+	},
+
+	setProfile:function(profileName,onSuccess) {
+		var thisClass = this;
+		paella.Profiles.loadProfile(profileName,function(profileData) {
+			if (thisClass.numberOfStreams()==1) {
+				profileData.masterVideo = thisClass.getMonostreamMasterProfile();
+				profileData.slaveVideo = thisClass.getMonostreamSlaveProfile();
+			}
+			thisClass.applyProfileWithJson(profileData);
+			onSuccess(profileName);
+			paella.utils.cookies.set("lastProfile",profileName);
+		});
+	},
+	
+	isReady:function() {
+		return this.isMasterReady && this.isSlaveReady;
+	},
+
+	hideAllLogos:function() {
+		for (var i=0;i<this.logos.length;++i) {
+			var logoId = this.logos[i];
+			var logo = this.container.getNode(logoId);
+			$(logo.domElement).hide();
+		}
+	},
+
+	showLogos:function(logos) {
+		var relativeSize = new paella.RelativeVideoSize();
+		for (var i=0; i<logos.length;++i) {
+			var logo = logos[i];
+			var logoId = logo.content;
+			var logoNode = this.container.getNode(logoId);
+			var rect = logo.rect;
+			if (!logoNode) {
+				style = {};
+				logoNode = this.container.addNode(new paella.DomNode('img',logoId,style));
+				logoNode.domElement.setAttribute('src','config/profiles/resources/' + logoId);
+				logoNode.domElement.setAttribute('src','config/profiles/resources/' + logoId);
+			}
+			else {
+				$(logoNode.domElement).show();
+			}
+			var percentTop = relativeSize.percentVSize(rect.top) + '%';
+			var percentLeft = relativeSize.percentWSize(rect.left) + '%';
+			var percentWidth = relativeSize.percentWSize(rect.width) + '%';
+			var percentHeight = relativeSize.percentVSize(rect.height) + '%';
+			var style = {top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:'absolute',zIndex:logo.zIndex};
+			$(logoNode.domElement).css(style);
+		}
+	},
+
+	applyProfileWithJson:function(profileData) {
+		var video1 = this.container.getNode(this.video1Id);
+		var video2 = this.container.getNode(this.video2Id);
+
+		var background = this.container.getNode(this.backgroundId);
+
+		var rectMaster = profileData.masterVideo.rect[0];
+		var rectSlave = profileData.slaveVideo.rect[0];
+		var masterDimensions = video1.getDimensions();
+		var slaveDimensions = {width:360,height:240};
+		if (video2) slaveDimensions = video2.getDimensions();
+		var masterAspectRatio = (masterDimensions.height==0) ? 1.3333:masterDimensions.width / masterDimensions.height;
+		var slaveAspectRatio = (slaveDimensions.height==0) ? 1.3333:slaveDimensions.width / slaveDimensions.height;
+		var profileMasterAspectRatio = 1.333;
+		var profileSlaveAspectRatio = 1.333;
+		
+		var minMasterDiff = 10;
+		for (var i = 0; i<profileData.masterVideo.rect.length;++i) {
+			var profileMaster = profileData.masterVideo.rect[i];
+			if (/([0-9]+)\/([0-9]+)/.test(profileMaster.aspectRatio)) {
+				profileMasterAspectRatio = Number(RegExp.$1) / Number(RegExp.$2);
+			}
+			var masterDiff = Math.abs(profileMasterAspectRatio - masterAspectRatio);
+			if (minMasterDiff>masterDiff) {
+				minMasterDiff = masterDiff;
+				rectMaster = profileMaster;
+			}
+			//paella.debug.log(profileMasterAspectRatio + ' - ' + masterAspectRatio + ' = ' + masterDiff);
+		}
+		
+		var minSlaveDiff = 10;
+		for (var i = 0; i<profileData.slaveVideo.rect.length;++i) {
+			var profileSlave = profileData.slaveVideo.rect[i];
+			if (/([0-9]+)\/([0-9]+)/.test(profileSlave.aspectRatio)) {
+				profileSlaveAspectRatio = Number(RegExp.$1) / Number(RegExp.$2);
+			}
+			var slaveDiff = Math.abs(profileSlaveAspectRatio - slaveAspectRatio);
+			if (minSlaveDiff>slaveDiff) {
+				minSlaveDiff = slaveDiff;
+				rectSlave = profileSlave;
+			}
+		}
+		
+		// Logos
+		// Hide previous logos
+		this.hideAllLogos();
+
+		// Create or show new logos
+		this.showLogos(profileData.logos);
+
+		video1.setRect(rectMaster,true);
+		this.currentMasterVideoRect = rectMaster;
+		video1.setVisible(profileData.masterVideo.visible,true);
+		if (video2) {
+			video2.setRect(rectSlave,true);
+			this.currentSlaveVideoRect = rectSlave;
+			video2.setVisible(profileData.slaveVideo.visible,true);
+			video2.setLayer(profileData.slaveVideo.layer);
+		}
+		video1.setLayer(profileData.masterVideo.layer);
+		background.setImage('config/profiles/resources/' + profileData.background.content);
+	},
+
+	resizePortrail:function() {
+		var width = $(this.domElement).width();
+		var relativeSize = new paella.RelativeVideoSize();
+		var height = relativeSize.proportionalHeight(width);
+		this.container.domElement.style.width = width + 'px';
+		this.container.domElement.style.height = height + 'px';
+		
+		var containerHeight = $(this.domElement).height();
+		var newTop = containerHeight / 2 - height / 2;
+		this.container.domElement.style.top = newTop + "px";
+	},
+	
+	resizeLandscape:function() {
+		var height = $(this.domElement).height();
+		var relativeSize = new paella.RelativeVideoSize();
+		var width = relativeSize.proportionalWidth(height);
+		this.container.domElement.style.width = width + 'px';
+		this.container.domElement.style.height = height + 'px';
+		this.container.domElement.style.top = '0px';
+	},
+
+	onresize:function() { this.parent();
+		var relativeSize = new paella.RelativeVideoSize();
+		var aspectRatio = relativeSize.aspectRatio();
+		var width = $(this.domElement).width();
+		var height = $(this.domElement).height();
+		var containerAspectRatio = width/height;
+		
+		if (containerAspectRatio>aspectRatio) {
+			this.resizeLandscape();
+		}
+		else {
+			this.resizePortrail();
+		}
+	}
+});
+
+
diff --git a/tmp/05_plugin_base.js b/tmp/05_plugin_base.js
new file mode 100644
index 0000000..d4d7684
--- /dev/null
+++ b/tmp/05_plugin_base.js
@@ -0,0 +1,375 @@
+paella.PluginManager = Class.create({
+	targets:null,
+	pluginList:new Array(),
+	eventDrivenPlugins:new Array(),
+	
+	initialize:function() {
+		this.targets = {};
+		var thisClass = this;
+		paella.events.bind(paella.events.loadPlugins,function(event) {
+			thisClass.loadPlugins();
+		});
+	},
+
+	setTarget:function(pluginType,target) {
+		if (target.addPlugin) {
+			this.targets[pluginType] = target;
+		}
+	},
+
+	getTarget:function(pluginType) {
+		// PluginManager can handle event-driven events:
+		if (pluginType=="eventDriven") {
+			return this;
+		}
+		else {
+			var target = this.targets[pluginType];
+			return target;
+		}
+	},
+	
+	registerPlugin:function(plugin) {
+		// Registra los plugins en una lista y los ordena
+		this.pluginList.push(plugin);
+		this.pluginList.sort(function(a,b) {
+			return a.getIndex() - b.getIndex();
+		});
+	},
+
+	loadPlugins:function() {
+		for (var i=0; i<this.pluginList.length; ++i) {
+			var plugin = this.pluginList[i];
+			paella.debug.log("loading plugin " + plugin.getName());
+			plugin.load(this);
+		}
+	},
+	
+	addPlugin:function(plugin) {
+		var thisClass = this;
+		plugin.checkEnabled(function(isEnabled) {
+			if (plugin.type=="eventDriven" && isEnabled) {
+				plugin.setup();
+				thisClass.eventDrivenPlugins.push(plugin);
+				var events = plugin.getEvents();
+				for (var i=0; i<events.length;++i) {
+					var eventName = events[i];
+					paella.events.bind(eventName,function(event,params) {
+						plugin.onEvent(event.type,params);
+					});
+				}	
+			}
+		});
+	},
+	
+	getPlugin:function(name) {
+		for (var i=0;i<this.pluginList.length;++i) {
+			if (this.pluginList[i].getName()==name) return this.pluginList[i];
+		}
+		return null;
+	}
+});
+
+paella.pluginManager = new paella.PluginManager();
+
+paella.Plugin = Class.create({
+	type:'',
+	
+	initialize:function() {
+		var thisClass = this;
+		paella.pluginManager.registerPlugin(this);
+	},
+
+	load:function(pluginManager) {
+		var target = pluginManager.getTarget(this.type);
+		if (target && target.addPlugin) {
+			target.addPlugin(this);
+		}
+	},
+
+	getRootNode:function(id) {
+		return null;
+	},
+	
+	checkEnabled:function(onSuccess) {
+		onSuccess(true);
+	},
+	
+	setup:function() {
+		
+	},
+	
+	getIndex:function() {
+		return 0;
+	},
+	
+	getName:function() {
+		return "";
+	}
+});
+
+paella.PopUpContainer = Class.create(paella.DomNode,{
+	containers:null,
+	currentContainerId:-1,
+
+	initialize:function(id,className) {
+		var This = this;
+		var style = {};
+		this.parent('div',id,style);
+		this.domElement.className = className;
+		
+		this.containers = {};
+		paella.events.bind(paella.events.hidePopUp,function(event,params) { This.hideContainer(params.identifier,params.button); });
+		paella.events.bind(paella.events.showPopUp,function(event,params) { This.showContainer(params.identifier,params.button); });
+	},
+	
+	hideContainer:function(identifier,button) {
+		var container = this.containers[identifier];
+		if (container && this.currentContainerId==identifier) {
+			container.plugin.willHideContent();
+			$(container.element).hide();
+			container.button.className = container.button.className.replace(' selected','');
+			$(this.domElement).css({width:'0px'});
+			this.currentContainerId = -1;
+			container.plugin.didHideContent();
+		}
+	},
+	
+	showContainer:function(identifier,button) {
+		var container = this.containers[identifier];
+		var right = $(button.parentElement).width() - $(button).position().left - $(button).width();
+		if (container && this.currentContainerId!=identifier && this.currentContainerId!=-1) {
+			var prevContainer = this.containers[this.currentContainerId];
+			prevContainer.plugin.willHideContent();
+			prevContainer.button.className = prevContainer.button.className.replace(' selected','');
+			container.button.className = container.button.className + ' selected';
+			$(prevContainer.element).hide();
+			prevContainer.plugin.didHideContent();
+			container.plugin.willShowContent();
+			$(container.element).show();
+			var width = $(container.element).width();
+			$(this.domElement).css({width:width + 'px',right:right + 'px'});
+			this.currentContainerId = identifier;
+			container.plugin.didShowContent();
+		}
+		else if (container && this.currentContainerId==identifier) {
+			container.plugin.willHideContent();
+			$(container.element).hide();
+			$(this.domElement).css({width:'0px'});			
+			container.button.className = container.button.className.replace(' selected','');
+			this.currentContainerId = -1;
+			container.plugin.didHideContent();
+		}
+		else if (container) {
+			container.button.className = container.button.className + ' selected';
+			container.plugin.willShowContent();
+			$(container.element).show();
+			var width = $(container.element).width();
+			$(this.domElement).css({width:width + 'px',right:right + 'px'});
+			this.currentContainerId = identifier;
+			container.plugin.didShowContent();
+		}
+	},
+	
+	registerContainer:function(identifier,domElement,button,plugin) {
+		var containerInfo = {
+			button:button,
+			element:domElement,
+			plugin:plugin
+		};
+		this.containers[identifier] = containerInfo;
+		// this.domElement.appendChild(domElement);
+		$(domElement).hide();
+		button.popUpIdentifier = identifier;
+		button.sourcePlugin = plugin;
+		$(button).click(function(event) {
+			paella.events.trigger(paella.events.showPopUp,{identifier:this.popUpIdentifier,button:this});
+		});
+	}
+});
+
+paella.TimelineContainer = Class.create(paella.PopUpContainer,{
+	hideContainer:function(identifier,button) {
+		var container = this.containers[identifier];
+		if (container && this.currentContainerId==identifier) {
+			container.plugin.willHideContent();
+			$(container.element).hide();
+			container.button.className = container.button.className.replace(' selected','');
+			this.currentContainerId = -1;
+			$(this.domElement).css({height:'0px'});
+			container.plugin.didHideContent();
+		}
+	},
+	
+	showContainer:function(identifier,button) {
+		var container = this.containers[identifier];
+		if (container && this.currentContainerId!=identifier && this.currentContainerId!=-1) {
+			var prevContainer = this.containers[this.currentContainerId];
+			prevContainer.button.className = prevContainer.button.className.replace(' selected','');
+			container.button.className = container.button.className + ' selected';
+			prevContainer.plugin.willHideContent();
+			$(prevContainer.element).hide();
+			prevContainer.plugin.didHideContent();
+			container.plugin.willShowContent();
+			$(container.element).show();
+			this.currentContainerId = identifier;
+			var height = $(container.element).height();
+			$(this.domElement).css({height:height + 'px'});
+			container.plugin.didShowContent();
+		}
+		else if (container && this.currentContainerId==identifier) {
+			container.plugin.willHideContent();
+			$(container.element).hide();		
+			container.button.className = container.button.className.replace(' selected','');
+			$(this.domElement).css({height:'0px'});
+			this.currentContainerId = -1;
+			container.plugin.didHideContent();
+		}
+		else if (container) {
+			container.plugin.willShowContent();
+			container.button.className = container.button.className + ' selected';
+			$(container.element).show();
+			this.currentContainerId = identifier;
+			var height = $(container.element).height();
+			$(this.domElement).css({height:height + 'px'});
+			container.plugin.didShowContent();
+		}
+	}
+});
+
+paella.ButtonPlugin = Class.create(paella.Plugin,{
+	type:'button',
+	subclass:'',
+	container:null,
+	
+	getAlignment:function() {
+		return 'left';	// or right
+	},
+	
+	// Returns the button subclass.
+	getSubclass:function() {
+		return "myButtonPlugin";
+	},
+
+	action:function(button) {
+		// Implement this if you want to do something when the user push the plugin button
+	},
+	
+	getName:function() {
+		return "ButtonPlugin";
+	},
+	
+	getMinWindowSize:function() {
+		return 0;
+	},
+	
+	buildContent:function(domElement) {
+		// Override if your plugin 
+	},
+	
+	willShowContent:function() {
+		paella.debug.log(this.getName() + " willDisplayContent");
+	},
+
+	didShowContent:function() {
+		paella.debug.log(this.getName() + " didDisplayContent");
+	},
+
+	willHideContent:function() {
+		paella.debug.log(this.getName() + " willHideContent");
+	},
+
+	didHideContent:function() {
+		paella.debug.log(this.getName() + " didHideContent");
+	},
+
+	getButtonType:function() {
+		//return paella.ButtonPlugin.type.popUpButton;
+		//return paella.ButtonPlugin.type.timeLineButton;
+		return paella.ButtonPlugin.type.actionButton;
+	},
+	
+	// Utility functions: do not override
+	changeSubclass:function(newSubclass) {
+		this.subclass = newSubclass;
+		this.container.className = this.getClassName();
+	},
+	
+	getClassName:function() {
+		return paella.ButtonPlugin.kClassName + ' ' + this.getAlignment() + ' ' + this.subclass;
+	},
+	
+	getContainerClassName:function() {
+		if (this.getButtonType()==paella.ButtonPlugin.type.timeLineButton) {
+			return paella.ButtonPlugin.kTimeLineClassName + ' ' + this.getSubclass();
+		}
+		else if (this.getButtonType()==paella.ButtonPlugin.type.popUpButton) {
+			return paella.ButtonPlugin.kPopUpClassName + ' ' + this.getSubclass();
+		}
+	}
+});
+
+paella.ButtonPlugin.alignment = {
+	left:'left',
+	right:'right'
+}
+paella.ButtonPlugin.kClassName = 'buttonPlugin';
+paella.ButtonPlugin.kPopUpClassName = 'buttonPluginPopUp';
+paella.ButtonPlugin.kTimeLineClassName = 'buttonTimeLine';
+paella.ButtonPlugin.type = {
+	actionButton:1,
+	popUpButton:2,
+	timeLineButton:3
+}
+
+paella.ButtonPlugin.buildPluginButton = function(plugin,id) {
+	plugin.subclass = plugin.getSubclass();
+	var elem = document.createElement('div');
+	elem.className = plugin.getClassName();
+	elem.id = id;
+	elem.plugin = plugin;
+	plugin.container = elem;
+	$(elem).click(function(event) {
+		this.plugin.action(this);
+	});
+	return elem;
+}
+
+paella.ButtonPlugin.buildPluginPopUp = function(parent,plugin,id) {
+	plugin.subclass = plugin.getSubclass();
+	var elem = document.createElement('div');
+	parent.appendChild(elem);
+	elem.className = plugin.getContainerClassName();
+	elem.id = id;
+	elem.plugin = plugin;
+	plugin.buildContent(elem);
+	return elem;
+}
+
+
+paella.EventDrivenPlugin = Class.create(paella.Plugin,{
+	type:'eventDriven',
+	
+	initialize:function() {
+		this.parent();
+		var events = this.getEvents();
+		for (var i = 0; i<events.length;++i) {
+			var event = events[i];
+			if (event==paella.events.loadStarted) {
+				this.onEvent(paella.events.loadStarted);
+			}
+		}
+	},
+
+	getEvents:function() {
+		return new Array();
+	},
+
+	onEvent:function(eventType,params) {
+	},
+	
+	getName:function() {
+		return "EventDrivenPlugin";
+	}
+});
+
+
diff --git a/tmp/06_ui_controls.js b/tmp/06_ui_controls.js
new file mode 100644
index 0000000..9b2c6c6
--- /dev/null
+++ b/tmp/06_ui_controls.js
@@ -0,0 +1 @@
+paella.TimeControl=Class.create(paella.DomNode,{initialize:function(b){this.parent("div",b,{left:"0%"});this.domElement.className="timeControlOld";this.domElement.className="timeControl";var a=this;paella.events.bind(paella.events.timeupdate,function(c,d){a.onTimeUpdate(d)})},onTimeUpdate:function(a){var b=a.videoContainer;var g={start:0,end:b.duration};var f={start:b.trimStart(),end:b.trimEnd()};var d=a.currentTime-f.start;var e=f.end-f.start;var c=d*100/e;if(this.domElement.className=="timeControlOld"){this.domElement.style.left=c+"%"}this.domElement.innerHTML=this.secondsToHours(parseInt(d))},secondsToHours:function(b){var a=Math.floor(b/3600);var c=Math.floor((b-(a*3600))/60);var d=b-(a*3600)-(c*60);if(c<10){c="0"+c}if(d<10){d="0"+d}return a+":"+c+":"+d}});paella.PlaybackBar=Class.create(paella.DomNode,{playbackFullId:"",updatePlayBar:true,timeControlId:"",initialize:function(d){var c={};this.parent("div",d,c);this.domElement.className="playbackBar";this.playbackFullId=d+"_full";this.timeControlId=d+"_timeControl";var b=new paella.DomNode("div",this.playbackFullId,{width:"0%"});b.domElement.className="playbackBarFull";this.addNode(b);this.addNode(new paella.TimeControl(this.timeControlId));var a=this;paella.events.bind(paella.events.timeupdate,function(e,f){a.onTimeUpdate(f)});$(this.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(b.domElement).bind("mousedown",function(e){paella.utils.mouseManager.down(a,e);e.stopPropagation()});$(this.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(b.domElement).bind("mousemove",function(e){paella.utils.mouseManager.move(e)});$(this.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)});$(b.domElement).bind("mouseup",function(e){paella.utils.mouseManager.up(e)})},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(a){this.playbackFull().domElement.style.width=a+"%"},isSeeking:function(){return !this.updatePlayBar},onTimeUpdate:function(a){if(this.updatePlayBar){var b=a.videoContainer;var f={start:0,end:b.duration};var e={start:b.trimStart(),end:b.trimEnd()};var c=a.currentTime-e.start;var d=e.end-e.start;this.setPlaybackPosition(c*100/d)}},down:function(b,a,c){this.updatePlayBar=false;this.move(b,a,c)},move:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}this.setPlaybackPosition(b)},up:function(d,a,e){var c=$(this.domElement).width();var b=a-$(this.domElement).offset().left;if(b<0){b=0}else{if(b>c){b=100}else{b=b*100/c}}paella.events.trigger(paella.events.seekTo,{newPositionPercent:b});this.updatePlayBar=true}});paella.PlaybackControl=Class.create(paella.DomNode,{playbackBarId:"",pluginsContainer:null,popUpPluginContainer:null,timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(c){var a=this;var d="buttonPlugin"+this.buttonPlugins.length;var b=paella.ButtonPlugin.buildPluginButton(c,d);c.button=b;this.pluginsContainer.domElement.appendChild(b);$(b).hide();c.checkEnabled(function(g){if(g){$(c.button).show();c.setup();var i="buttonPlugin"+a.buttonPlugins.length;if(c.getButtonType()==paella.ButtonPlugin.type.popUpButton){var f=a.popUpPluginContainer.domElement;var e=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_container");a.popUpPluginContainer.registerContainer(c.getName(),e,b,c)}else{if(c.getButtonType()==paella.ButtonPlugin.type.timeLineButton){var f=a.timeLinePluginContainer.domElement;var h=paella.ButtonPlugin.buildPluginPopUp(f,c,i+"_timeline");a.timeLinePluginContainer.registerContainer(c.getName(),h,b,c)}}}})},initialize:function(c){var b={};this.parent("div",c,b);this.domElement.className="playbackControls";this.playbackBarId=c+"_playbackBar";var a=this;this.pluginsContainer=new paella.DomNode("div",c+"_playbackBarPlugins");this.pluginsContainer.domElement.className="playbackBarPlugins";this.addNode(this.pluginsContainer);this.popUpPluginContainer=new paella.PopUpContainer(c+"_popUpPluginContainer","popUpPluginContainer");this.addNode(this.popUpPluginContainer);this.timeLinePluginContainer=new paella.TimelineContainer(c+"_timelinePluginContainer","timelinePluginContainer");this.addNode(this.timeLinePluginContainer);this.addNode(new paella.PlaybackBar(this.playbackBarId));paella.pluginManager.setTarget("button",this)},playbackBar:function(){if(this.playbackBarInstance==null){this.playbackBarInstance=this.getNode(this.playbackBarId)}return this.playbackBarInstance},onresize:function(){paella.debug.log("resize playback bar");var a=$(this.domElement).width();for(var b=0;b<this.buttonPlugins.length;++b){var c=this.buttonPlugins[b];var d=c.getMinWindowSize();if(d>0&&a<d){$(c.container).hide()}else{$(c.container).show()}}}});paella.ControlsContainer=Class.create(paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:true,autohideTimer:null,hideControlsTimeMillis:3000,playbackControlInstance:null,initialize:function(b){this.parent("div",b);this.viewControlId=b+"_view";this.playbackControlId=b+"_playback";this.editControlId=b+"_editor";this.addNode(new paella.PlaybackControl(this.playbackControlId));var a=this;paella.events.bind(paella.events.showEditor,function(c){a.onShowEditor()});paella.events.bind(paella.events.hideEditor,function(c){a.onHideEditor()});paella.events.bind(paella.events.play,function(c){a.onPlayEvent()});paella.events.bind(paella.events.pause,function(c){a.onPauseEvent()});paella.events.bind("mousemove",function(c){a.onMouseMoveEvent()});paella.events.bind(paella.events.endVideo,function(c){a.onEndVideoEvent()})},onShowEditor:function(){var a=this.editControl();if(a){$(a.domElement).hide()}},onHideEditor:function(){var a=this.editControl();if(a){$(a.domElement).show()}},showEditorButton:function(){this.addNode(new EditControl(this.editControlId))},enterEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).hide()}},exitEditMode:function(){var b=this.playbackControl();var a=this.editControl();if(b&&a){$(b.domElement).show()}},playbackControl:function(){if(this.playbackControlInstance==null){this.playbackControlInstance=this.getNode(this.playbackControlId)}return this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=false;this.hide()},enable:function(){this.isEnabled=true;this.show()},hide:function(){var a=new UserAgent();if(!a.browser.IsMobileVersion){$(this.domElement).animate({opacity:0},300);paella.events.trigger(paella.events.controlBarWillHide)}else{paella.debug.log("Mobile version: controls will not hide")}},show:function(){if(this.isEnabled){if(this.domElement.style.opacity!=1){this.domElement.style.opacity=1;paella.events.trigger(paella.events.controlBarDidShow)}}},autohideTimeout:function(){var a=this.playbackControl().playbackBar();if(a.isSeeking()){this.restartAutohideTimer()}else{this.hideControls()}},hideControls:function(){this.hide()},showControls:function(){this.show()},onPlayEvent:function(){this.restartAutohideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show();this.clearAutohideTimer()},onMouseMoveEvent:function(){this.showControls();if(paella.player.videoContainer.isReady()&&!paella.player.videoContainer.paused()){this.restartAutohideTimer()}},clearAutohideTimer:function(){if(this.autohideTimer!=null){this.autohideTimer.cancel();this.autohideTimer=null}},restartAutohideTimer:function(){this.clearAutohideTimer();var a=this;this.autohideTimer=new paella.utils.Timer(function(b){a.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}});
\ No newline at end of file
diff --git a/tmp/07_ui_extras.js b/tmp/07_ui_extras.js
new file mode 100644
index 0000000..db3b105
--- /dev/null
+++ b/tmp/07_ui_extras.js
@@ -0,0 +1,321 @@
+paella.LoaderContainer = Class.create(paella.DomNode,{
+	timer:null,
+	loader:null,
+	loaderPosition:0,
+
+	initialize:function(id) {
+		this.parent('div',id,{position:'fixed',backgroundColor:'white',opacity:'0.7',top:'0px',left:'0px',right:'0px',bottom:'0px',zIndex:10000});
+		this.loader = this.addNode(new paella.DomNode('div','',{position:'fixed',width:'128px',height:'128px',top:'50%',left:'50%',marginLeft:'-64px',marginTop:'-64px',backgroundImage:'url(resources/images/loader.png)'}));
+		var thisClass = this;
+		paella.events.bind(paella.events.loadComplete,function(event,params) { thisClass.loadComplete(params); });
+		this.timer = new paella.utils.Timer(function(timer) {
+			thisClass.loaderPosition -= 128;
+			thisClass.loader.domElement.style.backgroundPosition = thisClass.loaderPosition + 'px';
+			timer.timeout = timer.timeout * 2;
+		},1000);
+		this.timer.repeat = true;
+	},
+	
+	loadComplete:function(params) {
+		$(this.domElement).hide();
+		this.timer.repeat = false;
+	}
+});
+
+paella.KeyManager = Class.create({
+	isPlaying:false,
+	Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},
+	
+	enabled:true,
+
+	initialize:function() {
+		var thisClass = this;
+		paella.events.bind(paella.events.loadComplete,function(event,params) { thisClass.loadComplete(event,params); });
+		paella.events.bind(paella.events.play,function(event) { thisClass.onPlay(); });
+		paella.events.bind(paella.events.pause,function(event) { thisClass.onPause(); });
+	},
+	
+	loadComplete:function(event,params) {
+		var thisClass = this;
+		paella.events.bind("keyup",function(event) { thisClass.keyUp(event); });
+	},
+
+	onPlay:function() {
+		this.isPlaying = true;
+	},
+
+	onPause:function() {
+		this.isPlaying = false;
+	},
+
+	keyUp:function(event) {
+		if (!this.enabled) return;
+		
+		// Matterhorn standard keys
+		if (event.altKey && event.ctrlKey) {
+			if (event.which==this.Keys.P) {
+				this.togglePlayPause();
+			}
+			else if (event.which==this.Keys.S) {
+				this.pause();
+			}
+			else if (event.which==this.Keys.M) {
+				this.mute();
+			}
+			else if (event.which==this.Keys.U) {
+				this.volumeUp();
+			}
+			else if (event.which==this.Keys.D) {
+				this.volumeDown();
+			}
+		}
+		else { // Paella player keys
+			if (event.which==this.Keys.Space) {
+				this.togglePlayPause();
+			}
+			else if (event.which==this.Keys.Up) {
+				this.volumeUp();
+			}
+			else if (event.which==this.Keys.Down) {
+				this.volumeDown();
+			}
+			else if (event.which==this.Keys.M) {
+				this.mute();
+			}
+		}
+	},
+	
+	togglePlayPause:function() {
+		if (this.isPlaying) {
+			paella.events.trigger(paella.events.pause);
+		}
+		else {
+			paella.events.trigger(paella.events.play);
+		}
+	},
+	
+	pause:function() {
+		paella.events.trigger(paella.events.pause);
+	},
+	
+	mute:function() {
+		var videoContainer = paella.player.videoContainer;
+		var newVolume = 0;
+		if (videoContainer.volume()==0) newVolume = 1.0;
+		paella.events.trigger(paella.events.setVolume,{master:newVolume,slave:0});
+	},
+	
+	volumeUp:function() {
+		var videoContainer = paella.player.videoContainer;
+		var volume = videoContainer.volume();
+		volume += 0.1;
+		volume = (volume>1) ? 1.0:volume;
+		paella.events.trigger(paella.events.setVolume,{master:volume,slave:0});
+	},
+	
+	volumeDown:function() {
+		var videoContainer = paella.player.videoContainer;
+		var volume = videoContainer.volume();
+		volume -= 0.1;
+		volume = (volume<0) ? 0.0:volume;
+		paella.events.trigger(paella.events.setVolume,{master:volume,slave:0});
+	}
+});
+
+paella.keyManager = new paella.KeyManager();
+
+paella.MessageBox = Class.create({
+	modalContainerClassName:'modalMessageContainer',
+	frameClassName:'frameContainer',
+	messageClassName:'messageContainer',
+	errorClassName:'errorContainer',
+	currentMessageBox:null,
+	messageContainer:null,
+	onClose:null,
+	
+	initialize:function() {
+		var thisClass = this;
+		$(window).resize(function(event) { thisClass.adjustTop(); });
+	},
+
+	showFrame:function(src,params) {
+		var closeButton = true;
+		var width = "80%";
+		var height = "80%";
+		var onClose = null;
+		if (params) {
+			closeButton = params.closeButton;
+			width = params.width;
+			height = params.height;
+			onClose = params.onClose;	
+		}
+
+		this.doShowFrame(src,closeButton,width,height,onClose);
+	},
+
+	doShowFrame:function(src,closeButton,width,height,onClose) {
+		this.onClose = onClose;
+
+		if (this.currentMessageBox) {
+			this.close();
+		}
+
+		if (!width) { width = '80%'; }
+		
+		if (!height) { height = '80%'; }
+		
+		var modalContainer = document.createElement('div');
+		modalContainer.className = this.modalContainerClassName;
+		modalContainer.style.position = 'fixed';
+		modalContainer.style.top = '0px';
+		modalContainer.style.left = '0px';
+		modalContainer.style.right = '0px';
+		modalContainer.style.bottom = '0px';
+		modalContainer.style.zIndex = 999999;
+		
+		var messageContainer = document.createElement('div');
+		messageContainer.className = this.frameClassName;
+		messageContainer.style.width = width;
+		messageContainer.style.height = height;
+		messageContainer.style.position = 'relative';
+		modalContainer.appendChild(messageContainer);
+		
+		var iframeContainer = document.createElement('iframe');
+		iframeContainer.src = src;
+		iframeContainer.setAttribute("frameborder", "0");
+		iframeContainer.style.width = "100%";
+		iframeContainer.style.height = "100%";
+		messageContainer.appendChild(iframeContainer);
+		
+		$('body')[0].appendChild(modalContainer);
+		
+		this.currentMessageBox = modalContainer;
+		this.messageContainer = messageContainer;
+		var thisClass = this;
+		this.adjustTop();
+		
+		if (closeButton) {
+			this.createCloseButton();
+		}
+
+	},
+
+	showMessage:function(message,params) {
+		var closeButton = true;
+		var width = "60%";
+		var height = "40%";
+		var onClose = null;
+		var className = this.messageClassName;
+		if (params) {
+			className = params.className;
+			closeButton = params.closeButton;
+			width = params.width;
+			height = params.height;
+			onClose = params.onClose;	
+		}
+		
+		this.doShowMessage(message,closeButton,width,height,className,onClose);
+	},
+
+	doShowMessage:function(message,closeButton,width,height,className,onClose) {
+		this.onClose = onClose;
+
+		if (this.currentMessageBox) {
+			this.close();
+		}
+		if (!className) className = this.messageClassName;
+		
+		if (!width) { width = '80%'; }
+		
+		if (!height) { height = '30%'; }
+		
+		var modalContainer = document.createElement('div');
+		modalContainer.className = this.modalContainerClassName;
+		modalContainer.style.position = 'fixed';
+		modalContainer.style.top = '0px';
+		modalContainer.style.left = '0px';
+		modalContainer.style.right = '0px';
+		modalContainer.style.bottom = '0px';
+		modalContainer.style.zIndex = 999999;
+		
+		var messageContainer = document.createElement('div');
+		messageContainer.className = className;
+		messageContainer.style.width = width;
+		messageContainer.style.height = height;
+		messageContainer.style.position = 'relative';
+		messageContainer.innerHTML = message;
+		modalContainer.appendChild(messageContainer);
+		
+		$('body')[0].appendChild(modalContainer);
+		
+		this.currentMessageBox = modalContainer;
+		this.messageContainer = messageContainer;
+		var thisClass = this;
+		this.adjustTop();
+		
+		if (closeButton) {
+			this.createCloseButton();
+		}
+	},
+	
+	showError:function(message,params) {
+		var closeButton = false;
+		var width = "60%";
+		var height = "20%";
+		var onClose = null;
+		if (params) {
+			closeButton = params.closeButton;
+			width = params.width;
+			height = params.height;
+			onClose = params.onClose;	
+		}
+		
+		this.doShowError(message,closeButton,width,height,onClose);
+	},
+
+	doShowError:function(message,closeButton,width,height,onClose) {
+		this.doShowMessage(message,closeButton,width,height,this.errorClassName,onClose);
+	},
+	
+	createCloseButton:function() {
+		if (this.messageContainer) {
+			var thisClass = this;
+			var closeButton = document.createElement('div');
+			this.messageContainer.appendChild(closeButton);
+			closeButton.className = 'paella_messageContainer_closeButton';
+			$(closeButton).click(function(event) { thisClass.onCloseButtonClick(); });
+		}
+	},
+	
+	adjustTop:function() {
+		if (this.currentMessageBox) {
+		
+			var msgHeight = $(this.messageContainer).outerHeight();
+			var containerHeight = $(this.currentMessageBox).height();
+
+			var top = containerHeight/2 - msgHeight/2;
+			this.messageContainer.style.marginTop = top + 'px';
+		}
+	},
+	
+	close:function() {
+		if (this.currentMessageBox && this.currentMessageBox.parentNode) {
+			var msgBox = this.currentMessageBox;
+			var parent = msgBox.parentNode;
+			$(msgBox).animate({opacity:0.0},300,function() {
+				parent.removeChild(msgBox);
+			});
+			if (this.onClose) {
+				this.onClose();
+			}
+		}
+	},
+	
+	onCloseButtonClick:function() {
+		this.close();
+	}
+});
+
+paella.messageBox = new paella.MessageBox();
+
+
diff --git a/tmp/08_paella_core.js b/tmp/08_paella_core.js
new file mode 100644
index 0000000..0015a7d
--- /dev/null
+++ b/tmp/08_paella_core.js
@@ -0,0 +1,312 @@
+paella.AccessControl = Class.create({
+	permissions:{
+		canRead:false,
+		canContribute:false,
+		canWrite:false,
+		loadError:true,
+		isAnonymous:false
+	},
+
+	checkAccess:function(onSuccess) {
+		onSuccess(this.permissions);
+	}
+});
+
+paella.DefaultAccessControl = Class.create(paella.AccessControl,{
+	checkAccess:function(onSuccess) {
+		this.permissions.canRead = false;
+		this.permissions.canContribute = false;
+		this.permissions.canWrite = false;
+		this.permissions.loadError = false;
+		this.permissions.isAnonymous = true;
+		onSuccess(this.permissions);
+	}
+});
+
+paella.VideoLoader = Class.create({
+	streams:[],		// {sources:{mp4:{src:"videourl.mp4",type:"video/mp4"},
+					//			 ogg:{src:"videourl.ogv",type:"video/ogg"},
+					//			 webm:{src:"videourl.webm",type:"video/webm"},
+					//			 flv:{src:"videourl.flv",type:"video/x-flv"},
+					//			 rtmp:{src:"rtmp://server.com/endpoint/url.loquesea",type="video/mp4 | video/x-flv"},
+					//			 image:{frames:{frame_1:'frame_1.jpg',...frame_n:'frame_n.jpg'},duration:183},
+					//	preview:'video_preview.jpg'}
+	frameList:[],	// frameList[timeInstant] = { id:"frame_id", mimetype:"image/jpg", time:timeInstant, url:"image_url"}
+
+	loadStatus:false,
+	codecStatus:false,
+
+	isH264Capable:function() {
+		var videoElement = document.createElement('video');
+		var h264 = videoElement.canPlayType('video/mp4; codecs="avc1.42E01E"');
+		if (h264=="") h264 = videoElement.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
+		h264 = (h264=='probably') || (h264=='maybe');
+		return h264;
+	},
+
+	isOggCapable:function() {
+		var videoElement = document.createElement('video');
+		var ogg = videoElement.canPlayType('video/ogg; codecs="theora"');
+		ogg = (ogg=='probably') || (ogg=='maybe');
+		return ogg;
+	},
+
+	isWebmCapable:function() {
+		var videoElement = document.createElement('video');
+		var webm = videoElement.canPlayType('video/webm; codecs="vp8, vorbis"');
+		webm = (webm=='probably') || (webm=='maybe');
+		return webm;
+	},
+	
+	isImageCapable:function() {
+		return true;
+	},
+	
+	isHtmlVideoCompatible:function(streamIndex) {
+		var status = false;
+		if (this.streams.length>streamIndex) {
+			var stream = this.streams[streamIndex];
+			var h264 = this.isH264Capable();
+			var ogg = this.isOggCapable();
+			var webm = this.isWebmCapable();
+			
+			paella.debug.log("Browser video capabilities: mp4=" + ((h264) ? 'yes':'no') + ', ogg=' + ((ogg) ? 'yes':'no') + ', webm=' + ((webm) ? 'yes':'no'));
+			
+			if (stream.sources.mp4 && h264 && !/rtmp:\/\//.test(stream.sources.mp4.src)) {
+				status = true;
+			}
+			else if (stream.sources.ogg && ogg) {
+				status = true;
+			}
+			else if (stream.sources.webm && webm) {
+				status = true;
+			}
+		}
+		return status;
+	},
+	
+	isImageCompatible:function(streamIndex) {
+		var status = false;
+		if (this.streams.length>streamIndex) {
+			var stream = this.streams[streamIndex];
+			if (stream.sources.image) {
+				status = true;
+			}
+		}
+		return status;
+	},
+	
+	isFlashCompatible:function(streamIndex) {
+		var ua = new UserAgent();
+		var status = false;
+		
+		if (this.streams.length>streamIndex) {
+			var stream = this.streams[streamIndex];
+				
+			if (stream.sources.mp4) status = true;
+			else if (stream.sources.flv) status = true;
+		}
+
+		return status && !ua.browser.IsMobileVersion;
+	},
+
+	isStreamingCompatible:function(streamIndex) {
+		var ua = new UserAgent();
+		var status = false;
+
+		if (this.streams.length>streamIndex) {
+			var stream = this.streams[streamIndex];
+				
+			if (stream.sources.rtmp) status = true;
+			else status = false;
+		}
+
+		return status && !ua.browser.IsMobileVersion;
+	},
+	
+	isStreamCompatible:function(streamIndex,method) {
+		var status = false;
+		if (method.name=='html' && this.isHtmlVideoCompatible(streamIndex)) {
+			status = true;
+		}
+		else if (method.name=='flash' && this.isFlashCompatible(streamIndex)) {
+			status = true;
+		}
+		else if (method.name=='streaming' && this.isStreamingCompatible(streamIndex)) {
+			status = true;
+		}
+		else if (method.name=='image' && this.isImageCompatible(streamIndex)) {
+			status = true;
+		}
+		return status;
+	},
+
+	getPreferredMethod:function(streamIndex) {
+		var userAgent = new UserAgent();
+		var preferredMethod = null;
+		var methods = paella.player.config.player.methods;
+		
+		// Mobile browsers can only play one stream
+		if (userAgent.browser.isMobileVersion && streamIndex>=1) {
+			for (var i=0;i<methods.length;++i) {
+				if (methods[i].name=='image' && methods[i].enabled && this.isStreamCompatible(streamIndex,methods[i])) {
+					preferredMethod = method;
+				}
+			}
+		} 
+		else {
+			for (var i=0;i<methods.length;++i) {
+				if (this.isStreamCompatible(streamIndex,methods[i])) {
+					preferredMethod = methods[i];
+					break;
+				}
+			}
+		}
+		
+		return preferredMethod;
+	},
+
+	loadVideo:function(videoId,onSuccess) {
+		// This function must to:
+		//	- load this.streams and this.frameList
+		// 	- Check streams compatibility using this.isStreamCompatible(streamIndex)
+		//	- Set this.loadStatus = true if load is Ok, or false if something gone wrong
+		//	- Set this.codecStatus = true if the browser can reproduce all streams
+		//	- Call onSuccess()
+		onSuccess();
+	}
+});
+
+paella.PlayerBase = Class.create({
+	config:null,
+	playerId:'',
+	mainContainer:null,
+	videoContainer:null,
+	controls:null,
+	accessControl:null,
+	
+	checkCompatibility:function() {
+		if (paella.utils.parameters.get('ignoreBrowserCheck')) {
+			return true;
+		}
+		var userAgent = new UserAgent();
+		if (userAgent.browser.IsMobileVersion) return true;
+		if (userAgent.browser.Chrome || userAgent.browser.Safari || userAgent.browser.Firefox || userAgent.browser.Opera ||
+				(userAgent.browser.Explorer && userAgent.browser.Version.major>=9)) {
+			return true;
+		}
+		else {
+			var errorMessage = paella.dictionary.translate("It seems that your browser is not HTML 5 compatible");
+			paella.events.trigger(paella.events.error,{error:errorMessage});
+			var message = errorMessage + '<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="resources/images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="resources/images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="resources/images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>';
+			message += '<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">' + paella.dictionary.translate("Continue anyway") + '</a></div>';
+			paella.messageBox.showError(message,{height:'40%'});
+		}
+		return false;
+	},
+
+	initialize:function(playerId) {
+		if (!this.checkCompatibility()) {
+			paella.debug.log('It seems that your browser is not HTML 5 compatible');
+		}
+		else {
+			paella.player = this;
+			this.playerId = playerId;
+			this.mainContainer = $('#' + this.playerId)[0];
+			this.accessControl = paella.initDelegate.initParams.accessControl;
+			var thisClass = this;
+			paella.events.bind(paella.events.loadComplete,function(event,params) { thisClass.loadComplete(event,params); });
+		}
+	},
+
+	includePlugins:function(productionPluginFile,devPluginsDir,devPluginsArray,productionPluginCss) {
+		if (!productionPluginCss) productionPluginCss = 'plugins/plugins.css';
+
+		if (/debug/.test(window.location.href)) {
+			paella.debug.debug = true;
+			for (var i=0; i<devPluginsArray.length; i++) {
+				var jsFile = devPluginsArray[i];
+				var cssFile = jsFile.substr(0, jsFile.lastIndexOf(".")) + ".css";
+				paella.debug.log(devPluginsDir + jsFile + ", " + devPluginsDir + cssFile);
+				paella.utils.require(devPluginsDir + jsFile);
+				paella.utils.importStylesheet(devPluginsDir + cssFile);
+			}
+		}
+		else {
+			paella.utils.importStylesheet(productionPluginCss);
+		}
+	},
+
+	loadComplete:function(event,params) {
+		
+	}
+});
+
+paella.InitDelegate = Class.create({
+	initParams:{
+		configUrl:'config/config.json',
+		dictionaryUrl:'config/dictionary',
+		editorDictionaryUrl:'config/editor_dictionary',
+		accessControl:new paella.DefaultAccessControl(),
+		videoLoader:new paella.VideoLoader()
+	},
+
+	initialize:function(params) {
+		if (params) {
+			for (var key in params) {
+				this.initParams[key] = params[key];
+			}
+		}
+	},
+
+	getId:function() {
+		return paella.utils.parameters.get('id');
+	},
+	
+	loadDictionary:function(onSuccess) {
+		var asyncLoader = new paella.AsyncLoader();
+		asyncLoader.addCallback(new paella.DictionaryLoader(this.initParams.dictionaryUrl));
+		asyncLoader.addCallback(new paella.DictionaryLoader(this.initParams.editorDictionaryUrl));
+		asyncLoader.load(function() {
+				onSuccess();
+			},
+			function() {
+				onSuccess();
+			}
+		);
+	},
+
+	loadConfig:function(onSuccess) {
+		var configUrl = this.initParams.configUrl;
+		var params = {};
+		params.url = configUrl;
+		paella.ajax.get(params,function(data,type,returnCode) {
+				if (typeof(data)=='string') {
+					try {
+						data = JSON.parse(data);
+					}
+					catch (e) {
+						onSuccess({});
+					}
+				}
+				paella.dictionary.addDictionary(data);
+				onSuccess(data);
+			},
+			function(data,type,returnCode) {
+				onSuccess({});
+			});
+	},
+
+	loadEditorConfig:function(onSuccess) {
+		var data = {
+			cssPath:'resources/ui/jquery-ui.css'
+		};
+		onSuccess(data);
+	}
+});
+
+var paellaPlayer = null;
+paella.plugins = {};
+paella.plugins.events = {};
+paella.initDelegate = null;
+
diff --git a/tmp/09_paella_player.js b/tmp/09_paella_player.js
new file mode 100644
index 0000000..ec59032
--- /dev/null
+++ b/tmp/09_paella_player.js
@@ -0,0 +1,283 @@
+var PaellaPlayer = Class.create(paella.PlayerBase,{
+	player:null,
+	
+	selectedProfile:'',
+	videoIdentifier:'',
+	editor:null,
+	loader:null,
+
+	// Video data:
+	videoData:null,
+
+	setProfile:function(profileName) {
+		var thisClass = this;
+		this.videoContainer.setProfile(profileName,function(newProfileName) {
+			thisClass.selectedProfile = newProfileName;
+		});
+	},
+
+	initialize:function(playerId) {
+		this.parent(playerId);
+		
+		// if initialization ok
+		if (this.playerId==playerId) {
+			this.loadPaellaPlayer();
+			this.includePlugins('javascript/paella_plugins.js','plugins/',paella.pluginList);
+
+			var thisClass = this; 
+			paella.events.bind(paella.events.setProfile,function(event,params) {
+				thisClass.setProfile(params.profileName);
+			});	
+		}
+	},
+
+	loadPaellaPlayer:function() {
+		var thisClass = this;
+		this.loader = new paella.LoaderContainer('paellaPlayer_loader');
+		$('body')[0].appendChild(this.loader.domElement);
+		paella.events.trigger(paella.events.loadStarted);
+
+		paella.initDelegate.loadDictionary(function() {
+			paella.initDelegate.loadConfig(function(config) {
+				thisClass.onLoadConfig(config);
+			});
+		});		
+	},
+
+	onLoadConfig:function(configData) {
+		paella.data = new paella.Data(configData);
+
+		this.config = configData;
+		this.videoIdentifier = paella.initDelegate.getId();
+
+		if (this.videoIdentifier) {
+			if (this.mainContainer) {
+				this.videoContainer = new paella.VideoContainer(this.playerId + "_videoContainer");
+				this.controls = new paella.ControlsContainer(this.playerId + '_controls');
+				this.mainContainer.appendChild(this.videoContainer.domElement);
+				this.mainContainer.appendChild(this.controls.domElement);
+			}
+			$(window).resize(function(event) { paella.player.onresize(); });
+			this.onload();	
+		}
+	},
+	
+	onload:function() {
+		var thisClass = this;
+		this.accessControl.checkAccess(function(permissions) {
+			if (!permissions.loadError) {
+				paella.debug.log("read:" + permissions.canRead + ", contribute:" + permissions.canContribute + ", write:" + permissions.canWrite);
+				if (permissions.canWrite) {
+					thisClass.setupEditor();
+					paella.events.bind(paella.events.showEditor,function(event) { thisClass.showEditor(); });
+					paella.events.bind(paella.events.hideEditor,function(event) { thisClass.hideEditor(); });
+				}
+				if (permissions.canRead) {
+					thisClass.loadVideo();
+					thisClass.videoContainer.publishVideo();
+				}
+				else {
+					thisClass.unloadAll(paella.dictionary.translate("You are not authorized to view this resource"));
+				}	
+			}
+			else if (permissions.isAnonymous) {
+				var errorMessage = paella.dictionary.translate("You are not logged in");
+				thisClass.unloadAll(errorMessage);
+				paella.events.trigger(paella.events.error,{error:errorMessage});
+			}
+			else {
+				var errorMessage = paella.dictionary.translate("You are not authorized to view this resource");
+				thisClass.unloadAll(errorMessage);
+				paella.events.trigger(paella.events.error,{error:errorMessage});
+			}
+		});
+	},
+
+	onresize:function() {
+		this.videoContainer.onresize();
+		this.controls.onresize();
+		if (this.editor) {
+			this.editor.resize();
+		}
+	},
+
+	unloadAll:function(message) {
+		$('#playerContainer')[0].innerHTML = "";
+		var loaderContainer = $('#paellaPlayer_loader')[0];
+		paella.messageBox.showError(message);
+	},
+
+	setupEditor:function() {
+		//if (paella.extended) return;
+		if (paella.editor && paella.player.config.editor && paella.player.config.editor.enabled) {
+			this.controls.showEditorButton();
+		}
+		else {
+			setTimeout('paella.player.setupEditor()',500);
+		}
+	},
+	
+	showEditor:function() {
+		new paella.editor.Editor();
+	},
+
+	hideEditor:function() {
+	},
+
+	loadVideo:function() {
+		if (this.videoIdentifier) {
+			var thisClass = this;
+			var loader = paella.initDelegate.initParams.videoLoader;
+			loader.loadVideo(this.videoIdentifier,function() {
+				var master = loader.streams[0];
+				var slave = loader.streams[1];
+				var frames = loader.frameList;
+			
+				if (loader.loadStatus) {
+					var preferredMethodMaster = loader.getPreferredMethod(0);
+					var preferredMethodSlave  = loader.getPreferredMethod(1);
+					var status = true;
+					
+					if (preferredMethodMaster) {
+						status = paella.player.videoContainer.setMasterSource(master,preferredMethodMaster.name);
+					}
+					
+					if (preferredMethodSlave) {
+						status = paella.player.videoContainer.setSlaveSource(slave,preferredMethodSlave.name);
+					}
+					else {
+						paella.player.videoContainer.setMonoStreamMode();
+					}
+
+					if (status) {
+						paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager});
+
+						// The loadComplete event depends on the readyState of presenter and slide video
+						new paella.utils.Timer(function(timer) {
+							if (thisClass.videoContainer.isReady()) {
+								paella.events.trigger(paella.events.loadComplete,{masterVideo:master,slaveVideo:slave,frames:frames});
+								thisClass.onresize();
+								timer.repeat = false;
+							}
+							else {
+								timer.repeat = true;
+							}
+						},500);
+					}
+					else {
+						var errorMessage = paella.dictionary.translate("Your browser is not compatible with the required video codec");
+						paella.messageBox.showError(errorMessage);
+						paella.events.trigger(paella.events.error,{error:errorMessage});
+					}
+				}
+				else {
+					var errorMessage = paella.dictionary.translate("Error loading video data");
+					paella.messageBox.showError(errorMessage);
+					paella.events.trigger(paella.events.error,{error:errorMessage});
+				}
+			});
+		}
+	},
+	
+	loadPreviews:function() {
+		var streams = paella.initDelegate.initParams.videoLoader.streams;
+		var slavePreviewImg = null;
+		
+		var masterPreviewImg = streams[0].preview;
+		if (streams.length >=2) {
+			slavePreviewImg = streams[1].preview;
+		}
+		if (masterPreviewImg) {
+			var masterRect = paella.player.videoContainer.overlayContainer.getMasterRect();
+			this.masterPreviewElem = document.createElement('img');
+			this.masterPreviewElem.src = masterPreviewImg;
+			paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,masterRect);
+		}
+		if (slavePreviewImg) {
+			var slaveRect = paella.player.videoContainer.overlayContainer.getSlaveRect();
+			this.slavePreviewElem = document.createElement('img');
+			this.slavePreviewElem.src = slavePreviewImg;
+			paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,slaveRect);
+		}
+		paella.events.bind(paella.events.timeUpdate,function(event) {
+			paella.player.unloadPreviews();
+		});
+	},
+	
+	unloadPreviews:function() {
+		if (this.masterPreviewElem) {
+			paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem);
+			this.masterPreviewElem = null;
+		}
+		if (this.slavePreviewElem) {
+			paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem);
+			this.slavePreviewElem = null;
+		}
+	},
+	
+	loadComplete:function(event,params) {
+		var thisClass = this;
+		var time = paella.utils.parameters.get('time');
+		var master = paella.player.videoContainer.masterVideo();
+		var getProfile = paella.utils.parameters.get('profile');
+		var cookieProfile = paella.utils.cookies.get('lastProfile');
+		if (getProfile) {
+			this.setProfile(getProfile);
+		}
+		else if (cookieProfile) {
+			this.setProfile(cookieProfile);
+		}
+		else {
+			this.setProfile(this.config.defaultProfile);
+		}
+
+		// TODO: No sé muy bien por qué pero si no se reproduce el vídeo al menos un segundo no funciona el setSeek
+		paella.events.trigger(paella.events.play);
+		new paella.utils.Timer(function(timer) {
+			var autoplay = paella.utils.parameters.get('autoplay');
+			autoplay = autoplay.toLowerCase();
+			if (autoplay!='true' && autoplay!='yes') paella.events.trigger(paella.events.pause);
+			if (time) {
+				var duration = master.duration();
+				var trimStart = thisClass.videoContainer.trimStart();
+				var trimEnd = thisClass.videoContainer.trimEnd();
+				if (thisClass.videoContainer.trimEnabled()) {
+					duration = trimEnd - trimStart;
+				}
+				var hour = 0;
+				var minute = 0;
+				var second = 0;
+				if (/([0-9]+)h/.test(time)) {
+					hour = Number(RegExp.$1);
+				}
+				if (/([0-9]+)m/.test(time)) {
+					minute = Number(RegExp.$1);
+				}
+				if (/([0-9]+)s/.test(time)) {
+					second = Number(RegExp.$1);
+				}
+				var currentTime = hour * 60 * 60 + minute * 60 + second;
+				var currentPercent = currentTime * 100 / duration;
+				paella.events.trigger(paella.events.seekTo,{newPositionPercent:currentPercent});
+			}
+			thisClass.loadPreviews();
+			if (paella.player.config.editor &&
+				paella.player.config.editor.enabled &&
+				paella.player.config.editor.loadOnStartup) {
+				paella.events.trigger(paella.events.showEditor);
+			}
+		},1000);
+	}
+});
+
+/* Initializer function */
+function initPaellaEngage(playerId,initDelegate) {
+	if (!initDelegate) {
+		initDelegate = new paella.InitDelegate();
+	}
+	paella.initDelegate = initDelegate;
+	var lang = navigator.language || window.navigator.userLanguage;
+	paellaPlayer = new PaellaPlayer(playerId,paella.initDelegate);
+}
+
+
diff --git a/tmp/10_paella_extended.js b/tmp/10_paella_extended.js
new file mode 100644
index 0000000..298a557
--- /dev/null
+++ b/tmp/10_paella_extended.js
@@ -0,0 +1,269 @@
+/*
+	Paella HTML 5 Multistream Player
+	Copyright (C) 2013  Universitat Politècnica de València
+
+	This program is free software: you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation, either version 3 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program.  If not, see <http://www.gnu.org/licenses/>.
+*/
+
+paella.ExtendedPlugin = Class.create(paella.Plugin, {
+	type:'extendedPlugin',
+	
+	getName:function() { return "es.upv.paella.extended.Plugin"; },
+	
+	checkEnabled:function(onSuccess) {
+		onSuccess(paella.extended!=null);
+	},
+	
+	getIndex:function() {
+		return 10000;
+	}
+});
+
+paella.RightBarPlugin = Class.create(paella.ExtendedPlugin,{
+	type:'rightBarPlugin',
+	getName:function() { return "es.upv.paella.extended.RightBarPlugin"; },
+
+	buildContent:function(domElement) {
+		
+	}
+});
+
+paella.TabBarPlugin = Class.create(paella.ExtendedPlugin,{
+	type:'tabBarPlugin',
+	getName:function() { return "es.upv.paella.extended.TabBarPlugin"; },
+	
+	getTabName:function() {
+		return "New Tab";
+	},
+
+	buildContent:function(domElement) {
+		
+	}
+});
+
+paella.Extended = Class.create({
+	container:null,
+	paellaContainer:null,
+	rightContainer:null,
+	bottomContainer:null,
+
+	settings:{
+		containerId:'paellaExtendedContainer',
+		paellaContainerId:'playerContainer',
+		rightContainerId:'paella_right',
+		bottomContainerId:'paella_bottom',
+		containerClass:'paellaExtendedContainer',
+		playerContainerClass:'playerContainer',
+		rightContainerClass:'rightContainer',
+		bottomContainerClass:'bottomContainer',
+		aspectRatio:1.777777,
+		initDelegate:new paella.InitDelegate({accessControl:new paella.AccessControl(),videoLoader:new paella.VideoLoader})
+	},
+	
+	rightBarPlugins:[],
+	tabBarPlugins:[],
+	
+	currentTabIndex:0,
+	bottomContainerTabs:null,
+	bottomContainerContent:null,
+
+	initialize:function(settings) {
+		this.saveSettings(settings);
+		this.loadPaellaExtended();
+		var thisClass = this;
+		$(window).resize(function(event) { thisClass.onresize() });
+	},
+	
+	saveSettings:function(settings) {
+		if (settings) {
+			for (var key in settings) {
+				this.settings[key] = settings[key];
+			}
+		}
+	},
+	
+	loadPaellaExtended:function() {
+		this.container = $('#' + this.settings.containerId)[0];
+		if (!this.container) {
+			var body = $('body')[0];
+			body.innerHTML = "";
+			this.container = document.createElement('div');
+			this.container.id = this.settings.containerId;
+			this.container.className = this.settings.containerClass;
+			body.appendChild(this.container);
+		}
+		else {
+			this.container.innerHTML = "";
+			this.container.className = this.settings.containerClass;
+		}
+		
+		this.paellaContainer = document.createElement('div');
+		this.paellaContainer.id = this.settings.paellaContainerId;
+		this.paellaContainer.className=this.settings.playerContainerClass;
+		this.container.appendChild(this.paellaContainer);
+		
+		this.rightContainer = document.createElement('div');
+		this.rightContainer.id = this.settings.rightContainerId;
+		this.rightContainer.className = this.settings.rightContainerClass;
+		this.container.appendChild(this.rightContainer);
+		
+		this.bottomContainer = document.createElement('div');
+		this.bottomContainer.id = this.settings.bottomContainerId;
+		this.bottomContainer.className=this.settings.bottomContainerClass;
+		this.container.appendChild(this.bottomContainer);
+		
+		var tabs = document.createElement('div');
+		tabs.id = 'bottomContainer_tabs';
+		tabs.className = 'bottomContainerTabs';
+		this.bottomContainerTabs = tabs;
+		this.bottomContainer.appendChild(tabs);
+		
+		var bottomContent = document.createElement('div');
+		bottomContent.id = 'bottomContainer_content';
+		bottomContent.className = 'bottomContainerContent';
+		this.bottomContainerContent = bottomContent;
+		this.bottomContainer.appendChild(bottomContent);
+		
+
+		var thisClass = this;
+		$(document).bind(paella.events.loadComplete,function(event,params) {
+			thisClass.setMainProfile();
+		});
+
+		
+		this.initPlugins();
+
+		initPaellaEngage(this.paellaContainer.id,this.settings.initDelegate);
+		this.onresize();
+	},
+	
+	initPlugins:function() {
+		paella.pluginManager.setTarget('rightBarPlugin',this);
+		paella.pluginManager.setTarget('tabBarPlugin',this);
+	},
+	
+	addPlugin:function(plugin) {
+		var thisClass = this;
+		plugin.checkEnabled(function(isEnabled) {
+			if (isEnabled) {
+				plugin.setup();
+				if (plugin.type=='rightBarPlugin') {
+					thisClass.rightBarPlugins.push(plugin);
+					thisClass.addRightBarPlugin(plugin);
+				}
+				if (plugin.type=='tabBarPlugin') {
+					thisClass.tabBarPlugins.push(plugin);
+					thisClass.addTabPlugin(plugin);
+				}	
+			}
+		});
+	},
+	
+	showTab:function(tabIndex) {
+		for (var i=0;i<this.tabBarPlugins.length;++i) {
+			var tabItem = $("#tab_" + i)[0];
+			var tabContent = $("#tab_content_" + i)[0];
+		
+			if (i==tabIndex) {
+				tabItem.className = "bottomContainerTabItem enabledTabItem";
+				tabContent.className = "bottomContainerContent enabledTabContent";
+			}
+			else {
+				tabItem.className = "bottomContainerTabItem disabledTabItem";
+				tabContent.className = "bottomContainerContent disabledTabContent";			
+			}
+		}
+	},
+
+	addTabPlugin:function(plugin) {
+		var tabIndex = this.currentTabIndex;
+		
+		// Add tab
+		var tabItem = document.createElement('div');
+		tabItem.id = "tab_" + tabIndex;
+		tabItem.className = "bottomContainerTabItem disabledTabItem";
+		tabItem.innerHTML = plugin.getTabName();
+		tabItem.plugin = plugin;
+		var thisClass = this;
+		$(tabItem).click(function(event) { if (/disabledTabItem/.test(this.className)) { thisClass.showTab(tabIndex); this.plugin.action(this); } });
+		this.bottomContainerTabs.appendChild(tabItem);
+		
+		// Add tab content
+		var tabContent = document.createElement('div');
+		tabContent.id = "tab_content_" + tabIndex;
+		tabContent.className = "bottomContainerContent disabledTabContent " + plugin.getSubclass();
+		this.bottomContainerContent.appendChild(tabContent);
+		plugin.buildContent(tabContent);
+		
+		// Show tab
+		this.showTab(tabIndex);
+		++this.currentTabIndex;
+	},
+	
+	addRightBarPlugin:function(plugin) {
+		var container = document.createElement('div');
+		container.className = "rightBarPluginContainer " + plugin.getSubclass();
+		this.rightContainer.appendChild(container);
+		plugin.buildContent(container);
+	},
+
+	setMainProfile:function() {
+		var profile = 'full';
+		var cookieProfile = paella.utils.cookies.get("paella.extended.profile");
+		if (cookieProfile) {
+			profile = cookieProfile;
+		}
+		else if ((paella) && (paella.player) && (paella.player.config) && (paella.player.config.player) && (paella.player.config.player.defaultProfile)){
+			profile = paella.player.config.player.defaultProfile;
+		}
+		this.setProfile(profile);
+	},
+	
+	setProfile:function(profileName) {
+		paella.utils.cookies.set("paella.extended.profile", profileName);
+		var thisClass = this;
+		this.container.className = this.settings.containerClass + " " + profileName;
+		this.paellaContainer.className = this.settings.playerContainerClass + " " + profileName;
+		this.rightContainer.className = this.settings.rightContainerClass + " " + profileName;
+		this.bottomContainer.className = this.settings.bottomContainerClass + " " + profileName;
+		this.onresize();
+		if (paella.player) {
+			paella.player.onresize();
+		}
+	},
+	
+	getProfile:function() {
+		var regExp = new RegExp(this.settings.containerClass + " ([a-zA-Z0-9]+)");
+		if (regExp.test(paella.extended.container.className)) {
+			return RegExp.$1;
+		}
+		return '';
+		//return /paellaExtendedContainer ([a-zA-Z0-9]+)/.test(paella.extended.container.className)
+	},
+
+	onresize:function() {
+	/*
+		var aspect = this.settings.aspectRatio;
+		var width = jQuery(this.paellaContainer).width();
+		var height = width / aspect;
+		this.paellaContainer.style.height = height + 'px';
+	*/
+	}
+});
+
+function initPaellaExtended(settings) {
+	paella.extended = new paella.Extended(settings);
+}
+
+
diff --git a/tmp/11_editor_base.js b/tmp/11_editor_base.js
new file mode 100644
index 0000000..a713f00
--- /dev/null
+++ b/tmp/11_editor_base.js
@@ -0,0 +1 @@
+paella.editor={};paella.editor.utils={mouse:{mouseDownTarget:"",}};
\ No newline at end of file
diff --git a/tmp/12_editor_bootstrap_utils.js b/tmp/12_editor_bootstrap_utils.js
new file mode 100644
index 0000000..a83b0eb
--- /dev/null
+++ b/tmp/12_editor_bootstrap_utils.js
@@ -0,0 +1,97 @@
+var bootstrapUtils = {
+	elem:function(type,params,inner) {
+		var elem = document.createElement(type);
+		for (var attr in params) {
+			elem.setAttribute(attr, params[attr]);
+		}
+		if (inner) {elem.innerHTML = inner;}
+		return elem;
+	},
+	
+	append:function(parent,child) {
+		parent.appendChild(child);
+		return child;
+	},
+
+	navbar:function(title,subclass) {
+		var nav = this.elem("div",{"class":"navbar tiny " + subclass});
+		var navInner = this.append(nav,this.elem("div",{"class":"navbar-inner tiny"}))
+		if (title) {
+			this.append(navInner,this.elem("div",{"class":"brand","href":"JavaScript:void(0);"},title));
+		}
+		return nav;
+	},
+	
+	dropdown:function(title,subclass,items,size,icon,alignRight) {
+		return this.dropButton(title,subclass,items,size,icon,alignRight,'');
+	},
+	
+	dropup:function(title,subclass,items,size,icon,alignRight) {
+		return this.dropButton(title,subclass,items,size,icon,alignRight,'dropup');
+	},
+
+	dropButton:function(title,subclass,items,size,icon,alignRight,type) {
+		var align = '';
+		if (alignRight) align = 'pull-right';
+		
+		var dropup = this.elem('div',{'class':'btn-group ' + type + ' ' + subclass + ' ' + align});
+		if (icon) {
+			title = '<i class="' + icon + '"></i>&nbsp;<span class="text">' + title + '</span>&nbsp;';
+		}
+		else {
+			title = '&nbsp;<span class="text">' + title + '</span>&nbsp;';
+		}
+		
+		var btn = this.append(dropup,this.elem('a',{'class':'btn dropdown-toggle ' + size,'data-toggle':'dropdown','href':'JavaScript:void(0);'},title + '<span class="caret"></span>'));
+		
+		
+		var ul = this.append(dropup,this.elem('ul',{'class':'dropdown-menu'}));
+		for (var key in items) {
+			var action = items[key];
+			var li = this.append(ul,this.elem('li'));
+			this.append(li,this.elem('a',{'href':'JavaScript:void(0);','onclick':action,'class':'listItem'},key));
+		}
+		return dropup;
+	},
+	
+	buttonGroup:function(buttons,btnSubclass,isPushButton) {
+		var group = document.createElement('div');
+		group.className = 'btn-group';
+		
+		
+		for (var i=0;i<buttons.length;++i) {
+			var button = document.createElement('button');
+			button.className = 'btn ' + btnSubclass;
+			button.innerHTML = buttons[i].label;
+			button.buttonData = buttons[i];
+			button.buttonData.disabledClass = button.className;
+			button.title = buttons[i].hint;
+			if (isPushButton) {
+				$(button).click(function(event) {
+					this.buttonData.onclick(this.buttonData);
+				});				
+			}
+			else {
+				$(button).click(function(event) {
+					for (var j=0;j<this.parentNode.childNodes.length;++j) {
+						this.parentNode.childNodes[j].className = this.buttonData.disabledClass;
+					}
+					this.className = this.className + ' active';
+					this.buttonData.onclick(this.buttonData);
+				});
+			}
+			group.appendChild(button);
+		}
+		return group;
+	},
+	
+	button:function(label,className,hint,onclick) {
+		var button = document.createElement('button');
+		button.className = 'btn ' + className;
+		button.innerHTML = label;
+		button.title = hint;
+		$(button).click(function(event) { onclick(this); });
+		return button;
+	}
+};
+
diff --git a/tmp/13_editor_plugin_base.js b/tmp/13_editor_plugin_base.js
new file mode 100644
index 0000000..16c0ac8
--- /dev/null
+++ b/tmp/13_editor_plugin_base.js
@@ -0,0 +1,299 @@
+paella.editor.PluginSaveCallback = Class.create(paella.AsyncLoaderCallback,{
+	plugin:null,
+	
+	initialize:function(plugin) {
+		this.parent("pluginSaveCallback");
+		this.plugin = plugin;
+	},
+	
+	load:function(onSuccess,onError) {
+		this.plugin.onSave(function() {
+			onSuccess();
+		});
+	}
+});
+
+paella.editor.PluginDiscardCallback = Class.create(paella.AsyncLoaderCallback,{
+	plugin:null,
+	
+	initialize:function(plugin) {
+		this.parent("pluginDiscardCallback");
+		this.plugin = plugin;
+	},
+	
+	load:function(onSuccess,onError) {
+		this.plugin.onDiscard(function() {
+			onSuccess();
+		});
+	}
+});
+
+paella.editor.PluginManager = Class.create({
+	trackPlugins:[],
+	rightBarPlugins:[],
+	toolbarPlugins:[],
+
+	initialize:function() {
+		this.initPlugins();	
+	},
+	
+	initPlugins:function() {
+		paella.pluginManager.setTarget('editorTrackPlugin',this);
+		paella.pluginManager.setTarget('editorRightBarPlugin',this);
+		paella.pluginManager.setTarget('editorToolbarPlugin',this);
+	},
+	
+	addPlugin:function(plugin) {
+		var thisClass = this;
+		plugin.checkEnabled(function(isEnabled) {
+			if (isEnabled) {
+				plugin.setup();
+				if (plugin.type=='editorTrackPlugin') {
+					thisClass.trackPlugins.push(plugin);
+				}
+				if (plugin.type=='editorRightBarPlugin') {
+					thisClass.rightBarPlugins.push(plugin);
+				}
+				if (plugin.type=='editorToolbarPlugin') {
+					thisClass.toolbarPlugins.push(plugin);
+				}
+			}
+		});
+	},
+	
+	onTrackChanged:function(newTrack) {
+		// Notify tab plugins
+		for (var i=0;i<this.rightBarPlugins.length;++i) {
+			var plugin = this.rightBarPlugins[i];
+			plugin.onTrackSelected(newTrack);
+		}
+		
+		// Notify toolbar plugins
+		for (var i=0;i<this.toolbarPlugins.length;++i) {
+			var plugin = this.toolbarPlugins[i];
+			plugin.onTrackSelected(newTrack);
+		}
+	},
+	
+	onSave:function(onDone) {
+		var asyncLoader = new paella.AsyncLoader();
+		for (var i=0;i<this.trackPlugins.length;++i) {
+			asyncLoader.addCallback(new paella.editor.PluginSaveCallback(this.trackPlugins[i]));
+		}
+		for (var i=0;i<this.rightBarPlugins.length;++i) {
+			asyncLoader.addCallback(new paella.editor.PluginSaveCallback(this.rightBarPlugins[i]));
+		}
+		for (var i=0;i<this.toolbarPlugins.length;++i) {
+			asyncLoader.addCallback(new paella.editor.PluginSaveCallback(this.toolbarPlugins[i]));
+		}
+		asyncLoader.load(function() {
+				paella.events.trigger(paella.events.didSaveChanges);
+				onDone(true);
+			},
+			function() {
+				onDone(false);
+			});
+	},
+	
+	onDiscard:function(onDone) {
+		var asyncLoader = new paella.AsyncLoader();
+		for (var i=0;i<this.trackPlugins.length;++i) {
+			asyncLoader.addCallback(new paella.editor.PluginDiscardCallback(this.trackPlugins[i]));
+		}
+		for (var i=0;i<this.rightBarPlugins.length;++i) {
+			asyncLoader.addCallback(new paella.editor.PluginDiscardCallback(this.rightBarPlugins[i]));
+		}
+		for (var i=0;i<this.toolbarPlugins.length;++i) {
+			asyncLoader.addCallback(new paella.editor.PluginDiscardCallback(this.toolbarPlugins[i]));
+		}
+		asyncLoader.load(function() {
+				onDone(true);
+			},
+			function() {
+				onDone(false);
+			});
+	}
+});
+
+paella.editor.pluginManager = new paella.editor.PluginManager();
+
+paella.editor.EditorPlugin = Class.create(paella.Plugin,{
+	onTrackSelected:function(newTrack) {
+		if (newTrack) {
+			paella.debug.log(this.getName() + ": New track selected " + newTrack.getName());
+		}
+		else {
+			paella.debug.log("No track selected");
+		}
+	},
+
+	onSave:function(onDone) {
+		// Paella Editor calls this function when the user clicks on "save" button
+		onDone();
+	},
+	
+	onDiscard:function(onDone) {
+		onDone();
+	},
+	
+	contextHelpString:function() {
+		return "";
+	}
+});
+
+paella.editor.TrackPlugin = Class.create(paella.editor.EditorPlugin,{
+	type:'editorTrackPlugin',
+
+	getIndex:function() {
+		return 10000;
+	},
+
+	getName:function() {
+		return "editorTrackPlugin";
+	},
+	
+	getTrackName:function() {
+		return "My Track";
+	},
+	
+	getColor:function() {
+		return "#5500FF";
+	},
+	
+	getTextColor:function() {
+		return "#F0F0F0";
+	},
+	
+	getTrackType:function() {
+		return "secondary";
+	},
+	
+	getTrackItems:function() {
+		var exampleTracks = [{id:1,s:10,e:70},{id:2,s:110,e:340}];
+		return exampleTracks;
+	},
+	
+	allowResize:function() {
+		return true;
+	},
+	
+	allowDrag:function() {
+		return true;
+	},
+	
+	allowEditContent:function() {
+		return true;
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		//paella.debug.log('Track changed: id=' + id + ", start: " + start + ", end:" + end);
+		paella.events.trigger(paella.events.documentChanged);
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		//paella.debug.log('Track content changed: id=' + id + ', new content: ' + content);
+		paella.events.trigger(paella.events.documentChanged);
+	},
+	
+	onSelect:function(trackItemId) {
+		paella.debug.log('Track list selected: ' + this.getTrackName());
+	},
+	
+	onUnselect:function() {
+		paella.debug.log('Track list unselected: ' + this.getTrackName());
+	},
+	
+	onDblClick:function(trackData) {
+	},
+	
+	getTools:function() {
+		return [];
+	},
+
+	onToolSelected:function(toolName) {
+		//paella.debug.log('Tool selected: ' + toolName);
+		paella.events.trigger(paella.events.documentChanged);
+	},
+
+	isToolEnabled:function(toolName) {
+		return true;
+	},
+	
+	buildToolTabContent:function(tabContainer) {
+		
+	},
+
+	getSettings:function() {
+		return null;
+	}
+});
+
+paella.editor.MainTrackPlugin = Class.create(paella.editor.TrackPlugin,{
+	getTrackType:function() {
+		return "master";
+	},
+	
+	getTrackItems:function() {
+		var exampleTracks = [{id:1,s:30,e:470}];
+		return exampleTracks;
+	},
+	
+	getName:function() {
+		return "editorMainTrackPlugin";
+	},
+});
+
+paella.editor.RightBarPlugin = Class.create(paella.editor.EditorPlugin,{
+	type:'editorRightBarPlugin',
+	
+	getIndex:function() {
+		return 10000;
+	},
+	
+	getName:function() {
+		return "editorRightbarPlugin";
+	},
+	
+	getTabName:function() {
+		return "My Rightbar Plugin";
+	},
+	
+	getContent:function() {
+		var container = document.createElement('div');
+		container.innerHTML = "Rightbar plugin";
+		return container;
+	},
+	
+	onLoadFinished:function() {
+		
+	}
+});
+
+paella.editor.EditorToolbarPlugin = Class.create(paella.editor.EditorPlugin,{
+	type:'editorToolbarPlugin',
+	trackList:[],
+	
+	getIndex:function() {
+		return 10000;
+	},
+	
+	getName:function() {
+		return "editorToolbarPlugin";
+	},
+		
+	getButtonName:function() {
+		return "Toolbar Plugin";
+	},
+	
+	getIcon:function() {
+		return "icon-edit";
+	},
+
+	getOptions:function() {
+		return []
+	},
+	
+	onOptionSelected:function(optionIndex) {
+	}
+});
+
diff --git a/tmp/14_editor_ui_controls.js b/tmp/14_editor_ui_controls.js
new file mode 100644
index 0000000..e999a2f
--- /dev/null
+++ b/tmp/14_editor_ui_controls.js
@@ -0,0 +1,579 @@
+paella.editor.Tabbar = Class.create({
+	navbar:null,
+	container:null,
+	
+	initialize:function(parent) {
+		this.navbar = bootstrapUtils.navbar("","navbar-inverse");
+		parent.appendChild(this.navbar);
+		this.container = $(this.navbar).find(".navbar-inner")[0];
+	}
+});
+
+paella.editor.Toolbar = Class.create({
+	navbar:null,
+	container:null,
+	toolButton:null,
+	selectedToolUtils:null,
+	editorMenu:null,
+	toolbarPlugins:null,
+
+	initialize:function(parent) {
+		this.navbar = bootstrapUtils.navbar("","navbar-inverse");
+		parent.appendChild(this.navbar);
+		this.container = $(this.navbar).find(".navbar-inner")[0];
+		this.buildTrackTools();
+		this.buildPlaybackControls();
+		this.buildEditorMenu();
+		this.buildPlugins();
+	},
+	
+	buildTrackTools:function() {
+		var selectionTrackName = paella.dictionary.translate("Selection");
+		var tools = {};
+		tools[selectionTrackName] = "paella.editor.instance.bottomBar.toolbar.onToolChanged('select','" + selectionTrackName + "')";
+		var trackPlugins = paella.editor.pluginManager.trackPlugins;
+		for (var i in trackPlugins) {
+			var plugin = trackPlugins[i];
+			var label = plugin.getTrackName();
+			// TODO: tool icon
+			var action = "paella.editor.instance.bottomBar.toolbar.onToolChanged('" + plugin.getName() + "','" + plugin.getTrackName() +"')";
+			//var action = "paella.editor.instance.bottomBar.timeline.selectTrackList('" + plugin.getName() + "');";
+			tools[label] = action;
+		}
+		var defaultText = paella.dictionary.translate("Tool") + ": " + paella.dictionary.translate('Selection');
+		this.toolButton = bootstrapUtils.dropdown(defaultText,'toolDropdown',tools,'btn-mini','',false);
+		this.container.appendChild(this.toolButton);
+		this.selectedToolUtils = document.createElement('span');
+		this.selectedToolUtils.className = 'editorToolbar_selectedToolUtils';
+		this.container.appendChild(this.selectedToolUtils);
+	},
+	
+	buildPlaybackControls:function() {
+		var playbackControls = document.createElement('span');
+		playbackControls.className = 'editorToolbarPlaybackControls';
+		this.container.appendChild(playbackControls);
+		var buttonData = [];
+		buttonData.push({
+			label:'<i class="icon-step-backward icon-white"></i>',hint:'',
+			onclick:function(buttonData) {
+				$(document).trigger(paella.events.seekTo,{newPositionPercent:0});
+			}
+		});
+		buttonData.push({
+			label:'<i class="icon-play icon-white"></i>',hint:'',
+			onclick:function(buttonData) {
+				$(document).trigger(paella.events.play);
+			}
+		});
+		buttonData.push({
+			label:'<i class="icon-pause icon-white"></i>',hint:'',
+			onclick:function(buttonData) {
+				$(document).trigger(paella.events.pause);
+			}
+		});
+		buttonData.push({
+			label:'<i class="icon-step-forward icon-white"></i>',hint:'',
+			onclick:function(buttonData) {
+				$(document).trigger(paella.events.seekTo,{newPositionPercent:99});
+			}
+		});
+		playbackControls.appendChild(bootstrapUtils.buttonGroup(buttonData,'btn-mini',true));
+	},
+	
+	buildPlugins:function() {
+		if (!this.toolbarPlugins) {
+			this.toolbarPlugins = document.createElement('span');
+			this.container.appendChild(this.toolbarPlugins);
+		}
+		else {
+			this.toolbarPlugins.innerHTML = "";
+		}
+		var plugins = paella.editor.pluginManager.toolbarPlugins;
+		for (var i=0;i<plugins.length;++i) {
+			var plugin = plugins[i];
+			var pluginName = plugin.getName();
+			var name = plugin.getButtonName();
+			var options = plugin.getOptions();
+			var optionsObject = {}
+			var icon = plugin.getIcon();
+			if (icon) { icon = icon + ' icon-white'; }
+			for (var j=0;j<options.length;++j) {
+				optionsObject[options[j]] = "paella.editor.instance.bottomBar.toolbar.selectPluginOption('" + pluginName + "'," + j + ")";
+			}
+			var button = bootstrapUtils.dropdown(name,'editorDropdown',optionsObject,'btn-mini',icon,true);
+			this.toolbarPlugins.appendChild(button);
+		}
+	},
+
+	buildEditorMenu:function() {
+		var tools = {
+		};
+		tools[paella.dictionary.translate("Save and close editor")] = "paella.editor.instance.bottomBar.toolbar.saveAndClose();";
+		tools[paella.dictionary.translate("Save changes")] = "paella.editor.instance.bottomBar.toolbar.save();";
+		tools[paella.dictionary.translate("Discard changes and close")] = "paella.editor.instance.bottomBar.toolbar.discardAndClose();";
+		this.editorMenu = bootstrapUtils.dropdown(paella.dictionary.translate('Paella Editor'),'editorDropdown',tools,'btn-mini','icon-edit icon-white',true);
+		this.container.appendChild(this.editorMenu);
+	},
+	
+	selectPluginOption:function(pluginName,optionIndex) {
+		var plugins = paella.editor.pluginManager.toolbarPlugins;
+		for (var i=0;i<plugins.length;++i) {
+			var plugin = plugins[i];
+			if (plugin.getName()==pluginName) {
+				plugin.onOptionSelected(optionIndex);
+			}
+		}
+		this.buildPlugins();
+	},
+
+	onToolChanged:function(toolName,trackName) {
+		paella.editor.instance.bottomBar.timeline.selectTrackList(toolName);
+		var textElem = $(this.toolButton).find('.text')[0];
+		textElem.innerHTML = paella.dictionary.translate("Tool") + ": " + trackName;
+		this.setupTrackTool(toolName);
+	},
+	
+	setupTrackTool:function(toolName) {
+		this.selectedToolUtils.innerHTML = "";
+		var plugin = null;
+		for (var i=0;i<paella.editor.pluginManager.trackPlugins.length;++i) {
+			plugin = paella.editor.pluginManager.trackPlugins[i];
+			if (toolName==plugin.getName()) {
+				break;
+			}
+			else {
+				plugin = null;
+			}
+		}
+		if (plugin) {
+			var buttonData = [];
+			var tools = plugin.getTools()
+			for (var i=0;i<tools.length;++i) {
+				buttonData.push({
+					label:tools[i].label,
+					plugin:plugin,
+					toolName:tools[i].name,
+					hint:tools[i].hint,
+					onclick:function(buttonData) {
+						if (buttonData.plugin.onToolSelected(buttonData.toolName)) {
+							paella.editor.instance.bottomBar.timeline.rebuildTrack(plugin.getName());
+							paella.editor.pluginManager.onTrackChanged(plugin);
+							paella.editor.instance.rightBar.updateCurrentTab();
+						}
+					}
+				});
+			}
+			if (buttonData.length>0) {
+				var toolLabel = document.createElement('span');
+				toolLabel.innerHTML = '&nbsp;' + paella.dictionary.translate('Options') + ':';
+				this.selectedToolUtils.appendChild(toolLabel);
+				this.selectedToolUtils.appendChild(bootstrapUtils.buttonGroup(buttonData,'btn-mini'));
+			}
+		}
+	},
+	
+	saveAndClose:function() {
+		paella.editor.pluginManager.onSave(function(status) {
+			paella.editor.instance.unloadEditor();
+		});
+	},
+	
+	save:function() {
+		paella.editor.pluginManager.onSave(function() {
+			
+		});
+	},
+	
+	discardAndClose:function() {
+		paella.editor.pluginManager.onDiscard(function(status) {
+			paella.debug.log("Discard changes");
+			paella.editor.instance.unloadEditor();
+		});
+	}
+});
+
+paella.editor.Timeline = Class.create({
+	container:null,
+	containerMinHeight:133,
+	content:null,
+	timeMarks:null,
+	tracks:null,
+	zoom:100,
+	trackItemList:null,
+	trackItemIndex:{
+		back:5,
+		front:10
+	},
+	trackItemOpacity:{
+		back:0.5,
+		front:0.9
+	},
+	currentTrackList:null,
+	
+	initialize:function(parent) {
+		var defaultHeight = this.containerMinHeight;
+		
+		this.trackItemList = [];
+		this.container = document.createElement('div');
+		this.container.className = 'editorTimelineContainer';
+		$(this.container).css({
+			"height":defaultHeight + "px"
+		});
+		parent.appendChild(this.container);
+		
+		
+		this.content = document.createElement('div');
+		this.content.className = 'editorTimelineContent';
+		$(this.content).css({
+			'width':this.zoom + '%',
+			'height':'100%'
+		});
+		this.container.appendChild(this.content);
+		
+		this.timeMarks = document.createElement('div');
+		this.timeMarks.className = "editorTimeLineTimeMarks";
+		this.content.appendChild(this.timeMarks);
+		this.buildTimeMarks();
+
+		this.tracks = document.createElement('div');
+		this.tracks.className = "editorTimeLineTracks";
+		this.tracks.style.minHeight = this.containerMinHeight + 'px';
+		this.content.appendChild(this.tracks);
+		
+		this.loadPlugins();
+		
+		this.setupCursors();
+	},
+	
+	setupCursors:function() {
+		var cursor = document.createElement('div');
+		cursor.className = 'editorTimelineCursor';
+		this.container.appendChild(cursor);
+		var content = this.content;
+		$(this.container).mousemove(function(event) {
+			var duration = paella.player.videoContainer.duration(true);
+			var contentWidth = $(content).width();
+			var position = $(content).position().left
+			var left = event.pageX - position;
+			$(cursor).css({'left':left + 'px'});
+			
+			var time = left * duration / contentWidth;
+			cursor.innerHTML =  paella.utils.timeParse.secondsToTime(time);
+		});
+		
+		var currentTimeCursor = document.createElement('div');
+		currentTimeCursor.className = 'editorTimelineCursor currentTime';
+		this.container.appendChild(currentTimeCursor);
+		$(document).bind(paella.events.timeUpdate,function(event,params) {
+			var duration = paella.player.videoContainer.duration(true);
+			var contentWidth = $(content).width();
+			var currentTime = params.currentTime;
+
+			var left = currentTime * contentWidth / duration;
+			
+			$(currentTimeCursor).css({'left':left + 'px'});
+
+			currentTimeCursor.innerHTML =  paella.utils.timeParse.secondsToTime(currentTime);
+		});
+		
+		$(document).bind(paella.events.seekToTime,function(event,params) {
+			var duration = paella.player.videoContainer.duration(true);
+			var contentWidth = $(content).width();
+			var currentTime = params.time;
+
+			var left = currentTime * contentWidth / duration;
+			
+			$(currentTimeCursor).css({'left':left + 'px'});
+
+			currentTimeCursor.innerHTML =  paella.utils.timeParse.secondsToTime(currentTime);
+		});
+
+		$(this.container).mouseup(function(event) {
+			if (paella.editor.utils.mouse.mouseDownTarget!='track') {
+				var duration = paella.player.videoContainer.duration(true);
+				var contentWidth = $(content).width();
+				var position = $(content).position().left
+				var left = event.pageX - position;
+				var time = left * 100 / contentWidth;
+				$(document).trigger(paella.events.seekTo,{newPositionPercent:time});	
+			}			
+		});
+	},
+
+	loadPlugins:function() {
+		var thisClass = this;
+		var container = this.tracks;
+		container.innerHTML = "";
+		var plugins = paella.editor.pluginManager.trackPlugins;
+		var secTrackIndex = 0;
+		var subclass = "";
+		for (var i in plugins) {
+			if (plugins[i].getTrackType()=='secondary') {
+				subclass = "track" + secTrackIndex;
+				++secTrackIndex;
+			}
+			else {
+				subclass = "";
+			}
+			var track = new paella.editor.Track(container,plugins[i],subclass);
+			this.trackItemList.push(track);
+		}
+		this.selectTrackList(this.currentTrackList);
+	},
+
+	rebuildTrack:function(pluginName) {
+		var plugins = paella.editor.pluginManager.trackPlugins;
+		for (var i in this.trackItemList) {
+			var track = this.trackItemList[i];
+			if (track.getName()==pluginName) {
+				track.rebuild();
+			}
+		}
+	},
+	
+	getHeight:function() {
+		if ($(this.container).height()<this.containerMinHeight) return this.containerMinHeight;
+		else return $(this.container).height();
+	},
+
+	buildTimeMarks:function() {
+		var zoom = this.zoom;
+		this.timeMarks.innerHTML = "";
+		var barWidth = $(this.timeMarks).width();
+		var duration = paella.player.videoContainer.duration(true);
+		var markWidth = 70;
+		var numberOfMarks = Math.ceil(barWidth / markWidth);
+		var timeIncrement = duration / numberOfMarks;
+		var remainder = barWidth % markWidth;
+		var odd = true;
+		var currentTime = 0;
+		for (var i=0;i<numberOfMarks;++i) {
+			var mark = document.createElement('div');
+			mark.className = "editorTimeLineMark";
+			if (odd) mark.className = mark.className + " odd";
+			if (i==(numberOfMarks-1)) {
+				markWidth = remainder;
+				mark.className += " last";
+			}
+			mark.style.width = markWidth + 'px';
+			mark.innerHTML = paella.utils.timeParse.secondsToTime(currentTime);//"0:00:00";
+			currentTime += timeIncrement;
+			this.timeMarks.appendChild(mark);
+			var padding = 0; //$(mark).css('padding-left');
+			var finalWidth = markWidth - padding;
+			mark.style.width = finalWidth + 'px';
+			odd = !odd;
+		}
+	},
+
+	setZoom:function(percent) {
+		var thisClass = this;
+		this.zoom = percent;
+		this.timeMarks.innerHTML = "";
+		$(this.content).animate({'width':percent + '%'},{
+			complete:function() {
+				thisClass.buildTimeMarks();
+			}
+		});
+	},
+	
+	onresize:function() {
+		this.buildTimeMarks();
+		var height = $(this.tracks).outerHeight();
+		$(this.container).css('height',height + 'px');
+	},
+	
+	selectTrackList:function(trackItem,noEvent,selectTrackItem) {
+		if (trackItem=='select') {
+			this.currentTrackList = null;
+		}
+		else {
+			for (var i in this.trackItemList) {
+				var trackItemObj = this.trackItemList[i];
+				var container = trackItemObj.container;
+				if (trackItemObj.getName()==trackItem) {
+					this.currentTrackList = trackItemObj;
+					$(container).css({
+						'z-index':this.trackItemIndex.front,
+						'opacity':this.trackItemOpacity.front
+					});
+				}
+				else {
+					$(container).css({
+						'z-index':this.trackItemIndex.back,
+						'opacity':this.trackItemOpacity.back
+					});	
+				}			
+			}
+		}
+		
+		var plugin = null;
+		if (this.currentTrackList) {
+			plugin = this.currentTrackList.plugin;
+			if (selectTrackItem>0) this.currentTrackList.selectTrack(selectTrackItem,noEvent);
+		}
+		if (!noEvent) {
+			paella.editor.pluginManager.onTrackChanged(plugin);
+			paella.editor.instance.rightBar.updateCurrentTab();
+		}
+	},
+	
+	focusTrackListItem:function(trackItemName,itemId) {
+		this.selectTrackList(trackItemName,true,itemId);
+		var trackElement = $('#' + paella.editor.TrackUtils.buildTrackItemId(trackItemName,itemId))[0];
+		if (trackElement) {
+			var scrollLeft = paella.editor.instance.bottomBar.timeline.container.scrollLeft;
+			var itemOffset = $(trackElement).offset().left - 10;
+			var newScroll = scrollLeft + itemOffset;
+			 $(paella.editor.instance.bottomBar.timeline.container).animate({scrollLeft : newScroll},{duration:100});
+		}
+	}
+});
+
+paella.editor.BottomToolbar = Class.create({
+	container:null,
+	content:null,
+	
+	initialize:function(parent) {
+		this.container = document.createElement('div');
+		this.container.className = 'editorBottomToolbarContainer';
+		parent.appendChild(this.container);
+		
+		this.content = document.createElement('div');
+		this.container.appendChild(this.content);
+		this.content.appendChild(bootstrapUtils.dropup('Zoom','zoomDropup',{
+			'100%':'paella.editor.instance.bottomBar.timeline.setZoom(100)',
+			'200%':'paella.editor.instance.bottomBar.timeline.setZoom(200)',
+			'500%':'paella.editor.instance.bottomBar.timeline.setZoom(200)',
+			'1000%':'paella.editor.instance.bottomBar.timeline.setZoom(1000)',
+			'3000%':'paella.editor.instance.bottomBar.timeline.setZoom(3000)',
+			'5000%':'paella.editor.instance.bottomBar.timeline.setZoom(5000)'
+		},'btn-mini','icon-search',true));
+	}
+});
+
+paella.editor.BottomBar = Class.create(paella.AsyncLoaderCallback,{
+	editor:null,
+	container:null,
+	toolbar:null,
+	timeline:null,
+	bottomToolbar:null,
+
+	initialize:function() {
+		this.editor = paella.editor.instance;
+	},
+	
+	load:function(onSuccess,onError) {
+		var thisClass = this;
+		this.container = document.createElement('div');
+		this.container.className = "paellaEditorBottomBar";
+	//	this.container.style.height = this.getHeight() + 'px';
+		this.editor.editorContainer.appendChild(this.container);
+		this.build();
+		onSuccess();
+	},
+	
+	build:function() {
+		this.toolbar = new paella.editor.Toolbar(this.container);
+		this.timeline = new paella.editor.Timeline(this.container);
+		this.bottomToolbar = new paella.editor.BottomToolbar(this.container);
+	},
+	
+	getHeight:function() {
+		return $(this.container).height();
+	},
+	
+	onresize:function() {
+		this.timeline.onresize();
+	}
+});
+
+paella.editor.RightBar = Class.create(paella.AsyncLoaderCallback,{
+	editor:null,
+	container:null,
+	tabBar:null,
+	selectedTab:0,
+	tabContent:null,
+
+	initialize:function() {
+		this.editor = paella.editor.instance;
+	},
+	
+	load:function(onSuccess,onError) {
+		this.container = document.createElement('div');
+		this.container.className = "paellaEditorRightBar";
+		this.container.style.width = this.getWidth() + 'px';
+		this.container.style.bottom = this.editor.bottomBar.getHeight() + 'px';
+		this.editor.editorContainer.appendChild(this.container);
+		this.tabBar = new paella.editor.Tabbar(this.container);
+		this.tabContent = document.createElement('div');
+		this.tabContent.className = "paellaEditorRightBarContent";
+		this.container.appendChild(this.tabContent);
+	
+		this.loadPlugins();
+		onSuccess();
+	},
+	
+	loadPlugins:function() {
+		var thisClass = this;
+		var container = this.tabBar.container;
+		container.innerHTML = "";
+		var ul = document.createElement('ul');
+		ul.className = "nav";
+		var active = "active";
+		var plugins = paella.editor.pluginManager.rightBarPlugins;
+		if (plugins.length>0) {
+			var i=0;
+			for (var i in plugins) {
+				var plugin = plugins[i];
+				ul.appendChild(this.getTab(plugin,i));
+				++i;
+			}
+			container.appendChild(ul);
+		
+			var currentTab = plugins[this.selectedTab];
+			this.tabContent.innerHTML = "";
+			this.tabContent.appendChild(currentTab.getContent());	
+			currentTab.onLoadFinished();
+		}
+	},
+	
+	getTab:function(plugin,index) {
+		var thisClass = this;
+		var active = ""
+		if (index==this.selectedTab) active = "active";
+		var li = document.createElement('li');
+		li.className = active;
+		var a = document.createElement('a');
+		a.className = "rightBarPlugin";
+		a.setAttribute('href','JavaScript:void(0);');
+		a.innerHTML = '<span class="editorRightBarTabIcon ' + plugin.getName() + '"></span>' + plugin.getTabName();
+		a.tabIndex = index;
+		$(a).click(function(event) {
+			thisClass.loadTab(this.tabIndex);
+		});
+		li.appendChild(a);
+		return li;
+	},
+	
+	updateCurrentTab:function() {
+		if (this.tabBar) {	// Prevents update current tab if the editor is the tab bar is not loaded
+			this.loadPlugins();
+		}
+	},
+
+	getWidth:function() {
+		return 300;
+	},
+	
+	loadTab:function(index) {
+		this.selectedTab = index;
+		this.loadPlugins();
+	},
+	
+	onresize:function() {
+		this.container.style.bottom = this.editor.bottomBar.getHeight() + 'px';	
+	}
+});
+
+
diff --git a/tmp/15_editor_track.js b/tmp/15_editor_track.js
new file mode 100644
index 0000000..b5d2a33
--- /dev/null
+++ b/tmp/15_editor_track.js
@@ -0,0 +1 @@
+paella.editor.TrackUtils={buildTrackItemId:function(b,a){return"paellaEditorTrack_"+b+"_"+a},};paella.editor.Track=Class.create({container:null,plugin:null,trackIndex:{back:10,front:20},trackOpacity:{back:0.7,front:1},trackElemList:null,buildTrackItemId:function(b,a){return paella.editor.TrackUtils.buildTrackItemId(b,a)},initialize:function(d,c,b){this.trackElemList=[];this.plugin=c;var a=document.createElement("div");this.container=a;d.appendChild(a);this.buildTracks(a);type=c.getTrackType();if(type=="master"){a.className="editorTrackListItem master "+b}else{if(type=="secondary"){a.className="editorTrackListItem secondary "+b}}},getName:function(){return this.plugin.getName()},rebuild:function(){this.container.innerHTML="";this.buildTracks(this.container)},buildTracks:function(a){var c=this.plugin;var e=c.getTrackItems();for(var b in e){var d=this.getTrack(e[b]);this.trackElemList.push(d);this.container.appendChild(d)}},getTrack:function(d){var k=this;var h=this.plugin;var f=paella.player.videoContainer.duration(true);d.d=d.e-d.s;var c=document.createElement("div");c.className="editorTrackItem "+h.getName();c.id=this.buildTrackItemId(h.getName(),d.id);var a=d.s*100/f;var b=d.d*100/f;$(c).css({left:a+"%",width:b+"%","background-color":h.getColor(),opacity:this.trackOpacity.back});c.trackInfo={trackData:d,plugin:h};var j=document.createElement("div");if(d.name&&d.name!=""){j.innerHTML=d.name}else{j.innerHTML=h.getTrackName()}j.className="editorTrackItemLabel "+this.plugin.getTrackType();j.style.color=h.getTextColor();c.appendChild(j);if(!d.lock){if(h.allowResize()){var i=document.createElement("div");i.className="editorTrackItemResizer left";i.track=c;c.appendChild(i);var e=document.createElement("div");e.className="editorTrackItemResizer right";e.track=c;c.appendChild(e);$(i).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"L",m)});$(e).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"R",m)})}if(h.allowDrag()){var g=document.createElement("div");g.className="editorTrackItemMoveArea";g.track=c;c.appendChild(g);$(g).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onResizerDown(this.track,"M",m)})}}else{var l=document.createElement("i");l.className="editorTrackItemLock icon-lock icon-white";c.appendChild(l)}$(c).mousedown(function(m){paella.editor.utils.mouse.mouseDownTarget="track";k.onTrackDown(this,m)});$(document).mousemove(function(m){k.onResizerMove(m)});$(document).mouseup(function(m){paella.editor.utils.mouse.mouseDownTarget="";k.onResizerUp(this.track,m)});$(c).dblclick(function(m){k.onDblClick(this.trackInfo,m)});return c},currentTrack:null,resizeTrack:null,currentResizer:null,lastPos:{x:0,y:0},selectTrack:function(d,a){if(typeof(d)=="number"){for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c.trackInfo.trackData.id==d){d=c;break}}}if(typeof(d)!="number"&&this.currentTrack!=d){if(!a){this.onUnselect()}for(var b=0;b<this.trackElemList.length;++b){var c=this.trackElemList[b];if(c==d){this.currentTrack=c;if(!a){this.onSelect(c.trackInfo)}$(c).css({"z-index":this.trackIndex.front,opacity:this.trackOpacity.front})}else{$(c).css({"z-index":this.trackIndex.back,opacity:this.trackOpacity.back})}}}},onSelect:function(a){this.plugin.onSelect(a.trackData)},onDblClick:function(a,b){this.plugin.onDblClick(a.trackData)},onUnselect:function(){this.plugin.onUnselect()},onTrackDown:function(a,b){this.selectTrack(a);paella.editor.instance.bottomBar.toolbar.onToolChanged(this.plugin.getName(),this.plugin.getTrackName())},onResizerDown:function(a,c,b){if(b){this.resizeTrack=a;this.currentResizer=c;this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}},onResizerUp:function(d,a){if(this.resizeTrack){var g=paella.player.videoContainer.duration(true);var i=$(this.container).width();var f=$(this.resizeTrack).position().left;var c=$(this.resizeTrack).width();f=f*100/i;c=c*100/i;var b=f*g/100;var h=(f+c)*g/100;var j=this.resizeTrack.trackInfo.plugin;var e=this.resizeTrack.trackInfo.trackData;j.onTrackChanged(e.id,b,h);paella.editor.pluginManager.onTrackChanged(j);paella.editor.instance.rightBar.updateCurrentTab();paella.editor.instance.bottomBar.timeline.rebuildTrack(j.getName());this.resizeTrack.trackInfo.trackData;$(this.resizeTrack).css({left:f+"%",width:c+"%"})}this.resizeTrack=null},onResizerMove:function(b){if(this.resizeTrack){var e={x:b.clientX-this.lastPos.x,y:b.clientY-this.lastPos.y};var d=paella.player.videoContainer.duration(true);var c=$(this.resizeTrack).position().left;var a=$(this.resizeTrack).width();if(this.currentResizer=="L"){c+=e.x;a-=e.x;$(this.resizeTrack).css({left:c+"px",width:a+"px"})}else{if(this.currentResizer=="R"){a+=e.x;$(this.resizeTrack).css({width:a+"px"})}else{if(this.currentResizer=="M"){c+=e.x;$(this.resizeTrack).css({left:c+"px"})}}}this.lastPos.x=b.clientX;this.lastPos.y=b.clientY}}});
\ No newline at end of file
diff --git a/tmp/16_embed_player.js b/tmp/16_embed_player.js
new file mode 100644
index 0000000..ddc2c53
--- /dev/null
+++ b/tmp/16_embed_player.js
@@ -0,0 +1,58 @@
+paella.editor.EmbedPlayer = Class.create(paella.AsyncLoaderCallback,{
+	editar:null,
+	
+	initialize:function() {
+		this.editor = paella.editor.instance;
+	},
+	
+	load:function(onSuccess,onError) {
+		var barHeight = this.editor.bottomBar.getHeight() + 20;
+		var rightBarWidth = this.editor.rightBar.getWidth() + 20;
+		$(paella.player.mainContainer).css({
+			'position':'fixed',
+			"width":"",
+			"bottom":barHeight + "px",
+			"right":rightBarWidth + "px",
+			"left":"20px",
+			"top":"20px"
+		});
+		paella.player.mainContainer.className = "paellaMainContainerEditorMode";
+		new Timer(function(timer) {
+			paella.player.controls.disable();
+			paella.player.onresize();
+			if (onSuccess) {
+				onSuccess();
+			}
+		},500);
+	},
+	
+	restorePlayer:function() {
+		$('body')[0].appendChild(paella.player.mainContainer);
+		paella.player.controls.enable();
+		paella.player.mainContainer.className = "";
+		$(paella.player.mainContainer).css({
+			'position':'',
+			"width":"",
+			"bottom":"",
+			"left":"",
+			"right":"",
+			"top":""
+		});
+		paella.player.onresize();
+	},
+	
+	onresize:function() {
+		var barHeight = this.editor.bottomBar.getHeight() + 20;
+		var rightBarWidth = this.editor.rightBar.getWidth() + 20;
+		$(paella.player.mainContainer).css({
+			'position':'fixed',
+			"width":"",
+			"bottom":barHeight + "px",
+			"right":rightBarWidth + "px",
+			"left":"20px",
+			"top":"20px"
+		});
+
+	}
+});
+
diff --git a/tmp/17_paella_editor.js b/tmp/17_paella_editor.js
new file mode 100644
index 0000000..2328930
--- /dev/null
+++ b/tmp/17_paella_editor.js
@@ -0,0 +1,113 @@
+paella.editor.Editor = Class.create({
+	config:null,
+	editorContainer:null,
+	isLoaded:false,
+	bottomBar:null,
+	rightBar:null,
+	embedPlayer:null,
+	loader:null,
+
+	initialize:function() {
+		if (paella.player.accessControl.permissions.canWrite) {
+			var thisClass = this;
+			paella.editor.instance = this;
+			paella.initDelegate.loadEditorConfig(function(config) {
+				thisClass.config = config;
+				thisClass.loadEditor();
+			});	
+		}
+	},
+	
+	loadEditor:function() {
+		paella.keyManager.enabled = false;
+		var thisClass = this;
+		this.editorContainer = document.createElement('div');
+		$('body')[0].appendChild(this.editorContainer);
+		this.editorContainer.className = 'editorContainer';
+		this.editorContainer.id = "editorContainer";
+		this.editorContainer.appendChild(paella.player.mainContainer);
+		$('body')[0].style.backgroundImage = "url(resources/images/editor_video_bkg.png)";
+		
+		this.loader = new paella.AsyncLoader();
+		this.bottomBar = this.loader.addCallback(new paella.editor.BottomBar());
+		this.rightBar = this.loader.addCallback(new paella.editor.RightBar());
+		this.embedPlayer = this.loader.addCallback(new paella.editor.EmbedPlayer());
+		this.loader.load(function() {
+			thisClass.onLoadSuccess();
+		},function() {
+			thisClass.onLoadFail();
+		});
+	},
+	
+	onLoadSuccess:function() {
+		this.isLoaded = true;
+		var thisClass = this;
+		this.onresize();
+		$(window).resize(function(event) {
+			thisClass.onresize();
+		});
+		$(document).trigger(paella.events.play);
+		new Timer(function(timer) {
+			$(document).trigger(paella.events.pause);	
+		},100);
+		paella.events.bind(paella.events.documentChanged,function(event,params) {
+			window.onbeforeunload = function(event) { return paella.dictionary.translate('There are unsaved changes'); }
+		});
+		paella.events.bind(paella.events.didSaveChanges,function(event,params) {
+			window.onbeforeunload = null;
+		});
+	},
+	
+	onLoadFail:function() {
+		
+	},
+	
+	unloadEditor:function() {
+		paella.keyManager.enabled = true;
+		this.embedPlayer.restorePlayer();
+		$('body')[0].removeChild(this.editorContainer);
+		$('body')[0].style.backgroundImage = "";
+		this.editorContainer = null;
+		this.isLoaded = false;
+		$(document).trigger(paella.events.hideEditor);
+	},
+
+	onresize:function() {
+		if (this.isLoaded) {
+			this.bottomBar.onresize();
+			this.rightBar.onresize();
+			this.embedPlayer.onresize();
+		}
+	}
+});
+
+var EditControl = Class.create(paella.DomNode,{
+	buttonId:'',
+
+	initialize:function(id) {
+		this.buttonId = id + '_button';
+		var style = {position:'absolute',top:'0px',right:'0px'};
+		this.parent('div',id,style);
+		this.domElement.className = 'editControlContainer';
+		var editButton = this;
+		this.addNode(new paella.Button(this.buttonId,'editButton',function(event) {
+			editButton.toggleEditor();
+		},false));
+	},
+
+	toggleEditor:function() {
+		if ((paella.extended) || (window!=window.top)){
+			window.open("index.html?id=" + paella.player.videoIdentifier);
+		}
+		else{
+			$(document).trigger(paella.events.showEditor);
+		}
+	},
+
+	getButton:function() {
+		return this.getNode(this.buttonId);
+	}
+});
+
+
+
diff --git a/tmp/basic_editor_plugins.js b/tmp/basic_editor_plugins.js
new file mode 100644
index 0000000..d7e2e8e
--- /dev/null
+++ b/tmp/basic_editor_plugins.js
@@ -0,0 +1,293 @@
+
+paella.editor.ToolStatusPlugin = Class.create(paella.editor.RightBarPlugin,{
+	currentTrack:null,
+	currentTextField:null,
+	trackItemContainer:null,
+	selectedColor:"rgb(255, 255, 236)",
+	
+	initialize:function() {
+		this.parent();
+		if (paella.utils.language()=='es') {
+			var esDict = {
+				'Tool':'Herramienta',
+				'Selected tool':'Herramienta seleccionada',
+				'this track does not contain any item':'esta pista no contiene ningún elemento',
+				'Click on timeline outside any track to select current playback time.':'Haz clic en el fondo de la línea de tiempo para establecer el instante actual de reproducción',
+				'Quick help':'Ayuda rápida',
+				'item':'elemento',
+				'items':'elementos',
+				'from':'desde',
+				'to':'hasta'
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getIndex:function() {
+		return 10000;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.toolStatusPlugin";
+	},
+	
+	getTabName:function() {
+		return paella.dictionary.translate("Tool");
+	},
+	
+	getContent:function() {
+		this.currentTextField = null;
+		var elem = document.createElement('div');
+		if (this.currentTrack) {
+			var plugin = paella.pluginManager.getPlugin(this.currentTrack.getName());
+			elem.innerHTML = "<h6>" + paella.dictionary.translate("Tool") + ": " + paella.dictionary.translate(this.currentTrack.getTrackName()) + "</h6>";
+			var trackList = this.currentTrack.getTrackItems();
+			var trackContainer = document.createElement('div');
+			trackContainer.className = "editorPluginToolStatus_trackItemList";
+			this.trackItemContainer = trackContainer;
+			plugin.buildToolTabContent(trackContainer);
+			if (trackContainer.childNodes.length==0) {
+				for (var i=0;i<trackList.length;++i) {
+					this.addTrackData(trackContainer,trackList[i]);
+				}
+			}
+			elem.appendChild(trackContainer);
+		}
+		else {
+			elem.innerHTML = "<h6>" + paella.dictionary.translate("Tool") + ": " + paella.dictionary.translate("Selection") + "</h6>";
+			
+		}
+		
+		this.addToolHelp(elem);
+		
+		return elem;
+	},
+	
+	addTrackData:function(parent,track) {
+		var trackData = document.createElement('div');
+		//trackData.innerHTML = track.id + " s:" + track.s + ", e:" + track.e;
+		var trackTime = document.createElement('div');
+		var duration = Math.round((track.e - track.s) * 100) / 100;
+		trackTime.innerHTML = paella.dictionary.translate('from') + ' ' + paella.utils.timeParse.secondsToTime(track.s) + ' ' +
+							  paella.dictionary.translate('to') + ' ' + paella.utils.timeParse.secondsToTime(track.e) + ', ' +
+							  duration + ' sec';
+		trackData.appendChild(trackTime); 
+		if (track.content) {
+			this.addTrackContent(trackData,track.id,track.content,track.s,track.e);
+		}
+		parent.appendChild(trackData);
+	},
+	
+	addTrackContent:function(parent,id,content,start,end) {
+		var contentElem = null;
+		var thisClass = this;
+		if (this.currentTrack.allowEditContent()) {
+			contentElem = document.createElement('input');
+			contentElem.setAttribute('type', 'text');
+			contentElem.setAttribute('id','trackContentEditor_' + id);
+			contentElem.setAttribute('value',content);
+			contentElem.trackData = {id:id,content:content,s:start,e:end};
+			contentElem.plugin = this.currentTrack;
+			$(contentElem).change(function(event) {
+				this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());
+				paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName());
+			});
+			$(contentElem).click(function(event) {
+				thisClass.onFocusChanged(this,this.plugin,this.trackData);
+			});
+			$(contentElem).focus(function(event) {
+				thisClass.onFocusChanged(this,this.plugin,this.trackData);
+			});
+			
+			var selectedTrackItemId = paella.editor.instance.bottomBar.timeline.currentTrackList.currentTrack.trackInfo.trackData.id;
+			if (selectedTrackItemId==id) {
+				this.currentTextField = contentElem;
+				this.currentTextField.style.backgroundColor = this.selectedColor;
+			}
+		}
+		else {
+			contentElem = document.createElement('input');
+			contentElem.setAttribute('type', 'text');
+			contentElem.setAttribute('id',id);
+			contentElem.setAttribute('disabled','disabled');
+			contentElem.setAttribute('style','color:rgb(119, 119, 119)');
+			contentElem.setAttribute('value',content);
+		}
+		
+		
+		parent.appendChild(contentElem);
+	},
+	
+	onFocusChanged:function(field,plugin,trackData) {
+		if (this.currentTextField) {
+			this.currentTextField.style.backgroundColor = "#fff";
+		}
+		field.style.backgroundColor = this.selectedColor;
+		paella.editor.instance.bottomBar.timeline.focusTrackListItem(plugin.getName(),trackData.id);
+		this.currentTextField = field;
+		
+		// Set the timeline position at the end of this track item
+		var time = trackData.e;
+		$(document).trigger(paella.events.seekToTime,{time:time});
+	},
+	
+	onLoadFinished:function() {
+		if (this.currentTextField) {
+			this.trackItemContainer.scrollTop = $(this.currentTextField).position().top;
+		}
+	},
+		
+	addToolHelp:function(parent) {
+		var helpText = "";
+		if (this.currentTrack) {
+			helpText = this.currentTrack.contextHelpString();
+		}
+		else {
+			helpText = paella.dictionary.translate("Click on timeline outside any track to select current playback time.");
+		}
+		
+		if (helpText!="") {
+			var helpElem = document.createElement('div');
+			helpElem.className = "editorPluginToolStatusHelp";
+			parent.appendChild(helpElem);
+			helpElem.innerHTML = '<strong>' + paella.dictionary.translate('Quick help') + ': </strong>' + helpText;
+		}		
+	},
+	
+	onTrackSelected:function(newTrack) {
+		this.currentTrack = newTrack;
+	}
+});
+
+new paella.editor.ToolStatusPlugin();
+
+
+/*
+
+
+paella.editor.CaptionsPlugin = Class.create(paella.editor.TrackPlugin,{
+	tracks:[],
+	selectedTrackItem:null,
+	
+	setup:function() {
+		if (paella.utils.language()=="es") {
+			var esDict = {
+				'Captions':'Subtítulos',
+				'Create':'Crear',
+				'Delete':'Borrar'
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getTrackItems:function() {
+		for (var i=0;i<this.tracks.length;++i) {
+			this.tracks[i].name = this.tracks[i].content;
+		}
+		return this.tracks;
+	},
+	
+	getTools:function() {
+		return [
+			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new caption in the current position')},
+			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected caption')}
+		];
+	},
+	
+	getTrackItemIndex:function(item) {
+//		return this.tracks.indexOf(item);
+		for(var i=0;i<this.tracks.length;++i) {
+			if (item.id==this.tracks[i].id) {
+				return i;
+			}
+		}
+		return -1;
+	},
+
+	onToolSelected:function(toolName) {
+		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
+			this.tracks.splice(this.getTrackItemIndex(this.selectedTrackItem),1);
+			return true;
+		}
+		else if (toolName=='create') {
+			var start = paella.player.videoContainer.currentTime();
+			var end = start + 60;
+			var id = this.getTrackUniqueId();
+			this.tracks.push({id:id,s:start,e:end,content:paella.dictionary.translate('Caption')});
+			return true;
+		}
+	},
+	
+	getTrackUniqueId:function() {
+		var newId = -1;
+		if (this.tracks.length==0) return 1;
+		for (var i=0;i<this.tracks.length;++i) {
+			if (newId<=this.tracks[i].id) {
+				newId = this.tracks[i].id + 1;
+			}
+		}
+		return newId;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.trackCaptions";
+	},
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Captions");
+	},
+	
+	getColor:function() {
+		return 'rgb(212, 212, 224)';
+	},
+	
+	getTextColor:function() {
+		return 'rgb(90,90,90)';
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.s = start;
+			item.e = end;
+			this.selectedTrackItem = item;
+		}
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.content = content;
+			item.name = content;
+		}
+	},
+	
+	allowEditContent:function() {
+		return false;
+	},
+	
+	getTrackItem:function(id) {
+		for (var i=0;i<this.tracks.length;++i) {
+			if (this.tracks[i].id==id) return this.tracks[i];
+		}
+	},
+	
+	contextHelpString:function() {
+		if (paella.utils.language()=="es") {
+			return "Utiliza esta herramienta para crear, borrar y editar subtítulos. Para crear un subtítulo, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los subtítulos";
+		}
+		else {
+			return "Use this tool to create, delete and edit video captions. To create a caption, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the caption text.";
+		}
+	}
+});
+
+paella.editor.captionsPlugin = new paella.editor.CaptionsPlugin();
+
+*/
+
+
+
+
+
+
diff --git a/tmp/break.js b/tmp/break.js
new file mode 100644
index 0000000..87e7bdf
--- /dev/null
+++ b/tmp/break.js
@@ -0,0 +1,206 @@
+paella.plugins.BreaksEditorPlugin = Class.create(paella.editor.TrackPlugin,{
+	tracks:null,
+	selectedTrackItem:null,
+	
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.tracks = [];
+		paella.data.read('breaks',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.breaks && data.breaks.length>0) {
+				This.tracks = data.breaks;
+			}
+			onSuccess(true);
+		});
+	},
+
+	setup:function() {
+		if (paella.utils.language()=="es") {
+			var esDict = {
+				'Breaks':'Descansos',
+				'Break':'Descanso',
+				'Create a new break in the current position': 'Añade un descanso en el instante actual',
+				'Delete selected break': 'Borra el descanso seleccionado'
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getTrackItems:function() {
+		return this.tracks;
+	},
+	
+	getTools:function() {
+		return [
+			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new break in the current position')},
+			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected break')}
+		];
+	},
+	
+	onToolSelected:function(toolName) {
+		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
+			paella.events.trigger(paella.events.documentChanged);
+			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
+			return true;
+		}
+		else if (toolName=='create') {
+			paella.events.trigger(paella.events.documentChanged);
+			var start = paella.player.videoContainer.currentTime();
+			var end = start + 30;
+			var id = this.getTrackUniqueId();
+			var content = paella.dictionary.translate('Break');
+			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
+			return true;
+		}
+	},
+	
+	getTrackUniqueId:function() {
+		var newId = -1;
+		if (this.tracks.length==0) return 1;
+		for (var i=0;i<this.tracks.length;++i) {
+			if (newId<=this.tracks[i].id) {
+				newId = this.tracks[i].id + 1;
+			}
+		}
+		return newId;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.trackBreaks";
+	},
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Breaks");
+	},
+	
+	getColor:function() {
+		return 'rgb(226, 228, 204)';
+	},
+	
+	getTextColor:function() {
+		return 'rgb(90,90,90)';
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.s = start;
+			item.e = end;
+			this.selectedTrackItem = item;
+		}
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.content = content;
+			item.name = content;
+		}
+	},
+	
+	allowEditContent:function() {
+		return true;
+	},
+	
+	getTrackItem:function(id) {
+		for (var i=0;i<this.tracks.length;++i) {
+			if (this.tracks[i].id==id) return this.tracks[i];
+		}
+	},
+	
+	contextHelpString:function() {
+		if (paella.utils.language()=="es") {
+			return "Utiliza esta herramienta para crear, borrar y editar descansos. Para crear un descanso, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los descansos";
+		}
+		else {
+			return "Use this tool to create, delete and edit breaks. To create a break, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the break text.";
+		}
+	},
+	
+	onSave:function(success) {
+		var data = {
+			breaks:this.tracks
+		}
+		paella.data.write('breaks',{id:paella.initDelegate.getId()},data,function(response,status) {
+			paella.plugins.breaksPlayerPlugin.breaks = data.breaks;
+			success(status);
+		});
+		
+	}
+});
+
+paella.plugins.breaksEditorPlugin = new paella.plugins.BreaksEditorPlugin();
+
+
+paella.plugins.BreaksPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
+	breaks:null,
+	lastEvent:0,
+	visibleBreaks:null,
+
+	getName:function() { return "es.upv.paella.BreaksPlayerPlugin"; },
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.breaks = [];
+		this.visibleBreaks = [];
+		paella.data.read('breaks',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.breaks && data.breaks.length>0) {
+				This.breaks = data.breaks;
+			}
+			onSuccess(true);
+		});
+	},
+		
+	getEvents:function() { return [paella.events.timeUpdate]; },
+
+	onEvent:function(eventType,params) {
+		this.checkBreaks(params);
+	},
+	
+	checkBreaks:function(params) {
+		for (var i=0; i<this.breaks.length; ++i) {
+			var a = this.breaks[i];
+			
+			if (a.s<params.currentTime && a.e>params.currentTime) {
+				this.showBreaks(a);
+			} else if (a.s.toFixed(0) == params.currentTime.toFixed(0)){
+				this.avoidBreak(a);
+			}
+		}
+		
+		for (var key in this.visibleBreaks) {
+			if (typeof(a)=='object') {
+				var a = this.visibleBreaks[key];
+				if (a && (a.s>=params.currentTime || a.e<=params.currentTime)) {
+					this.removeBreak(a);
+				}
+			}
+		}
+	},
+	
+	showBreaks:function(br) {
+		if (!this.visibleBreaks[br.s]) {
+			var rect = {left:100,top:350,width:1080,height:20};
+			br.elem = paella.player.videoContainer.overlayContainer.addText(br.content,rect);
+			br.elem.className = 'textBreak';
+			this.visibleBreaks[br.s] = br;
+		}
+	},
+	
+	removeBreak:function(br) {
+		if (this.visibleBreaks[br.s]) {
+			var elem = this.visibleBreaks[br.s].elem;
+			paella.player.videoContainer.overlayContainer.removeElement(elem);
+			this.visibleBreaks[br.s] = null;
+		}
+	},
+	
+	avoidBreak:function(br){
+		var newTime = br.e; 
+		paella.events.trigger(paella.events.seekToTime,{time:newTime});
+	}
+});
+
+paella.plugins.breaksPlayerPlugin = new paella.plugins.BreaksPlayerPlugin();
+
+
diff --git a/tmp/caption_editor.js b/tmp/caption_editor.js
new file mode 100644
index 0000000..52aba37
--- /dev/null
+++ b/tmp/caption_editor.js
@@ -0,0 +1,226 @@
+paella.plugins.CaptionsEditorPlugin = Class.create(paella.editor.TrackPlugin,{
+	tracks:null,
+	selectedTrackItem:null,
+	
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.tracks = [];
+		paella.data.read('captions',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.captions && data.captions.length>0) {
+				This.tracks = data.captions;
+			}
+			onSuccess(true);
+		});
+	},
+
+	setup:function() {
+		if (paella.utils.language()=="es") {
+			var esDict = {
+				'Captions':'Subtítulos',
+				'Caption':'Subtítulo',
+				'Create a new caption in the current position': 'Añade un subtítulo en el instante actual',
+				'Delete selected caption': 'Borra el subtítulo seleccionado'
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getTrackItems:function() {
+		return this.tracks;
+	},
+	
+	getTools:function() {
+		return [
+			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new caption in the current position')},
+			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected caption')}
+		];
+	},
+	
+	onToolSelected:function(toolName) {
+		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
+			paella.events.trigger(paella.events.documentChanged);
+			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
+			return true;
+		}
+		else if (toolName=='create') {
+			paella.events.trigger(paella.events.documentChanged);
+			var start = paella.player.videoContainer.currentTime();
+			var end = start + 30;
+			var id = this.getTrackUniqueId();
+			var content = paella.dictionary.translate('Caption');
+			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
+			return true;
+		}
+	},
+	
+	getTrackUniqueId:function() {
+		var newId = -1;
+		if (this.tracks.length==0) return 1;
+		for (var i=0;i<this.tracks.length;++i) {
+			if (newId<=this.tracks[i].id) {
+				newId = this.tracks[i].id + 1;
+			}
+		}
+		return newId;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.trackCaptions";
+	},
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Captions");
+	},
+	
+	getColor:function() {
+		return 'rgb(159, 166, 88)';
+	},
+	
+	getTextColor:function() {
+		return 'rgb(90,90,90)';
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.s = start;
+			item.e = end;
+			this.selectedTrackItem = item;
+		}
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.content = content;
+			item.name = content;
+		}
+	},
+	
+	allowEditContent:function() {
+		return true;
+	},
+	
+	getTrackItem:function(id) {
+		for (var i=0;i<this.tracks.length;++i) {
+			if (this.tracks[i].id==id) return this.tracks[i];
+		}
+	},
+	
+	contextHelpString:function() {
+		if (paella.utils.language()=="es") {
+			return "Utiliza esta herramienta para crear, borrar y editar subtítulos. Para crear un subtítulo, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de los subtítulos";
+		}
+		else {
+			return "Use this tool to create, delete and edit video captions. To create a caption, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the caption text.";
+		}
+	},
+	
+	onSave:function(success) {
+		var data = {
+			captions:this.tracks
+		}
+		paella.data.write('captions',{id:paella.initDelegate.getId()},data,function(response,status) {
+			paella.plugins.captionsPlayerlugin.captions = data.captions;
+			success(status);
+		});
+	}
+});
+
+paella.plugins.captionsEditorPlugin = new paella.plugins.CaptionsEditorPlugin();
+
+
+paella.plugins.CaptionsPlayerPlugin = Class.create(paella.EventDrivenPlugin,{
+	captions:null,
+	lastEvent:0,
+	visibleCaptions:null,
+	captionsEnabled:null,
+
+	getName:function() { return "es.upv.paella.CaptionsPlayerPlugin"; },
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.captions = [];
+		this.visibleCaptions = [];
+		paella.data.read('captions',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.captions && data.captions.length>0) {
+				This.captions = data.captions;
+			}
+			onSuccess(true);
+		});
+	},
+		
+	getEvents:function() { return [paella.events.timeUpdate]; },
+
+	onEvent:function(eventType,params) {
+		this.checkCaptions(params);
+	},
+	
+	checkCaptions:function(params) {
+		for (var i=0; i<this.captions.length; ++i) {
+			var a = this.captions[i];
+			if (this.captionsEnabled && a.s<params.currentTime && a.e>params.currentTime) {
+				this.showCaption(a);
+			}
+		}
+		
+		for (var key in this.visibleCaptions) {
+			if (typeof(a)=='object') {
+				var a = this.visibleCaptions[key];
+				if (a && (a.s>=params.currentTime || a.e<=params.currentTime || !this.captionsEnabled)) {
+					this.removeCaption(a);
+				}
+			}
+		}
+	},
+	
+	showCaption:function(caption) {
+		if (!this.visibleCaptions[caption.s]) {
+			var rect = {left:100,top:620,width:1080,height:20};
+			caption.elem = paella.player.videoContainer.overlayContainer.addText(caption.content,rect);
+			caption.elem.className = 'textCaption';
+			this.visibleCaptions[caption.s] = caption;
+		}
+	},
+	
+	removeCaption:function(caption) {
+		if (this.visibleCaptions[caption.s]) {
+			var elem = this.visibleCaptions[caption.s].elem;
+			paella.player.videoContainer.overlayContainer.removeElement(elem);
+			this.visibleCaptions[caption.s] = null;
+		}
+	}
+});
+
+paella.plugins.captionsPlayerlugin = new paella.plugins.CaptionsPlayerPlugin();
+
+paella.plugins.ActiveCaptionsPlugin = Class.create(paella.ButtonPlugin,{
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showCaptionsPluginButton"; },
+	getIndex:function() { return 105; },
+	getMinWindowSize:function() { return 300; },
+	getName:function() { return "es.upv.paella.activeCaptionsPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(true); },
+						  
+	action:function(button) {
+		if (this.activeCaptions) {
+			button.className = this.getButtonItemClass(false);
+			paella.plugins.captionsPlayerlugin.captionsEnabled = false;
+			this.activeCaptions = false;
+		} else { 
+			button.className = this.getButtonItemClass(true);
+			paella.plugins.captionsPlayerlugin.captionsEnabled = true;
+			this.activeCaptions = true;
+		}
+	},
+	
+	getButtonItemClass:function(selected) {
+		return 'buttonPlugin '+this.getAlignment() +' '+ this.getSubclass() + ((selected) ? ' selected':'');
+	}
+});
+  
+
+paella.plugins.activeCaptionsPlugin = new paella.plugins.ActiveCaptionsPlugin();
+
+
diff --git a/tmp/comments.js b/tmp/comments.js
new file mode 100644
index 0000000..a307303
--- /dev/null
+++ b/tmp/comments.js
@@ -0,0 +1,128 @@
+paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
+	divRoot:null,
+	divPublishComment:null,
+	divComments:null,
+	divLoading:null,
+	publishCommentTextArea:null,
+	publishCommentButtons:null,
+  
+	getSubclass:function() { return "showCommentsTabBar"; },
+	getName:function() { return "es.upv.paella.commentsPlugin"; },
+	getTabName:function() { return "Comentarios"; },
+			
+	domElement:null,
+			
+	buildContent:function(domElement) {
+		this.domElement = domElement;
+		this.loadContent();
+	},
+			
+	action:function(tab) {
+		this.loadContent();
+	},
+			
+	loadContent:function() {
+		this.divRoot = this.domElement;
+		
+		this.divPublishComment = document.createElement('div');
+		this.divPublishComment.className = 'CommentPlugin_Publish';
+		this.divPublishComment.id = 'CommentPlugin_Publish';
+		
+		this.divLoading = document.createElement('div');
+		this.divLoading.className = 'CommentPlugin_Loading';
+		this.divLoading.id = 'CommentPlugin_Loading';	
+		
+		this.divComments = document.createElement('div'); 
+		this.divComments.className = 'CommentPlugin_Comments';
+		this.divComments.id = 'CommentPlugin_Comments';
+
+		//container.appendChild(this.divPublishComment);
+		//container.appendChild(this.divLoading);
+		this.divRoot.appendChild(this.divComments);
+	  
+		/*var container = this.domElement;
+		container.innerHTML = "Loading...";
+		new paella.Timer(function(t) {
+			container.innerHTML = "Loading done";
+		},2000);*/
+		
+		this.createPublishComment();
+		
+	},
+	
+	createPublishComment:function() {
+		var thisClass = this;
+		var rootID = this.divPublishComment.identifier+"_entry";
+		
+		this.divEntry = document.createElement('div');
+		this.divEntry.className = 'comments_entry';
+		
+		this.divComments.appendChild(this.divEntry);
+		
+		var divSil;
+		this.divSil = document.createElement('img');
+		this.divSil.className = 'comments_entry_silhouette';
+		this.divSil.src = "plugins/silhouette32.png";
+		this.divEntry.appendChild(this.divSil);
+		
+		var divTextAreaContainer;
+		this.divTextAreaContainer = document.createElement('div');
+		this.divTextAreaContainer.className = "comments_entry_container";
+		this.divEntry.appendChild(this.divTextAreaContainer);
+		//this.divTextAreaContainer.onclick = function(){thisClass.onClickTextAreaContainer(divTextAreaContainer)};
+		
+		this.publishCommentTextArea = document.createElement('textarea');
+		this.divTextAreaContainer.appendChild(this.publishCommentTextArea);
+		
+		this.publishCommentButtons = document.createElement('div');
+		this.divTextAreaContainer.className = "comments_entry_container"; 
+		this.divTextAreaContainer.appendChild(this.publishCommentButtons);
+		
+		var btnAddComment;
+		this.btnAddComment = document.createElement('button');
+		this.btnAddComment.className = "publish";
+		this.btnAddComment.onclick = function(){thisClass.addComment();};
+		this.btnAddComment.innerHTML = "Publicar";
+		
+		this.publishCommentButtons.appendChild(this.btnAddComment);
+		
+		this.divTextAreaContainer.commentsTextArea = this.publishCommentTextArea;
+		this.divTextAreaContainer.commentsBtnAddComment = this.btnAddComment;
+		this.divTextAreaContainer.commentsBtnAddCommentToInstant = this.btnAddCommentToInstant;
+	},
+		
+	addComment:function(){
+		var thisClass = this;
+		var txtValue = this.publishCommentTextArea.value;
+		txtValue = txtValue.replace(/<>/g, "< >");  //TODO: Hacer este replace bien!
+	
+		console.log('Texto: '+txtValue)
+		
+		//TODO: Guardar comentario
+	},
+	
+	addReply:function(annotationID, domNodeId){
+		var thisClass = this;
+                
+                var textArea = document.getElementById(domNodeId);
+
+		var txtValue = textArea.value;
+		txtValue = txtValue.replace(/<>/g, "< >");  //TODO: Hacer este replace bien!
+		
+		var commentValue = paella.matterhorn.me.username + "<>" + txtValue + "<>reply<>"+annotationID;
+	
+		textArea.value = "";
+		
+		var restEndpoint = paella.player.config.restServer.url + "annotation"; 		
+		new paella.Ajax(restEndpoint,{episode:paella.matterhorn.episode.id, type:"comment", in:0, out:0, value:commentValue}, function(response) {
+			thisClass.reloadComments();
+		}, thisClass.proxyUrl, thisClass.useJsonp, 'PUT'); 
+	}
+
+});
+  
+
+paella.plugins.commentsPlugin = new paella.plugins.CommentsPlugin();
+
+
+
diff --git a/tmp/consolidate.js b/tmp/consolidate.js
new file mode 100644
index 0000000..48a4de6
--- /dev/null
+++ b/tmp/consolidate.js
@@ -0,0 +1,306 @@
+paella.plugins.ConsolidateEditorPlugin = Class.create(paella.editor.TrackPlugin,{
+	tracks:null,
+	selectedTrackItem:null,
+	
+	checkEnabled:function(onSuccess) {
+		var This = this;
+		this.tracks = [];
+		paella.data.read('consolidate',{id:paella.initDelegate.getId()},function(data,status) {
+			if (data && typeof(data)=='object' && data.consolidate && data.consolidate.length>0) {
+				This.tracks = data.consolidate;
+			}
+			onSuccess(true);
+		});
+	},
+
+	setup:function() {
+		if (paella.utils.language()=="es") {
+			var esDict = {
+				'Create':'Crear',
+				'Delete':'Borrar',
+			};
+			paella.dictionary.addDictionary(esDict);
+		}
+	},
+
+	getTrackItems:function() {
+		return this.tracks;
+	},
+	
+	getTools:function() {
+		return [
+			{name:'create',label:paella.dictionary.translate('Create'),hint:paella.dictionary.translate('Create a new XX in the current position')},
+			{name:'delete',label:paella.dictionary.translate('Delete'),hint:paella.dictionary.translate('Delete selected XX')}
+		];
+	},
+	
+	onToolSelected:function(toolName) {
+		if (this.selectedTrackItem && toolName=='delete' && this.selectedTrackItem) {
+			paella.events.trigger(paella.events.documentChanged);
+			this.tracks.splice(this.tracks.indexOf(this.selectedTrackItem),1);
+			return true;
+		}
+		else if (toolName=='create') {
+			paella.events.trigger(paella.events.documentChanged);
+			var start = paella.player.videoContainer.currentTime();
+			var end = start + 30;
+			var id = this.getTrackUniqueId();
+			var content = paella.dictionary.translate('Consolidate');
+			this.tracks.push({id:id,s:start,e:end,content:content,name:content});
+			return true;
+		}
+	},
+	
+	getTrackUniqueId:function() {
+		var newId = -1;
+		if (this.tracks.length==0) return 1;
+		for (var i=0;i<this.tracks.length;++i) {
+			if (newId<=this.tracks[i].id) {
+				newId = this.tracks[i].id + 1;
+			}
+		}
+		return newId;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.TrackConsolidate";
+	},
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Consolidate");
+	},
+	
+	getColor:function() {
+		return 'rgb(212, 212, 224)';
+	},
+	
+	getTextColor:function() {
+		return 'rgb(90,90,90)';
+	},
+	
+	
+	onTrackChanged:function(id,start,end) {
+	 paella.events.trigger(paella.events.documentChanged);
+	 var item = this.getTrackItem(id);
+	 
+	 if (item){
+	   
+		if (this.tracks.length!=0)
+		    for (var i=0;i<this.tracks.length;++i) {
+		      if (id != this.tracks[i].id){
+			if (end > this.tracks[i].s && start < this.tracks[i].e ){
+				if (start < this.tracks[i].s)
+				  end = this.tracks[i].s
+				if (end > this.tracks[i].e)
+				  start = this.tracks[i].e
+				if (start > this.tracks[i].s && end < this.tracks[i].e ){
+				   end = 0;
+				   start = 0;
+				}
+			}
+		      }
+		    }
+		    
+		item.s = start;
+		item.e = end;
+		item.d = end - start;
+		this.selectedTrackItem = item;
+		
+	  }
+	},
+	
+	onTrackContentChanged:function(id,content) {
+		paella.events.trigger(paella.events.documentChanged);
+		var item = this.getTrackItem(id);
+		if (item) {
+			item.content = content;
+			item.name = content;
+		}
+	},
+	
+	allowEditContent:function() {
+		return true;
+	},
+	
+	getTrackItem:function(id) {
+		for (var i=0;i<this.tracks.length;++i) {
+			if (this.tracks[i].id==id) return this.tracks[i];
+		}
+	},
+	
+	contextHelpString:function() {
+		if (paella.utils.language()=="es") {
+			return "Utiliza esta herramienta para crear, borrar y editar xxx. Para crear una xxx, selecciona el instante de tiempo haciendo clic en el fondo de la línea de tiempo, y pulsa el botón 'Crear'. Utiliza esta pestaña para editar el texto de las anotaciones";
+		}
+		else {
+			return "Use this tool to create, delete and edit video consolidate. To create an xxx, select the time instant clicking the timeline's background and press 'create' button. Use this tab to edit the xxx text.";
+		}
+	},
+	
+	buildToolTabContent:function(tabContainer) {
+	},
+	
+	onSave:function(success) {
+		var data = {
+			consolidate:this.tracks
+		}
+		paella.data.write('consolidate',{id:paella.initDelegate.getId()},data,function(response,status) {
+			success(status);
+		});
+	}
+});
+
+paella.plugins.consolidateEditorPlugin = new paella.plugins.ConsolidateEditorPlugin();
+
+paella.editor.ConsolidatePlugin = Class.create(paella.editor.RightBarPlugin,{
+	currentTrack:null,
+	currentTextField:null,
+	trackItemContainer:null,
+	selectedColor:"rgb(255, 255, 236)",
+					       
+	getIndex:function() {
+		return 10001;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.editor.consolidatePlugin";
+	},
+	
+	getTabName:function() {
+		return "Consolidate";
+	},
+	
+	getContent:function() {
+		this.currentTextField = null;
+		var elem = document.createElement('div');
+		
+		if (this.currentTrack && this.currentTrack.getTrackName() == "Consolidate") {
+			elem.innerHTML = "<h6>" + paella.dictionary.translate("Tool") + ": " + paella.dictionary.translate(this.currentTrack.getTrackName()) + "</h6>";
+			var trackList = this.currentTrack.getTrackItems();
+			var trackContainer = document.createElement('div');
+			trackContainer.className = "editorPluginConsolidate_trackItemList";
+			this.trackItemContainer = trackContainer;
+			for (var i=0;i<trackList.length;++i) {
+				this.addTrackData(trackContainer,trackList[i]);
+			}
+			elem.appendChild(trackContainer);
+			this.addToolHelp(elem);
+		}
+		else {
+			//elem.innerHTML = "<h6>" + paella.dictionary.translate("Tool") + ": " + paella.dictionary.translate(this.currentTrack.getTrackName()) + "</h6>";
+			elem.innerHTML += '<p> No hay opciones que mostrar para esta herramienta.</p>';
+		}
+		
+		
+		return elem;
+	},
+	
+	addTrackData:function(parent,track) {
+		var trackData = document.createElement('div');
+		//trackData.innerHTML = track.id + " s:" + track.s + ", e:" + track.e;
+		var trackTime = document.createElement('div');
+		var duration = Math.round((track.e - track.s) * 100) / 100;
+		trackTime.innerHTML = paella.dictionary.translate('from') + ' ' + paella.utils.timeParse.secondsToTime(track.s) + ' ' +
+							  paella.dictionary.translate('to') + ' ' + paella.utils.timeParse.secondsToTime(track.e) + ', ' +
+							  duration + ' sec';
+		trackData.appendChild(trackTime); 
+		if (track.content) {
+			this.addTrackContent(trackData,track.id,track.content,track.s,track.e);
+		}
+		parent.appendChild(trackData);
+	},
+	
+	addTrackContent:function(parent,id,content,start,end) {
+		var contentElem = null;
+		var thisClass = this;
+		if (this.currentTrack.allowEditContent()) {
+			contentElem = document.createElement('input');
+			contentElem.setAttribute('type', 'text');
+			contentElem.setAttribute('id','trackContentEditor_' + id);
+			contentElem.setAttribute('value',content);
+			contentElem.trackData = {id:id,content:content,s:start,e:end};
+			contentElem.plugin = this.currentTrack;
+			$(contentElem).change(function(event) {
+				this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());
+				paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName());
+			});
+			$(contentElem).click(function(event) {
+				thisClass.onFocusChanged(this,this.plugin,this.trackData);
+			});
+			$(contentElem).focus(function(event) {
+				thisClass.onFocusChanged(this,this.plugin,this.trackData);
+			});
+			
+			var selectedTrackItemId = paella.editor.instance.bottomBar.timeline.currentTrackList.currentTrack.trackInfo.trackData.id;
+			if (selectedTrackItemId==id) {
+				this.currentTextField = contentElem;
+				this.currentTextField.style.backgroundColor = this.selectedColor;
+			}
+		}
+		else {
+			contentElem = document.createElement('input');
+			contentElem.setAttribute('type', 'text');
+			contentElem.setAttribute('id',id);
+			contentElem.setAttribute('disabled','disabled');
+			contentElem.setAttribute('style','color:rgb(119, 119, 119)');
+			contentElem.setAttribute('value',content);
+		}
+		
+		
+		parent.appendChild(contentElem);
+	},
+	
+	onFocusChanged:function(field,plugin,trackData) {
+		if (this.currentTextField) {
+			this.currentTextField.style.backgroundColor = "#fff";
+		}
+		field.style.backgroundColor = this.selectedColor;
+		paella.editor.instance.bottomBar.timeline.focusTrackListItem(plugin.getName(),trackData.id);
+		this.currentTextField = field;
+		
+		// Set the timeline position at the end of this track item
+		var time = trackData.e;
+		$(document).trigger(paella.events.seekToTime,{time:time});
+	},
+	
+	onLoadFinished:function() {
+		if (this.currentTextField) {
+			this.trackItemContainer.scrollTop = $(this.currentTextField).position().top;
+		}
+	},
+	
+	addToolHelp:function(parent) {
+		var helpText = "";
+		if (this.currentTrack) {
+			helpText = this.currentTrack.contextHelpString();
+		}
+		else {
+			helpText = "Texto de ayuda PROVISIONAL";
+		}
+		
+		if (helpText!="") {
+			var helpElem = document.createElement('div');
+			helpElem.className = "editorPluginConsolidateHelp";
+			parent.appendChild(helpElem);
+			helpElem.innerHTML = '<strong>' + paella.dictionary.translate('Quick help') + ': </strong>' + helpText;
+		}		
+	},
+	
+	onTrackSelected:function(newTrack) {
+		this.currentTrack = newTrack;
+	},
+	
+	addElement:function() {
+	  var elem = document.createElement('div');
+	}
+	
+	
+	
+});
+
+new paella.editor.ConsolidatePlugin();
+
+
+
+
+
diff --git a/tmp/description.js b/tmp/description.js
new file mode 100644
index 0000000..e619b44
--- /dev/null
+++ b/tmp/description.js
@@ -0,0 +1,29 @@
+paella.plugins.DescriptionPlugin = Class.create(paella.TabBarPlugin,{
+	getSubclass:function() { return "showDescriptionTabBar"; },
+	getName:function() { return "es.upv.paella.descriptionPlugin"; },
+	getTabName:function() { return "Descripción"; },
+			
+	domElement:null,
+			
+	buildContent:function(domElement) {
+		this.domElement = domElement;
+		this.loadContent();
+	},
+			
+	action:function(tab) {
+		this.loadContent();
+	},
+			
+	loadContent:function() {
+		var container = this.domElement;
+		container.innerHTML = "Loading...";
+		new paella.Timer(function(t) {
+			container.innerHTML = "Loading done";
+		},2000);
+	}
+	
+});
+  
+
+paella.plugins.descriptionPlugin = new paella.plugins.DescriptionPlugin();
+
diff --git a/tmp/extended_profiles.js b/tmp/extended_profiles.js
new file mode 100644
index 0000000..0e042f4
--- /dev/null
+++ b/tmp/extended_profiles.js
@@ -0,0 +1,125 @@
+paella.plugins.ExtendedProfilesPlugin = Class.create(paella.ButtonPlugin,{
+	buttonItems: null,
+	extendedModes: null,
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showExtendedProfilesButton"; },
+	getIndex:function() { return 102; },
+	getMinWindowSize:function() { return 300; },
+	getName:function() { return "es.upv.paella.extendedProfilesPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(paella.extended); },
+	
+	getButtonType:function() { return paella.ButtonPlugin.type.popUpButton; },
+	
+	buildContent:function(domElement) {
+		var thisClass = this;
+		this.buttonItems = {};
+		extendedModes = ['fullScr','full','big','small'];
+		for (var mode in extendedModes){
+		  var modeData = extendedModes[mode];
+		  var buttonItem = thisClass.getProfileItemButton(mode,modeData);
+		  thisClass.buttonItems[mode] = buttonItem;
+		  domElement.appendChild(buttonItem);
+		}
+	},
+	
+	getProfileItemButton:function(profile,profileData) {
+		var elem = document.createElement('div');
+		elem.className = 'extendedProfilesItemButton ' + profileData
+		elem.id = profile + '_button';
+		elem.data = {
+			profile:profile,
+			profileData:profileData,
+			plugin:this
+		}
+		$(elem).click(function(event) {
+			this.data.plugin.onItemClick(elem,this.data.profile, this.data.profileData);
+		});
+		return elem;
+	},
+	
+	onItemClick:function(button,profile,profileData) {
+		if (profileData == "fullScr") {
+			//paella.extended.setProfile('full');
+			this.switchFullScreen(profile,profileData);
+		} else {
+			if (this.isFullscreen()) {
+				if (document.webkitCancelFullScreen) {
+					document.webkitCancelFullScreen();
+				}
+				else if (document.mozCancelFullScreen) {
+					document.mozCancelFullScreen();
+				}
+				else if (document.cancelFullScreen) {
+					document.cancelFullScreen();
+				}
+				this.buttonItems[0].className  = this.getButtonItemClass('fullScr',false);
+			}
+			
+			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
+			this.buttonItems[profile].className = this.getButtonItemClass(profileData,true);
+			paella.extended.setProfile(button.data.profileData);
+	  }
+	    paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
+	},
+	
+	getButtonItemClass:function(profileName,selected) {
+		return 'extendedProfilesItemButton ' + profileName  + ((selected) ? ' selected':'');
+	},
+	
+	switchFullScreen:function(profile,profileData){
+		var fs = document.getElementById(paella.player.mainContainer.id);
+		fs.style.width = '100%';
+		fs.style.height = '100%';
+		if (this.isFullscreen()) {
+			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),true);
+			if (document.webkitCancelFullScreen) {
+				document.webkitCancelFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,false);
+			}
+			else if (document.mozCancelFullScreen) {
+				document.mozCancelFullScreen();
+				this.buttonItems[profile].className = this.getButtonItemClass(profileData,false);
+			}
+			else if (document.cancelFullScreen) {
+				document.cancelFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,false);
+			}
+		}
+		else {
+			this.buttonItems[extendedModes.indexOf(paella.extended.getProfile())].className = this.getButtonItemClass(paella.extended.getProfile(),false);
+			if (fs.webkitRequestFullScreen) {
+				fs.webkitRequestFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
+				
+			}
+			else if (fs.mozRequestFullScreen){
+				fs.mozRequestFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
+			}
+			else if (fs.requestFullScreen()) {
+				fs.requestFullScreen();
+				this.buttonItems[profile].className  = this.getButtonItemClass(profileData,true);
+			  
+			}
+			else {
+				alert('Your browser does not support fullscreen mode');
+			}
+		}
+	},
+	
+	isFullscreen:function() {
+		if (document.webkitIsFullScreen!=undefined) {
+			return document.webkitIsFullScreen;
+		}
+		else if (document.mozFullScreen!=undefined) {
+			return document.mozFullScreen;
+		}
+		return false;
+	}
+	
+});
+  
+
+paella.plugins.extendedProfilesPlugin = new paella.plugins.ExtendedProfilesPlugin();
+
+
diff --git a/tmp/footprints.js b/tmp/footprints.js
new file mode 100644
index 0000000..3da944a
--- /dev/null
+++ b/tmp/footprints.js
@@ -0,0 +1,145 @@
+
+paella.plugins.FootPrintsPlugin = Class.create(paella.ButtonPlugin,{
+	INTERVAL_LENGTH:5,
+	inPosition:0,
+	outPosition:0,	
+	canvas: null,
+	footPrintsTimer: null,
+	footPrintsData: {},
+	
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "footPrints"; },
+	getIndex:function() { return 1002; },
+	getMinWindowSize:function() { return 700; },
+	getName:function() { return "es.upv.paella.FootPrintsPlugin"; },
+	getButtonType:function() { return paella.ButtonPlugin.type.timeLineButton; },
+
+
+	setup:function(){
+		var thisClass = this;
+		paella.events.bind(paella.events.timeUpdate, function(event) { thisClass.onTimeUpdate(); });
+	},
+
+	checkEnabled:function(onSuccess) {
+		onSuccess(true);
+	},
+
+	buildContent:function(domElement) {
+		var container = document.createElement('div');
+		container.className = 'footPrintsContainer';
+
+		this.canvas = document.createElement('canvas');
+		this.canvas.id = 'footPrintsCanvas';
+		this.canvas.className = 'footPrintsCanvas';
+		container.appendChild(this.canvas);
+	
+	
+		domElement.appendChild(container);		
+	},
+	
+    onTimeUpdate:function() {
+		var videoCurrentTime = Math.round(paella.player.videoContainer.currentTime() + paella.player.videoContainer.trimStart());
+		if (this.inPosition <= videoCurrentTime && videoCurrentTime <= this.inPosition + this.INTERVAL_LENGTH) {
+			this.outPosition = videoCurrentTime;
+			if (this.inPosition + this.INTERVAL_LENGTH === this.outPosition) {
+				this.trackFootPrint(this.inPosition, this.outPosition);
+				this.inPosition = this.outPosition;
+			}
+		}
+		else {
+			this.trackFootPrint(this.inPosition, this.outPosition);
+			this.inPosition = videoCurrentTime;
+			this.outPosition = videoCurrentTime;
+		}
+    },
+    
+    trackFootPrint:function(inPosition, outPosition) {
+    	var data = {"in": inPosition, "out": outPosition};		
+		paella.data.write('footprints',{id:paella.initDelegate.getId()}, data);		
+    },
+	
+	willShowContent:function() {
+		var thisClass = this;
+		this.loadFootprints();
+		this.footPrintsTimer = new paella.utils.Timer(function(timer) {
+			thisClass.loadFootprints();
+			},5000);
+		this.footPrintsTimer.repeat = true;
+	},
+
+	didHideContent:function() {
+		if (this.footPrintsTimer!=null) {
+			this.footPrintsTimer.cancel();
+			this.footPrintsTimer = null;
+		}
+	},	
+		
+    loadFootprints:function () {
+	    var thisClass = this;
+		paella.data.read('footprints',{id:paella.initDelegate.getId()},function(data,status) {
+			var footPrintsData = {};
+			var duration = Math.floor(paella.player.videoContainer.duration());
+			var trimStart = Math.floor(paella.player.videoContainer.trimStart());
+			
+            var lastPosition = -1;
+            var lastViews = 0;
+			for (var i = 0; i < data.length; i++) {
+				position = data[i].position - trimStart;
+				if (position < duration){
+					views = data[i].views;
+					
+					if (position - 1 != lastPosition){
+						for (var j = lastPosition + 1; j < position; j++) {
+							footPrintsData[j] = lastViews;
+						}
+					}
+					footPrintsData[position] = views;
+					lastPosition = position;
+					lastViews = views;
+				}
+			}		
+			thisClass.drawFootPrints(footPrintsData);			
+		});
+    },
+	
+	drawFootPrints:function(footPrintsData) {
+		if (this.canvas) {
+			var duration = Object.keys(footPrintsData).length; 
+			var ctx = this.canvas.getContext("2d");
+			var h = 0;
+			for (var i = 0; i<duration; ++i) {
+				if (footPrintsData[i] > h) { h = footPrintsData[i]; } 
+			}
+
+			this.canvas.setAttribute("width", duration);
+			this.canvas.setAttribute("height", h);
+			ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
+			ctx.fillStyle = '#9ED4EE';
+			ctx.strokeStyle = "#0000FF";
+			ctx.lineWidth = 2;
+			
+			ctx.webkitImageSmoothingEnabled = false;
+			ctx.mozImageSmoothingEnabled = false;
+						
+			for (var i = 0; i<duration-1; ++i) {			
+				ctx.beginPath();
+				ctx.moveTo(i, h);
+				ctx.lineTo(i, h-footPrintsData[i]);
+				ctx.lineTo(i+1, h-footPrintsData[i+1]);
+				ctx.lineTo(i+1, h);
+				ctx.closePath();
+				ctx.fill();
+				
+				ctx.beginPath();
+				ctx.moveTo(i, h-footPrintsData[i]);
+				ctx.lineTo(i+1, h-footPrintsData[i+1]);
+				ctx.closePath();
+				ctx.stroke();
+			}
+		}
+	}
+});
+
+paella.plugins.footPrintsPlugin = new paella.plugins.FootPrintsPlugin();
+
+
diff --git a/tmp/framecontrol.js b/tmp/framecontrol.js
new file mode 100644
index 0000000..35563d0
--- /dev/null
+++ b/tmp/framecontrol.js
@@ -0,0 +1,210 @@
+paella.plugins.FrameControlPlugin = Class.create(paella.ButtonPlugin,{
+	frames:null,
+	highResFrames:null,
+	currentFrame:null,
+	navButtons:null,
+
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "frameControl"; },
+	getIndex:function() { return 100; },
+	getMinWindowSize:function() { return 400; },
+	getName:function() { return "es.upv.paella.FrameControlPlugin"; },
+	getButtonType:function() { return paella.ButtonPlugin.type.timeLineButton; },
+
+	checkEnabled:function(onSuccess) {
+		onSuccess(paella.initDelegate.initParams.videoLoader.frameList!=null);
+	},
+
+	buildContent:function(domElement) {
+		this.frames = [];
+		var container = document.createElement('div');
+		container.className = 'frameControlContainer';
+		
+		var content = document.createElement('div');
+		content.className = 'frameControlContent';
+		
+		this.navButtons = {
+			left:document.createElement('div'),
+			right:document.createElement('div')
+		}
+		this.navButtons.left.className = 'frameControl navButton left';
+		this.navButtons.right.className = 'frameControl navButton right';
+		
+		
+		var frame = this.getFrame(null);
+		
+		domElement.appendChild(this.navButtons.left);
+		domElement.appendChild(container);
+		container.appendChild(content);
+		domElement.appendChild(this.navButtons.right);
+		
+		this.navButtons.left.scrollContainer = container;
+		$(this.navButtons.left).click(function(event) {
+			this.scrollContainer.scrollLeft -= 100;
+		});
+
+		this.navButtons.right.scrollContainer = container;
+		$(this.navButtons.right).click(function(event) {
+			this.scrollContainer.scrollLeft += 100;
+		});
+		
+		content.appendChild(frame);
+		
+		var itemWidth = $(frame).outerWidth(true);
+		content.innerHTML = '';
+		
+		var frames = paella.initDelegate.initParams.videoLoader.frameList;
+		if (frames) {
+			var numFrames = 0;
+			for (var key in frames) {
+				var frameItem = this.getFrame(frames[key]);
+				content.appendChild(frameItem,'frameContrlItem_' + numFrames);
+				this.frames.push(frameItem);
+				++numFrames;
+			}
+		}
+		
+		$(content).css({width:(numFrames * itemWidth) + 'px'});
+		
+		var This = this;
+		paella.events.bind(paella.events.setTrim,function(event,params) {
+			This.checkVisibility(params.trimEnabled,params.trimStart,params.trimEnd);
+		});
+		
+		paella.events.bind(paella.events.timeupdate,function(event,params) { This.onTimeUpdate(params.currentTime) });
+		
+		this.checkHighResFrames();
+	},
+	
+	checkHighResFrames:function() {
+		var slidesStream = paella.initDelegate.initParams.videoLoader.streams.length>=2 ? paella.initDelegate.initParams.videoLoader.streams[1]:null;
+		if (slidesStream && slidesStream.sources.image) {
+			this.highResFrames = {};
+			for (var key in slidesStream.sources.image.frames) {
+				var src = slidesStream.sources.image.frames[key];
+				this.highResFrames[key] = src;
+			}
+		}
+	},
+	
+	showHiResFrame:function(url) {
+		var frameRoot = document.createElement("div"); 
+		var frame = document.createElement("div"); 
+		var hiResImage = document.createElement('img'); 
+        hiResImage.className = 'frameHiRes';
+        hiResImage.setAttribute('src',url);
+        hiResImage.setAttribute('style', 'width: 100%;');
+
+		$(frame).append(hiResImage);
+		$(frameRoot).append(frame);
+
+        frameRoot.setAttribute('style', 'display: table;');
+        frame.setAttribute('style', 'display: table-cell; vertical-align:middle;');
+		overlayContainer = paella.player.videoContainer.overlayContainer;
+		
+		var streams = paella.initDelegate.initParams.videoLoader.streams;
+		if (streams.length == 1){
+			overlayContainer.addElement(frameRoot, overlayContainer.getMasterRect());
+		}
+		else if (streams.length >= 2){
+			overlayContainer.addElement(frameRoot, overlayContainer.getSlaveRect());
+		}
+		overlayContainer.enableBackgroundMode();
+		this.hiResFrame = frameRoot;
+	},
+
+	removeHiResFrame:function() {
+		overlayContainer = paella.player.videoContainer.overlayContainer;
+		overlayContainer.removeElement(this.hiResFrame);
+		overlayContainer.disableBackgroundMode();
+	},
+	
+	checkVisibility:function(trimEnabled,trimStart,trimEnd) {
+		if (!trimEnabled) {
+			for (var i = 0; i<this.frames.length;++i) {
+				$(this.frames[i]).show();
+			}
+		}
+		else {
+			for (var i = 0; i<this.frames.length; ++i) {
+				var frameElem = this.frames[i];
+				var frameData = frameElem.frameData;
+				if (frameData.time<trimStart) {
+					if (this.frames.length>i+1 && this.frames[i+1].frameData.time>trimStart) {
+						$(frameElem).show();
+					}
+					else {
+						$(frameElem).hide();
+					}
+				}
+				else if (frameData.time>trimEnd) {
+					$(frameElem).hide();
+				}
+				else {
+					$(frameElem).show();
+				}
+			}	
+		}
+	},
+	
+	getFrame:function(frameData,id) {
+		var frame = document.createElement('div');
+		frame.className = 'frameControlItem';
+		if (id) frame.id = id;
+		if (frameData) {
+			frame.frameData = frameData;
+			frame.frameControl = this;
+			frame.innerHTML = '<img src="' + frameData.url + '" alt="" class="frameControlImage"></img>';
+			$(frame).mouseover(function(event) {
+				this.frameControl.onMouseOver(event,this.frameData);
+			});
+			$(frame).mouseout(function(event) {
+				this.frameControl.onMouseOut(event,this.frameData);
+			});
+			$(frame).click(function(event) {
+				this.frameControl.onClick(event,this.frameData);
+			});
+		}
+		return frame;
+	},
+	
+	onMouseOver:function(event,frameData) {
+		if (this.highResFrames) {
+			var hRes = this.highResFrames['frame_' + frameData.time];
+			if (hRes) {
+				this.showHiResFrame(hRes);
+			}
+		}
+	},
+	
+	onMouseOut:function(event,frameData) {
+		this.removeHiResFrame();
+	},
+	
+	onClick:function(event,frameData) {
+		paella.events.trigger(paella.events.seekToTime,{time:frameData.time + 1});
+	},
+	
+	onTimeUpdate:function(currentTime) {
+		var frame = null;
+		for (var i = 0; i<this.frames.length; ++i) {
+			if (this.frames[i].frameData.time<=currentTime) {
+				frame = this.frames[i];
+			}
+			else {
+				break;
+			}
+		}
+		if (this.currentFrame!=frame) {
+			if (this.currentFrame) this.currentFrame.className = 'frameControlItem';
+			this.currentFrame = frame;
+			this.currentFrame.className = 'frameControlItem current';
+		}
+	}
+});
+
+
+
+paella.plugins.frameControlPlugin = new paella.plugins.FrameControlPlugin();
+
+
diff --git a/tmp/fullscreenbutton.js b/tmp/fullscreenbutton.js
new file mode 100644
index 0000000..947982f
--- /dev/null
+++ b/tmp/fullscreenbutton.js
@@ -0,0 +1,66 @@
+paella.plugins.FullScreenPlugin = Class.create(paella.ButtonPlugin, {
+	getIndex:function() { return 104; },
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showFullScreenButton"; },
+	getName:function() { return "es.upv.paella.fullScreenButtonPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(!paella.extended); },
+
+					       
+	action:function(button) {
+		var fs = document.getElementById(paella.player.mainContainer.id);
+		fs.style.width = '100%';
+		fs.style.height = '100%';
+		if (this.isFullscreen()) {
+		 
+			if (document.webkitCancelFullScreen) {
+				document.webkitCancelFullScreen();
+				button.className = this.getButtonItemClass(false);
+			}
+			else if (document.mozCancelFullScreen) {
+				document.mozCancelFullScreen();
+				button.className = this.getButtonItemClass(false);
+			}
+			else if (document.cancelFullScreen) {
+				document.cancelFullScreen();
+				button.className = this.getButtonItemClass(false);
+			}
+			
+			
+		}
+		else {
+			if (fs.webkitRequestFullScreen) {
+				fs.webkitRequestFullScreen();
+				button.className = this.getButtonItemClass(true);
+			}
+			else if (fs.mozRequestFullScreen){
+				fs.mozRequestFullScreen();
+				button.className = this.getButtonItemClass(true);
+			}
+			else if (fs.requestFullScreen()) {
+				fs.requestFullScreen();
+				button.className = this.getButtonItemClass(true);
+			}
+			else {
+				alert('Your browser does not support fullscreen mode');
+			}
+		}
+	},
+	
+	isFullscreen:function() {
+		if (document.webkitIsFullScreen!=undefined) {
+			return document.webkitIsFullScreen;
+		}
+		else if (document.mozFullScreen!=undefined) {
+			return document.mozFullScreen;
+		}
+		return false;
+	},
+	
+	getButtonItemClass:function(selected) {
+		return 'buttonPlugin '+this.getAlignment() +' '+ this.getSubclass() + ((selected) ? ' active':'');
+	}
+});
+
+paella.plugins.fullScreenPlugin = new paella.plugins.FullScreenPlugin();
+
+
diff --git a/tmp/playbutton.js b/tmp/playbutton.js
new file mode 100644
index 0000000..743c8f8
--- /dev/null
+++ b/tmp/playbutton.js
@@ -0,0 +1,152 @@
+
+paella.plugins.PlayPauseButtonPlugin = Class.create(paella.ButtonPlugin, {
+	playSubclass:'playButton',
+	pauseSubclass:'pauseButton',
+	
+	getAlignment:function() { return 'left'; },
+	getSubclass:function() { return this.playSubclass; },
+	getName:function() { return "es.upv.paella.playPauseButtonPlugin"; },
+	
+	setup:function() {
+		var This = this;
+		paella.events.bind(paella.events.play,function(event) { This.changeSubclass(This.pauseSubclass); });
+		paella.events.bind(paella.events.pause,function(event) { This.changeSubclass(This.playSubclass); });
+	},
+
+	action:function(button) {
+		if (paella.player.videoContainer.paused()) {
+			paella.events.trigger(paella.events.play);
+		}
+		else {		
+			paella.events.trigger(paella.events.pause);
+		}
+	}
+});
+
+paella.plugins.playPauseButtonPlugn = new paella.plugins.PlayPauseButtonPlugin();
+
+paella.plugins.PlayButtonOnScreen = Class.create(paella.EventDrivenPlugin,{
+	containerId:'paella_plugin_PlayButtonOnScreen',
+	container:null,
+	enabled:true,
+	isPlaying:false,
+
+	initPlugin:function() {
+		this.container = document.createElement('div');
+		this.container.className = "playButtonOnScreen";
+		this.container.id = this.containerId;
+		paella.player.videoContainer.domElement.appendChild(this.container);
+		var thisClass = this;
+		$(this.container).click(function(event){thisClass.onPlayButtonClick()});
+		
+		var icon = document.createElement('canvas');
+		icon.className = "playButtonOnScreenIcon";
+		icon.setAttribute("width", 300);
+		icon.setAttribute("height",300);
+		var ctx = icon.getContext('2d');
+		
+		ctx.beginPath();
+		ctx.arc(150,150,140,0,2*Math.PI,true);
+		ctx.closePath();
+		
+		ctx.strokeStyle = 'white';
+		ctx.lineWidth = 10;
+		ctx.stroke();
+		ctx.fillStyle = '#8f8f8f';
+		ctx.fill();
+		
+		ctx.beginPath();
+		ctx.moveTo(100,70);
+		ctx.lineTo(250,150);
+		ctx.lineTo(100,230);
+		ctx.lineTo(100,70);
+		ctx.closePath();
+		ctx.fillStyle = 'white';
+		ctx.fill();
+
+		ctx.stroke();
+
+		this.container.appendChild(icon);
+	},
+	
+	getEvents:function() {
+		return [paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor,paella.events.loadComplete];
+	},
+	
+	onEvent:function(eventType,params) {
+		switch (eventType) {
+			case paella.events.loadComplete:
+				this.initPlugin();
+				break;
+			case paella.events.endVideo:
+				this.endVideo();
+				break;
+			case paella.events.play:
+				this.play();
+				break;
+			case paella.events.pause:
+				this.pause();
+				break;
+			case paella.events.showEditor:
+				this.showEditor();
+				break;
+			case paella.events.hideEditor:
+				this.hideEditor();
+				break;
+		}
+	},
+	
+	onPlayButtonClick:function() {
+		$(document).trigger(paella.events.play);
+	},
+	
+	endVideo:function() {
+		this.isPlaying = false;
+		this.checkStatus();
+	},
+	
+	play:function() {
+		this.isPlaying = true;
+		this.checkStatus();
+	},
+	
+	pause:function() {
+		this.isPlaying = false;
+		this.checkStatus();
+	},
+	
+	showEditor:function() {
+		this.enabled = false;
+		this.checkStatus();
+	},
+	
+	hideEditor:function() {
+		this.enabled = true;
+		this.checkStatus();
+	},
+	
+	checkStatus:function() {
+		if ((this.enabled && this.isPlaying) || !this.enabled) {
+			$(this.container).hide();
+		}
+		else {
+			$(this.container).show();
+		}
+	},
+
+	checkEnabled:function(onSuccess) {
+		onSuccess(true);
+	},
+	
+	getIndex:function() {
+		return 1010;
+	},
+	
+	getName:function() {
+		return "es.upv.paella.playButtonOnScreen";
+	}
+});
+
+new paella.plugins.PlayButtonOnScreen();
+
+
diff --git a/tmp/repeatbutton.js b/tmp/repeatbutton.js
new file mode 100644
index 0000000..9429f84
--- /dev/null
+++ b/tmp/repeatbutton.js
@@ -0,0 +1,16 @@
+paella.plugins.RepeatButtonPlugin = Class.create(paella.ButtonPlugin, {
+	repeatSubclass:'repeatButton',
+	
+	getAlignment:function() { return 'left'; },
+	getSubclass:function() { return this.repeatSubclass; },
+	getName:function() { return "es.upv.paella.repeatButtonPlugin"; },
+	
+	action:function(button) {
+	  var newTime = paella.player.videoContainer.currentTime()-30;
+	  paella.events.trigger(paella.events.seekToTime,{time:newTime});
+	}
+});
+
+paella.plugins.repeatButtonPlugin = new paella.plugins.RepeatButtonPlugin();
+
+
diff --git a/tmp/social.js b/tmp/social.js
new file mode 100644
index 0000000..cd422b9
--- /dev/null
+++ b/tmp/social.js
@@ -0,0 +1,61 @@
+paella.plugins.SocialPlugin = Class.create(paella.ButtonPlugin,{
+	buttonItems: null,
+	socialMedia: null,
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showSocialPluginButton"; },
+	getIndex:function() { return 103; },
+	getMinWindowSize:function() { return 300; },
+	getName:function() { return "es.upv.paella.socialPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(true); },
+	
+	getButtonType:function() { return paella.ButtonPlugin.type.popUpButton; },
+	
+	buildContent:function(domElement) {
+		var thisClass = this;
+		this.buttonItems = {};
+		socialMedia = ['facebook','twitter'];
+		for (var media in socialMedia){
+		  var mediaData = socialMedia[media];
+		  var buttonItem = thisClass.getSocialMediaItemButton(mediaData);
+		  thisClass.buttonItems[media] = buttonItem;
+		  domElement.appendChild(buttonItem);
+		}
+	},
+	
+	getSocialMediaItemButton:function(mediaData) {
+		var elem = document.createElement('div');
+		elem.className = 'socialItemButton ' + mediaData
+		elem.id = mediaData + '_button';
+		elem.data = {
+			mediaData:mediaData,
+			plugin:this
+		}
+		$(elem).click(function(event) {
+			this.data.plugin.onItemClick(this.data.mediaData);
+		});
+		return elem;
+	},
+	
+	onItemClick:function(mediaData) {
+		var url = this.getVideoUrl();
+		switch (mediaData) {
+			case ('twitter'):
+				window.open('http://twitter.com/home?status=' + url);
+				break;
+			case ('facebook'):
+				window.open('http://www.facebook.com/sharer.php?u=' + url);
+				break;  
+                }
+		paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
+	},
+	
+	getVideoUrl:function() {
+		var url = document.location.href;
+		return url;
+	}
+});
+  
+
+paella.plugins.socialPlugin = new paella.plugins.SocialPlugin();
+
+
diff --git a/tmp/trimming.js b/tmp/trimming.js
new file mode 100644
index 0000000..ed74378
--- /dev/null
+++ b/tmp/trimming.js
@@ -0,0 +1,108 @@
+paella.plugins.TrimmingLoaderPlugin = Class.create(paella.EventDrivenPlugin,{
+	
+	getName:function() { return "es.upv.paella.TrimmingPlayerPlugin"; },
+	checkEnabled:function(onSuccess) { onSuccess(paella.player.config.trimming && paella.player.config.trimming.enabled); },
+		
+	getEvents:function() { return [paella.events.loadComplete,paella.events.showEditor,paella.events.hideEditor]; },
+
+	onEvent:function(eventType,params) {
+		switch (eventType) {
+			case paella.events.loadComplete:
+				this.loadTrimming();
+				break;
+			case paella.events.showEditor:
+				paella.player.videoContainer.disableTrimming();
+				break;
+			case paella.events.hideEditor:
+				if (paella.player.config.trimming && paella.player.config.trimming.enabled) {
+					paella.player.videoContainer.enableTrimming();
+				}
+				break;
+		}
+	},
+	
+	loadTrimming:function() {
+		var videoId = paella.initDelegate.getId();
+		paella.data.read('trimming',{id:videoId},function(data,status) {
+			if (data && status && data.end>0) {
+				paella.player.videoContainer.enableTrimming();
+				paella.player.videoContainer.setTrimming(data.start, data.end);
+			}
+		});
+	}
+});
+
+paella.plugins.trimmingLoaderPlugin = new paella.plugins.TrimmingLoaderPlugin();
+
+paella.plugins.TrimmingTrackPlugin = Class.create(paella.editor.MainTrackPlugin,{
+	trimmingTrack:null,
+	trimmingData:{s:0,e:0},
+
+	getTrackItems:function() {
+		if (this.trimmingTrack==null) {
+			this.trimmingTrack = {id:1,s:0,e:0};
+			this.trimmingTrack.s = paella.player.videoContainer.trimStart();
+			this.trimmingTrack.e = paella.player.videoContainer.trimEnd();
+			this.trimmingData.s = this.trimmingTrack.s;
+			this.trimmingData.e = this.trimmingTrack.e;
+		}		
+		var tracks = [];
+		tracks.push(this.trimmingTrack);
+		return tracks;
+	},
+		
+	getName:function() { return "es.upv.paella.editor.TrimmingTrackPlugin"; },
+	
+	getTrackName:function() {
+		return paella.dictionary.translate("Trimming");
+	},
+	
+	getColor:function() {
+		return 'rgb(0, 51, 107)';
+	},
+	
+	checkEnabled:function(isEnabled) {
+		isEnabled(paella.player.config.trimming && paella.player.config.trimming.enabled);
+	},
+	
+	onSave:function(onDone) {
+		paella.player.videoContainer.enableTrimming();
+		paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s);
+		paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e);
+		
+		paella.data.write('trimming',{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(data,status) {
+			onDone(status);
+		});
+	},
+	
+	onDiscard:function(onDone) {
+		this.trimmingTrack.s = this.trimmingData.s;
+		this.trimmingTrack.e = this.trimmingData.e;
+		onDone(true);
+	},
+	
+	allowDrag:function() {
+		return false;
+	},
+	
+	onTrackChanged:function(id,start,end) {
+		this.trimmingTrack.s = start;
+		this.trimmingTrack.e = end;
+		this.parent(id,start,end);
+	},
+
+	contextHelpString:function() {
+		// TODO: Implement this using the standard paella.dictionary class
+		if (paella.utils.language()=="es") {
+			return "Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista \"Recorte\", en la linea de tiempo.";
+		}
+		else {
+			return "Use this tool to define the start and finish time.";
+		}
+	}
+});
+
+paella.plugins.trimmingTrackPlugin = new paella.plugins.TrimmingTrackPlugin();
+
+
+
diff --git a/tmp/viewmode.js b/tmp/viewmode.js
new file mode 100644
index 0000000..3ffdf2b
--- /dev/null
+++ b/tmp/viewmode.js
@@ -0,0 +1,62 @@
+paella.plugins.ViewModePlugin = Class.create(paella.ButtonPlugin,{
+	buttonItems:null,
+
+	getAlignment:function() { return 'right'; },
+	getSubclass:function() { return "showViewModeButton"; },
+	getIndex:function() { return 101; },
+	getMinWindowSize:function() { return 300; },
+	getName:function() { return "es.upv.paella.viewModePlugin"; },
+	getButtonType:function() { return paella.ButtonPlugin.type.popUpButton; },
+
+	checkEnabled:function(onSuccess) {
+		onSuccess(paella.initDelegate.initParams.videoLoader.streams.length>=2);
+	},
+
+	buildContent:function(domElement) {
+		var thisClass = this;
+		this.buttonItems = {};
+		paella.Profiles.loadProfileList(function(profiles) {
+			for (var profile in profiles) {
+				var profileData = profiles[profile];
+				var buttonItem = thisClass.getProfileItemButton(profile,profileData);
+				thisClass.buttonItems[profile] = buttonItem;
+				domElement.appendChild(buttonItem);
+			}
+		});
+	},
+	
+	getProfileItemButton:function(profile,profileData) {
+		var elem = document.createElement('div');
+		elem.className = this.getButtonItemClass(profile,false);
+		elem.id = profile + '_button';
+		elem.data = {
+			profile:profile,
+			profileData:profileData,
+			plugin:this
+		}
+		$(elem).click(function(event) {
+			this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData);
+		});
+		return elem;
+	},
+	
+	onItemClick:function(button,profile,profileData) {
+		var prevButtonItem = this.buttonItems[paella.player.selectedProfile];
+		var nextButtonItem = this.buttonItems[profile];
+		
+		if (nextButtonItem && prevButtonItem!=nextButtonItem) {
+			prevButtonItem.className = this.getButtonItemClass(paella.player.selectedProfile,false);
+			nextButtonItem.className = this.getButtonItemClass(profile,true);
+			paella.events.trigger(paella.events.setProfile,{profileName:profile});
+			paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()});
+		}
+	},
+	
+	getButtonItemClass:function(profileName,selected) {
+		return 'viewModeItemButton ' + profileName  + ((selected) ? ' selected':'');
+	}
+});
+
+paella.plugins.viewModePlugin = new paella.plugins.ViewModePlugin();
+
+
-- 
1.7.9.5


From 9b0655388f245dddfeaebf86f26984477709f6f8 Mon Sep 17 00:00:00 2001
From: Sergio Peiro <serpeilop@gmail.com>
Date: Wed, 30 Oct 2013 11:02:53 +0100
Subject: [PATCH 6/6] Captions button added

---
 plugins/comments.js |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/plugins/comments.js b/plugins/comments.js
index 0fdb8bc..a6f4bf6 100644
--- a/plugins/comments.js
+++ b/plugins/comments.js
@@ -46,7 +46,7 @@ paella.plugins.CommentsPlugin = Class.create(paella.TabBarPlugin,{
 			container.innerHTML = "Loading done";
 		},2000);*/
 		
-		this.createPublishComment();
+		//this.createPublishComment();
 		
 	},
 	
-- 
1.7.9.5

