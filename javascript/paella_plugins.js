paella.editor.ToolStatusPlugin=Class.create(paella.editor.RightBarPlugin,{currentTrack:null,currentTextField:null,trackItemContainer:null,selectedColor:"rgb(255, 255, 236)",initialize:function(){this.parent();if(paella.utils.language()=="es"){var a={Tool:"Herramienta","Selected tool":"Herramienta seleccionada","this track does not contain any item":"esta pista no contiene ningún elemento","Click on timeline outside any track to select current playback time.":"Haz clic en el fondo de la línea de tiempo para establecer el instante actual de reproducción","Quick help":"Ayuda rápida",item:"elemento",items:"elementos",from:"desde",to:"hasta"};paella.dictionary.addDictionary(a)}},getIndex:function(){return 10000},getName:function(){return"toolStatusPlugin"},getTabName:function(){return paella.dictionary.translate("Tool")},getContent:function(){this.currentTextField=null;var c=document.createElement("div");if(this.currentTrack){c.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate(this.currentTrack.getTrackName())+"</h6>";var d=this.currentTrack.getTrackItems();var a=document.createElement("div");a.className="editorPluginToolStatus_trackItemList";this.trackItemContainer=a;for(var b=0;b<d.length;++b){this.addTrackData(a,d[b])}c.appendChild(a)}else{c.innerHTML="<h6>"+paella.dictionary.translate("Tool")+": "+paella.dictionary.translate("Selection")+"</h6>"}this.addToolHelp(c);return c},addTrackData:function(b,a){var d=document.createElement("div");var e=document.createElement("div");var c=Math.round((a.e-a.s)*100)/100;e.innerHTML=paella.dictionary.translate("from")+" "+paella.utils.timeParse.secondsToTime(a.s)+" "+paella.dictionary.translate("to")+" "+paella.utils.timeParse.secondsToTime(a.e)+", "+c+" sec";d.appendChild(e);if(a.content){this.addTrackContent(d,a.id,a.content,a.s,a.e)}b.appendChild(d)},addTrackContent:function(d,h,e,g,c){var a=null;var b=this;if(this.currentTrack.allowEditContent()){a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id","trackContentEditor_"+h);a.setAttribute("value",e);a.trackData={id:h,content:e,s:g,e:c};a.plugin=this.currentTrack;$(a).change(function(i){this.plugin.onTrackContentChanged(this.trackData.id,$(this).val());paella.editor.instance.bottomBar.timeline.rebuildTrack(this.plugin.getName())});$(a).click(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});$(a).focus(function(i){b.onFocusChanged(this,this.plugin,this.trackData)});var f=paella.editor.instance.bottomBar.timeline.currentTrackList.currentTrack.trackInfo.trackData.id;if(f==h){this.currentTextField=a;this.currentTextField.style.backgroundColor=this.selectedColor}}else{a=document.createElement("input");a.setAttribute("type","text");a.setAttribute("id",h);a.setAttribute("disabled","disabled");a.setAttribute("style","color:rgb(119, 119, 119)");a.setAttribute("value",e)}d.appendChild(a)},onFocusChanged:function(d,a,c){if(this.currentTextField){this.currentTextField.style.backgroundColor="#fff"}d.style.backgroundColor=this.selectedColor;paella.editor.instance.bottomBar.timeline.focusTrackListItem(a.getName(),c.id);this.currentTextField=d;var b=c.e;$(document).trigger(paella.events.seekToTime,{time:b})},onLoadFinished:function(){if(this.currentTextField){this.trackItemContainer.scrollTop=$(this.currentTextField).position().top}},addToolHelp:function(c){var b="";if(this.currentTrack){b=this.currentTrack.contextHelpString()}else{b=paella.dictionary.translate("Click on timeline outside any track to select current playback time.")}if(b!=""){var a=document.createElement("div");a.className="editorPluginToolStatusHelp";c.appendChild(a);a.innerHTML="<strong>"+paella.dictionary.translate("Quick help")+": </strong>"+b}},onTrackSelected:function(a){this.currentTrack=a}});new paella.editor.ToolStatusPlugin();paella.editor.ConsolidatePlugin=Class.create(paella.editor.RightBarPlugin,{getIndex:function(){return 10001},getName:function(){return"consolidatePlugin"},getTabName:function(){return"Consolidate"},getContent:function(){var a=document.createElement("div");a.innerHTML="Consolidate video";a.innerHTML+='<div><label for="title">Title:</label><input type="text" value="title" id="title"></div>';a.innerHTML+='<div><label for="author">Author:</label><input type="text" value="author" id="title"></div>';a.innerHTML+='<div><label for="serie">Serie:</label><input type="text" value="serie" id="title"></div>';a.innerHTML+='<div><input type="button" value="Consolidate"></div>';return a}});new paella.editor.ConsolidatePlugin();paella.plugins.FrameControlPlugin=Class.create(paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 100},getMinWindowSize:function(){return 400},getName:function(){return"FrameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},checkEnabled:function(a){a(paella.initDelegate.initParams.videoLoader.frameList!=null&&paella.initDelegate.initParams.videoLoader.streams.length>=2)},buildContent:function(e){this.frames=[];var a=document.createElement("div");a.className="frameControlContainer";var h=document.createElement("div");h.className="frameControlContent";var c=this.getFrame(null);e.appendChild(a);a.appendChild(h);h.appendChild(c);var g=$(c).outerWidth(true);h.innerHTML="";var i=paella.initDelegate.initParams.videoLoader.frameList;if(i){var f=0;for(var j in i){var d=this.getFrame(i[j]);h.appendChild(d,"frameContrlItem_"+f);this.frames.push(d);++f}}$(h).css({width:(f*g)+"px"});var b=this;paella.events.bind(paella.events.setTrim,function(k,l){b.checkVisibility(l.trimEnabled,l.trimStart,l.trimEnd)});paella.events.bind(paella.events.timeupdate,function(k,l){b.onTimeUpdate(l.currentTime)});this.checkHighResFrames()},checkHighResFrames:function(){var a=paella.initDelegate.initParams.videoLoader.streams.length>=2?paella.initDelegate.initParams.videoLoader.streams[1]:null;if(a&&a.sources.image){this.highResFrames={};for(var b in a.sources.image.frames){var c=a.sources.image.frames[b];this.highResFrames[b]=c}}},showHiResFrame:function(b){var e=document.createElement("div");var c=document.createElement("div");var a=document.createElement("img");a.className="frameHiRes";a.setAttribute("src",b);a.setAttribute("style","width: 100%;");$(c).append(a);$(e).append(c);e.setAttribute("style","display: table;");c.setAttribute("style","display: table-cell; vertical-align:middle;");overlayContainer=paella.player.videoContainer.overlayContainer;var d=paella.initDelegate.initParams.videoLoader.streams;if(d.length==1){overlayContainer.addElement(e,overlayContainer.getMasterRect())}else{if(d.length>=2){overlayContainer.addElement(e,overlayContainer.getSlaveRect())}}overlayContainer.enableBackgroundMode();this.hiResFrame=e},removeHiResFrame:function(){overlayContainer=paella.player.videoContainer.overlayContainer;overlayContainer.removeElement(this.hiResFrame);overlayContainer.disableBackgroundMode()},checkVisibility:function(a,e,f){if(!a){for(var c=0;c<this.frames.length;++c){$(this.frames[c]).show()}}else{for(var c=0;c<this.frames.length;++c){var b=this.frames[c];var d=b.frameData;if(d.time<e){if(this.frames.length>c+1&&this.frames[c+1].frameData.time>e){$(b).show()}else{$(b).hide()}}else{if(d.time>f){$(b).hide()}else{$(b).show()}}}}},getFrame:function(a,c){var b=document.createElement("div");b.className="frameControlItem";if(c){b.id=c}if(a){b.frameData=a;b.frameControl=this;b.innerHTML='<img src="'+a.url+'" alt="" class="frameControlImage"></img>';$(b).mouseover(function(d){this.frameControl.onMouseOver(d,this.frameData)});$(b).mouseout(function(d){this.frameControl.onMouseOut(d,this.frameData)});$(b).click(function(d){this.frameControl.onClick(d,this.frameData)})}return b},onMouseOver:function(b,a){if(this.highResFrames){var c=this.highResFrames["frame_"+a.time];if(c){this.showHiResFrame(c)}}},onMouseOut:function(b,a){this.removeHiResFrame()},onClick:function(b,a){paella.events.trigger(paella.events.seekToTime,{time:a.time+1})},onTimeUpdate:function(b){var c=null;for(var a=0;a<this.frames.length;++a){if(this.frames[a].frameData.time<=b){c=this.frames[a]}else{break}}if(this.currentFrame!=c){if(this.currentFrame){this.currentFrame.className="frameControlItem"}this.currentFrame=c;this.currentFrame.className="frameControlItem current"}}});paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin();paella.plugins.PlayPauseButtonPlugin=Class.create(paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"PlayPauseButtonPlugin"},setup:function(){var a=this;paella.events.bind(paella.events.play,function(b){a.changeSubclass(a.pauseSubclass)});paella.events.bind(paella.events.pause,function(b){a.changeSubclass(a.playSubclass)})},action:function(a){if(paella.player.videoContainer.paused()){paella.events.trigger(paella.events.play)}else{paella.events.trigger(paella.events.pause)}}});paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin();paella.plugins.PlayButtonOnScreen=Class.create(paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:true,isPlaying:false,initPlugin:function(){this.container=document.createElement("div");this.container.className="playButtonOnScreen";this.container.id=this.containerId;paella.player.videoContainer.domElement.appendChild(this.container);var b=this;$(this.container).click(function(d){b.onPlayButtonClick()});var c=document.createElement("canvas");c.className="playButtonOnScreenIcon";c.setAttribute("width",300);c.setAttribute("height",300);var a=c.getContext("2d");a.beginPath();a.arc(150,150,140,0,2*Math.PI,true);a.closePath();a.strokeStyle="white";a.lineWidth=10;a.stroke();a.fillStyle="#8f8f8f";a.fill();a.beginPath();a.moveTo(100,70);a.lineTo(250,150);a.lineTo(100,230);a.lineTo(100,70);a.closePath();a.fillStyle="white";a.fill();a.stroke();this.container.appendChild(c)},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor,paella.events.loadComplete]},onEvent:function(a,b){switch(a){case paella.events.loadComplete:this.initPlugin();break;case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor();break}},onPlayButtonClick:function(){$(document).trigger(paella.events.play)},endVideo:function(){this.isPlaying=false;this.checkStatus()},play:function(){this.isPlaying=true;this.checkStatus()},pause:function(){this.isPlaying=false;this.checkStatus()},showEditor:function(){this.enabled=false;this.checkStatus()},hideEditor:function(){this.enabled=true;this.checkStatus()},checkStatus:function(){if((this.enabled&&this.isPlaying)||!this.enabled){$(this.container).hide()}else{$(this.container).show()}},checkEnabled:function(a){a(true)},getIndex:function(){return 1010},getName:function(){return"PlayButtonOnScreen"}});new paella.plugins.PlayButtonOnScreen();paella.plugins.ViewModePlugin=Class.create(paella.ButtonPlugin,{buttonItems:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 101},getMinWindowSize:function(){return 300},getName:function(){return"ViewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(a){a(!paella.player.videoContainer.isMonostream)},buildContent:function(b){var a=this;this.buttonItems={};paella.Profiles.loadProfileList(function(c){for(var e in c){var f=c[e];var d=a.getProfileItemButton(e,f);a.buttonItems[e]=d;b.appendChild(d)}})},getProfileItemButton:function(a,c){var b=document.createElement("div");b.className=this.getButtonItemClass(a,false);b.id=a+"_button";b.data={profile:a,profileData:c,plugin:this};$(b).click(function(d){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)});return b},onItemClick:function(b,c,d){var a=this.buttonItems[paella.player.selectedProfile];var e=this.buttonItems[c];if(e&&a!=e){a.className=this.getButtonItemClass(paella.player.selectedProfile,false);e.className=this.getButtonItemClass(c,true);paella.events.trigger(paella.events.setProfile,{profileName:c});paella.events.trigger(paella.events.hidePopUp,{identifier:this.getName()})}},getButtonItemClass:function(b,a){return"viewModeItemButton "+b+((a)?" selected":"")}});paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin();